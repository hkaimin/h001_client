var __reflect=this&&this.__reflect||function(e,t,i){e.__class__=t,i?i.push(t):i=[t],e.__types__=e.__types__?i.concat(e.__types__):i},__extends=this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);i.prototype=t.prototype,e.prototype=new i},__awaiter=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))(function(o,s){function a(e){try{r(n.next(e))}catch(t){s(t)}}function l(e){try{r(n["throw"](e))}catch(t){s(t)}}function r(e){e.done?o(e.value):new i(function(t){t(e.value)}).then(a,l)}r((n=n.apply(e,t||[])).next())})},__generator=this&&this.__generator||function(e,t){function i(e){return function(t){return n([e,t])}}function n(i){if(o)throw new TypeError("Generator is already executing.");for(;r;)try{if(o=1,s&&(a=s[2&i[0]?"return":i[0]?"throw":"next"])&&!(a=a.call(s,i[1])).done)return a;switch(s=0,a&&(i=[0,a.value]),i[0]){case 0:case 1:a=i;break;case 4:return r.label++,{value:i[1],done:!1};case 5:r.label++,s=i[1],i=[0];continue;case 7:i=r.ops.pop(),r.trys.pop();continue;default:if(a=r.trys,!(a=a.length>0&&a[a.length-1])&&(6===i[0]||2===i[0])){r=0;continue}if(3===i[0]&&(!a||i[1]>a[0]&&i[1]<a[3])){r.label=i[1];break}if(6===i[0]&&r.label<a[1]){r.label=a[1],a=i;break}if(a&&r.label<a[2]){r.label=a[2],r.ops.push(i);break}a[2]&&r.ops.pop(),r.trys.pop();continue}i=t.call(e,r)}catch(n){i=[6,n],s=0}finally{o=a=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}var o,s,a,l,r={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return l={next:i(0),"throw":i(1),"return":i(2)},"function"==typeof Symbol&&(l[Symbol.iterator]=function(){return this}),l},ResourceUtils=function(){function e(){this._groupIndex=0,this._configs=new Array,this._groups={},RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceLoadProgress,this),RES.addEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this)}return e.prototype.addConfig=function(e,t){this._configs.push([e,t])},e.prototype.loadConfig=function(e,t){this._onConfigComplete=e,this._onConfigCompleteTarget=t,this.loadNextConfig()},e.prototype.loadNextConfig=function(){if(0==this._configs.length)return this._onConfigComplete.call(this._onConfigCompleteTarget),this._onConfigComplete=null,void(this._onConfigCompleteTarget=null);var e=this._configs.shift();RES.addEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigCompleteHandle,this),RES.loadConfig(e[0],e[1])},e.prototype.onConfigCompleteHandle=function(e){RES.removeEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigCompleteHandle,this),this.loadNextConfig()},e.prototype.loadGroup=function(e,t,i,n){this._groups[e]=[t,i,n],RES.loadGroup(e)},e.prototype.loadGroups=function(e,t,i,n,o){RES.createGroup(e,t,!0),this.loadGroup(e,i,n,o)},e.prototype.pilfererLoadGroup=function(e,t){void 0===t&&(t=null);var i="pilferer_"+e;t||(t=[e]),RES.createGroup(i,t,!0),RES.loadGroup(i,-1)},e.prototype.onResourceLoadComplete=function(e){var t=e.groupName;if(this._groups[t]){var i=this._groups[t][0],n=this._groups[t][2];null!=i&&i.call(n),this._groups[t]=null,delete this._groups[t]}},e.prototype.onResourceLoadProgress=function(e){var t=e.groupName;if(this._groups[t]){var i=this._groups[t][1],n=this._groups[t][2];null!=i&&i.call(n,e.itemsLoaded,e.itemsTotal)}},e.prototype.onResourceLoadError=function(e){egret.error(e.groupName+"资源组有资源加载失败"),this.onResourceLoadComplete(e)},e.prototype.loadResource=function(e,t,i,n,o){void 0===e&&(e=[]),void 0===t&&(t=[]),void 0===i&&(i=null),void 0===n&&(n=null),void 0===o&&(o=null);var s=e.concat(t),a="loadGroup"+this._groupIndex++;RES.createGroup(a,s,!0),this._groups[a]=[i,n,o],RES.loadGroup(a)},e}();__reflect(ResourceUtils.prototype,"ResourceUtils");var WebSocketUtil=function(e){function t(t){var i=e.call(this)||this;return i.zipAndAes=!0,i.ip="119.91.155.74",i.ipUrl="wss://login2.joyfulh.com:441",i.zipPort=18024,i.freePort=8011,i.sCurData="",i.text="TestWebSocket",i.protoId=1,i.sCurData=t,i.initWebSocket(),i.timer=new egret.Timer(3e4,0),i.timer.addEventListener(egret.TimerEvent.TIMER,i.timerFunc,i),i.timer.addEventListener(egret.TimerEvent.TIMER_COMPLETE,i.timerComFunc,i),i.timer.start(),i}return __extends(t,e),t.prototype.socketConnect=function(){this.zipAndAes?1==ConstValue.p_LOGIN_MODEL?this.socket.connect(this.ip,this.zipPort):2==ConstValue.p_LOGIN_MODEL&&this.socket.connectByUrl(this.ipUrl):this.socket.connect(this.ip,this.freePort)},t.prototype.timerFunc=function(){if(CommonTools.log("计时"),this.socket.connected){var e=new egret.ByteArray;e.writeByte(0),e.writeByte(0),e.position=0,this.socket.writeBytes(e,0,e.bytesAvailable),CommonTools.log("======heart beat==========sendData... "+e.bytesAvailable+" byte.toString:"+this.Bytes2Str(e.bytes))}else t.reloginCnt++,this.socketConnect()},t.prototype.timerComFunc=function(){CommonTools.log("计时结束")},t.prototype.initStateText=function(){this.stateText=new egret.TextField,this.stateText.size=22,this.stateText.text=this.text,this.stateText.width=480,this.addChild(this.stateText)},t.prototype.initWebSocket=function(){CommonTools.log("==============initWebSocket"),this.socket=new egret.WebSocket,this.socket.type=egret.WebSocket.TYPE_BINARY,this.socket.addEventListener(egret.ProgressEvent.SOCKET_DATA,this.onReceiveMessage,this),this.socket.addEventListener(egret.Event.CONNECT,this.onSocketOpen,this),this.socket.addEventListener(egret.Event.CLOSE,this.onSocketClose,this),this.socket.addEventListener(egret.IOErrorEvent.IO_ERROR,this.onSocketError,this),this.socketConnect()},t.prototype.trim=function(e){return e.replace(/(^\s*)|(\s*$)/g,"")},t.prototype.makeJsonObj=function(e){var t=e.replace(/{/g,"").replace(/}/g,""),i=t.split(","),n={};for(var o in i){var s=i[o].split(":");n[s[0]]=s[1]}},t.prototype.handleRecJsonStr=function(e){try{var i=JSON.parse(e);switch(i.f){case"scrollNotice":ConstValue.sysTips=i.d.lInfo;break;case"rf_scrollNotice":ConstValue.oneTipsCnt++,ConstValue.oneTips[ConstValue.oneTipsCnt]=i.d.sInfo;break;case"reflashsimple":ConstValue.cacheUserInfo.curexp=i.d.curexp,ConstValue.cacheUserInfo.lv=i.d.lv,ConstValue.cacheUserInfo.coin=i.d.coin,ConstValue.cacheUserInfo.diamond=i.d.diamond,ConstValue.cacheUserInfo.maxExp=i.d.exp,null!=ConstValue.P_HALL_OBJ&&ConstValue.P_HALL_OBJ.updateCoin();break;case"register":case"login":case"entergame":case"loginWX":ConstValue.P_LOGIN_OBJ.handlePacket(i);break;case"WaitingInfo":case"syncMapData":null!=ConstValue.P_HALL_OBJ?ConstValue.P_HALL_OBJ.handlePacket(i):(null==ConstValue.P_FIGHT_OBJ&&(ConstValue.P_FIGHT_OBJ=new FightingModule(ConstValue.P_CONTEXT)),ConstValue.P_FIGHT_OBJ.handlePacket(i));break;case"gmFunc":case"contract":case"openRnakUI":case"getTotalPvpRank":case"getTotalLvRank":case"getTotalGuankaRank":case"openDiyMapUI":case"openShopUI":case"openBagUI":case"Buy":case"C2GOpenWujinUI":case"SeventDayReward":case"open1V1Room":case"open1V1RoomByMap":case"showMatch1v1RoomUI":case"Room1v1Dismiss":case"showAllClassList":case"reflashClassList":case"showUpgradeReward":case"getRoleDetail":case"getBarrierInfo":case"C2G_Open_MainUI":case"reflashRoleData":case"G2C_getWXInfo":case"saveWXInfo":case"getHelp":case"getGonggao":case"getPvpRankThree":case"AddMainCoin":case"AddSubCoin":case"createNft":case"getNftMarket":case"getOwnNft":case"SellNft":case"BuyNft":if("SeventDayReward"==i.f&&!HallModule.isSafeArea)return;null!=ConstValue.P_HALL_OBJ?ConstValue.P_HALL_OBJ.handlePacket(i):FightingModule.Delay(2e3,function(){try{ConstValue.P_HALL_OBJ.handlePacket(i)}catch(e){CommonTools.log("handleRecJsonStr====error====="+e)}},this);break;case"GuildInfo":HallModule.curGuide=i.d.id,null!=ConstValue.P_FIGHT_OBJ?3==i.d.id&&ConstValue.P_FIGHT_OBJ.handlePacket(i):null!=ConstValue.P_HALL_OBJ?3!=i.d.id&&ConstValue.P_HALL_OBJ.handlePacket(i):null==ConstValue.P_HALL_OBJ&&FightingModule.Delay(2e3,function(){try{3!=i.d.id&&ConstValue.P_HALL_OBJ.handlePacket(i)}catch(e){CommonTools.log("handleRecJsonStr====error====="+e)}},this);break;case"pushBtnData":HallModule.pushBtnData=i.d;break;case"refreshInfo":null!=ConstValue.cacheUserInfo&&(ConstValue.cacheUserInfo=i.d);break;case"notify":null!=ConstValue.P_LOGIN_OBJ&&ConstValue.P_LOGIN_OBJ.addCommonTips(i.d.tips),null!=ConstValue.P_HALL_OBJ&&ConstValue.P_HALL_OBJ.addCommonTips(i.d.tips),null!=ConstValue.P_FIGHT_OBJ&&ConstValue.P_FIGHT_OBJ.addCommonTips(i.d.tips),null!=ConstValue.P_MAP_OBJ&&ConstValue.P_MAP_OBJ.addCommonTips(i.d.tips);break;case"syncPosBroadcase":case"syncPut":case"syncBoomZhuan":case"syncpickItem":case"gameResult":case"gameGuanKaResult":case"useSkillOK":case"syncKillMst":ConstValue.P_FIGHT_OBJ.handlePacket(i);break;case"getMyMaps":null==ConstValue.P_MAP_OBJ?ConstValue.P_HALL_OBJ.handlePacket(i):ConstValue.P_MAP_OBJ.handlePacket(i);break;case"saveMap":case"getNewRank":case"getHopRank":ConstValue.P_MAP_OBJ.handlePacket(i);break;case"relogin":t.closeFlag=!1}}catch(n){CommonTools.log("handleRecJsonStr====error====="+e),CommonTools.log("handleRecJsonStr====error====="+n)}},t.prototype.out_relogin=function(){if(t.reloginCnt>=5&&!this.socket.connected)return void this.outLogin();if(t.reloginCnt>=5&&this.socket.connected&&t.closeFlag)return void this.outLogin();ConstValue.P_HALL_OBJ?ConstValue.P_NET_OBJ.relogin():ConstValue.P_NET_OBJ.relogin2();var e="网络重试:"+t.reloginCnt+"/5";null!=ConstValue.P_LOGIN_OBJ&&ConstValue.P_LOGIN_OBJ.addCommonTips(e),null!=ConstValue.P_HALL_OBJ&&ConstValue.P_HALL_OBJ.addCommonTips(e),null!=ConstValue.P_FIGHT_OBJ&&ConstValue.P_FIGHT_OBJ.addCommonTips(e),null!=ConstValue.P_MAP_OBJ&&ConstValue.P_MAP_OBJ.addCommonTips(e)},t.prototype.sendData=function(e){if(this.sCurData=e,!this.socket.connected)return void FightingModule.Delay(2e3,function(){CommonTools.log("----sendData--------reloginCnt-----"+t.reloginCnt),this.socketConnect(),this.out_relogin()},this);t.closeFlag&&(FightingModule.Delay(2e3,function(){CommonTools.log("----sendData--------reloginCnt-----"+t.reloginCnt),this.out_relogin()},this),this.sCurData=CommonTools.getDataJsonStr("relogin",1,{pid:ConstValue.cacheUserInfo.id,token:ConstValue.cacheUserInfo.token}));var i=function(e){return new Blob([e]).size};if(CommonTools.log(" ====11111 "+this.bToString(this.stringToByte(e))),this.zipAndAes){var n=new egret.ByteArray;n.endian=egret.Endian.LITTLE_ENDIAN,n.writeByte(0),n.writeByte(0),n.writeByte(1),this.protoId+=1,n.writeUnsignedShort(this.protoId),n.endian=egret.Endian.BIG_ENDIAN;for(var o=this.stringToByte(e),s=0;s<o.length;s++)n.writeByte(o[s]);n.position=0;var a=JSZip.compressions.DEFLATE.compressgzip(n.bytes,{level:6}),l=new egret.ByteArray;l._writeUint8Array(a),l.position=0;var r=new egret.ByteArray;r.endian=egret.Endian.LITTLE_ENDIAN,r.writeUnsignedShort(l.bytesAvailable),n.endian=egret.Endian.BIG_ENDIAN,r.writeBytes(l),r.position=0,this.socket.writeBytes(r,0,r.bytesAvailable)}else{var n=new egret.ByteArray;n.endian=egret.Endian.LITTLE_ENDIAN,n.writeUnsignedShort(i(e)+5),n.writeByte(0),n.writeByte(0),n.writeByte(1),this.protoId+=1,n.writeUnsignedShort(this.protoId),n.endian=egret.Endian.BIG_ENDIAN,n.writeUTFBytes(e),n.position=0,this.socket.writeBytes(n,0,n.bytesAvailable)}this.sCurData=""},t.prototype.sendData2=function(e){if(this.sCurData=e,!this.socket.connected)return void FightingModule.Delay(1e3,function(){this.socketConnect(),this.out_relogin()},this);t.closeFlag&&(FightingModule.Delay(1e3,function(){CommonTools.log("----sendData--------reloginCnt-----"+t.reloginCnt),this.out_relogin()},this),this.sCurData=CommonTools.getDataJsonStr("relogin",1,{pid:ConstValue.cacheUserInfo.id,token:ConstValue.cacheUserInfo.token}));var i=function(e){return new Blob([e]).size};if(CommonTools.log(" ====11111 "+this.bToString(this.stringToByte(e))),this.zipAndAes){var n=new egret.ByteArray;n.endian=egret.Endian.LITTLE_ENDIAN,n.writeByte(0),n.writeByte(1),n.writeByte(1),this.protoId+=1,n.writeUnsignedShort(this.protoId),n.endian=egret.Endian.BIG_ENDIAN;for(var o=this.stringToByte(e),s=0;s<o.length;s++)n.writeByte(o[s]);n.position=0;var a=JSZip.compressions.DEFLATE.compressgzip(n.bytes,{level:6}),l=new egret.ByteArray;l._writeUint8Array(a),l.position=0;var r=new egret.ByteArray;r.endian=egret.Endian.LITTLE_ENDIAN,r.writeUnsignedShort(l.bytesAvailable),n.endian=egret.Endian.BIG_ENDIAN,r.writeBytes(l),r.position=0,this.socket.writeBytes(r,0,r.bytesAvailable)}else{var n=new egret.ByteArray;n.endian=egret.Endian.LITTLE_ENDIAN,n.writeUnsignedShort(i(e)+5),n.writeByte(0),n.writeByte(1),n.writeByte(1),this.protoId+=1,n.writeUnsignedShort(this.protoId),n.endian=egret.Endian.BIG_ENDIAN,n.writeUTFBytes(e),n.position=0,this.socket.writeBytes(n,0,n.bytesAvailable)}this.sCurData=""},t.prototype.Bytes2Str=function(e){for(var t="",i=0;i<e.length;i++){var n=e[i].toString(16);1==n.length&&(n="0"+n),t+=i==e.length-1?n:n+"-"}return t},t.prototype.Bytes2Str2=function(e){for(var t="",i=0;i<e.length;i++)t+=i==e.length-1?e[i]+"":e[i]+"-";return t},t.prototype.Bytes2StrNoFix=function(e){for(var t="",i=0;i<e.length;i++){var n=e[i].toString(16);1==n.length&&(n="0"+n),t+=n}return t},t.prototype.stringToByte=function(e){var t,i,n=new Array;t=e.length;for(var o=0;t>o;o++)i=e.charCodeAt(o),i>=65536&&1114111>=i?(n.push(i>>18&7|240),n.push(i>>12&63|128),n.push(i>>6&63|128),n.push(63&i|128)):i>=2048&&65535>=i?(n.push(i>>12&15|224),n.push(i>>6&63|128),n.push(63&i|128)):i>=128&&2047>=i?(n.push(i>>6&31|192),n.push(63&i|128)):n.push(255&i);return n},t.prototype.bToString=function(e){if("string"==typeof e)return e;for(var t="",i=e,n=0;n<i.length;n++){var o=i[n].toString(2),s=o.match(/^1+?(?=0)/);if(s&&8==o.length){for(var a=s[0].length,l=i[n].toString(2).slice(7-a),r=1;a>r;r++)l+=i[r+n].toString(2).slice(2);t+=String.fromCharCode(parseInt(l,2)),n+=a-1}else t+=String.fromCharCode(i[n])}return t},t.prototype.outLogin=function(){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),t.closeFlag=!1,t.reloginCnt=0,this.timer.stop(),null!=this.socket&&(this.socket.removeEventListener(egret.ProgressEvent.SOCKET_DATA,this.onReceiveMessage,this),this.socket.removeEventListener(egret.Event.CONNECT,this.onSocketOpen,this),this.socket.removeEventListener(egret.Event.CLOSE,this.onSocketClose,this),this.socket.removeEventListener(egret.IOErrorEvent.IO_ERROR,this.onSocketError,this),this.socket=null),null!=ConstValue.P_HALL_OBJ&&(ConstValue.P_HALL_OBJ.clear(),ConstValue.P_HALL_OBJ=null),null!=ConstValue.P_FIGHT_OBJ&&ConstValue.P_FIGHT_OBJ.clear2(),ConstValue.P_NET_OBJ=null,ConstValue.cacheHasLoginSuccess=!1,ConstValue.cacheUserInfo=null,[4,ConstValue.P_CONTEXT.loadResource("pre_preload",1)];case 1:return i.sent(),[3,3];case 2:return e=i.sent(),CommonTools.log("outLogin-----------back console"),CommonTools.logError(e),[3,3];case 3:return[2]}})})},t.prototype.relogin=function(){t.reloginCnt++;var e=CommonTools.getDataJsonStr("relogin",1,{pid:ConstValue.cacheUserInfo.id,token:ConstValue.cacheUserInfo.token});this.sendData(e)},t.prototype.relogin2=function(){t.reloginCnt++;var e=CommonTools.getDataJsonStr("relogin",1,{pid:ConstValue.cacheUserInfo.id,token:ConstValue.cacheUserInfo.token});this.sendData2(e)},t.prototype.onSocketOpen=function(){t.reloginCnt=0,CommonTools.log("================onSocketOpen..."),""!=this.sCurData&&this.sendData(this.sCurData)},t.prototype.onSocketClose=function(){t.closeFlag=!0,CommonTools.log("------onSocketClose "),this.socketConnect(),this.out_relogin()},t.prototype.onSocketError=function(){CommonTools.log("------onSocketError")},t.prototype.onReceiveMessage=function(e){var t=new egret.ByteArray;if(this.socket.readBytes(t),t.length>2){t.endian=egret.Endian.LITTLE_ENDIAN;var i=t.readShort();if(this.zipAndAes){for(var n=new egret.ByteArray,o=2;o<t.bytes.length;o++)n.writeByte(t.bytes[o]);n.position=0;var s=SnappyJS.uncompress(n.bytes),a=new egret.ByteArray(s);a.endian=egret.Endian.LITTLE_ENDIAN;a.readByte(),a.readByte(),a.readByte(),a.readShort();a.endian=egret.Endian.BIG_ENDIAN;var l=a.readUTFBytes(a.bytesAvailable);CommonTools.log("------onReceiveMessage 收到数据:"+l),this.handleRecJsonStr(l)}else{t.readByte(),t.readByte(),t.readShort();t.endian=egret.Endian.BIG_ENDIAN;var l=t.readUTFBytes(t.bytesAvailable);CommonTools.log("------onReceiveMessage 收到数据:"+l),CommonTools.log("------onReceiveMessage 收到数据: iLen "+i)}}else CommonTools.log("------onReceiveMessage length<=2---")},t.prototype.trace=function(e){this.text=this.text+"\n"+e,this.stateText.text=this.text,egret.log(e)},t.reloginCnt=0,t.closeFlag=!1,t}(egret.DisplayObjectContainer);__reflect(WebSocketUtil.prototype,"WebSocketUtil");var Main=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.isLoaded=!1,t.dDataInfo=null,t.dDataInfo2=null,t}return __extends(t,e),t.prototype.createChildren=function(){e.prototype.createChildren.call(this),egret.lifecycle.addLifecycleListener(function(e){CommonTools.log("===========onPause 1")}),egret.lifecycle.onPause=function(){CommonTools.log("===========onPause 2")},egret.lifecycle.onResume=function(){egret.ticker.resume(),null==ConstValue.cacheUserInfo||ConstValue.P_NET_OBJ.socket.connected||(ConstValue.P_NET_OBJ.socketConnect(),ConstValue.P_NET_OBJ.out_relogin(),CommonTools.log("-----resumeresumeresumeresume1-------------------")),null!=ConstValue.cacheUserInfo&&ConstValue.P_NET_OBJ.socket.connected&&WebSocketUtil.closeFlag&&(CommonTools.log("-----resumeresumeresumeresume2-------------------"),ConstValue.P_NET_OBJ.out_relogin()),CommonTools.log("===========onResume"),CommonAudioHandle.curPlayName="",null==ConstValue.P_LOGIN_OBJ&&CommonAudioHandle.play("mainmenu_mp3",0)},egret.ImageLoader.crossOrigin="anonymous";var t=new AssetAdapter;egret.registerImplementation("eui.IAssetAdapter",t),egret.registerImplementation("eui.IThemeAdapter",new ThemeAdapter),this.runGame()["catch"](function(e){CommonTools.log(e)})},t.prototype.runGame=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return 1!=ConstValue.p_LOGIN_MODEL?[3,2]:[4,this.loadResource("pre_preload",1)];case 1:return e.sent(),[3,4];case 2:return 2!=ConstValue.p_LOGIN_MODEL?[3,4]:[4,this.loadResourceStart("pre_preload",1)];case 3:e.sent(),e.label=4;case 4:return[2]}})})},t.prototype.doNext=function(e){return __awaiter(this,void 0,void 0,function(){var t,t;return __generator(this,function(i){switch(i.label){case 0:return null==ConstValue.P_CONTEXT&&(ConstValue.P_CONTEXT=this),this.stage.removeChild(this.loadingView),this.loadingView=null,1!=e?[3,1]:(ConstValue.P_LOGIN_OBJ=new LoginModule(this),[3,8]);case 1:return 2!=e?[3,2]:(ConstValue.P_HALL_OBJ=new HallModule(this),[3,8]);case 2:return 3!=e?[3,3]:(ConstValue.P_IS_DEBUG||(t=CommonTools.getDataJsonStr("enterPPRoom",1,{}),ConstValue.P_NET_OBJ.sendData(t)),[3,8]);case 3:return 4!=e?[3,4]:(ConstValue.P_IS_DEBUG||(t=CommonTools.getDataJsonStr("openDiyMapUI",1,{theme:1}),ConstValue.P_NET_OBJ.sendData(t)),[3,8]);case 4:return 5!=e?[3,5]:(ConstValue.P_IS_DEBUG,[3,8]);case 5:return 6!=e?[3,6]:(ConstValue.P_IS_DEBUG||(null==ConstValue.P_FIGHT_OBJ&&(ConstValue.P_FIGHT_OBJ=new FightingModule(this)),ConstValue.P_FIGHT_OBJ.initMapData(this.dDataInfo),FightingModule.readyTwo&&!FightingModule.readyRes&&(ConstValue.P_FIGHT_OBJ.releaseVsPanel(),ConstValue.P_FIGHT_OBJ.updateInfo(this.dDataInfo2))),[3,8]);case 6:return 7!=e?[3,8]:[4,this.loadResource("preloadHall",2)];case 7:i.sent(),i.label=8;case 8:return[2]}})})},t.prototype.loadResource=function(e,t){return __awaiter(this,void 0,void 0,function(){var i;return __generator(this,function(n){switch(n.label){case 0:return n.trys.push([0,5,,6]),("fighting"==e||"diymap"==e)&&(HallModule.isSafeArea=!1),this.loadingView=new LoadingUI(this.stage.stageWidth,this.stage.stageHeight,this),this.stage.addChildAt(this.loadingView,1),this.isLoaded?[3,1]:(1==ConstValue.p_LOGIN_MODEL?CommonTools.resourceMgr.addConfig(PathUtils.RESOURC+PathUtils.Version_Default_Res,PathUtils.RESOURC):2==ConstValue.p_LOGIN_MODEL&&(CommonTools.resourceMgr.addConfig(PathUtils.RESOURCSUB1+PathUtils.Version_SUBPACK1_Res,PathUtils.RESOURCSUB1),CommonTools.resourceMgr.addConfig(PathUtils.RESOURCSUB2+PathUtils.Version_SUBPACK2_Res,PathUtils.RESOURCSUB2)),CommonTools.resourceMgr.loadConfig(this.onLoginConfigComplete,this),[3,4]);case 1:return null!=ConstValue.cacheKeyGroup[e]?[3,3]:[4,RES.loadGroup(e,0,this.loadingView)];case 2:n.sent(),ConstValue.cacheKeyGroup[e]=1,n.label=3;case 3:ConstValue.P_IS_DEBUG&&this.stage.removeChild(this.loadingView),this.doNext(t),n.label=4;case 4:return[3,6];case 5:return i=n.sent(),console.error(i),[3,6];case 6:return[2]}})})},t.prototype.onLoginConfigComplete=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return 1!=ConstValue.p_LOGIN_MODEL?[3,3]:[4,this.loadTheme()];case 1:return e.sent(),[4,RES.loadGroup("pre_preload",0,this.loadingView)];case 2:return e.sent(),this.isLoaded=!0,ConstValue.cacheKeyGroup.preload=1,this.doNext(1),[3,5];case 3:return 2!=ConstValue.p_LOGIN_MODEL?[3,5]:[4,RES.loadGroup("sub1preload",0,this.loadingView)];case 4:e.sent(),this.isLoaded=!0,ConstValue.cacheKeyGroup.sub1preload=1,this.doNext(7),e.label=5;case 5:return[2]}})})},t.prototype.loadResourceStart=function(e,t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){try{this.loadingView=new LoadingUI(this.stage.stageWidth,this.stage.stageHeight,this),this.stage.addChildAt(this.loadingView,1),CommonTools.resourceMgr.addConfig(PathUtils.RESOURC+PathUtils.Version_Default_Res,PathUtils.RESOURC),CommonTools.resourceMgr.loadConfig(this.onLoginConfigCompleteStart,this)}catch(t){console.error(t)}return[2]})})},t.prototype.onLoginConfigCompleteStart=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return[4,this.loadTheme()];case 1:return e.sent(),[4,RES.loadGroup("pre_preload",0,this.loadingView)];case 2:return e.sent(),ConstValue.cacheKeyGroup.preload=1,this.doNext(1),[2]}})})},t.prototype.loadResourceBlackground=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return CommonTools.log("loadBlackGround=================2"),[4,RES.loadGroup(e,0,null)];case 1:return t.sent(),CommonTools.log("loadBlackGround=================2_1"),[2]}})})},t.prototype.addBackGround=function(e){var t=this.createBitmapByName(e),i=this.stage.stageWidth;this.stage.stageHeight;t.width=i;var n=1334/i;return t.height=750/n,t},t.prototype.getStageWidth=function(){return this.stage.stageWidth},t.prototype.getStageHeight=function(){return this.stage.stageHeight},t.prototype.getClientWidth=function(){return document.documentElement.clientWidth},t.prototype.getClientHeight=function(){return document.documentElement.clientHeight},t.prototype.loadTheme=function(){var e=this;return new Promise(function(t,i){var n=new eui.Theme(PathUtils.RESOURC+PathUtils.Version_Default_Thm,e.stage);n.addEventListener(eui.UIEvent.COMPLETE,function(){t()},e)})},t.prototype.createGameScene=function(){var e=this.stage.stageWidth;this.stage.stageHeight;this.addChild(this.addBackGround("bg_jpg"));var t=new egret.Shape;t.graphics.beginFill(0,.5),t.graphics.drawRect(0,0,e,172),t.graphics.endFill(),t.y=33,this.addChild(t);var i=this.createBitmapByName("egret_icon_png");this.addChild(i),i.x=26,i.y=33;var n=new egret.Shape;n.graphics.lineStyle(2,16777215),n.graphics.moveTo(0,0),n.graphics.lineTo(0,117),n.graphics.endFill(),n.x=172,n.y=61,this.addChild(n);var o=new egret.TextField;o.textColor=16777215,o.width=e-172,o.textAlign="center",o.text="Hello Egret",o.size=24,o.x=172,o.y=80,this.addChild(o);var s=new egret.TextField;this.addChild(s),s.alpha=0,s.width=e-172,s.textAlign=egret.HorizontalAlign.CENTER,s.size=24,s.textColor=16777215,s.x=172,s.y=135,this.textfield=s;var a=new eui.Button;a.label="Click!",a.horizontalCenter=0,a.verticalCenter=0,this.addChild(a),a.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onButtonClick,this),CommonTools.log("createGameScene=============done")},t.prototype.createBitmapByName=function(e){var t=new egret.Bitmap,i=RES.getRes(e);return t.texture=i,t},t.prototype.startAnimation=function(e){var t=this,i=new egret.HtmlTextParser,n=e.map(function(e){return i.parse(e)}),o=this.textfield,s=-1,a=function(){s++,s>=n.length&&(s=0);var e=n[s];o.textFlow=e;var i=egret.Tween.get(o);i.to({alpha:1},200),i.wait(2e3),i.to({alpha:0},200),i.call(a,t)};a()},t.getResUtil=function(e){return RES.getRes(e)},t.prototype.onButtonClick=function(e){var t=new eui.Panel;t.title="Title",t.horizontalCenter=0,t.verticalCenter=0,this.addChild(t)},t.roomkey=null,t}(eui.UILayer);__reflect(Main.prototype,"Main");var DebugPlatform=function(){function e(){}return e.prototype.getUserInfo=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2,{nickName:"username"}]})})},e.prototype.login=function(){return __awaiter(this,void 0,void 0,function(){var e,t;return __generator(this,function(i){switch(i.label){case 0:return[4,window.ethereum.request({method:"eth_requestAccounts"})];case 1:return e=i.sent(),t=e[0],[2,t]}})})},e.prototype.connectWallet=function(){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(t){return e=!1,"undefined"!=typeof window.ethereum&&(e=!0),[2,e]})})},e.prototype.initSOL=function(){ContractSol.hweb3=new Web3(window.ethereum)},e.prototype.updateInfo=function(e){},e.prototype.shareAppMessage=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return CommonTools.log("-------DebugPlatform------shareAppMessage"),[2]})})},e.prototype.shareWinAppMessage=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return CommonTools.log("-------DebugPlatform------shareWinAppMessage"),[2]})})},e.prototype.showShareMenu=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return CommonTools.log("-------DebugPlatform------showShareMenu"),[2]})})},e.prototype.onWxShow=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return CommonTools.log("-------DebugPlatform------onWxShow"),[2]})})},e}();__reflect(DebugPlatform.prototype,"DebugPlatform",["Platform"]),window.platform||(window.platform=new DebugPlatform);var ThemeAdapter=function(){function e(){}return e.prototype.getTheme=function(e,t,i,n){function o(e){t.call(n,e)}function s(t){t.resItem.url==e&&(RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,s,null),i.call(n))}var a=this;"undefined"!=typeof generateEUI?egret.callLater(function(){t.call(n,generateEUI)},this):"undefined"!=typeof generateEUI2?RES.getResByUrl("resource/gameEui.bin",function(e,i){window.JSONParseClass.setData(e),o(e),egret.callLater(function(){t.call(n,generateEUI2)},a)},this,RES.ResourceItem.TYPE_BIN):(RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,s,null),RES.getResByUrl(e,o,this,RES.ResourceItem.TYPE_TEXT))},e}();__reflect(ThemeAdapter.prototype,"ThemeAdapter",["eui.IThemeAdapter"]);var CommonAudioHandle=function(){function e(){}return e.play=function(t,i){if(ConstValue.musicOpen&&"1"!=egret.localStorage.getItem("noVolume")&&t!=e.curPlayName){e.curPlayName=t,null!=e.channel&&e.channel.stop();var n=RES.getRes(t);n.type=egret.Sound.MUSIC,e.channel=n.play(0,i)}},e.stopPlay=function(){null!=e.channel&&e.channel.stop()},e.setVolume=function(t){null!=e.channel&&(e.channel.volume=t)},e.playEffect=function(e,t){if(ConstValue.musicOpen&&"1"!=egret.localStorage.getItem("noVolume")){var i=RES.getRes(e);i.play(0,t)}},e.stop=function(){null!=e.channel&&(e.channel.stop(),e.channel=null)},e}();__reflect(CommonAudioHandle.prototype,"CommonAudioHandle");var CommonButtonHandle=function(){function e(){}return e.beginTouch=function(t,i){t.addEventListener(egret.TouchEvent.TOUCH_BEGIN,e.onButtonClickBegin,i),t.addEventListener(egret.TouchEvent.TOUCH_END,e.onButtonClickEnd,i),t.addEventListener(egret.TouchEvent.TOUCH_MOVE,e.onButtonClickEnd,i)},e.onButtonClickBegin=function(t){e.scaleXOld=t.target.scaleX,e.scaleYOld=t.target.scaleY,t.target.scaleX*=1.1,t.target.scaleY*=1.1,null==ConstValue.P_LOGIN_OBJ&&CommonAudioHandle.playEffect("playBomb_mp3",1)},e.onButtonClickEnd=function(t){t.target.scaleX=e.scaleXOld,t.target.scaleY=e.scaleYOld},e.scaleXOld=0,e.scaleYOld=0,e}();__reflect(CommonButtonHandle.prototype,"CommonButtonHandle");var CommonTools=function(){function e(){}return e.addShapeBG=function(e,t){var i=new egret.Shape;return i.graphics.beginFill(2301984,.6),i.graphics.drawRect(0,0,e,t),i.graphics.endFill(),i},e.shake=function(e){var t=egret.Tween.get(e,{loop:!0},egret.Ease.sineInOut);t.to({rotation:8},80),t.to({rotation:-8},80),t.to({rotation:8},80),t.to({rotation:-8},80),t.to({rotation:8},80),t.to({rotation:-8},80),t.to({rotation:0},40),t.to({rotation:0},1500)},e.removeShake=function(e){egret.Tween.removeTweens(e)},e.niceTip=function(e,t,i){if(1==t){e.scaleX=.5,e.scaleY=.5;var n=1,o=1;ConstValue.deviveNormalScale>2&&(n=ConstValue.deviveScale,o=ConstValue.deviveScale);var s=egret.Tween.get(e);s.to({scaleX:1,scaleY:1},90),s.to({scaleX:1.05,scaleY:1.05},80),s.to({scaleX:n,scaleY:n},100)}else{var s=egret.Tween.get(e);s.to({scaleX:1.05,scaleY:1.05},100),s.to({scaleX:0,scaleY:0,visible:!1},200),s.call(function(){i.closeNice()},this)}},e.fixFix=function(e,t,i,n,o){var s=750,a=e.getStageHeight(),l=a/s;ConstValue.deviveScale=l;var r=1*e.getClientWidth()/e.getClientHeight();if(ConstValue.deviveNormalScale=r,!(2>r)){var h=0,u=0;if(1==i?h=t.y:2==i?u=s-t.y:3==i&&(u=s-t.y),t.scaleX=l,t.scaleY=l,1==i){var c=(1-l)/2;t.y=h*l+a*c+o,t.x=t.x+n}else if(2==i){var c=(1-l)/2;t.y=a-u*l+a*c+o,t.x=t.x+n}}},e.addCommonTips=function(t,i){e.curTipsLen>=5&&(e.curTipsLen=0);var n=t.stage.stageWidth,o=t.stage.stageHeight,s=new eui.Panel;s.name="tips_panel_"+e.curTipsLen,s.skinName="resource/eui_skins/UserUI/CommonTips.exml";var a=n/2-s.width/2,l=o/2-s.height/2;s.x=a,s.y=l;var r=s.getChildByName("lb_tips_txt");r.text=i,t.addChild(s);var h=function(){"tips_panel_0"==s.name&&(e.curTipsLen=0),t.removeChild(s)},u=l-200+80*e.curTipsLen,c=egret.Tween.get(s);c.to({y:u},500),c.wait(1500-100*e.curTipsLen),c.call(h),e.curTipsLen+=1},e.jumpAnim=function(e){var t=e.scaleX,i=egret.Tween.get(e);i.to({scaleX:2*t,scaleY:2*t},200),i.to({scaleX:t,scaleY:t},200)},e.addTipsPanel=function(t,i,n){var o=t.stage.stageWidth,s=t.stage.stageHeight,a=new eui.Image("guide_mask_png");a.width=o,a.height=s,t.addChild(a);var l=new eui.Panel;l.skinName="resource/eui_skins/UserUI/TipsPanelUI.exml",l.horizontalCenter=0,l.verticalCenter=0,t.addChild(l),e.fixFix(t,l,1,0,0);var r=l.getChildByName("fighting_parent"),h=r.getChildByName("tip_title");h.text=i;var u=r.getChildByName("t_s"),c=u.getChildByName("t_g"),d=c.getChildByName("tip_content");d.text=n,l.getChildByName("btn_close").addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){t.removeChild(a),t.removeChild(l)},this)},e.getDataJsonStr=function(e,t,i){var n={};return n.f=e,n.s=t,n.d=i,JSON.stringify(n)},e.getAnimDraw=function(e,t,i){var n,o=new egret.MovieClipDataFactory(e,t);return n=""==i?new egret.MovieClip(o.generateMovieClipData()):new egret.MovieClip(o.generateMovieClipData(i))},e.deepCopyMap=function(e){var t={};for(var i in e){var n=e[i];t[i]=n}return t},e.printMap=function(e){if(ConstValue.p_is_PRINT_MAP){console.log("-----startMap------");var t=0;for(var i in e){e[i];console.log("-----srcMap--key----"+i),t++}console.log("-----endMap------len:"+t)}},e.printObject=function(e){var t="";for(var i in e){var n=e[i];t+=i+" = "+n+"\n"}console.log("-----printObject------description:"+t)},e.getRandomFloor=function(e,t){return t?Math.floor(Math.random()*e):Math.floor(Math.random()*e==0?1:Math.random()*e)},e.log=function(e){ConstValue.P_IS_INNER&&console.log(e)},e.logError=function(e){ConstValue.p_is_PRINT_ERROR&&console.log(e)},e.logDebug=function(e){ConstValue.p_is_PRINT_DEBUG&&console.log(e)
},e.logAI=function(e){ConstValue.p_is_PRINT_AI&&console.log(e)},e.logAIPath=function(e){ConstValue.p_is_PRINT_AI_PATH&&console.log(e)},e.logWallet=function(e){ConstValue.p_is_PRINT_WALLET_DEBUG&&console.log(e)},e.resourceMgr=new ResourceUtils,e.curTipsLen=0,e}();__reflect(CommonTools.prototype,"CommonTools");var ConstValue=function(){function e(){}return e.P_BAR_LABEL="资源加载中",e.P_BAR_LABEL2="^_^.每个场景部分地图较大，首次加载可能需要几分钟  喝杯茶吧，以后再次加载将会秒速进入",e.P_BAR_LABEL3="资源加载中",e.P_NULL_ACCOUNT="请输入账号",e.P_NULL_PASSWORD="请输入密码",e.P_NULL_INVITE="请输入推广号",e.P_NULL_VERIFY="请输入验证码",e.P_SEND_VERIFY="验证码发送成功",e.P_SEND_MODIFY_SUCCESS="修改成功",e.P_SEND_REGISTE_SUCCESS="注册成功",e.P_SEND_REGISTE_FAIL="用户名已存在",e.P_SEND_LOGIN_FAIL="用户名或密码错误",e.P_SEND_LOGIN_SUCCESS="登录成功",e.P_SEND_WAITING="敬请期待",e.P_SEND_HALLBACK_FAIL="网络异常，进入大厅失败",e.P_COPY_SUCCESS="复制成功",e.P_MODIFY_NULL_FAIL="修改内容不能为空",e.P_MODIFY_TITLE="信息",e.P_MODIFY_NICHENG="修改昵称：",e.P_MODIFY_OLD_PWD="旧密码：",e.P_MODIFY_NEW_PWD="新密码：",e.P_MODIFY_REALNAME="修改名字：",e.P_MODIFY_WX="修改微信：",e.P_MODIFY_BEGET="修改比例：",e.P_MODIFY_FAIL="修改失败，请稍后再试",e.P_MODIFY_PWD_FAIL="新密码2次输入有误",e.P_ENTER_ROOM_FAIL="进入房间失败",e.P_WAIT_NEXT="请等待下轮开始",e.P_NO_USER_ADDRESS="Please install MetaMask！",e.P_NO_HORSE="Ticket to exchange horse! ",e.P_PUSHING_TR="Pushing transaction...",e.P_TR_SUCCESS="Transaction executed!",e.P_TR_FAIL="Transaction failed!",e.P_NOT_ENOUGH="Not enough! ",e.P_IS_DEBUG=!1,e.P_IS_INNER=!0,e.p_is_PRINT_ERROR=!0,e.p_is_PRINT_DEBUG=!1,e.p_is_PRINT_AI=!1,e.p_is_PRINT_AI_PATH=!1,e.p_is_PRINT_MAP=!1,e.p_is_PRINT_WALLET=!0,e.p_LOGIN_MODEL=1,e.p_USE_WALLET=1,e.p_is_PRINT_WALLET_DEBUG=!0,e.P_NET_OBJ=null,e.P_LOGIN_OBJ=null,e.P_HALL_OBJ=null,e.P_FIGHT_OBJ=null,e.P_MAP_OBJ=null,e.P_CONTEXT=null,e.P_CONFIG=null,e.cacheUserAccount="",e.cacheUserPwd="",e.cacheHasLoginSuccess=!1,e.cacheUserInfo=null,e.cacheContract={nftLen:0,nftIndex:""},e.cacheKeyGroup={},e.gatewayType=0,e.deviveScale=1,e.deviveNormalScale=1.7,e.musicOpen=!0,e.role_select_img={0:"role_select_p1_png",1:"role_select_p2_png",2:"role_select_p3_png",3:"role_select_p4_png"},e.PUSH_BUTTON={1:{btn_name:"btn_map_bag",btn_res_01:"new_ui_10_01_png",btn_res_02:"new_ui_10_02_png"},2:{btn_name:"btn_friend",btn_res_01:"new_ui_09_01_png",btn_res_02:"new_ui_09_02_png"},3:{btn_name:"btn_setting",btn_res_01:"new_ui_04_01_png",btn_res_02:"new_ui_04_02_png"},4:{btn_name:"btn_ranking",btn_res_01:"new_ui_06_01_png",btn_res_02:"new_ui_06_02_png"},5:{btn_name:"btn_map_shop",btn_res_01:"new_ui_05_png",btn_res_02:"new_ui_05_png"},6:{btn_name:"btn_vip",btn_res_01:"new_ui_08_png",btn_res_02:"new_ui_08_png"},7:{btn_name:"btn_activity",btn_res_01:"new_ui_07_png",btn_res_02:"new_ui_07_png"},8:{btn_name:"btn_select_role",btn_res_01:"new_ui_19_01_png",btn_res_02:"new_ui_19_02_png"},9:{btn_name:"btn_uplv_task",btn_res_01:"new_ui_get_reward_png",btn_res_02:"new_ui_get_reward_png"},10:{btn_name:"btn_skill",btn_res_01:"new_ui_20_01_png",btn_res_02:"new_ui_20_02_png"},11:{btn_name:"btn_maprank",btn_res_01:"new_ui_21_png",btn_res_02:"new_ui_21_png"},12:{btn_name:"btn_redtv",btn_res_01:"red_tv_png",btn_res_02:"red_tv_png"}},e.role_select_bg={0:"role_select_bg_png",1:"role_select_bg2_png",2:"role_select_bg3_png",3:"role_select_bg4_png"},e.skill_conf={1:{icon:"skill_dog_png",cdicon:"skill_dog_nn_png"},2:{icon:"skill_chicken_png",cdicon:"skill_chicken_nn_png"}},e.guide_tips={1:{tip:"主人，让我动起来吧～",saveKey:"moveTip",jumpPoint:"controler_parent",jumpoffx:100,jumpoffy:80},2:{tip:"很好，找个安全地方放泡泡吧～",saveKey:"boomTip",jumpPoint:"boom_btn",jumpoffx:65,jumpoffy:-80},3:{tip:"注意躲避爆炸区域，持续3秒～",saveKey:"goawayTip"},4:{tip:"有东西在闪，我们捡起来吧～",saveKey:"itemTip"},5:{tip:"来吧，干掉对面呆瓜～",saveKey:"killTip"}},e.sysTips=[],e.oneTipsCnt=0,e.oneTipsCur=0,e.oneTips={},e.videoAd=null,e.videoAdOBJ=null,e.videoIndx=0,e.horseLv={1:{lv_icon:"icon_level_d_png"},2:{lv_icon:"icon_level_c_png"},3:{lv_icon:"icon_level_b_png"},4:{lv_icon:"icon_level_a_png"},5:{lv_icon:"icon_level_s_png"}},e}();__reflect(ConstValue.prototype,"ConstValue");var ContractSol=function(){function e(){}return e.initSOL=function(){e.res_nft_tokensOfOwner=RES.getRes("nft_tokensOfOwner_json"),e.method_nft_tokensOfOwner=e.res_nft_tokensOfOwner,e.abiDef_nft_tokensOfOwner=e.method_nft_tokensOfOwner,e.metaNFT_nft_tokensOfOwner=e.hweb3.eth.contract([e.abiDef_nft_tokensOfOwner]).at(e.NFTAddress),e.res_maincoin_transfer=RES.getRes("maincoin_transfer_json"),e.method_maincoin_transfer=e.res_maincoin_transfer,e.abiDef_maincoin_transfer=e.method_maincoin_transfer,e.res_maincoin_balanceOf=RES.getRes("maincoin_balanceOf_json"),e.method_maincoin_balanceOf=e.res_maincoin_balanceOf,e.abiDef_maincoin_balanceOf=e.method_maincoin_balanceOf,e.res_maincoin_transferFrom=RES.getRes("maincoin_transferFrom_json"),e.method_maincoin_transferFrom=e.res_maincoin_transferFrom,e.abiDef_maincoin_transferFrom=e.method_maincoin_transferFrom,e.res_maincoin_increaseApproval=RES.getRes("maincoin_increaseApproval_json"),e.method_maincoin_increaseApproval=e.res_maincoin_increaseApproval,e.abiDef_maincoin_increaseApproval=e.method_maincoin_increaseApproval,e.res_subcoin_transfer=RES.getRes("maincoin_transfer_json"),e.method_subcoin_transfer=e.res_subcoin_transfer,e.abiDef_subcoin_transfer=e.method_subcoin_transfer,e.res_subcoin_balanceOf=RES.getRes("maincoin_balanceOf_json"),e.method_subcoin_balanceOf=e.res_subcoin_balanceOf,e.abiDef_subcoin_balanceOf=e.method_subcoin_balanceOf,e.res_subcoin_transferFrom=RES.getRes("maincoin_transferFrom_json"),e.method_subcoin_transferFrom=e.res_subcoin_transferFrom,e.abiDef_subcoin_transferFrom=e.method_subcoin_transferFrom,e.metaNFT_maincoin=e.hweb3.eth.contract([e.abiDef_maincoin_transfer,e.abiDef_maincoin_balanceOf,e.abiDef_maincoin_transferFrom,e.abiDef_maincoin_increaseApproval]).at(e.BEP20_Main_Address),e.metaNFT_subcoin=e.hweb3.eth.contract([e.abiDef_subcoin_transfer,e.abiDef_subcoin_balanceOf,e.abiDef_subcoin_transferFrom]).at(e.BEP20_Sub_Address)},e.nft_tokensOfOwner=function(t){e.metaNFT_nft_tokensOfOwner.tokensOfOwner(t,{from:e.sender},function(e,t){if(e)throw CommonTools.logError("--nft_tokensOfOwner-error--"+e),e;if(CommonTools.logWallet("--nft_tokensOfOwner-token_result--"+t.length),CommonTools.logWallet("--nft_tokensOfOwner-token_result--"+t),ConstValue.cacheContract.nftLen=t.length,ConstValue.cacheContract.nftIndex=t,t.length>0){var i=CommonTools.getDataJsonStr("getOwnNft",1,{lNft:t});ConstValue.P_NET_OBJ.sendData(i)}})},e.DelayGetReceipt=function(t,i,n){CommonTools.logWallet("--DelayGetReceipt------"+t+" "+i+" "+n),FightingModule.Delay(5e3,function(){e.hweb3.eth.getTransactionReceipt(t,function(o,s){if(CommonTools.logWallet("--DelayGetReceipt----result--"+s),null==s)e.DelayGetReceipt(t,i,n);else if("0x1"==s.status.toString()&&1==i){ConstValue.P_HALL_OBJ.addCommonTips("Waiting NFT response..."),e.maincoin_balanceOf(e.sender);var a=CommonTools.getDataJsonStr("createNft",1,{iTickets:n});ConstValue.P_NET_OBJ.sendData(a)}})},this)},e.maincoin_transfer=function(t,i){e.metaNFT_maincoin.transfer(t,i,{from:e.sender},function(t,n){if(t)throw CommonTools.logError("--maincoin-transfer error--"+t),t;CommonTools.logWallet("--maincoin-transfer txnHash--"+n),e.DelayGetReceipt(n,1,i)})},e.maincoin_balanceOf=function(t){e.metaNFT_maincoin.balanceOf(t,{from:e.sender},function(e,t){if(e)throw CommonTools.logError("--maincoin-balanceOf error--"+e),e;CommonTools.logWallet("--maincoin_balanceOf-token_result--"+t),ConstValue.P_HALL_OBJ.updateMaincoin(t,!0)})},e.maincoin_transferFrom=function(t,i,n){e.metaNFT_maincoin.transferFrom(t,i,n,{from:e.sender,gas:1e5,gasPrice:e.hweb3.eth.gasPrice},function(e,t){if(e)throw CommonTools.logError("--maincoin_transferFrom error--"+e),e;CommonTools.logWallet("--maincoin_transferFrom txnHash--"+t)})},e.maincoin_increaseApproval=function(t,i){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(n){return e.metaNFT_maincoin.increaseApproval(t,i,{from:e.sender},function(e,t){if(e)throw CommonTools.logError("--maincoin_increaseApproval error--"+e),e;CommonTools.logWallet("--maincoin_increaseApproval txnHash--"+t)}),[2]})})},e.subcoin_transfer=function(t,i){e.metaNFT_subcoin.transfer(t,i,{from:e.sender,gas:1e5,gasPrice:e.hweb3.eth.gasPrice},function(e,t){if(e)throw CommonTools.logError("--subcoin-transfer error--"+e),e;CommonTools.logWallet("--subcoin-transfer txnHash--"+t)})},e.subcoin_balanceOf=function(t){e.metaNFT_subcoin.balanceOf(t,{from:e.sender},function(e,t){if(e)throw CommonTools.logError("--subcoin-balanceOf error--"+e),e;CommonTools.logWallet("--subcoin_balanceOf-token_result--"+t),ConstValue.P_HALL_OBJ.updateSubcoin(t,!0)})},e.subcoin_transferFrom=function(t,i,n){e.metaNFT_subcoin.transferFrom(t,i,n,{from:e.sender,gas:1e5,gasPrice:e.hweb3.eth.gasPrice},function(e,t){if(e)throw CommonTools.logError("--subcoin_transferFrom error--"+e),e;CommonTools.logWallet("--subcoin_transferFrom txnHash--"+t)})},e.netURL="https://data-seed-prebsc-1-s1.binance.org:8545",e.BEP20_Main_Address="0xa9e75f8838c7173412f229a7cd13a6b6e0fe6e39",e.BEP20_Sub_Address="0x6A3587d791946E2C567a279886ACc10Fa962a4cc",e.NFTAddress="0x14c75969e8aeb8ff68c4450ebc3090b48425f4bb",e.sender="",e.createAddress="0x210729036108b7dd19bba5141e181a47a619a46f",e}();__reflect(ContractSol.prototype,"ContractSol");var EBitUtil=function(){function e(){}return e.isSetBit=function(e,t){return t>31?!1:(e&1<<t)>0},e.SetBit=function(e,t){return t>31?e:e|1<<t},e.ClearBit=function(e,t){return t>31?e:e&~(1<<t)},e.getArr=function(e){var t=[];for(e.position=0;e.bytesAvailable>0;)t.push(e.readByte());return t},e}();__reflect(EBitUtil.prototype,"EBitUtil");var PathUtils=function(){function e(){}return Object.defineProperty(e,"RESOURC",{get:function(){return 1==ConstValue.p_LOGIN_MODEL&&(e.CDN_URL=""),e.CDN_URL="",e.CDN_URL+e.RESOURC_URL},enumerable:!0,configurable:!0}),Object.defineProperty(e,"RESOURCSUB1",{get:function(){return 1==ConstValue.p_LOGIN_MODEL&&(e.CDN_URL=""),e.CDN_URL="",e.CDN_URL+e.RESOURC_SUB1_URL},enumerable:!0,configurable:!0}),Object.defineProperty(e,"RESOURCSUB2",{get:function(){return 1==ConstValue.p_LOGIN_MODEL&&(e.CDN_URL=""),e.CDN_URL="",e.CDN_URL+e.RESOURC_SUB2_URL},enumerable:!0,configurable:!0}),Object.defineProperty(e,"NOTICE",{get:function(){return 1==ConstValue.p_LOGIN_MODEL&&(e.CDN_URL=""),e.CDN_URL+e.RESOURC_URL+e.NOTICE_URL},enumerable:!0,configurable:!0}),e.CND_URL_49YOU="",e.CDN_URL="https://www.iogood.cn:442/pptcdn/",e.RESOURC_URL="resource/",e.NOTICE_URL="notice/",e.RESOURC_SUB1_URL="stage1/resource/",e.RESOURC_SUB2_URL="stage2/resource/",e.Version_Default_Res="default.res.json",e.Version_Default_Thm="default.thm.json",e.Version_SUBPACK1_Res="subpack1.res.json",e.Version_SUBPACK2_Res="subpack2.res.json",e}();__reflect(PathUtils.prototype,"PathUtils");var AssetAdapter=function(){function e(){}return e.prototype.getAsset=function(e,t,i){function n(n){t.call(i,n,e)}if(RES.hasRes(e)){var o=RES.getRes(e);o?n(o):RES.getResAsync(e,n,this)}else RES.getResByUrl(e,n,this,RES.ResourceItem.TYPE_IMAGE)},e}();__reflect(AssetAdapter.prototype,"AssetAdapter",["eui.IAssetAdapter"]);var LoadingUI=function(e){function t(t,i,n){var o=e.call(this)||this;return o.iScreenWidth=t,o.iScreenHeight=i,o.context=n,o.createView(),o}return __extends(t,e),t.prototype.createView=function(){var e="";if(1==ConstValue.p_LOGIN_MODEL?e="preload":2==ConstValue.p_LOGIN_MODEL&&(e="sub1preload"),null==ConstValue.cacheKeyGroup[e]){CommonTools.log("=====================not load preload ,use mask");var t=new egret.Shape;t.graphics.beginFill(0,1),t.graphics.drawRect(0,0,this.iScreenWidth,this.iScreenHeight),t.graphics.endFill(),this.addChild(t)}else{if(CommonTools.log("=====================load preload ,use ui"),null==ConstValue.P_LOGIN_OBJ){var i=new eui.Image("login_bg_ppt_png");i.width=this.iScreenWidth;var n=1334/this.iScreenWidth;i.height=750/n,this.addChild(i)}this.pBar=new eui.ProgressBar,this.pBar.maximum=100,this.pBar.minimum=0,this.pBar.width=549,this.pBar.height=78,this.addChild(this.pBar),this.pBar.value=0,this.pBar.x=400,this.pBar.y=570,this.pBar.labelFunction=this.barLabelFunction,CommonTools.fixFix(this.context,this.pBar,2,40,0)}},t.prototype.barLabelFunction=function(e,t){return""},t.prototype.onProgress=function(e,t){var i=e/(1*t)*100;i=Math.ceil(i),null!=this.pBar&&(this.pBar.value=i)},t}(egret.Sprite);__reflect(LoadingUI.prototype,"LoadingUI",["RES.PromiseTaskReporter"]);var FightingModule=function(){function e(e){this.pMainRole="",this.p1=119,this.p2=120,this.pAI=121,this.pAISelect={},this.controlerHit_x=28,this.controlerHit_y=183,this.r=104,this.controlerHit_x_c=132,this.controlerHit_y_c=287,this.initRow=7,this.initColumn=9,this.firstItemX=167,this.firstItemY=134,this.groundItemW=82,this.groundItemH=82,this.groundOffX=-25,this.groundOffY=-28,this.APP_MODE=1,this.FIGHT_MODE=1,this.scaleX=1,this.scaleY=1,this.playerData=null,this.playerLen=0,this.curPlayer=null,this.vsPanel=null,this.resultPanel=null,this.miniGamePanel=null,this.otherCount=0,this.counterTimer=null,this.countDown=3,this.counterTimerSkill01=null,this.countDownSkill01=0,this.counterTimerSkill02=null,this.countDownSkill02=0,this.backBtn=null,this.initCnt=0,this.shareRes=0,this.dSkill=null,this.shortCut01="1",this.shortCut02="2",this.testGround=[1,1,1,1,1,1,2,2,1,1,1,1,1,1,1,2,1,2,1,1,1,3,1,1,2,2,1,3,2,2,1,1,1,2,2,3,1,1,3,1,1,1,2,2,1,1,2,1,1,1,1,2,3,2,1,1,1,1,1,1,2,3,2],this.testMap=[1,1,1,1,1,1,2,6,1,1,119,1,1,1,1,2,6,1,1,1,1,1,1,1,2,6,1,3,2,2,1,1,120,2,6,1,1,1,13,1,1,1,2,6,1,1,9,6,1,1,1,2,6,1,1,12,11,1,1,1,2,6,1],this.testGround2=[1,1,1,1,1,1,2,2,1,1,1,1,1,1,1,1,1,2,1,2,1,1,1,1,1,3,1,1,2,2,1,1,1,3,2,2,1,1,1,2,2,3,1,1,1,1,3,1,1,1,2,2,1,1,1,1,2,1,1,1,1,2,3,2,1,1,1,1,1,1,1,1,2,3,2,1,1,1,1,1,1,1,1,2,3,2,1,1,1,1,1,1,1,1,2,3,2,1,1],this.testMap2=[0,0,0,0,0,0,0,0,5,6,0,0,119,0,0,0,0,0,6,5,6,0,0,0,0,0,0,0,0,6,5,6,0,0,0,0,0,0,120,0,6,5,6,0,0,0,13,0,0,0,0,6,5,6,0,0,9,6,0,0,0,0,0,0,0,0,0,9,6,0,0,0,0,6,5,6,0,0,9,6,0,0,0,0,6,5,6,0,0,12,11,0,0,0,0,6,5,6,0],CommonAudioHandle.play("mainmenu_mp3",0),CommonTools.log("=init===1=========="),this.context=e,this.maskBg=new eui.Image("bg_ppt_1_png"),this.maskBg.width=this.context.getStageWidth();var t=1334/this.context.getStageWidth();this.maskBg.height=750/t,this.context.addChild(this.maskBg),this.infoPanel=new eui.Panel,this.infoPanel.skinName="resource/eui_skins/UserUI/FightInfoGroup.exml",this.infoPanel.title="TitleInfo",this.infoPanel.x=-50,this.infoPanel.y=80,this.infoPanel.scaleX=.8,this.infoPanel.scaleY=.8,this.context.addChild(this.infoPanel),this.panel=new eui.Panel,this.panel.skinName="resource/eui_skins/UserUI/fightingUI.exml",this.panel.title="Title",this.panel.horizontalCenter=0,this.panel.verticalCenter=0,this.context.addChild(this.panel),this.backBtn=new eui.Image("btn_back_png"),this.backBtn.width=60,this.backBtn.height=60,this.backBtn.x=44,this.backBtn.y=10,this.backBtn.name="back_btn",this.context.addChild(this.backBtn),this.backBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),CommonTools.log("=init===2=========="),CommonTools.fixFix(this.context,this.panel,1,0,0),CommonTools.fixFix(this.context,this.infoPanel,1,70,-100),ConstValue.gatewayType=1,Main.roomkey=null}return e.prototype.initConfig=function(){LZMA.decompress(EBitUtil.getArr(new egret.ByteArray(RES.getRes("config_json"))),function(e){ConstValue.P_CONFIG=JSON.parse(e)},function(e){})},e.prototype.initMapData=function(e){this.APP_MODE=e.map_mode,this.FIGHT_MODE=e.fight_mode,this.testGround=e.bgConf,this.testMap=e.layerConf,this.playerData=e.player},e.prototype.setControl=function(e,t){var i=Math.atan2(t-this.controlerHit_y_c,e-this.controlerHit_x_c),n=i*(180/Math.PI),o=this.controlerHit_x+this.r*Math.cos(3.14*n/180),s=this.controlerHit_y+this.r*Math.sin(3.14*n/180);this.controlerHit.x=o,this.controlerHit.y=s},e.prototype.myKeyDown=function(e){if(CommonTools.logDebug("keydown =====code:"+e.keyCode),87==e.keyCode||83==e.keyCode||65==e.keyCode||68==e.keyCode){var t=ConstValue.P_FIGHT_OBJ.getMainPlayer();t.keyDir!=e.keyCode&&(null!=t.func&&(t.setMoving(!1),t.removeEventListener(egret.Event.ENTER_FRAME,t.func,t),t.func=null),t.func=function(e){t.setMoving(!0),t.move(-1,!0)},t.addEventListener(egret.Event.ENTER_FRAME,t.func,t),t.keyDir=e.keyCode),87==e.keyCode&&(t.setMoving(!0),t.move(0,!1)),83==e.keyCode&&(t.setMoving(!0),t.move(2,!1)),65==e.keyCode&&(t.setMoving(!0),t.move(3,!1)),68==e.keyCode&&(t.setMoving(!0),t.move(1,!1))}if(74==e.keyCode){var i=ConstValue.P_FIGHT_OBJ.getMainPlayer();i.markPosition(-1);var n=CommonTools.getDataJsonStr("syncPut",1,{x:i.x,y:i.y,idx:parseInt(i.curMapIdx),playerID:0});ConstValue.P_NET_OBJ.sendData2(n)}},e.prototype.myKeyUp=function(t){if(CommonTools.logDebug("keyup =====code:"+t.keyCode),87==t.keyCode||83==t.keyCode||65==t.keyCode||68==t.keyCode){ConstValue.P_FIGHT_OBJ.controlerHit.x=ConstValue.P_FIGHT_OBJ.controlerHit_x,ConstValue.P_FIGHT_OBJ.controlerHit.y=ConstValue.P_FIGHT_OBJ.controlerHit_y;var i=ConstValue.P_FIGHT_OBJ.getMainPlayer();if(i.setMoving(!1),i.removeEventListener(egret.Event.ENTER_FRAME,i.func,i),i.func=null,i.keyDir=-1,!e.aiPVE){var n=CommonTools.getDataJsonStr("syncPos",1,{x:i.x,y:i.y,direction:-1,speed:i.speed,idx:parseInt(i.curMapIdx),playerID:0});ConstValue.P_NET_OBJ.sendData2(n)}}},e.prototype.initScene=function(){if(!(this.initCnt>0)){this.initCnt++,2==this.APP_MODE&&(this.initRow=9,this.initColumn=11,this.scaleX=.8,this.scaleY=.8);var t=this.panel.getChildByName("fighting_parent");if(e.groundLayer=t.getChildByName("ground_layer"),e.playerLayer=t.getChildByName("player_layer"),e.bulletLayer=t.getChildByName("bullet_layer"),e.mapLayer=t.getChildByName("map_layer"),2==this.APP_MODE){var i=t.getChildByName("fighting_platform");i.width=770,i.height=640,i.x+=16,i.y+=12,t.x=156,t.y=-50}else 1==this.APP_MODE&&(t.x=145,t.y=-45);this.controlerParent=this.panel.getChildByName("controler_parent"),this.controlerHit=this.panel.getChildByName("controler_parent").getChildByName("controler_hit_btn"),this.panel.getChildByName("test").addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){egret.localStorage.setItem("fightFirstPNG","0");for(var t=["1","2","3","4","5"],i=0;i<t.length;i++)egret.localStorage.setItem(ConstValue.guide_tips[t[i]].saveKey,"0");CommonTools.addCommonTips(this.panel,"清理成功，请重新进入战斗")},this),this.panel.getChildByName("boom_btn").addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){var t=this.getMainPlayer();t.markPosition(-1);var i=CommonTools.getDataJsonStr("syncPut",1,{x:t.x,y:t.y,idx:parseInt(t.curMapIdx),playerID:0});ConstValue.P_NET_OBJ.sendData2(i)},this);var n=this.panel.getChildByName("skill_01_cd"),o=this.panel.getChildByName("skill_02_cd"),s=this.panel.getChildByName("skill_01"),a=this.panel.getChildByName("skill_02");s.addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){if(!(this.countDownSkill01>0)){if(s.source==ConstValue.skill_conf[this.shortCut01].cdicon)return void CommonTools.addCommonTips(this.panel,"请学习技能系统");var t=CommonTools.getDataJsonStr("useSkill",1,{skillID:1});ConstValue.P_NET_OBJ.sendData2(t),null!=this.counterTimerSkill01&&(this.counterTimerSkill01.stop(),this.counterTimerSkill01.removeEventListener(egret.TimerEvent.TIMER)),n.visible=!0,s.source=ConstValue.skill_conf[this.shortCut01].cdicon,n.text=this.dSkill[this.shortCut01].cd,this.countDownSkill01=this.dSkill[this.shortCut01].cd,this.counterTimerSkill01=new egret.Timer(1e3,0),this.counterTimerSkill01.addEventListener(egret.TimerEvent.TIMER,function(){0==this.countDownSkill01?(n.visible=!1,s.source=ConstValue.skill_conf[this.shortCut01].icon,this.counterTimerSkill01.stop()):(this.countDownSkill01--,n.text=this.countDownSkill01)},this),this.counterTimerSkill01.start()}},this),a.addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){if(!(this.countDownSkill02>0)){if(a.source==ConstValue.skill_conf[this.shortCut02].cdicon)return void CommonTools.addCommonTips(this.panel,"请学习技能系统");var t=CommonTools.getDataJsonStr("useSkill",1,{skillID:2});ConstValue.P_NET_OBJ.sendData2(t),null!=this.counterTimerSkill02&&(this.counterTimerSkill02.stop(),this.counterTimerSkill02.removeEventListener(egret.TimerEvent.TIMER)),o.visible=!0,a.source=ConstValue.skill_conf[this.shortCut02].cdicon,o.text=this.dSkill[this.shortCut02].cd,this.countDownSkill02=this.dSkill[this.shortCut02].cd,this.counterTimerSkill02=new egret.Timer(1e3,0),this.counterTimerSkill02.addEventListener(egret.TimerEvent.TIMER,function(){0==this.countDownSkill02?(o.visible=!1,a.source=ConstValue.skill_conf[this.shortCut02].icon,this.counterTimerSkill02.stop()):(this.countDownSkill02--,o.text=this.countDownSkill02)},this),this.counterTimerSkill02.start()}},this),this.controlerParent.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(e){var t=this.getMainPlayer();null!=t.func&&(t.setMoving(!1),t.removeEventListener(egret.Event.ENTER_FRAME,t.func,t),t.func=null),e.localX>=this.controlerHit_x_c&&e.localY>=this.controlerHit_y_c?e.localX-this.controlerHit_x_c>=e.localY-this.controlerHit_y_c?(CommonTools.log("四-------右"),t.curDirect=1):t.curDirect=2:e.localX>=this.controlerHit_x_c&&e.localY<=this.controlerHit_y_c?e.localX-this.controlerHit_x_c>=this.controlerHit_y_c-e.localY?(CommonTools.log("一-------右"),t.curDirect=1):(CommonTools.log("一-------上"),t.curDirect=0):e.localX<=this.controlerHit_x_c&&e.localY<=this.controlerHit_y_c?this.controlerHit_x_c-e.localX>=this.controlerHit_y_c-e.localY?(CommonTools.log("二-------左"),t.curDirect=3):(CommonTools.log("二-------上"),t.curDirect=0):e.localX<=this.controlerHit_x_c&&e.localY>=this.controlerHit_y_c&&(this.controlerHit_x_c-e.localX>=e.localY-this.controlerHit_y_c?(CommonTools.log("三-------左"),t.curDirect=3):(CommonTools.log("三-------下"),t.curDirect=2)),t.func=function(e){t.setMoving(!0),t.move(-1,!0)},t.addEventListener(egret.Event.ENTER_FRAME,t.func,t)},this),document.addEventListener("keydown",this.myKeyDown),document.addEventListener("keyup",this.myKeyUp),this.controlerParent.addEventListener(egret.TouchEvent.TOUCH_END,function(t){this.controlerHit.x=this.controlerHit_x,this.controlerHit.y=this.controlerHit_y;var i=this.getMainPlayer();if(i.setMoving(!1),i.removeEventListener(egret.Event.ENTER_FRAME,i.func,i),i.func=null,!e.aiPVE){var n=CommonTools.getDataJsonStr("syncPos",1,{x:i.x,y:i.y,direction:-1,speed:i.speed,idx:parseInt(i.curMapIdx),playerID:0});ConstValue.P_NET_OBJ.sendData2(n)}},this),this.controlerParent.addEventListener(egret.TouchEvent.TOUCH_MOVE,function(e){CommonTools.log("=e.localX, e.localY========x:::="+e.localX+" y:::"+e.localY);var t=this.getMainPlayer();e.localX>=this.controlerHit_x_c&&e.localY>=this.controlerHit_y_c?e.localX-this.controlerHit_x_c>=e.localY-this.controlerHit_y_c?(CommonTools.log("四-------右"),t.setMoving(!0),t.move(1,!1)):(CommonTools.log("四-------下"),t.setMoving(!0),t.move(2,!1)):e.localX>=this.controlerHit_x_c&&e.localY<=this.controlerHit_y_c?e.localX-this.controlerHit_x_c>=this.controlerHit_y_c-e.localY?(CommonTools.log("一-------右"),t.setMoving(!0),t.move(1,!1)):(CommonTools.log("一-------上"),t.setMoving(!0),t.move(0,!1)):e.localX<=this.controlerHit_x_c&&e.localY<=this.controlerHit_y_c?this.controlerHit_x_c-e.localX>=this.controlerHit_y_c-e.localY?(CommonTools.log("二-------左"),t.setMoving(!0),t.move(3,!1)):(CommonTools.log("二-------上"),t.setMoving(!0),t.move(0,!1)):e.localX<=this.controlerHit_x_c&&e.localY>=this.controlerHit_y_c&&(this.controlerHit_x_c-e.localX>=e.localY-this.controlerHit_y_c?(CommonTools.log("三-------左"),t.setMoving(!0),t.move(3,!1)):(CommonTools.log("三-------下"),t.setMoving(!0),t.move(2,!1))),this.setControl(e.localX,e.localY)},this);for(var l=0,r=0;r<this.initRow;r++)for(var h=0;h<this.initColumn;h++){var u=this.groundItemW,c=this.groundItemH,d=this.groundOffX,g=this.groundOffY;2==this.APP_MODE&&h>0&&(d=-32,u=this.groundItemW*this.scaleX),2==this.APP_MODE&&r>0&&(g=-32,c=this.groundItemH*this.scaleY);var m=this.firstItemX+u*h+d,_=this.firstItemY+c*r+g,p={img:"res_"+this.testGround[l]+"_png",x:m,y:_,name:"ground_"+l,curIdx:l},C=new Fight.MapItem(p);C.setRow(r),C.setColumn(h),C.setType(ConstValue.P_CONFIG.MapBase[this.testGround[l].toString()].Type),2==this.APP_MODE&&(C.scaleX=this.scaleX,C.scaleY=this.scaleY),e.groundLayer.addChild(C),e.groundLayerSubObj[l.toString()]=C,e.groundLayerSubObjDanger[C.getColumn()+"_"+C.getRow()]=C;var y=-48;if(2==this.APP_MODE&&(y=-42),this.testMap[l]<=3&&(y=-9),this.testMap[l]>100&&this.playerLen<=this.getPlayerTotal()){CommonTools.log("--this.testMap[count]--xxxxx---"+this.testMap[l]+" "+this.playerLen+" "+this.getPlayerTotal()),this.playerLen++;var f={},b=null,v=!1,T=null;if(this.testMap[l]==this.p1){T=this.getPlayerBySize(1);var P=40,B=0;2==this.APP_MODE&&(P=28),f={pObj:T,side:1,x:m+P,y:_+B,name:"role1",isAI:T.isAI,iClass:T.iClass,aiLevel:T.aiLevel,lWalkArea:T.lWalkArea},v=!0}else if(this.testMap[l]==this.pAI){T=this.getAINotInSelect();var P=40,x=0;2==this.APP_MODE&&(P=28),f={pObj:T,side:2,x:m+P,y:_+x,name:"role2",isAI:T.isAI,iClass:T.iClass,aiLevel:T.aiLevel,lWalkArea:T.lWalkArea}}else{T=this.getPlayerBySize(2);var P=40,N=0;2==this.APP_MODE&&(P=28),f={pObj:T,side:2,x:m+P,y:_+N,name:"role2",isAI:T.isAI,iClass:T.iClass,aiLevel:T.aiLevel,lWalkArea:T.lWalkArea}}if(b=new Fight.Player(f),b.roleId==ConstValue.cacheUserInfo.id&&(this.curPlayer=b),2==this.APP_MODE&&(b.scaleX=this.scaleX,b.scaleY=this.scaleY),e.mapLayer.addChild(b),b.markPosition(-1),e.playerLayerSubObj[l.toString()]=b,1==b.isAI){var k=null;k=0==T.aiLevel?new AIUtil0(b,this.testMap,this.initRow,this.initColumn,this.APP_MODE):1==T.aiLevel?new AIUtil1(b,this.testMap,this.initRow,this.initColumn,this.APP_MODE):2==T.aiLevel?new AIUtil1(b,this.testMap,this.initRow,this.initColumn,this.APP_MODE):3==T.aiLevel?new AIUtil1(b,this.testMap,this.initRow,this.initColumn,this.APP_MODE):T.aiLevel>3?new Mst1(b,this.testMap,this.initRow,this.initColumn,this.APP_MODE):new AIUtil1(b,this.testMap,this.initRow,this.initColumn,this.APP_MODE),e.aiSubObj[l.toString()]=k,e.aiPVE=!0}CommonTools.log("init player x,y "+b.x+" "+b.y+" "+b.roleId)}else if(this.testMap[l]>0&&this.testMap[l]<100){var S={img:"res_"+this.testMap[l]+"_png",x:m,y:_+y,name:"mapitem_"+l,curIdx:l},I=new Fight.MapItem(S);I.setRow(r),I.setColumn(h),I.setType(ConstValue.P_CONFIG.MapBase[this.testMap[l].toString()].Type),2==this.APP_MODE&&(I.scaleX=this.scaleX,I.scaleY=this.scaleY),e.mapLayer.addChild(I),e.mapLayerSubObj[l.toString()]=I}l++}this.showGuide(!0)}},e.prototype.showGuide=function(e){if("1"!=egret.localStorage.getItem("fightFirstPNG")){var t=new eui.Image("guide_mask_png");t.width=this.context.getStageWidth(),t.height=this.context.getStageHeight(),this.context.addChild(t);var i=new eui.Image("guide_01_png");return i.width=.7*this.context.getStageWidth(),i.height=.7*this.context.getStageHeight(),i.horizontalCenter=0,i.verticalCenter=0,this.context.addChild(i),void i.addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){this.context.removeChild(t),this.context.removeChild(i),egret.localStorage.setItem("fightFirstPNG","1"),this.showGuide(!0)},this)}for(var n=["1","2","3","4","5"],o=0;o<n.length;o++)if("1"!=egret.localStorage.getItem(ConstValue.guide_tips[n[o]].saveKey)){if(parseInt(n[o])>2&&e)continue;("1"==n[o]||"2"==n[o])&&this.jumpPoint(this.panel.getChildByName(ConstValue.guide_tips[n[o]].jumpPoint),ConstValue.guide_tips[n[o]].jumpoffx,ConstValue.guide_tips[n[o]].jumpoffy),this.getMainPlayer().addGuideTips(n[o]);break}},e.prototype.jumpPoint=function(e,t,i){this.jumpHand=new eui.Image("guide_point_down_png"),this.jumpTip=egret.Tween.get(this.jumpHand),this.jumpHand.x=e.x+t,this.jumpHand.y=e.y+i;for(var n=0;100>n;n++)this.jumpTip.to({y:this.jumpHand.y-50},400),this.jumpTip.to({y:this.jumpHand.y},400);this.panel.addChild(this.jumpHand)},e.prototype.removeJump=function(){null!=this.jumpHand&&(egret.Tween.removeTweens(this.jumpHand),this.panel.removeChild(this.jumpHand),this.jumpTip=null,this.jumpHand=null)},e.prototype.getPlayerBySize=function(e){for(var t in this.playerData){var i=this.playerData[t];if(parseInt(i.player_side)==e&&0==i.isAI)return i;if(parseInt(i.player_side)==e&&2==e)return i}return null},e.prototype.getAINotInSelect=function(){for(var e in this.playerData){var t=this.playerData[e];if(t.aiLevel>=50&&null==this.pAISelect[t.uid])return this.pAISelect[t.uid]=1,t}return null},e.prototype.getPlayerDataByRid=function(e){for(var t in this.playerData){var i=this.playerData[t];if(t==e+"")return i}return null},e.prototype.getPlayerTotal=function(){var e=0;for(var t in this.playerData)e++;return e},e.prototype.onClick=function(e){return __awaiter(this,void 0,void 0,function(){var t,i,n;return __generator(this,function(o){switch(o.label){case 0:switch(t=e.target.name,CommonTools.log("==========name::::"+t),i=t){case"replay_btn":return[3,1];case"replay_fail_btn":return[3,1];case"replay_btn_guanka":return[3,2];case"replay_fail_btn_guanka":return[3,3];case"goback_btn":return[3,4];case"back_btn":return[3,4];case"goback_fail_btn":return[3,4];case"share_btn":return[3,5]}return[3,7];case 1:return this.replay(),[3,8];case 2:return this.playNextGuanka(),[3,8];case 3:return this.replayGuanka(),[3,8];case 4:return this.clear(),[3,8];case 5:return n=window.platform,[4,n.shareWinAppMessage(this.shareRes)];case 6:return o.sent(),[3,8];case 7:return CommonTools.log("11111111 default"),[3,8];case 8:return[2]}})})},e.prototype.showResultpanel=function(e,t,i){if(null==this.resultPanel){this.maskResultBg=new eui.Image("mask_layer_png"),this.maskResultBg.width=this.context.getStageWidth(),this.maskResultBg.height=this.context.getStageHeight(),this.context.addChild(this.maskResultBg),this.resultPanel=new eui.Panel,this.resultPanel.horizontalCenter=0,this.resultPanel.verticalCenter=0,this.resultPanel.skinName="resource/eui_skins/UserUI/FightResultUI.exml",this.context.addChild(this.resultPanel),CommonTools.fixFix(this.context,this.resultPanel,1,0,0);var n=this.resultPanel.getChildByName("replay_btn");CommonButtonHandle.beginTouch(n,this),n.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this);var o=this.resultPanel.getChildByName("goback_btn");CommonButtonHandle.beginTouch(o,this),o.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this);var s=this.resultPanel.getChildByName("share_btn");CommonButtonHandle.beginTouch(s,this),s.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this);var a=this.resultPanel.getChildByName("goback_fail_btn");CommonButtonHandle.beginTouch(a,this),a.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this);var l=this.resultPanel.getChildByName("replay_fail_btn");CommonButtonHandle.beginTouch(l,this),l.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.resultPanel.getChildByName("gold_lb").text="金币";var r=this.resultPanel.getChildByName("gold_add_img_01"),h=this.resultPanel.getChildByName("gold_add_img_02"),u=this.resultPanel.getChildByName("gold_add_img_03");if(i.addcoin<10)h.visible=!1,u.visible=!1,r.source="digital_1_json."+i.addcoin;else if(i.addcoin<100){u.visible=!1;var c=Math.floor(i.addcoin/10),d=i.addcoin%10;r.source="digital_1_json."+c,h.source="digital_1_json."+d}else{var g=Math.floor(i.addcoin/100),m=i.addcoin%100,c=Math.floor(m/10),d=m%10;r.source="digital_1_json."+g,h.source="digital_1_json."+c,u.source="digital_1_json."+d}var _=this.resultPanel.getChildByName("exp_add_img_01"),p=this.resultPanel.getChildByName("exp_add_img_02"),C=this.resultPanel.getChildByName("exp_add_img_03");if(i.addExp<10)p.visible=!1,C.visible=!1,_.source="digital_2_json."+i.addExp;else if(i.addExp<100){C.visible=!1;var c=Math.floor(i.addExp/10),d=i.addExp%10;_.source="digital_2_json."+c,p.source="digital_2_json."+d}else{var g=Math.floor(i.addExp/100),m=i.addExp%100,c=Math.floor(m/10),d=m%10;_.source="digital_2_json."+g,p.source="digital_2_json."+c,C.source="digital_2_json."+d}var y=this.resultPanel.getChildByName("win_title_img");0==i.win?(y.source=RES.getRes("fail_png"),CommonAudioHandle.playEffect("failure_mp3",1),n.visible=!1,s.visible=!1,o.visible=!1):(CommonAudioHandle.playEffect("success_mp3",1),a.visible=!1,l.visible=!1,this.shareRes=0);var f=this.resultPanel.getChildByName("right_name_lb");
f.text=t.name;var b=this.resultPanel.getChildByName("right_head_img");""!=t.icon&&(b.source=t.icon);var v=this.resultPanel.getChildByName("left_name_lb");v.text=e.name;var T=this.resultPanel.getChildByName("left_head_img");""!=e.icon&&(T.source=e.icon),CommonTools.niceTip(this.resultPanel,1,this)}},e.prototype.showGuanKaResultpanel=function(e,t,i){if(null==this.resultPanel){this.maskResultBg=new eui.Image("mask_layer_png"),this.maskResultBg.width=this.context.getStageWidth(),this.maskResultBg.height=this.context.getStageHeight(),this.context.addChild(this.maskResultBg),this.resultPanel=new eui.Panel,this.resultPanel.horizontalCenter=0,this.resultPanel.verticalCenter=0,this.resultPanel.skinName="resource/eui_skins/UserUI/FightGuanKaResultUI.exml",this.context.addChild(this.resultPanel),CommonTools.fixFix(this.context,this.resultPanel,1,0,0);var n=this.resultPanel.getChildByName("replay_btn_guanka");CommonButtonHandle.beginTouch(n,this),n.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this);var o=this.resultPanel.getChildByName("goback_btn");CommonButtonHandle.beginTouch(o,this),o.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this);var s=this.resultPanel.getChildByName("share_btn");CommonButtonHandle.beginTouch(s,this),s.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this);var a=this.resultPanel.getChildByName("replay_fail_btn_guanka");CommonButtonHandle.beginTouch(a,this),a.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this);var l=this.resultPanel.getChildByName("goback_fail_btn");CommonButtonHandle.beginTouch(l,this),l.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.resultPanel.getChildByName("gold_lb").text="金币";var r=this.resultPanel.getChildByName("gold_add_img_01"),h=this.resultPanel.getChildByName("gold_add_img_02"),u=this.resultPanel.getChildByName("gold_add_img_03");if(i.addcoin<10)h.visible=!1,u.visible=!1,r.source="digital_1_json."+i.addcoin;else if(i.addcoin<100){u.visible=!1;var c=Math.floor(i.addcoin/10),d=i.addcoin%10;r.source="digital_1_json."+c,h.source="digital_1_json."+d}else{var g=Math.floor(i.addcoin/100),m=i.addcoin%100,c=Math.floor(m/10),d=m%10;r.source="digital_1_json."+g,h.source="digital_1_json."+c,u.source="digital_1_json."+d}var _=this.resultPanel.getChildByName("exp_add_img_01"),p=this.resultPanel.getChildByName("exp_add_img_02"),C=this.resultPanel.getChildByName("exp_add_img_03");if(i.addExp<10)p.visible=!1,C.visible=!1,_.source="digital_2_json."+i.addExp;else if(i.addExp<100){C.visible=!1;var c=Math.floor(i.addExp/10),d=i.addExp%10;_.source="digital_2_json."+c,p.source="digital_2_json."+d}else{var g=Math.floor(i.addExp/100),m=i.addExp%100,c=Math.floor(m/10),d=m%10;_.source="digital_2_json."+g,p.source="digital_2_json."+c,C.source="digital_2_json."+d}var y=this.resultPanel.getChildByName("win_title_img");0==i.win?(y.source=RES.getRes("fail_png"),CommonAudioHandle.playEffect("failure_mp3",1),n.visible=!1,s.visible=!1,o.visible=!1):(CommonAudioHandle.playEffect("success_mp3",1),a.visible=!1,l.visible=!1,i.star>3&&(i.star=3),this.shareRes=i.star),HallModule.isTrainBrr&&(i.star=3,this.resultPanel.getChildByName("name_bg_img").visible=!1,a.visible=!1,n.visible=!1,o.visible=!1,l.visible=!0,s.x=422.27,s.visible=!0);for(var f=1;f<=i.star&&!(f>3);f++){var b=this.resultPanel.getChildByName("star_0"+f);b.source="start_01_png"}var v=this.resultPanel.getChildByName("lb_guanka");v.text=i.GuanKaDesc,CommonTools.niceTip(this.resultPanel,1,this)}},e.prototype.closeResultpanel=function(){null!=this.resultPanel&&(this.context.removeChild(this.resultPanel),this.resultPanel=null),null!=this.maskResultBg&&(this.context.removeChild(this.maskResultBg),this.maskResultBg=null)},e.prototype.closeNice=function(){},e.prototype.isAiVs=function(){for(var t in e.aiSubObj)return!0;return!1},e.prototype.showVsMiniGamepanel=function(){if(null==this.miniGamePanel){this.maskMiniBg=new eui.Image("fighting_vs_png"),this.maskMiniBg.width=this.context.getStageWidth(),this.maskMiniBg.height=this.context.getStageHeight(),this.context.addChild(this.maskMiniBg),this.miniGamePanel=new eui.Panel,this.miniGamePanel.horizontalCenter=0,this.miniGamePanel.verticalCenter=0,this.miniGamePanel.skinName="resource/eui_skins/UserUI/FightingVsMiniGameUI.exml",this.context.addChild(this.miniGamePanel),CommonTools.fixFix(this.context,this.miniGamePanel,1,0,0);var e=this.miniGamePanel.getChildByName("time_countdown"),t=(this.miniGamePanel.getChildByName("my_click_num_lb"),this.miniGamePanel.getChildByName("other_click_num_lb"));this.miniGamePanel.getChildByName("click_btn").addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){if(this.countDown>0)return void CommonTools.addCommonTips(this.panel,"倒计时中...");var t=CommonTools.getDataJsonStr("normalClick",1,{});ConstValue.P_NET_OBJ.sendData2(t)},this),this.miniGamePanel.getChildByName("giveup_btn").addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){},this),this.miniGamePanel.getChildByName("use_btn").addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){},this),this.counterTimer=new egret.Timer(1e3,0),this.counterTimer.addEventListener(egret.TimerEvent.TIMER,function(){0==this.countDown?(e.visible=!1,0==this.otherCount?CommonTools.addCommonTips(this.panel,"开始抢夺！！GO"):CommonTools.addCommonTips(this.panel,"扑街，7头！！加油，加油...冇吃饭啊，丢"),this.isAiVs()&&(this.otherCount++,t.text=this.otherCount+" 对手")):(this.countDown--,e.text=this.countDown)},this),this.counterTimer.start()}},e.prototype.updateClickData=function(t){var i=this.miniGamePanel.getChildByName("my_click_num_lb"),n=this.miniGamePanel.getChildByName("other_click_num_lb");for(var o in e.playerLayerSubObj){var s=e.playerLayerSubObj[o];s.roleId==t.uid&&(1==s.whichSide?i.text=s.name+" "+t.click:n.text=s.name+" "+t.click)}},e.prototype.showVspanel=function(){null==this.vsPanel&&(this.maskVsBg=new eui.Image("fighting_vs_png"),this.maskVsBg.width=this.context.getStageWidth(),this.maskVsBg.height=this.context.getStageHeight(),this.context.addChild(this.maskVsBg),this.vsPanel=new eui.Panel,this.vsPanel.horizontalCenter=0,this.vsPanel.verticalCenter=0,this.vsPanel.skinName="resource/eui_skins/UserUI/FightingVsUI.exml",this.context.addChild(this.vsPanel),HallModule.isNoEnd||HallModule.isTrainBrr||(this.vsPanel.getChildByName("exit_match").visible=!0,this.vsPanel.getChildByName("exit_match").addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){this.closeVsPanel()},this)),CommonTools.fixFix(this.context,this.vsPanel,1,0,0))},e.prototype.closeVsPanel=function(){null!=ConstValue.P_HALL_OBJ&&(ConstValue.P_HALL_OBJ.clear(),ConstValue.P_HALL_OBJ=null),null!=this.vsPanel&&(this.context.removeChild(this.vsPanel),this.vsPanel=null),null!=this.maskVsBg&&(this.context.removeChild(this.maskVsBg),this.maskVsBg=null),this.preclear()},e.prototype.releaseVsPanel=function(){null!=ConstValue.P_HALL_OBJ&&(ConstValue.P_HALL_OBJ.clear(),ConstValue.P_HALL_OBJ=null),null==this.vsPanel&&this.showVspanel(),this.vsPanel.getChildByName("exit_match").visible=!1,HallModule.isNoEnd||HallModule.isTrainBrr||(this.vsPanel.getChildByName("match_tip").visible=!0,this.vsPanel.getChildByName("match_tip").source="match_success_png"),e.Delay(3e3,function(){if(null!=this.vsPanel&&(this.context.removeChild(this.vsPanel),this.vsPanel=null),null!=this.maskVsBg&&(this.context.removeChild(this.maskVsBg),this.maskVsBg=null),this.initScene(),null==this.miniGamePanel)for(var t in e.aiSubObj){var i=e.aiSubObj[t];i.startAI()}},this)},e.prototype.releaseMiniGamePanel=function(){null!=this.miniGamePanel&&(this.context.removeChild(this.miniGamePanel),this.miniGamePanel=null),null!=this.maskMiniBg&&(this.context.removeChild(this.maskMiniBg),this.maskMiniBg=null)},e.prototype.updateInfo=function(e){var t=e[ConstValue.cacheUserInfo.id],i=this.infoPanel.getChildByName("group_1"),n=i.getChildByName("heart_num_lb"),o=i.getChildByName("spead_num_lb"),s=i.getChildByName("boom_num_lb"),a=i.getChildByName("fire_num_lb");parseInt(n.text)!=t.life&&CommonTools.jumpAnim(n),parseInt(o.text)!=t.speed&&CommonTools.jumpAnim(o),parseInt(s.text)!=t.paopaocount&&CommonTools.jumpAnim(s),parseInt(a.text)!=t.power&&CommonTools.jumpAnim(a),n.text=t.life,o.text=t.speed,s.text=t.paopaocount,a.text=t.power,null==this.dSkill&&(this.dSkill=t.dSkill,null!=this.dSkill[this.shortCut01]&&(this.panel.getChildByName("skill_01").source=ConstValue.skill_conf[this.shortCut01].icon),null!=this.dSkill[this.shortCut02]&&(this.panel.getChildByName("skill_02").source=ConstValue.skill_conf[this.shortCut02].icon))},e.prototype.getMainPlayer=function(){return this.curPlayer},e.prototype.getPlayerById=function(t){for(var i in e.playerLayerSubObj){var n=e.playerLayerSubObj[i];if(n.roleId==t)return n}return null},e.Delay=function(e,t,i){var n=new egret.Timer(e,1);n.addEventListener(egret.TimerEvent.TIMER,t,i),n.start()},e.prototype.getInitRow=function(){return this.initRow},e.prototype.getInitColumn=function(){return this.initColumn},e.prototype.syncMove=function(e){var t=this.getPlayerById(e.rid);if(!t.isMainPlayer)return t.x=e.x,t.y=e.y,-1==e.direction?void(null!=t.func&&(t.setMoving(!1),t.removeEventListener(egret.Event.ENTER_FRAME,t.func,t),t.func=null)):void(null==t.func?(t.func=function(e){t.setMoving(!0),t.move(-1,!0)},t.addEventListener(egret.Event.ENTER_FRAME,t.func,t),t.setMoving(!0),t.move(e.direction,!1)):(t.setMoving(!0),t.move(e.direction,!1)))},e.prototype.getMapObjByIdx=function(t){for(var i in e.mapLayerSubObj){var n=e.mapLayerSubObj[i];if(n.getCurIdx()==t)return n}return null},e.prototype.syncBoomZhuan=function(t){var i=this.getMapObjByIdx(t.breakidx);for(var n in e.aiSubObj){var o=e.aiSubObj[n];o.openBlock(i.getColumn(),i.getRow())}var s=CommonTools.getAnimDraw(RES.getRes("SpeedNet_json"),RES.getRes("SpeedNet_png"),"0");e.mapLayer.addChild(s);var a=i.x,l=i.y;s.x=a,s.y=l,e.mapLayer.removeChild(i),e.mapLayerSubObj[t.breakidx.toString()]=null,delete e.mapLayerSubObj[t.breakidx.toString()],s.scaleX=1,s.scaleY=1,s.x+=30,s.y+=60,s.play(1),s.once(egret.Event.COMPLETE,function(i){if(null!=t.effect.type){var n=null;1==t.effect.type?n=new eui.Image(RES.getRes("mini_res_json.mini_speed")):3==t.effect.type?n=new eui.Image(RES.getRes("mini_res_json.mini_weili")):2==t.effect.type?n=new eui.Image(RES.getRes("mini_res_json.mini_boom")):7==t.effect.type&&(n=new eui.Image(RES.getRes("mini_res_json.pass_door"))),e.groundLayerSubObj[t.breakidx.toString()].addSub(n,t.effect.type)}e.mapLayer.removeChild(s)},this)},e.prototype.preclear=function(){return __awaiter(this,void 0,void 0,function(){var t,i,t,n,o;return __generator(this,function(s){switch(s.label){case 0:this.curPlayer=null;for(t in e.aiSubObj)i=e.aiSubObj[t],i.stopAI(),i.clear(),e.aiSubObj[t]=null;for(t in e.playerLayerSubObj)n=e.playerLayerSubObj[t],n.clear(),e.playerLayerSubObj[t]=null;return this.context.removeChild(this.infoPanel),this.context.removeChild(this.backBtn),this.backBtn=null,o=CommonTools.getDataJsonStr("exitPPRoom",1,{}),ConstValue.P_NET_OBJ.sendData(o),this.closeResultpanel(),this.context.removeChild(this.panel),this.context.dDataInfo=null,this.context.dDataInfo2=null,e.readyRes=!1,e.readyTwo=!1,e.aiSubObj={},e.aiPVE=!1,[4,this.context.loadResource("preloadHall",2)];case 1:return s.sent(),this.context=null,ConstValue.P_FIGHT_OBJ=null,[2]}})})},e.prototype.clear=function(){return __awaiter(this,void 0,void 0,function(){var t,i,t,n,o;return __generator(this,function(s){switch(s.label){case 0:null!=this.counterTimerSkill01&&(this.counterTimerSkill01.stop(),this.counterTimerSkill01.removeEventListener(egret.TimerEvent.TIMER),this.counterTimerSkill01=null),null!=this.counterTimerSkill02&&(this.counterTimerSkill02.stop(),this.counterTimerSkill02.removeEventListener(egret.TimerEvent.TIMER),this.counterTimerSkill02=null),this.curPlayer=null,this.controlerParent.removeEventListener(egret.TouchEvent.TOUCH_BEGIN),this.controlerParent.removeEventListener(egret.TouchEvent.TOUCH_END),this.controlerParent.removeEventListener(egret.TouchEvent.TOUCH_MOVE),this.controlerParent=null;for(t in e.aiSubObj)i=e.aiSubObj[t],i.stopAI(),i.clear(),e.aiSubObj[t]=null;for(t in e.playerLayerSubObj)n=e.playerLayerSubObj[t],n.clear(),e.playerLayerSubObj[t]=null;return this.context.removeChild(this.infoPanel),this.context.removeChild(this.backBtn),this.backBtn=null,o=CommonTools.getDataJsonStr("exitPPRoom",1,{}),ConstValue.P_NET_OBJ.sendData(o),this.closeResultpanel(),this.context.removeChild(this.panel),e.groundLayer.removeChildren(),e.groundLayer=null,e.playerLayer.removeChildren(),e.playerLayer=null,e.bulletLayer.removeChildren(),e.bulletLayer=null,e.mapLayer.removeChildren(),e.mapLayer=null,e.groundLayerSubObj={},e.playerLayerSubObj={},e.bulletLayerSubObj={},e.mapLayerSubObj={},e.groundLayerSubObjDanger={},this.context.dDataInfo=null,this.context.dDataInfo2=null,e.readyRes=!1,e.readyTwo=!1,e.aiSubObj={},e.aiPVE=!1,document.removeEventListener("keydown",this.myKeyDown),document.removeEventListener("keyup",this.myKeyUp),[4,this.context.loadResource("preloadHall",2)];case 1:return s.sent(),this.context=null,ConstValue.P_FIGHT_OBJ=null,[2]}})})},e.prototype.clear2=function(){null!=this.counterTimerSkill01&&(this.counterTimerSkill01.stop(),this.counterTimerSkill01.removeEventListener(egret.TimerEvent.TIMER),this.counterTimerSkill01=null),null!=this.counterTimerSkill02&&(this.counterTimerSkill02.stop(),this.counterTimerSkill02.removeEventListener(egret.TimerEvent.TIMER),this.counterTimerSkill02=null),this.curPlayer=null,this.controlerParent.removeEventListener(egret.TouchEvent.TOUCH_BEGIN),this.controlerParent.removeEventListener(egret.TouchEvent.TOUCH_END),this.controlerParent.removeEventListener(egret.TouchEvent.TOUCH_MOVE),this.controlerParent=null;for(var t in e.aiSubObj){var i=e.aiSubObj[t];i.stopAI(),i.clear(),e.aiSubObj[t]=null}for(var t in e.playerLayerSubObj){var n=e.playerLayerSubObj[t];n.clear(),e.playerLayerSubObj[t]=null}this.context.removeChild(this.infoPanel),this.context.removeChild(this.backBtn),this.backBtn=null;var o=CommonTools.getDataJsonStr("exitPPRoom",1,{});ConstValue.P_NET_OBJ.sendData(o),this.closeResultpanel(),this.context.removeChild(this.panel),e.groundLayer.removeChildren(),e.groundLayer=null,e.playerLayer.removeChildren(),e.playerLayer=null,e.bulletLayer.removeChildren(),e.bulletLayer=null,e.mapLayer.removeChildren(),e.mapLayer=null,e.groundLayerSubObj={},e.playerLayerSubObj={},e.bulletLayerSubObj={},e.mapLayerSubObj={},e.groundLayerSubObjDanger={},this.context.dDataInfo=null,this.context.dDataInfo2=null,e.readyRes=!1,e.readyTwo=!1,e.aiSubObj={},e.aiPVE=!1,document.removeEventListener("keydown",this.myKeyDown),document.removeEventListener("keyup",this.myKeyUp),this.context=null,ConstValue.P_FIGHT_OBJ=null},e.prototype.replay=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return this.clear2(),[4,ConstValue.P_CONTEXT.loadResource("fighting",3)];case 1:return e.sent(),[2]}})})},e.prototype.replayGuanka=function(){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(i){return this.clear2(),t=CommonTools.getDataJsonStr("C2GGotoBarrier",1,{barrierNo:e.curBarrNo}),ConstValue.P_NET_OBJ.sendData(t),[2]})})},e.prototype.playNextGuanka=function(){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(i){return this.clear2(),e.curBarrNo+=1,t=CommonTools.getDataJsonStr("C2GGotoBarrier",1,{barrierNo:e.curBarrNo}),ConstValue.P_NET_OBJ.sendData(t),[2]})})},e.prototype.addCommonTips=function(e){CommonTools.addCommonTips(this.panel,e)},e.prototype.handlePacket=function(t){return __awaiter(this,void 0,void 0,function(){var i,i,i,n,o,s,s,n,o,a,l,r,n,o,n,o,a,l,r,n,o,n,o;return __generator(this,function(h){switch(h.label){case 0:return"syncPosBroadcase"!=t.f?[3,1]:(""!=t.m||1!=t.s||this.syncMove(t.d),[3,17]);case 1:if("syncPut"!=t.f)return[3,2];if(""!=t.m||1!=t.s||""!=t.d&&36==t.d.err)i=this.getPlayerById(t.d.rid),1==i.isAI&&i.findOwnAi().moveNext();else{if(null==t.d.rid)return[2];i=this.getPlayerById(t.d.rid),i.fire(t.d.paopaoID,t.d.idx)}return[3,17];case 2:return"syncKillMst"!=t.f?[3,3]:(""!=t.m||1!=t.s||(i=this.getPlayerById(t.d.killID),i.visible=!1,i.findOwnAi().stopAI()),[3,17]);case 3:if("syncBoomZhuan"!=t.f)return[3,4];if(""!=t.m||1!=t.s);else{if(null==t.d.breakidx)return[2];this.syncBoomZhuan(t.d)}return[3,17];case 4:if("syncpickItem"!=t.f)return[3,5];if(""!=t.m||1!=t.s);else{for(n in t.d.player)o=t.d.player[n],s=this.getPlayerById(o.uid),s.speed=o.speed,s.bulletLen=o.power;this.updateInfo(t.d.player),this.getMainPlayer().removeGuideTips("4")}return[3,17];case 5:return"useSkillOK"!=t.f?[3,6]:(""!=t.m||1!=t.s||(CommonAudioHandle.playEffect("playBomb_mp3",1),s=this.getPlayerById(t.d.effectPlayer),s.addBuff(t.d.skillID)),[3,17]);case 6:return"GuildInfo"!=t.f?[3,7]:(""!=t.m||1!=t.s,[3,17]);case 7:if("gameResult"!=t.f)return[3,8];if(""!=t.m||1!=t.s);else{for(n in e.aiSubObj)o=e.aiSubObj[n],o.stopAI();a=null,l=null,r=null;for(n in t.d.player)o=t.d.player[n],0==o.win?r=o:l=o,o.uid==ConstValue.cacheUserInfo.id&&(a=o);this.showResultpanel(l,r,a)}return[3,17];case 8:if("gameGuanKaResult"!=t.f)return[3,9];if(""!=t.m||1!=t.s);else{for(n in e.aiSubObj)o=e.aiSubObj[n],o.stopAI();a=null,l=null,r=null;for(n in t.d.player)o=t.d.player[n],0==o.win?r=o:l=o,o.uid==ConstValue.cacheUserInfo.id&&(a=o);null!=this.backBtn&&this.showGuanKaResultpanel(l,r,a)}return[3,17];case 9:if("miniGameInfo"!=t.f)return[3,10];if(""!=t.m||1!=t.s);else{ConstValue.P_FIGHT_OBJ.showVsMiniGamepanel();for(n in e.aiSubObj)o=e.aiSubObj[n],o.stopAI()}return[3,17];case 10:return"WaitingInfo"!=t.f?[3,11]:(""!=t.m||1!=t.s?CommonTools.addCommonTips(this.panel,ConstValue.P_ENTER_ROOM_FAIL):(null==ConstValue.P_FIGHT_OBJ&&(ConstValue.P_FIGHT_OBJ=new e(this.context)),t.d.state<2?ConstValue.P_FIGHT_OBJ.showVspanel():2==t.d.state&&(e.readyTwo=!0,this.context.dDataInfo2=t.d.player,null!=ConstValue.P_FIGHT_OBJ.playerData&&(e.readyRes=!0,ConstValue.P_FIGHT_OBJ.releaseVsPanel(),ConstValue.P_FIGHT_OBJ.updateInfo(t.d.player)))),[3,17]);case 11:return"syncMapData"!=t.f?[3,16]:""==t.m&&1==t.s?[3,12]:[3,15];case 12:return null!=ConstValue.cacheKeyGroup.fighting?[3,14]:(this.context.dDataInfo=t.d,[4,this.context.loadResource("fighting",6)]);case 13:return h.sent(),[3,15];case 14:null==ConstValue.P_FIGHT_OBJ&&(ConstValue.P_FIGHT_OBJ=new e(this.context)),ConstValue.P_FIGHT_OBJ.initMapData(t.d),e.readyTwo&&!e.readyRes&&(ConstValue.P_FIGHT_OBJ.releaseVsPanel(),ConstValue.P_FIGHT_OBJ.updateInfo(this.context.dDataInfo2)),h.label=15;case 15:return[3,17];case 16:"UpdateClick"==t.f&&(""!=t.m||1!=t.s||this.updateClickData(t.d)),h.label=17;case 17:return[2]}})})},e.groundLayerSubObj={},e.groundLayerSubObjDanger={},e.playerLayerSubObj={},e.bulletLayerSubObj={},e.mapLayerSubObj={},e.mapLayerLock=!1,e.mapLeftLimit=177,e.mapUpLimit=106,e.mapRightLimit=823,e.mapDownLimit=649,e.aiSubObj={},e.aiPVE=!1,e.readyTwo=!1,e.readyRes=!1,e.curBarrNo=1,e}();__reflect(FightingModule.prototype,"FightingModule");var GuideModule=function(){function e(e,t,i,n){this.iGuideNo=0,this.curIdx=0,this.maxIdx=0,this.guide_tip_1={3:{tip_png:"guide_tip_diy_png",btn_name:"btn_map_diy",btn_png:"new_ui_14_png"},5:{tip_png:"guide_tip_friend_png",btn_name:"btn_friend_pvp",btn_png:"new_ui_03_png"},1:{tip_png:"guide_tip_match_png",btn_name:"btn_match_pvp",btn_png:"new_ui_13_png"},2:{tip_png:"guide_tip_noend_png",btn_name:"btn_noend_pve",btn_png:"new_ui_12_png"},6:{tip_png:"guide_tip_role_png",btn_name:"btn_select_role",btn_png:"new_ui_19_01_png"},4:{tip_png:"guide_tip_train_png",btn_name:"btn_training_pve",btn_png:"new_ui_02_png"}},this.context=e,this.iGuideNo=t,this.panel=i,this.panelNotice=n,this.createGuide()}return e.prototype.createGuide=function(){switch(this.iGuideNo){case 1:this.maxIdx=6,this.showNo1();break;case 2:this.showNo2();break;case 3:this.maxIdx=4,this.showNo3();break;case 4:this.showNo4();break;case 5:this.showNo5();break;case 6:this.showNo6();break;case 7:this.showNo7();break;case 8:this.showNo8();break;case 9:this.showNo9();break;case 10:this.showNo10();break;case 999:this.maxIdx=2,this.maskBgmask=new eui.Image("guide_mask_png"),this.maskBgmask.width=this.context.getStageWidth(),this.maskBgmask.height=this.context.getStageHeight(),this.context.addChild(this.maskBgmask),this.showNo999()}},e.prototype.getTip=function(){return 1==this.iGuideNo?this.guide_tip_1[this.curIdx+""].tip_png:""},e.prototype.getBtn=function(){return 1==this.iGuideNo?this.guide_tip_1[this.curIdx+""].btn_name:2==this.iGuideNo?"btn_training_pve":4==this.iGuideNo?"btn_noend_pve":5==this.iGuideNo?"p_1":6==this.iGuideNo?"btn_match_pvp":7==this.iGuideNo?"btn_map_diy":8==this.iGuideNo?"btn_friend_pvp":9==this.iGuideNo?"btn_select_role":10==this.iGuideNo?"btn_skill":""},e.prototype.getBtnPng=function(){return 1==this.iGuideNo?this.guide_tip_1[this.curIdx+""].btn_png:"guide_point_png"},e.prototype.showNo1=function(){if(CommonTools.log("------xxxx--111111"),this.curIdx++,this.curIdx>this.maxIdx){this.context.removeChild(this.maskBg),this.maskBg=null,this.context.removeChild(this.btn),this.btn=null,this.context.removeChild(this.tip),this.tip=null,HallModule.curGuide=0;var e=CommonTools.getDataJsonStr("getNextGuild",1,{});return void ConstValue.P_NET_OBJ.sendData(e)}null==this.maskBg&&(this.maskBg=new eui.Image("guide_mask_png"),this.maskBg.width=this.context.getStageWidth(),this.maskBg.height=this.context.getStageHeight(),this.context.addChild(this.maskBg),this.maskBg.addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){this.showNo1()},this)),null!=this.btn&&(this.context.removeChild(this.btn),this.btn=null,this.context.removeChild(this.tip),this.tip=null),this.btn=new eui.Image(this.getBtnPng());var t=this.panel.getChildByName(this.getBtn()).x,i=this.panel.getChildByName(this.getBtn()).y,n=this.panel.getChildByName(this.getBtn()).width,o=this.panel.getChildByName(this.getBtn()).height;ConstValue.deviveNormalScale>2&&(t=this.panel.getChildByName(this.getBtn()).x,i=this.panel.getChildByName(this.getBtn()).y-70,n=this.panel.getChildByName(this.getBtn()).width*ConstValue.deviveScale,o=this.panel.getChildByName(this.getBtn()).height*ConstValue.deviveScale),this.btn.x=t,this.btn.y=i,this.btn.width=n,this.btn.height=o,this.context.addChild(this.btn);var s=0,a=0;this.tip=new eui.Image(this.getTip()),5==this.curIdx?(s=0,a=a-this.btn.height-164):1==this.curIdx?(s=s-this.btn.width-277,a=a-this.btn.height-60):2==this.curIdx?(s=s-this.btn.width-277,a=a-this.btn.height-60):6==this.curIdx?(s=s-this.btn.width-340,a=a-this.btn.height-129):4==this.curIdx&&(s=s-this.btn.width-277),this.tip.x=this.btn.x+this.btn.width+s,this.tip.y=this.btn.y+this.btn.height+a,this.context.addChild(this.tip)},e.prototype.addGuideTips=function(t){this.panelT=new eui.Panel,this.panelT.skinName="resource/eui_skins/UserUI/GuideTipsGroup.exml",this.panelT.name="p_"+t;var i=this.panelT.getChildByName("group_1"),n=i.getChildByName("tip");n.text=e.guide_tip_new[t].tip,this.panelT.x=ConstValue.P_HALL_OBJ.getTipXY()[0],ConstValue.deviveNormalScale>2?(this.panelT.y+=140,this.panelT.x+=90):(this.panelT.y+=100,this.panelT.x+=140),this.panel.addChild(this.panelT),this.saveKey=e.guide_tip_new[t].saveKey},e.prototype.removeTips=function(){null!=this.panelT&&(this.panel.removeChild(this.panelT),this.panelT=null),null!=this.btn&&(egret.Tween.removeTweens(this.btn),this.panel.removeChild(this.btn),this.twJump=null),9==this.iGuideNo&&CommonTools.removeShake(this.panel.getChildByName("btn_select_role")),10==this.iGuideNo&&CommonTools.removeShake(this.panel.getChildByName("btn_skill")),egret.localStorage.setItem(this.saveKey,"1")},e.prototype.showNo2=function(){HallModule.curGuide=2,this.btn=new eui.Image(this.getBtnPng());var e=this.panel.getChildByName(this.getBtn()).x-30,t=this.panel.getChildByName(this.getBtn()).y+100;ConstValue.deviveNormalScale>2&&(e=this.panel.getChildByName(this.getBtn()).x-30,t=this.panel.getChildByName(this.getBtn()).y+100),this.btn.x=e,this.btn.y=t,this.panel.addChild(this.btn),this.twJump=egret.Tween.get(this.btn);for(var i=0;100>i;i++)this.twJump.to({y:this.btn.y-50},400),this.twJump.to({y:this.btn.y},400);this.addGuideTips("2")},e.prototype.showNo3=function(){if(this.curIdx++,this.curIdx>this.maxIdx){this.context.removeChild(this.maskBg),this.maskBg=null,HallModule.curGuide=0;var e=CommonTools.getDataJsonStr("getNextGuild",1,{});return void ConstValue.P_NET_OBJ.sendData(e)}null!=this.maskBg&&(this.context.removeChild(this.maskBg),this.maskBg=null),this.maskBg=new eui.Image("guide_0"+this.curIdx+"_png"),this.maskBg.width=this.context.getStageWidth(),this.maskBg.height=this.context.getStageHeight(),this.context.addChild(this.maskBg),this.maskBg.addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){this.showNo3()},this)},e.prototype.showNo4=function(){HallModule.curGuide=4,this.btn=new eui.Image(this.getBtnPng());var e=this.panel.getChildByName(this.getBtn()).x+120,t=this.panel.getChildByName(this.getBtn()).y+480;ConstValue.deviveNormalScale>2&&(e=this.panel.getChildByName(this.getBtn()).x+120,t=this.panel.getChildByName(this.getBtn()).y+380),this.btn.x=e,this.btn.y=t,this.panel.addChild(this.btn),this.twJump=egret.Tween.get(this.btn);for(var i=0;100>i;i++)this.twJump.to({y:this.btn.y-50},400),this.twJump.to({y:this.btn.y},400);this.addGuideTips("4")},e.prototype.showNo5=function(){HallModule.curGuide=5,this.btn=new eui.Image(this.getBtnPng());var e=this.panelNotice.getChildByName("fighting_parent"),t=e.x+e.getChildByName(this.getBtn()).x+20,i=e.y+e.getChildByName(this.getBtn()).y+170;ConstValue.deviveNormalScale>2&&(t=e.x+e.getChildByName(this.getBtn()).x+20,i=e.y+e.getChildByName(this.getBtn()).y+160),this.btn.x=t,this.btn.y=i,this.panelNotice.addChild(this.btn),this.twJump=egret.Tween.get(this.btn);for(var n=0;100>n;n++)this.twJump.to({y:this.btn.y-50},400),this.twJump.to({y:this.btn.y},400)},e.prototype.showNo6=function(){HallModule.curGuide=6,this.btn=new eui.Image(this.getBtnPng());var e=this.panel.getChildByName(this.getBtn()).x+80,t=this.panel.getChildByName(this.getBtn()).y+350;ConstValue.deviveNormalScale>2&&(e=this.panel.getChildByName(this.getBtn()).x+80,t=this.panel.getChildByName(this.getBtn()).y+300),this.btn.x=e,this.btn.y=t,this.panel.addChild(this.btn),this.twJump=egret.Tween.get(this.btn);for(var i=0;100>i;i++)this.twJump.to({y:this.btn.y-50},400),this.twJump.to({y:this.btn.y},400);this.addGuideTips("6")},e.prototype.showNo7=function(){HallModule.curGuide=7,this.btn=new eui.Image(this.getBtnPng());var e=this.panel.getChildByName(this.getBtn()).x,t=this.panel.getChildByName(this.getBtn()).y+150;ConstValue.deviveNormalScale>2&&(e=this.panel.getChildByName(this.getBtn()).x,t=this.panel.getChildByName(this.getBtn()).y+120),this.btn.x=e,this.btn.y=t,this.panel.addChild(this.btn),this.twJump=egret.Tween.get(this.btn);for(var i=0;100>i;i++)this.twJump.to({y:this.btn.y-50},400),this.twJump.to({y:this.btn.y},400);this.addGuideTips("7")},e.prototype.showNo8=function(){HallModule.curGuide=8,this.btn=new eui.Image(this.getBtnPng());var e=this.panel.getChildByName(this.getBtn()).x+80,t=this.panel.getChildByName(this.getBtn()).y+180;ConstValue.deviveNormalScale>2&&(e=this.panel.getChildByName(this.getBtn()).x+80,t=this.panel.getChildByName(this.getBtn()).y+180),this.btn.x=e,this.btn.y=t,this.panel.addChild(this.btn),this.twJump=egret.Tween.get(this.btn);for(var i=0;100>i;i++)this.twJump.to({y:this.btn.y-50},400),this.twJump.to({y:this.btn.y},400);this.addGuideTips("8")},e.prototype.showNo9=function(){HallModule.curGuide=9,CommonTools.shake(this.panel.getChildByName("btn_select_role")),this.addGuideTips("9")},e.prototype.showNo10=function(){HallModule.curGuide=10,CommonTools.shake(this.panel.getChildByName("btn_skill")),this.addGuideTips("10")},e.prototype.showNo999=function(){return this.curIdx++,this.curIdx>this.maxIdx?(this.context.removeChild(this.maskBg),this.maskBg=null,this.context.removeChild(this.maskBgmask),this.maskBgmask=null,void egret.localStorage.setItem("mapdiy0","1")):(null!=this.maskBg&&(this.context.removeChild(this.maskBg),this.maskBg=null),this.maskBg=new eui.Image("guild_map_0"+this.curIdx+"_png"),this.maskBg.horizontalCenter=0,this.maskBg.verticalCenter=0,this.context.addChild(this.maskBg),void this.maskBg.addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){this.showNo999()},this))},e.guide_tip_new={2:{tip:"强化训练，可以练习熟悉战斗中的操作哒！～",saveKey:"trainTip"},4:{tip:"过关斩将，可以获得资源和冲榜哦！～",saveKey:"pveTip"},6:{tip:"进入PVP随机匹配，和不同地方的玩家一决高下吧！～",saveKey:"pvpTip"},8:{tip:"可以邀请手机上的好友一起对战哦！～",saveKey:"wxpvpTip"},9:{tip:"这里还有很多角色等着你来召唤呢！～",saveKey:"roleTip"},10:{tip:"升级技能，在战斗中拥有更好的优势！～",saveKey:"skillTip"},7:{tip:"进入地图标记其，创造属于自己的作战地图吧！～",saveKey:"diymapTip"}},e}();__reflect(GuideModule.prototype,"GuideModule");var HallModule=function(){function e(t){this.sCurModifyBtn="",this.sCurModifyValue="",this.sCurModifyValue2="",this.shopUIType=1,this.shopPageType=0,this.shopItemNo=0,this.shopItemItemID=0,this.shopItemName="",this.shopPayType=0,this.barrLayer=1,this.seventCur=0,this.seventGetState=!1,this.shopItemClickName="",this.showWxVsPanel=null,this.isMainRoomer=!1,this.roleSelectIdx="0",this.fixGuide5=!1,this.curButton=null,this.moveLvGet=!0,this.btnPveAnimInitX=580,this.btnPveAnimInitY=350,this.btnPveAnimX=580,this.btnPveAnimY=350,this.horseCurrent=1,this.isCanShowSeventDay=!0,this.buyClass=0,this.curPage=1,this.subCurPage=1,this.horsePanelUp=!0,this.horseMarketData=null,this.horseOwnData=null,this.horseIndexS=0,this.isdisplay=!1,this.context=t,e.isNoEnd=!1,e.isTrainBrr=!1,e.isSafeArea=!0,ConstValue.P_CONFIG=JSON.parse(JSON.stringify(RES.getRes("res_json"))),this.init()}return e.prototype.initConfig=function(){var e=this;LZMA.decompress(EBitUtil.getArr(new egret.ByteArray(RES.getRes("config_json"))),function(t){ConstValue.P_CONFIG=JSON.parse(t),e.init()},function(e){})},e.prototype.setHorseXY=function(){ConstValue.deviveNormalScale<2?2==this.curPage?(this.btnPveAnim.x=this.btnPveAnimX-180,this.btnPveAnim.y=this.btnPveAnimY):(this.btnPveAnim.x=this.btnPveAnimX,this.btnPveAnim.y=this.btnPveAnimY):2==this.curPage?(this.btnPveAnim.x=this.btnPveAnimX-220,this.btnPveAnim.y=this.btnPveAnimY+40):(this.btnPveAnim.x=this.btnPveAnimX,this.btnPveAnim.y=this.btnPveAnimY)},e.prototype.drawHorse=function(){null!=this.btnPveAnim&&(this.btnPveAnim.removeEventListener(egret.Event.COMPLETE),null!=this.horseFunc&&(this.btnPveAnim.removeEventListener(egret.Event.ENTER_FRAME,this.horseFunc,this),this.horseFunc=null),this.panel.removeChild(this.btnPveAnim),this.btnPveAnim=null),this.btnPveAnim=CommonTools.getAnimDraw(RES.getRes("horse01_idle_0"+this.horseCurrent+"_json"),RES.getRes("horse01_idle_0"+this.horseCurrent+"_png"),"0"),this.btnPveAnim.play(1),this.btnPveAnim.name="btn_noend_pve_anim",this.panel.addChild(this.btnPveAnim),this.setHorseXY(),(2==this.curPage&&this.subCurPage>1||4==this.curPage&&1==this.subCurPage||5==this.curPage)&&(this.btnPveAnim.visible=!1),this.btnPveAnim.addEventListener(egret.Event.COMPLETE,function(){CommonTools.logWallet("---COMPLETE------"+this.horseCurrent),this.horseCurrent++,this.horseCurrent>3&&(this.horseCurrent=1),this.drawHorse()},this)},e.prototype.drawTraining=function(e){null!=this.btnPveAnim&&(null!=this.horseFunc&&(this.btnPveAnim.removeEventListener(egret.Event.ENTER_FRAME,this.horseFunc,this),this.horseFunc=null),this.btnPveAnim.removeEventListener(egret.Event.COMPLETE),this.panel.removeChild(this.btnPveAnim),this.btnPveAnim=null),4==e&&(this.btnPveAnim=CommonTools.getAnimDraw(RES.getRes("horse01_run01_json"),RES.getRes("horse01_run01_png"),"0")),this.btnPveAnim.play(-1),this.btnPveAnim.name="btn_noend_pve_anim",this.panel.addChild(this.btnPveAnim),this.setHorseXY(),this.horseFunc=function(e){this.btnPveAnimX+=8,this.btnPveAnimY=this.btnPveAnimInitY-50,this.setHorseXY(),this.btnPveAnimX>=this.context.getStageWidth()-200&&this.stopTraining(),this.btnPveAnimX>0&&this.btnPveAnimX%50==0&&CommonAudioHandle.playEffect("horse_step_on_grass_3_wav",1)},CommonAudioHandle.playEffect("horse_sfx_after_eat_wav",1),this.btnPveAnim.addEventListener(egret.Event.ENTER_FRAME,this.horseFunc,this)
},e.prototype.init=function(){CommonAudioHandle.play("mainmenu_mp3",0),"1"==egret.localStorage.getItem("noVolume")&&CommonAudioHandle.setVolume(0),this.maskNew=new eui.Image("new_ui_01_jpg"),this.maskNew.width=this.context.getStageWidth();var t=1334/this.context.getStageWidth();this.maskNew.height=750/t,this.context.addChild(this.maskNew),this.panel=new eui.Panel,this.panel.skinName="resource/eui_skins/UserUI/HallUI.exml",this.panel.title="Title",this.panel.horizontalCenter=0,this.panel.verticalCenter=0,this.context.addChild(this.panel),this.tipsPanel=this.panel,this.drawHorse(),this.panel.getChildByName("btn_map_diy").addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.panel.getChildByName("img_info").addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.panel.getChildByName("btn_training_pve").addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.panel.getChildByName("btn_2v2").addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.panel.getChildByName("up_item_group").getChildByName("img_coin1_add").addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.panel.getChildByName("up_item_group").getChildByName("img_coin2_add").addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.panel.getChildByName("sell_group").getChildByName("sell_btn_lb").addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),CommonTools.fixFix(this.context,this.panel.getChildByName("sell_group"),2,0,0),this.panel.getChildByName("buynft_group").getChildByName("buynft_btn_lb").addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),CommonTools.fixFix(this.context,this.panel.getChildByName("buynft_group"),2,0,0),this.rankHead01=this.panel.getChildByName("rank_grounp_main").getChildByName("rank_head_01"),this.rankHead02=this.panel.getChildByName("rank_grounp_main").getChildByName("rank_head_02"),this.rankHead03=this.panel.getChildByName("rank_grounp_main").getChildByName("rank_head_03"),this.rankHead04=this.panel.getChildByName("rank_grounp_main").getChildByName("rank_head_04"),this.rankHead05=this.panel.getChildByName("rank_grounp_main").getChildByName("rank_head_05"),this.rankHead01_mask=this.panel.getChildByName("rank_grounp_main").getChildByName("rank_head_01_mask"),this.rankHead02_mask=this.panel.getChildByName("rank_grounp_main").getChildByName("rank_head_02_mask"),this.rankHead03_mask=this.panel.getChildByName("rank_grounp_main").getChildByName("rank_head_03_mask"),this.rankHead04_mask=this.panel.getChildByName("rank_grounp_main").getChildByName("rank_head_04_mask"),this.rankHead05_mask=this.panel.getChildByName("rank_grounp_main").getChildByName("rank_head_05_mask"),this.rankHead01.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.rankHead02.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.rankHead03.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.rankHead04.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.rankHead05.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.btnBackImg=this.panel.getChildByName("rank_grounp_main").getChildByName("btn_back_img"),this.btnBackImg.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),CommonTools.fixFix(this.context,this.panel.getChildByName("btn_map_diy"),2,30,20),CommonTools.fixFix(this.context,this.panel.getChildByName("btn_training_pve"),2,30,20),CommonTools.fixFix(this.context,this.panel.getChildByName("btn_2v2"),2,30,20),CommonTools.fixFix(this.context,this.panel.getChildByName("info_grp"),1,44,10),CommonTools.fixFix(this.context,this.panel.getChildByName("img_head_bg"),1,34,10),CommonTools.fixFix(this.context,this.panel.getChildByName("img_info"),1,0,0),CommonTools.fixFix(this.context,this.panel.getChildByName("img_exp_bg"),1,27,10),CommonTools.fixFix(this.context,this.panel.getChildByName("img_exp_value"),1,27,10),CommonTools.fixFix(this.context,this.panel.getChildByName("img_coin_bg"),1,-10,10),CommonTools.fixFix(this.context,this.panel.getChildByName("img_zuan_bg"),1,-40,10),CommonTools.fixFix(this.context,this.panel.getChildByName("btn_noticetip"),1,0,10),CommonTools.fixFix(this.context,this.panel.getChildByName("btn_shop3"),1,0,10),CommonTools.fixFix(this.context,this.panel.getChildByName("hall_id_lb"),1,34,10),CommonTools.fixFix(this.context,this.panel.getChildByName("coin_num_lb"),1,-10,10),CommonTools.fixFix(this.context,this.panel.getChildByName("zuan_num_lb"),1,-50,10),CommonTools.fixFix(this.context,this.panel.getChildByName("img_lv_lb"),1,30,10),CommonTools.fixFix(this.context,this.panel.getChildByName("rank_grounp_main"),1,0,0),CommonTools.fixFix(this.context,this.panel.getChildByName("btn_gonggao"),1,44,10),CommonTools.fixFix(this.context,this.panel.getChildByName("up_item_group"),1,0,10);var i=this.panel.getChildByName("img_info");""!=ConstValue.cacheUserInfo.headPic&&(i.source=ConstValue.cacheUserInfo.headPic);var n=this.panel.getChildByName("hall_id_lb");n.text=ConstValue.cacheUserInfo.name;var o=this.panel.getChildByName("img_lv_lb");o.text=ConstValue.cacheUserInfo.lv;var s=this.panel.getChildByName("img_exp_value");s.width=1*ConstValue.cacheUserInfo.curexp/ConstValue.cacheUserInfo.maxExp*s.width,null!=ConstValue.cacheUserInfo&&1==ConstValue.cacheUserInfo.gm&&(this.panel.getChildByName("scroll_notify").addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.panel.getChildByName("up_item_group").getChildByName("horse_lv_img").addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){this.showEditUI("scroll_notify")},this)),CommonTools.fixFix(this.context,this.panel.getChildByName("scroll_notify"),2,0,20),this.notify_lb=this.panel.getChildByName("scroll_notify").getChildByName("group_notify").getChildByName("notity_all_lb"),egret.Tween.get(this.notify_lb).to({x:-426},8e3).call(function(){this.moveNotify()},this),ConstValue.gatewayType=0,0==ConstValue.p_USE_WALLET&&this.initPushBtn(),e.isInitLogin||e.curGuide>0&&3!=e.curGuide,e.isInitLogin=!1,FightingModule.Delay(500,function(){this.showGuide();var e=CommonTools.getDataJsonStr("getPvpRankThree",1,{});ConstValue.P_NET_OBJ.sendData(e),this.openWXPVP()},this),this.initAD(),this.panel.getChildByName("btn_gonggao").addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),1==ConstValue.p_USE_WALLET&&(platform.initSOL(),ContractSol.initSOL(),ContractSol.maincoin_balanceOf(ContractSol.sender),ContractSol.subcoin_balanceOf(ContractSol.sender),ContractSol.nft_tokensOfOwner(ContractSol.sender),this.changePage("rank_head_05"),this.updateUI())},e.prototype.clearHorseSelect=function(){if(1==this.curPage);else if(2==this.curPage||3==this.curPage){var e=570;ConstValue.deviveNormalScale>=2&&(e-=80),egret.Tween.get(this.horseSelectPanel).to({y:e},1e3),this.maskBg2.visible=!1,this.horsePanelUp=!0,this.resetHorse()}},e.prototype.resetHorse=function(){var e=this.horseSelectPanel.getChildByName("horse_panel_group").getChildByName("res_scroller");e.viewport.scrollV=0;for(var t=e.getChildByName("res_group"),i=20,n=0;i>n;n++){var o=t.getChildByName("p_"+n),s=o.getChildByName("group_1");s.scaleX=1,s.scaleY=1,s.getChildByName("select_2_img").visible=!1}var a=0;i>=5&&(a=2);var l=t.getChildByName("p_"+a),r=l.getChildByName("group_1");r.scaleX=1.2,r.scaleY=1.2,r.getChildByName("select_2_img").visible=!0},e.prototype.changeHorseRight=function(e){null!=this.horseSelectRightPanel&&(this.context.removeChild(this.horseSelectRightPanel),this.horseSelectRightPanel=null);var t=900,i=100;ConstValue.deviveNormalScale>=2&&(t-=0,i-=80),(2==this.curPage&&1==this.subCurPage||5==this.curPage)&&(this.horseSelectRightPanel=new eui.Panel,1==e?this.horseSelectRightPanel.skinName="resource/eui_skins/UserUI/StablesStatUI.exml":2==e?this.horseSelectRightPanel.skinName="resource/eui_skins/UserUI/StablesSkillUI.exml":this.horseSelectRightPanel.skinName="resource/eui_skins/UserUI/StablesPedigreeUI.exml",this.horseSelectRightPanel.title="Title",this.horseSelectRightPanel.x=t,this.horseSelectRightPanel.y=i,this.context.addChild(this.horseSelectRightPanel),CommonTools.fixFix(this.context,this.horseSelectRightPanel,2,0,0),5==this.curPage&&(ConstValue.deviveNormalScale>=2?(this.horseSelectRightPanel.scaleX=.7,this.horseSelectRightPanel.scaleY=.7):(this.horseSelectRightPanel.scaleX=.8,this.horseSelectRightPanel.scaleY=.8)),this.horseSelectRightPanel.getChildByName("horse_stat_lb").addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){CommonAudioHandle.playEffect("playBomb_mp3",1),this.changeHorseRight(1)},this),this.horseSelectRightPanel.getChildByName("horse_skill_lb").addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){CommonAudioHandle.playEffect("playBomb_mp3",1),this.changeHorseRight(2)},this),this.horseSelectRightPanel.getChildByName("horse_pedigree_lb").addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){CommonAudioHandle.playEffect("playBomb_mp3",1),this.changeHorseRight(3)},this))},e.prototype.createHorseItem=function(){null!=this.horseSelectPanel&&(this.context.removeChild(this.maskBg2),this.context.removeChild(this.horseSelectPanel),this.maskBg2=null,this.horseSelectPanel=null,this.horsePanelUp=!0);var e=305,t=570,i=215;ConstValue.deviveNormalScale>=2&&(e-=30,t-=80),this.maskBg2=new eui.Image("mask_layer_png"),this.maskBg2.width=this.context.getStageWidth(),this.maskBg2.height=this.context.getStageHeight(),this.maskBg2.addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){CommonAudioHandle.playEffect("playBomb_mp3",1),this.clearHorseSelect()},this),this.maskBg2.visible=!1,this.context.addChild(this.maskBg2),this.horseSelectPanel=new eui.Panel,this.horseSelectPanel.skinName="resource/eui_skins/UserUI/StablesPageUI.exml",this.horseSelectPanel.title="Title",this.horseSelectPanel.x=i,this.horseSelectPanel.y=t,this.context.addChild(this.horseSelectPanel),CommonTools.fixFix(this.context,this.horseSelectPanel,2,0,0);var n=this.horseSelectPanel.getChildByName("horse_panel_group").getChildByName("res_scroller");n.viewport.scrollV=0;var o=n.getChildByName("res_group");o.removeChildren(),this.horseSelectPanel.getChildByName("horse_panel_group").getChildByName("horse_up_point_click").addEventListener(egret.TouchEvent.TOUCH_TAP,function(i){CommonAudioHandle.playEffect("playBomb_mp3",1),this.horsePanelUp?(this.horsePanelUp=!1,egret.Tween.get(this.horseSelectPanel).to({y:e},1e3),this.maskBg2.visible=!0):(this.horsePanelUp=!0,egret.Tween.get(this.horseSelectPanel).to({y:t},1e3),this.maskBg2.visible=!1),this.resetHorse()},this);for(var s=20,a=function(e){var t=new eui.Panel;t.skinName="resource/eui_skins/UserUI/horseItemGroup.exml",t.name="p_"+e;t.x=11+120*(e%5),t.y=15+120*Math.floor(e/5),o.addChild(t),t.addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){CommonAudioHandle.playEffect("playBomb_mp3",1);for(var i=0;s>i;i++){var n=o.getChildByName("p_"+i),a=n.getChildByName("group_1");a.scaleX=1,a.scaleY=1,a.getChildByName("select_2_img").visible=!1}var l=t.getChildByName("group_1");l.scaleX=1.2,l.scaleY=1.2,l.getChildByName("select_2_img").visible=!0},l)},l=this,r=0;s>r;r++)a(r);var h=0;s>=5&&(h=2);var u=o.getChildByName("p_"+h),c=u.getChildByName("group_1");c.scaleX=1.2,c.scaleY=1.2,c.getChildByName("select_2_img").visible=!0,2==this.curPage&&this.changeHorseRight(1)},e.prototype.initMergeClick=function(){this.horseSelectRightPanel.getChildByName("left_horse_stat_lb").addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){CommonAudioHandle.playEffect("playBomb_mp3",1),this.horseSelectRightPanel.getChildByName("left_horse_stat_lb").source="icon_stats_s_png",this.horseSelectRightPanel.getChildByName("left_horse_skill_lb").source="icon_skill_n_png",this.horseSelectRightPanel.getChildByName("left_horse_pedigree_lb").source="icon_pedigree_n_png",this.horseSelectRightPanel.getChildByName("left_group_stat").visible=!0,this.horseSelectRightPanel.getChildByName("left_skill_group").visible=!1,this.horseSelectRightPanel.getChildByName("left_pedigree_group").visible=!1},this),this.horseSelectRightPanel.getChildByName("left_horse_skill_lb").addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){CommonAudioHandle.playEffect("playBomb_mp3",1),this.horseSelectRightPanel.getChildByName("left_horse_stat_lb").source="icon_stats_n_png",this.horseSelectRightPanel.getChildByName("left_horse_skill_lb").source="icon_skill_s_png",this.horseSelectRightPanel.getChildByName("left_horse_pedigree_lb").source="icon_pedigree_n_png",this.horseSelectRightPanel.getChildByName("left_group_stat").visible=!1,this.horseSelectRightPanel.getChildByName("left_skill_group").visible=!0,this.horseSelectRightPanel.getChildByName("left_pedigree_group").visible=!1},this),this.horseSelectRightPanel.getChildByName("left_horse_pedigree_lb").addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){CommonAudioHandle.playEffect("playBomb_mp3",1),this.horseSelectRightPanel.getChildByName("left_horse_stat_lb").source="icon_stats_n_png",this.horseSelectRightPanel.getChildByName("left_horse_skill_lb").source="icon_skill_n_png",this.horseSelectRightPanel.getChildByName("left_horse_pedigree_lb").source="icon_pedigree_s_png",this.horseSelectRightPanel.getChildByName("left_group_stat").visible=!1,this.horseSelectRightPanel.getChildByName("left_skill_group").visible=!1,this.horseSelectRightPanel.getChildByName("left_pedigree_group").visible=!0},this),this.horseSelectRightPanel.getChildByName("right_horse_stat_lb").addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){CommonAudioHandle.playEffect("playBomb_mp3",1),this.horseSelectRightPanel.getChildByName("right_horse_stat_lb").source="icon_stats_s_png",this.horseSelectRightPanel.getChildByName("right_horse_skill_lb").source="icon_skill_n_png",this.horseSelectRightPanel.getChildByName("right_horse_pedigree_lb").source="icon_pedigree_n_png",this.horseSelectRightPanel.getChildByName("right_group_stat").visible=!0,this.horseSelectRightPanel.getChildByName("right_skill_group").visible=!1,this.horseSelectRightPanel.getChildByName("right_pedigree_group").visible=!1},this),this.horseSelectRightPanel.getChildByName("right_horse_skill_lb").addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){CommonAudioHandle.playEffect("playBomb_mp3",1),this.horseSelectRightPanel.getChildByName("right_horse_stat_lb").source="icon_stats_n_png",this.horseSelectRightPanel.getChildByName("right_horse_skill_lb").source="icon_skill_s_png",this.horseSelectRightPanel.getChildByName("right_horse_pedigree_lb").source="icon_pedigree_n_png",this.horseSelectRightPanel.getChildByName("right_group_stat").visible=!1,this.horseSelectRightPanel.getChildByName("right_skill_group").visible=!0,this.horseSelectRightPanel.getChildByName("right_pedigree_group").visible=!1},this),this.horseSelectRightPanel.getChildByName("right_horse_pedigree_lb").addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){CommonAudioHandle.playEffect("playBomb_mp3",1),this.horseSelectRightPanel.getChildByName("right_horse_stat_lb").source="icon_stats_n_png",this.horseSelectRightPanel.getChildByName("right_horse_skill_lb").source="icon_skill_n_png",this.horseSelectRightPanel.getChildByName("right_horse_pedigree_lb").source="icon_pedigree_s_png",this.horseSelectRightPanel.getChildByName("right_group_stat").visible=!1,this.horseSelectRightPanel.getChildByName("right_skill_group").visible=!1,this.horseSelectRightPanel.getChildByName("right_pedigree_group").visible=!0},this)},e.prototype.createHorseMerge=function(){null!=this.horseSelectRightPanel&&(this.context.removeChild(this.horseSelectRightPanel),this.horseSelectRightPanel=null);var e=210,t=0;ConstValue.deviveNormalScale>=2&&(e-=0,t-=0),this.horseSelectRightPanel=new eui.Panel,this.horseSelectRightPanel.skinName="resource/eui_skins/UserUI/Merge_Right.exml",this.horseSelectRightPanel.title="Title",this.horseSelectRightPanel.x=e,this.horseSelectRightPanel.y=t,this.context.addChild(this.horseSelectRightPanel),CommonTools.fixFix(this.context,this.horseSelectRightPanel,2,0,-40),this.initMergeClick(),this.horseSelectRightPanel.getChildByName("left_pre_horse_img").visible=!1,this.horseSelectRightPanel.getChildByName("left_next_horse_img").visible=!1,this.horseSelectRightPanel.getChildByName("left_stallion_lb").visible=!1,this.horseSelectRightPanel.getChildByName("left_stallion_bg_img").visible=!1,this.horseSelectRightPanel.getChildByName("right_mare_lb").text="horses 1/3",this.horseSelectRightPanel.getChildByName("stallion_flag_img").visible=!1,this.horseSelectRightPanel.getChildByName("mare_flag_img").visible=!1,this.horseSelectRightPanel.getChildByName("merge_btn_lb").addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){CommonAudioHandle.playEffect("playBomb_mp3",1),this.createMergeFail(1)},this),this.horseSelectRightPanel.getChildByName("advanced_merge_btn_lb").addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){CommonAudioHandle.playEffect("playBomb_mp3",1),this.createMergeSuccess(1,0)},this)},e.prototype.closeMergeFail=function(){null!=this.maskBg2&&(this.context.removeChild(this.maskBg2),this.maskBg2=null),null!=this.horseMergeResult&&(this.context.removeChild(this.horseMergeResult),this.horseMergeResult=null)},e.prototype.createMergeFail=function(e){CommonAudioHandle.playEffect("failure_mp3",1),this.maskBg2=new eui.Image("black_mask_png"),this.maskBg2.alpha=.9,this.maskBg2.width=this.context.getStageWidth(),this.maskBg2.height=this.context.getStageHeight(),this.context.addChild(this.maskBg2),this.horseMergeResult=new eui.Panel,this.horseMergeResult.skinName="resource/eui_skins/UserUI/Merge_fail.exml",this.horseMergeResult.title="Title",this.horseMergeResult.horizontalCenter=0,this.context.addChild(this.horseMergeResult),CommonTools.fixFix(this.context,this.horseMergeResult,2,0,-40),this.horseMergeResult.getChildByName("merge_fail_confirm").addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){CommonAudioHandle.playEffect("playBomb_mp3",1),this.closeMergeFail()},this),2==e&&(this.horseMergeResult.getChildByName("merge_fail_icon").source="icon_heart2_png")},e.prototype.createMergeSuccess=function(e,t){CommonAudioHandle.playEffect("success_mp3",1),this.maskBg2=new eui.Image("black_mask_png"),this.maskBg2.alpha=.9,this.maskBg2.width=this.context.getStageWidth(),this.maskBg2.height=this.context.getStageHeight(),this.context.addChild(this.maskBg2),this.horseMergeResult=new eui.Panel,this.horseMergeResult.skinName="resource/eui_skins/UserUI/Merge_success.exml",this.horseMergeResult.title="Title",this.horseMergeResult.horizontalCenter=0,this.context.addChild(this.horseMergeResult),CommonTools.fixFix(this.context,this.horseMergeResult,2,0,-40),this.horseMergeResult.getChildByName("merge_fail_confirm").addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){CommonAudioHandle.playEffect("playBomb_mp3",1),this.closeMergeFail()},this),2==e&&(this.horseMergeResult.getChildByName("merge_success_title_img").source="pic_breed_png")},e.prototype.createMergeSuccessT=function(e){CommonAudioHandle.playEffect("success_mp3",1);var t=new eui.Image("black_mask_png");t.alpha=.9,t.width=this.context.getStageWidth(),t.height=this.context.getStageHeight(),this.context.addChild(t);var i=new eui.Panel;i.skinName="resource/eui_skins/UserUI/Merge_success.exml",i.title="Title",i.name="p_"+e.name,i.horizontalCenter=0,this.context.addChild(i),CommonTools.fixFix(this.context,i,2,0,-40),i.getChildByName("merge_fail_confirm").addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){CommonAudioHandle.playEffect("playBomb_mp3",1),this.context.removeChild(t),this.context.removeChild(i)},this);var n=i.getChildByName("merge_fail_title_img");n.source="pic_congratulation_png",i.getChildByName("merge_success_title_img").visible=!1;var o=i.getChildByName("horse_name_lb");o.text=e.name;var s=i.getChildByName("merge_lv_img");s.source="icon_level_"+e.iType+"_png";var a=i.getChildByName("merge_fail_icon");a.source="horse"+e.res_key+"_body_png"},e.prototype.createHorseBreeding=function(){null!=this.horseSelectRightPanel&&(this.context.removeChild(this.horseSelectRightPanel),this.horseSelectRightPanel=null);var e=210,t=0;ConstValue.deviveNormalScale>=2&&(e-=0,t-=0),this.horseSelectRightPanel=new eui.Panel,this.horseSelectRightPanel.skinName="resource/eui_skins/UserUI/Merge_Right.exml",this.horseSelectRightPanel.title="Title",this.horseSelectRightPanel.x=e,this.horseSelectRightPanel.y=t,this.context.addChild(this.horseSelectRightPanel),CommonTools.fixFix(this.context,this.horseSelectRightPanel,2,0,-40),this.initMergeClick(),this.horseSelectRightPanel.getChildByName("merge_title_img").source="BREEDING_png",this.horseSelectRightPanel.getChildByName("merge_btn_lb").text="Breeding",this.horseSelectRightPanel.getChildByName("advanced_merge_btn_lb").text="Advanced\nBreeding",this.horseSelectRightPanel.getChildByName("merge_btn_lb").addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){CommonAudioHandle.playEffect("playBomb_mp3",1),this.createMergeFail(2)},this),this.horseSelectRightPanel.getChildByName("advanced_merge_btn_lb").addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){CommonAudioHandle.playEffect("playBomb_mp3",1),this.createMergeSuccess(2,0)},this)},e.prototype.horseSelectUI=function(){1==this.subCurPage?(this.maskNew.source="horse_home_page2_jpg",this.createHorseItem(),this.btnPveAnim.visible=!0,this.panel.getChildByName("up_item_group").getChildByName("horse_lv_img").visible=!0,this.panel.getChildByName("up_item_group").getChildByName("horse_lv_bg_mg").visible=!0):2==this.subCurPage?(this.maskNew.source="horse_merge_page2_jpg",this.clearPage2HorseHome(),this.createHorseMerge()):3==this.subCurPage&&(this.maskNew.source="horse_merge_page2_jpg",this.clearPage2HorseHome(),this.createHorseBreeding())},e.prototype.royalClubUI=function(){var e=240,t=68;ConstValue.deviveNormalScale>=2&&(e+=70,t-=0),this.panel.getChildByName("up_item_group").getChildByName("horse_lv_img").visible=!1,this.panel.getChildByName("up_item_group").getChildByName("horse_lv_bg_mg").visible=!1,this.horseSelectMiddlePanel=new eui.Panel,this.horseSelectMiddlePanel.skinName="resource/eui_skins/UserUI/RoyalClub.exml",this.horseSelectMiddlePanel.title="Title",this.horseSelectMiddlePanel.x=e,this.horseSelectMiddlePanel.y=t,this.context.addChild(this.horseSelectMiddlePanel),CommonTools.fixFix(this.context,this.horseSelectMiddlePanel,2,0,-40),this.horseSelectMiddlePanel.getChildByName("ticket_price_lb").text=ConstValue.cacheUserInfo.ticketPrice,this.horseSelectMiddlePanel.getChildByName("pay_main_lb").addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){CommonAudioHandle.playEffect("playBomb_mp3",1);var t=parseInt(this.horseSelectMiddlePanel.getChildByName("pay_main").text);return ConstValue.cacheUserInfo.coin<t?void CommonTools.addCommonTips(this.context,ConstValue.P_NOT_ENOUGH):void ContractSol.maincoin_transfer(ContractSol.createAddress,t)},this),this.horseSelectMiddlePanel.getChildByName("up_img").addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){CommonAudioHandle.playEffect("playBomb_mp3",1);var t=parseInt(this.horseSelectMiddlePanel.getChildByName("total_lb").text);t+=1,this.horseSelectMiddlePanel.getChildByName("total_lb").text=t,this.horseSelectMiddlePanel.getChildByName("pay_main").text=t*ConstValue.cacheUserInfo.ticketPrice},this),this.horseSelectMiddlePanel.getChildByName("down_img").addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){CommonAudioHandle.playEffect("playBomb_mp3",1);var t=parseInt(this.horseSelectMiddlePanel.getChildByName("total_lb").text);0>=t||(t-=1,this.horseSelectMiddlePanel.getChildByName("total_lb").text=t,this.horseSelectMiddlePanel.getChildByName("pay_main").text=t*ConstValue.cacheUserInfo.ticketPrice)},this)},e.prototype.CreateMarketItems=function(e){var t=240,i=68;ConstValue.deviveNormalScale>=2&&(t+=70,i-=0),this.horseSelectMiddlePanel=new eui.Panel,this.horseSelectMiddlePanel.skinName="resource/eui_skins/UserUI/Market_horses.exml",this.horseSelectMiddlePanel.title="Title",this.horseSelectMiddlePanel.x=t,this.horseSelectMiddlePanel.y=i,this.context.addChild(this.horseSelectMiddlePanel),CommonTools.fixFix(this.context,this.horseSelectMiddlePanel,2,0,-40);var n=this.horseSelectMiddlePanel.getChildByName("scroll"),o=n.getChildByName("scroll_group");o.removeChildren();var s=null;s=1==e?this.horseMarketData:this.horseOwnData;var a=1,l=function(t){var i=s[t],n=new eui.Panel;n.skinName="resource/eui_skins/UserUI/horseItemGroup_market.exml",n.name="p_"+i.id;var l=a%3==0?3:a%3,h=0;h=a%3==0?a/3:a/3+1,n.x=212*(l-1),n.y=278*Math.floor(h-1),o.addChild(n);var u=n.getChildByName("group_1");if(1==e){var c=u.getChildByName("pay_money");c.text=i.money}else if(2==e)if(u.getChildByName("btn_shop").visible=!1,1==i.sellStatus){var c=u.getChildByName("pay_money");c.text="selling"}else u.getChildByName("pay_money").visible=!1;var d=u.getChildByName("horse_name");d.text=i.name;var g=u.getChildByName("horse_index");g.text="#"+i.id;var m=u.getChildByName("horse_lv_img");m.source="icon_level_"+i.iType+"_png";var _=u.getChildByName("horse_score");_.text=i.score;var p=u.getChildByName("horse_body");p.source="horse"+i.res_key+"_body_png",0==r.horseIndexS&&(r.horseIndexS=i.id,u.getChildByName("select_2_img").visible=!0),n.addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){CommonAudioHandle.playEffect("playBomb_mp3",1);var t=o.getChildByName("p_"+this.horseIndexS),n=t.getChildByName("group_1");n.getChildByName("select_2_img").visible=!1,this.horseIndexS=i.id,u.getChildByName("select_2_img").visible=!0},r),a++},r=this;for(var h in s)l(h)},e.prototype.MarketUI=function(){null!=this.horseMarketData&&(this.changeHorseRight(1),this.CreateMarketItems(1))},e.prototype.MyInventoryUI=function(){return 0==ConstValue.cacheContract.nftLen?void CommonTools.addCommonTips(this.context,ConstValue.P_NO_HORSE):void(null!=this.horseOwnData&&(this.changeHorseRight(1),this.CreateMarketItems(2)))},e.prototype.horseMarketUI=function(){this.maskNew.source="horse_market_page5_jpg",this.btnPveAnim.visible=!1,1==this.subCurPage?this.royalClubUI():2==this.subCurPage?this.MarketUI():3==this.subCurPage&&this.MyInventoryUI()},e.prototype.showTrainingSelect=function(e){this.horseSelectLeftPanel.getChildByName("training_img_01").source="btn_TNGP_png",this.horseSelectLeftPanel.getChildByName("training_img_01").alpha=.5,this.horseSelectLeftPanel.getChildByName("training_img_02").source="btn_TNGFR_png",this.horseSelectLeftPanel.getChildByName("training_img_02").alpha=.7,this.horseSelectLeftPanel.getChildByName("training_img_03").source="btn_TNGOBS_png",this.horseSelectLeftPanel.getChildByName("training_img_03").alpha=.7,this.horseSelectLeftPanel.getChildByName("training_img_04").source="btn_TNGtrot_png",this.horseSelectLeftPanel.getChildByName("training_img_04").alpha=.7,this.horseSelectLeftPanel.getChildByName("training_img_05").source="btn_TNGC_png",this.horseSelectLeftPanel.getChildByName("training_img_05").alpha=.5;var t="";1==e?t="btn_TNGP_S_png":2==e?t="btn_TNGFR_S_png":3==e?t="btn_TNGOBS_S_png":4==e?t="btn_TNGtrot_S_png":5==e&&(t="btn_TNGC_S_png"),this.horseSelectLeftPanel.getChildByName("training_img_0"+e).source=t,this.horseSelectLeftPanel.getChildByName("training_img_0"+e).alpha=1},e.prototype.startTraining=function(e){this.horseSelectLeftPanel.visible=!1,this.horseSelectMiddlePanel.visible=!1,this.horseSelectRightPanel.visible=!1,this.horseSelectPanel.visible=!1,this.btnPveAnimX=-200,this.setHorseXY(),this.drawTraining(e)},e.prototype.createTrainingSuccess=function(){CommonAudioHandle.playEffect("success_mp3",1),this.maskBg2=new eui.Image("black_mask_png"),this.maskBg2.alpha=.9,this.maskBg2.width=this.context.getStageWidth(),this.maskBg2.height=this.context.getStageHeight(),this.context.addChild(this.maskBg2),this.horseMergeResult=new eui.Panel,this.horseMergeResult.skinName="resource/eui_skins/UserUI/Training_success.exml",this.horseMergeResult.title="Title",this.horseMergeResult.horizontalCenter=0,this.context.addChild(this.horseMergeResult),CommonTools.fixFix(this.context,this.horseMergeResult,2,0,-40),this.horseMergeResult.getChildByName("merge_fail_confirm").addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){CommonAudioHandle.playEffect("playBomb_mp3",1),this.closeMergeFail()},this)},e.prototype.stopTraining=function(){this.horseSelectLeftPanel.visible=!0,this.horseSelectMiddlePanel.visible=!0,this.horseSelectRightPanel.visible=!0,this.horseSelectPanel.visible=!0,this.btnPveAnimX=this.btnPveAnimInitX,this.btnPveAnim.x=this.btnPveAnimX,this.drawHorse(),this.createTrainingSuccess()},e.prototype.updateTraining=function(){if(null==this.horseSelectRightPanel){var e=900,t=100,i=420,n=180,o=0,s=0;ConstValue.deviveNormalScale>=2&&(e-=0,t-=0,i-=80,n-=200,o-=0,s-=0),this.horseSelectRightPanel=new eui.Panel,this.horseSelectRightPanel.skinName="resource/eui_skins/UserUI/Training_right.exml",this.horseSelectRightPanel.title="Title",this.horseSelectRightPanel.x=e,this.horseSelectRightPanel.y=t,this.context.addChild(this.horseSelectRightPanel),CommonTools.fixFix(this.context,this.horseSelectRightPanel,2,0,-40),this.horseSelectMiddlePanel=new eui.Panel,this.horseSelectMiddlePanel.skinName="resource/eui_skins/UserUI/Training_middle.exml",this.horseSelectMiddlePanel.title="Title2",this.horseSelectMiddlePanel.x=i,this.horseSelectMiddlePanel.y=n,this.horseSelectMiddlePanel.scaleX=.7,this.horseSelectMiddlePanel.scaleY=.7,this.context.addChild(this.horseSelectMiddlePanel),CommonTools.fixFix(this.context,this.horseSelectMiddlePanel,2,0,-40),this.horseSelectLeftPanel=new eui.Panel,this.horseSelectLeftPanel.skinName="resource/eui_skins/UserUI/Training_left.exml",this.horseSelectLeftPanel.title="Title3",this.horseSelectLeftPanel.x=o,this.horseSelectLeftPanel.y=s,this.context.addChild(this.horseSelectLeftPanel),CommonTools.fixFix(this.context,this.horseSelectLeftPanel,2,0,-40),this.horseSelectLeftPanel.getChildByName("btn_back_img").addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){CommonAudioHandle.playEffect("playBomb_mp3",1),this.changePage("rank_head_01")},this),this.horseSelectRightPanel.getChildByName("train_btn_img").addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){CommonAudioHandle.playEffect("playBomb_mp3",1),this.startTraining(4)},this);for(var a=function(e){l.horseSelectLeftPanel.getChildByName("training_img_0"+e).addEventListener(egret.TouchEvent.TOUCH_TAP,function(t){CommonAudioHandle.playEffect("playBomb_mp3",1),this.showTrainingSelect(e)},l)},l=this,r=1;5>=r;r++)a(r)}},e.prototype.clearTraining=function(){null!=this.horseSelectRightPanel&&(this.context.removeChild(this.horseSelectRightPanel),this.horseSelectRightPanel=null),null!=this.horseSelectMiddlePanel&&(this.context.removeChild(this.horseSelectMiddlePanel),this.horseSelectMiddlePanel=null),null!=this.horseSelectLeftPanel&&(this.context.removeChild(this.horseSelectLeftPanel),this.horseSelectLeftPanel=null)},e.prototype.hideForAll=function(){this.panel.getChildByName("rank_grounp_main").visible=!1,this.panel.getChildByName("up_item_group").visible=!1,this.panel.getChildByName("horse_name_group").visible=!1,this.btnPveAnim.visible=!1},e.prototype.createCargoSuccess=function(e){CommonAudioHandle.playEffect("success_mp3",1),this.maskBg2=new eui.Image("black_mask_png"),this.maskBg2.alpha=.9,this.maskBg2.width=this.context.getStageWidth(),this.maskBg2.height=this.context.getStageHeight(),this.context.addChild(this.maskBg2),this.horseMergeResult=new eui.Panel,this.horseMergeResult.skinName="resource/eui_skins/UserUI/Cargo_success.exml",this.horseMergeResult.title="Title",this.horseMergeResult.horizontalCenter=0,this.context.addChild(this.horseMergeResult),CommonTools.fixFix(this.context,this.horseMergeResult,2,0,-40),this.horseMergeResult.getChildByName("merge_fail_confirm").addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){CommonAudioHandle.playEffect("playBomb_mp3",1),this.closeMergeFail()},this)},e.prototype.task01UI=function(){this.panel.getChildByName("up_item_group").visible=!0,this.panel.getChildByName("up_item_group").getChildByName("horse_lv_img").visible=!1,this.panel.getChildByName("up_item_group").getChildByName("horse_lv_bg_mg").visible=!1,this.horseSelectMiddlePanel=new eui.Panel,this.horseSelectMiddlePanel.skinName="resource/eui_skins/UserUI/PlayToEarn_select_01.exml",this.horseSelectMiddlePanel.title="Title",this.horseSelectMiddlePanel.horizontalCenter=0,this.horseSelectMiddlePanel.verticalCenter=0,this.context.addChild(this.horseSelectMiddlePanel),CommonTools.fixFix(this.context,this.horseSelectMiddlePanel,2,0,-40),this.horseSelectMiddlePanel.getChildByName("clain_rewards_btn").addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){CommonAudioHandle.playEffect("playBomb_mp3",1),this.testAddMain()
},this),this.tipsPanel=this.horseSelectMiddlePanel},e.prototype.task02UI=function(){this.panel.getChildByName("up_item_group").visible=!1;var e=280,t=180;this.btnPveAnimX=280,this.setHorseXY(),ConstValue.deviveNormalScale>=2&&(e-=80,t-=200,this.btnPveAnimX+=0),this.horseSelectMiddlePanel=new eui.Panel,this.horseSelectMiddlePanel.skinName="resource/eui_skins/UserUI/Training_middle.exml",this.horseSelectMiddlePanel.title="Title2",this.horseSelectMiddlePanel.x=e,this.horseSelectMiddlePanel.y=t,this.horseSelectMiddlePanel.scaleX=.7,this.horseSelectMiddlePanel.scaleY=.7,this.context.addChild(this.horseSelectMiddlePanel),CommonTools.fixFix(this.context,this.horseSelectMiddlePanel,2,0,-40),this.horseSelectRightPanel=new eui.Panel,this.horseSelectRightPanel.skinName="resource/eui_skins/UserUI/PlayToEarn_select_02.exml",this.horseSelectRightPanel.title="Title",this.horseSelectRightPanel.horizontalCenter=0,this.horseSelectRightPanel.verticalCenter=0,this.context.addChild(this.horseSelectRightPanel),CommonTools.fixFix(this.context,this.horseSelectRightPanel,2,0,-40),this.horseSelectRightPanel.getChildByName("Process_btn_lb").addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){CommonAudioHandle.playEffect("playBomb_mp3",1),this.createCargoSuccess()},this)},e.prototype.task03UI=function(){this.panel.getChildByName("up_item_group").visible=!1;var e=280,t=180;this.btnPveAnimX=280,this.setHorseXY(),ConstValue.deviveNormalScale>=2&&(e-=80,t-=200,this.btnPveAnimX+=0),this.horseSelectMiddlePanel=new eui.Panel,this.horseSelectMiddlePanel.skinName="resource/eui_skins/UserUI/Training_middle.exml",this.horseSelectMiddlePanel.title="Title2",this.horseSelectMiddlePanel.x=e,this.horseSelectMiddlePanel.y=t,this.horseSelectMiddlePanel.scaleX=.7,this.horseSelectMiddlePanel.scaleY=.7,this.context.addChild(this.horseSelectMiddlePanel),CommonTools.fixFix(this.context,this.horseSelectMiddlePanel,2,0,-40),this.horseSelectRightPanel=new eui.Panel,this.horseSelectRightPanel.skinName="resource/eui_skins/UserUI/PlayToEarn_select_03.exml",this.horseSelectRightPanel.title="Title",this.horseSelectRightPanel.horizontalCenter=0,this.horseSelectRightPanel.verticalCenter=0,this.context.addChild(this.horseSelectRightPanel),CommonTools.fixFix(this.context,this.horseSelectRightPanel,2,0,-40),this.horseSelectRightPanel.getChildByName("Process_btn_lb").addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){CommonAudioHandle.playEffect("playBomb_mp3",1),this.createCargoSuccess()},this)},e.prototype.clearTask=function(){null!=this.btnBackImgTemp&&(this.context.removeChild(this.btnBackImgTemp),this.btnBackImgTemp=null),null!=this.horseSelectMiddlePanel&&(this.context.removeChild(this.horseSelectMiddlePanel),this.horseSelectMiddlePanel=null),null!=this.horseSelectRightPanel&&(this.context.removeChild(this.horseSelectRightPanel),this.horseSelectRightPanel=null),null!=this.horseSelectPanel&&(this.context.removeChild(this.horseSelectPanel),this.horseSelectPanel=null)},e.prototype.taskUpdate=function(e){this.subCurPage=e,this.clearTask(),1==e&&this.task01UI(),2==e&&(this.btnPveAnim.visible=!0,this.createHorseItem(),this.task02UI()),3==e&&(this.btnPveAnim.visible=!0,this.createHorseItem(),this.task03UI()),this.btnBackImgTemp=new eui.Image,this.btnBackImgTemp.name="btnTempBack",this.btnBackImgTemp.source="btn_back_png",this.btnBackImgTemp.width=102,this.btnBackImgTemp.height=67,this.btnBackImgTemp.x=0,this.btnBackImgTemp.y=660,this.context.addChild(this.btnBackImgTemp),CommonTools.fixFix(this.context,this.btnBackImgTemp,1,0,-50),this.btnBackImgTemp.addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){CommonAudioHandle.playEffect("playBomb_mp3",1),this.panel.getChildByName("up_item_group").visible=!1,this.btnPveAnimX=-500,this.setHorseXY(),this.updatePlayToEarn()},this)},e.prototype.updatePlayToEarn=function(){this.clearTask(),this.btnPveAnim.visible=!1,this.horseSelectMiddlePanel=new eui.Panel,this.horseSelectMiddlePanel.skinName="resource/eui_skins/UserUI/PlayToEarn_select.exml",this.horseSelectMiddlePanel.title="Title",this.horseSelectMiddlePanel.horizontalCenter=0,this.horseSelectMiddlePanel.verticalCenter=0,this.context.addChild(this.horseSelectMiddlePanel),CommonTools.fixFix(this.context,this.horseSelectMiddlePanel,2,0,-40),this.btnBackImgTemp=new eui.Image,this.btnBackImgTemp.name="btnTempBack",this.btnBackImgTemp.source="btn_back_png",this.btnBackImgTemp.width=102,this.btnBackImgTemp.height=67,this.btnBackImgTemp.x=0,this.btnBackImgTemp.y=660,this.context.addChild(this.btnBackImgTemp),CommonTools.fixFix(this.context,this.btnBackImgTemp,1,0,-50),this.btnBackImgTemp.addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){CommonAudioHandle.playEffect("playBomb_mp3",1),this.changePage("rank_head_01")},this),this.horseSelectMiddlePanel.getChildByName("task_0"+this.subCurPage+"_select_di").visible=!0,this.horseSelectMiddlePanel.getChildByName("task_01_select").addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){CommonAudioHandle.playEffect("playBomb_mp3",1),this.taskUpdate(1)},this),this.horseSelectMiddlePanel.getChildByName("task_02_select").addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){CommonAudioHandle.playEffect("playBomb_mp3",1),this.taskUpdate(2)},this),this.horseSelectMiddlePanel.getChildByName("task_03_select").addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){CommonAudioHandle.playEffect("playBomb_mp3",1),this.taskUpdate(3)},this)},e.prototype.updateUI=function(){if(1==this.curPage){var e=this.panel.getChildByName("up_item_group").getChildByName("horse_lv_img");e.source=ConstValue.horseLv[ConstValue.cacheUserInfo.lv.toString()].lv_icon,this.panel.getChildByName("horse_name_group").getChildByName("horse_name_lb").text=ConstValue.cacheUserInfo.name,this.panel.getChildByName("up_item_group").getChildByName("main_coin_num_lb").text=ConstValue.cacheUserInfo.coin,this.panel.getChildByName("up_item_group").getChildByName("sub_coin_num_lb").text=ConstValue.cacheUserInfo.diamond}else 2==this.curPage?this.horseSelectUI():3==this.curPage?(this.panel.getChildByName("horse_name_group").visible=!1,this.panel.getChildByName("up_item_group").getChildByName("horse_lv_img").visible=!1,this.panel.getChildByName("up_item_group").getChildByName("horse_lv_bg_mg").visible=!1,this.createHorseItem(),this.updateTraining()):4==this.curPage?(this.hideForAll(),this.updatePlayToEarn()):5==this.curPage&&(null!=this.horseSelectMiddlePanel&&(this.context.removeChild(this.horseSelectMiddlePanel),this.horseSelectMiddlePanel=null),null!=this.horseSelectRightPanel&&(this.context.removeChild(this.horseSelectRightPanel),this.horseSelectRightPanel=null),this.horseMarketUI())},e.prototype.updateMaincoin=function(e,t){if(this.panel.getChildByName("up_item_group").getChildByName("main_coin_num_lb").text=e,t){var i=CommonTools.getDataJsonStr("saveCoinInfo",1,{mainCoin:e,subCoin:0});ConstValue.P_NET_OBJ.sendData(i)}},e.prototype.updateSubcoin=function(e,t){if(this.panel.getChildByName("up_item_group").getChildByName("sub_coin_num_lb").text=e,t){var i=CommonTools.getDataJsonStr("saveCoinInfo",1,{mainCoin:0,subCoin:e});ConstValue.P_NET_OBJ.sendData(i)}},e.prototype.initAD=function(){null==ConstValue.videoAd&&(ConstValue.videoAd=1)},e.prototype.showGuide=function(){if(1!=ConstValue.p_USE_WALLET)for(var e=["2","4","6","8","9","10","7"],t=0;t<e.length;t++)if(!("7"==e[t]&&ConstValue.cacheUserInfo.lv<5)&&"1"!=egret.localStorage.getItem(GuideModule.guide_tip_new[e[t]].saveKey)){this.guideModule=new GuideModule(null,parseInt(e[t]),this.panel,null);break}},e.prototype.removeGuide=function(){null!=this.guideModule&&(this.guideModule.removeTips(),this.guideModule=null)},e.prototype.moveNotify=function(){this.notify_lb.x=430;var e="喜迎新春，新春开服，福利多多，大家快来体验吧~";if(ConstValue.oneTipsCnt>ConstValue.oneTipsCur)0==ConstValue.oneTipsCur?(ConstValue.oneTipsCur++,null!=ConstValue.oneTips[ConstValue.oneTipsCur]&&(e=ConstValue.oneTips[ConstValue.oneTipsCur])):(null!=ConstValue.oneTips[ConstValue.oneTipsCur]&&delete ConstValue.oneTips[ConstValue.oneTipsCur],ConstValue.oneTipsCur++,null!=ConstValue.oneTips[ConstValue.oneTipsCur]&&(e=ConstValue.oneTips[ConstValue.oneTipsCur]));else{var t=CommonTools.getRandomFloor(3,!0);null!=ConstValue.sysTips[t]&&(e=ConstValue.sysTips[t])}this.notify_lb.text=e,egret.Tween.get(this.notify_lb).to({x:-426},8e3).call(function(){this.moveNotify()},this)},e.prototype.getTipXY=function(){return[this.btnPveAnim.x,this.btnPveAnim.y]},e.prototype.initPushBtn=function(){var t=750,i=26,n=5,o=1222.48,s=100,a=28,l=0,r=0,h=new Array,u=new Array;for(var c in e.pushBtnData){var d=e.pushBtnData[c];0!=d.isOpen&&(d.id>12||(1==d.pos?u.push(d):h.push(d)))}u.sort(function(e,t){return e.weight-t.weight}),h.sort(function(e,t){return e.weight-t.weight});for(var c in u){var d=u[c],g=ConstValue.PUSH_BUTTON[d.id+""],m=new eui.Image;m.name=g.btn_name,m.source=g.btn_res_01,m.width=84,m.height=84,m.x=o+42,m.y=s+a*r+m.height*r+42,r++,CommonTools.fixFix(this.context,m,2,0,0),m.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.panel.addChild(m),m.anchorOffsetX=42,m.anchorOffsetY=42,CommonButtonHandle.beginTouch(m,this)}for(var c in h){var d=h[c],g=ConstValue.PUSH_BUTTON[d.id+""],m=new eui.Image;m.name=g.btn_name,m.source=g.btn_res_01,m.width=94,m.height=94,m.x=t+n*l+m.width*l+47,m.y=i+47,l++,CommonTools.fixFix(this.context,m,2,-50,10),m.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.panel.addChild(m),m.scaleX=.8,m.scaleY=.8,m.anchorOffsetX=47,m.anchorOffsetY=47,CommonButtonHandle.beginTouch(m,this)}},e.prototype.openWXPVP=function(){if(CommonTools.log("--Main.roomkey--------"+Main.roomkey),null!=Main.roomkey){var e=CommonTools.getDataJsonStr("enter1V1Room",1,{fightRoomKey:Main.roomkey});ConstValue.P_NET_OBJ.sendData(e)}},e.prototype.clickNotice=function(e){for(var t=this.panelNotice.getChildByName("left_scroller"),i=t.getChildByName("left_group"),n=this.panelNotice.getChildByName("lb_title"),o=this.panelNotice.getChildByName("lb_mail_info"),s=i.numChildren,a=parseInt(e.replace("lb_notice_click","")),l=0;s>l;l++){var r=i.getChildByName("p_"+l),h=r.getChildByName("group_1");if(l==a){h.getChildByName("img_yellow").visible=!0,h.getChildByName("img_red").visible=!1;var u=h.getChildByName("img_letter");u.source=RES.getRes("mail_open2_png"),n.text="标题：喜报！！"+(l+1),o.text="恭喜用户1000"+l+"喜获超级大奖xxxxxxxxxxxxxx"}else h.getChildByName("img_yellow").visible=!1}},e.prototype.clickShopItem=function(e){this.shopItemClickName=e;var t=this.panelNotice.getChildByName("res_scroller"),i=t.getChildByName("res_group"),n=this.panelNotice.getChildByName("shop_show_icon"),o=this.panelNotice.getChildByName("shop_show_info"),s=this.panelNotice.getChildByName("coin_num_lb");s.text=ConstValue.cacheUserInfo.coin;var a=this.panelNotice.getChildByName("zuan_num_lb");a.text=ConstValue.cacheUserInfo.diamond;var l=i.numChildren,r=parseInt(e.replace("shop_item_click",""));1==this.shopUIType?(this.shopItemNo=this.dShopOrBagData.lShopInfo[r].iNo,this.shopPayType=this.dShopOrBagData.lShopInfo[r].payType,CommonTools.log("----this.shopItemNo-------"+this.shopItemNo),o.text=this.getConf("shopData",this.dShopOrBagData.lShopInfo[r].iNo.toString(),"desc"),this.shopItemName=this.getConf("shopData",this.dShopOrBagData.lShopInfo[r].iNo.toString(),"name")):(this.shopItemNo=this.dShopOrBagData.lItmeInfo[r].iNo,this.shopItemItemID=this.dShopOrBagData.lItmeInfo[r].iItemID,o.text=this.getConf("ItemData",this.dShopOrBagData.lItmeInfo[r].iNo.toString(),"desc"),this.shopItemName=this.getConf("ItemData",this.dShopOrBagData.lItmeInfo[r].iNo.toString(),"name"));for(var h=0;l>h;h++){var u=i.getChildByName("p_"+h),c=u.getChildByName("group_1"),d=c.getChildByName("shop_item_icon"),g=c.getChildByName("shop_item_bg"),m="shop_item_not_png",_="shop_item_yes_png";2==this.shopUIType&&(m="bag_item_not_png",_="bag_item_yes_png"),h==r?(n.source=d.source,g.source=_):g.source=m}},e.prototype.clickShopPage=function(e){var t=this.panelNotice.getChildByName("btn_fashion"),i=this.panelNotice.getChildByName("btn_paopao"),n=this.panelNotice.getChildByName("btn_texiao"),o=this.panelNotice.getChildByName("btn_daoju"),s=this.panelNotice.getChildByName("t_shi"),a=this.panelNotice.getChildByName("t_zhuang"),l=this.panelNotice.getChildByName("t_pao1"),r=this.panelNotice.getChildByName("t_pao2"),h=this.panelNotice.getChildByName("t_te"),u=this.panelNotice.getChildByName("t_xiao"),c=this.panelNotice.getChildByName("t_dao"),d=this.panelNotice.getChildByName("t_ju");s.stroke=3,a.stroke=3,l.stroke=3,r.stroke=3,h.stroke=3,u.stroke=3,c.stroke=3,d.stroke=3;var g="shop_page_not_png",m="shop_page_yes_png",_=16773583,p=15371313,C=15052686,y=16576479;2==this.shopUIType&&(g="rank_select_01_png",m="rank_select_02_png",_=10531804,p=7633371,C=8095419,y=13298175);var f=1;switch(e){case"btn_one_lb":t.source=m,i.source=g,n.source=g,o.source=g,s.textColor=p,a.textColor=p,l.textColor=_,r.textColor=_,h.textColor=_,u.textColor=_,c.textColor=_,d.textColor=_,s.strokeColor=y,a.strokeColor=y,l.strokeColor=C,r.strokeColor=C,h.strokeColor=C,u.strokeColor=C,c.strokeColor=C,d.strokeColor=C,f=1;break;case"btn_two_lb":t.source=g,i.source=m,n.source=g,o.source=g,s.textColor=_,a.textColor=_,l.textColor=p,r.textColor=p,h.textColor=_,u.textColor=_,c.textColor=_,d.textColor=_,s.strokeColor=C,a.strokeColor=C,l.strokeColor=y,r.strokeColor=y,h.strokeColor=C,u.strokeColor=C,c.strokeColor=C,d.strokeColor=C,f=2;break;case"btn_three_lb":t.source=g,i.source=g,n.source=m,o.source=g,s.textColor=_,a.textColor=_,l.textColor=_,r.textColor=_,h.textColor=p,u.textColor=p,c.textColor=_,d.textColor=_,s.strokeColor=C,a.strokeColor=C,l.strokeColor=C,r.strokeColor=C,h.strokeColor=y,u.strokeColor=y,c.strokeColor=C,d.strokeColor=C,f=3;break;case"btn_four_lb":t.source=g,i.source=g,n.source=g,o.source=m,s.textColor=_,a.textColor=_,l.textColor=_,r.textColor=_,h.textColor=_,u.textColor=_,c.textColor=p,d.textColor=p,s.strokeColor=C,a.strokeColor=C,l.strokeColor=C,r.strokeColor=C,h.strokeColor=C,u.strokeColor=C,c.strokeColor=y,d.strokeColor=y,f=4}if(1==this.shopUIType){this.shopPageType=f-1;var b=CommonTools.getDataJsonStr("openShopUI",1,{iType:this.shopPageType});ConstValue.P_NET_OBJ.sendData(b)}else{this.shopPageType=f-1;var b=CommonTools.getDataJsonStr("openBagUI",1,{iType:this.shopPageType});ConstValue.P_NET_OBJ.sendData(b)}},e.prototype.addCommonTips=function(e){CommonTools.addCommonTips(this.context,e)},e.prototype.clearPage2HorseHome=function(){null!=this.horseSelectPanel&&(this.context.removeChild(this.horseSelectPanel),this.horseSelectPanel=null),null!=this.horseSelectRightPanel&&(this.context.removeChild(this.horseSelectRightPanel),this.horseSelectRightPanel=null),null!=this.maskBg2&&(this.context.removeChild(this.maskBg2),this.maskBg2=null),this.btnPveAnim.visible=!1,this.panel.getChildByName("up_item_group").getChildByName("horse_lv_img").visible=!1,this.panel.getChildByName("up_item_group").getChildByName("horse_lv_bg_mg").visible=!1},e.prototype.autoChangeFirst=function(){this.curPage=6,this.changePage("rank_head_01")},e.prototype.changePage=function(e){if(this.horseIndexS=0,"rank_head_01"==e)5==this.curPage?(this.subCurPage=1,this.rankHead01_mask.visible=!0,this.rankHead02_mask.visible=!1,this.rankHead03_mask.visible=!1,this.rankHead01.source="icon_Royal-Club_s_png",this.rankHead02.source="icon_Horse-Market_n_png",this.rankHead03.source="icon_My-Inventory_n_png",this.updateUI()):(1!=this.curPage&&(this.maskNew.source="new_ui_01_jpg"),this.curPage=1,this.subCurPage=1,this.rankHead01_mask.visible=!0,this.rankHead02_mask.visible=!1,this.rankHead03_mask.visible=!1,this.rankHead04_mask.visible=!1,this.rankHead05_mask.visible=!1,this.rankHead01.source="icon_homestead_s_png",this.rankHead02.source="icon_stables_n_png",this.rankHead03.source="icon_training_n_png",this.rankHead04.source="icon_task_n_png",this.rankHead05.source="icon_marketpalec_n_png",this.panel.getChildByName("horse_name_group").visible=!0,this.btnBackImg.visible=!1,this.rankHead01.visible=!0,this.rankHead04.visible=!0,this.rankHead05.visible=!0,this.clearPage2HorseHome(),this.clearTraining(),this.btnPveAnim.visible=!0,this.panel.getChildByName("up_item_group").getChildByName("horse_lv_img").visible=!0,this.panel.getChildByName("up_item_group").getChildByName("horse_lv_bg_mg").visible=!0,this.panel.getChildByName("rank_grounp_main").visible=!0,null!=this.btnBackImgTemp&&(this.context.removeChild(this.btnBackImgTemp),this.btnBackImgTemp=null),this.btnPveAnimX=this.btnPveAnimInitX,this.btnPveAnim.x=this.btnPveAnimX,this.drawHorse(),this.panel.getChildByName("up_item_group").visible=!0,this.tipsPanel=this.panel);else if("rank_head_02"==e){if(5==this.curPage){if(2!=this.subCurPage){var t=CommonTools.getDataJsonStr("getNftMarket",1,{});ConstValue.P_NET_OBJ.sendData(t)}this.subCurPage=2,this.rankHead01_mask.visible=!1,this.rankHead02_mask.visible=!0,this.rankHead03_mask.visible=!1,this.rankHead01.source="icon_Royal-Club_n_png",this.rankHead02.source="icon_Horse-Market_s_png",this.rankHead03.source="icon_My-Inventory_n_png"}else this.panel.getChildByName("horse_name_group").visible=!1,this.curPage=2,this.subCurPage=1,this.rankHead01_mask.visible=!1,this.rankHead02_mask.visible=!0,this.rankHead03_mask.visible=!1,this.rankHead04_mask.visible=!1,this.rankHead05_mask.visible=!1,this.rankHead01.visible=!1,this.rankHead05.visible=!1,this.rankHead02.source="icon_horse_s_png",this.rankHead03.source="icon_merge_n_png",this.rankHead04.source="icon_breeding_n_png",this.btnBackImg.visible=!0;this.updateUI()}else"rank_head_03"==e?(2==this.curPage?(this.subCurPage=2,this.rankHead02_mask.visible=!1,this.rankHead03_mask.visible=!0,this.rankHead04_mask.visible=!1,this.rankHead02.source="icon_horse_n_png",this.rankHead03.source="icon_merge_s_png",this.rankHead04.source="icon_breeding_n_png"):5==this.curPage?(3!=this.subCurPage&&ConstValue.cacheContract.nftLen>0&&ContractSol.nft_tokensOfOwner(ContractSol.sender),this.subCurPage=3,this.rankHead01_mask.visible=!1,this.rankHead02_mask.visible=!1,this.rankHead03_mask.visible=!0,this.rankHead01.source="icon_Royal-Club_n_png",this.rankHead02.source="icon_Horse-Market_n_png",this.rankHead03.source="icon_My-Inventory_s_png"):(this.curPage=3,this.rankHead01_mask.visible=!1,this.rankHead02_mask.visible=!1,this.rankHead03_mask.visible=!0,this.rankHead04_mask.visible=!1,this.rankHead05_mask.visible=!1,this.rankHead01.source="icon_homestead_n_png",this.rankHead02.source="icon_stables_n_png",this.rankHead03.source="icon_training_s_png",this.rankHead04.source="icon_task_n_png",this.rankHead05.source="icon_marketpalec_n_png",this.panel.getChildByName("rank_grounp_main").visible=!1),this.updateUI()):"rank_head_04"==e?(2==this.curPage?(this.subCurPage=3,this.rankHead02_mask.visible=!1,this.rankHead03_mask.visible=!1,this.rankHead04_mask.visible=!0,this.rankHead02.source="icon_horse_n_png",this.rankHead03.source="icon_merge_n_png",this.rankHead04.source="icon_breeding_s_png"):(this.curPage=4,this.rankHead01_mask.visible=!1,this.rankHead02_mask.visible=!1,this.rankHead03_mask.visible=!1,this.rankHead04_mask.visible=!0,this.rankHead05_mask.visible=!1,this.rankHead01.source="icon_homestead_n_png",this.rankHead02.source="icon_stables_n_png",this.rankHead03.source="icon_training_n_png",this.rankHead04.source="icon_task_s_png",this.rankHead05.source="icon_marketpalec_n_png",this.maskNew.source="horse_playToEarn_page4_jpg"),this.updateUI()):"rank_head_05"==e&&(this.panel.getChildByName("horse_name_group").visible=!1,this.curPage=5,this.rankHead01_mask.visible=!0,this.rankHead02_mask.visible=!1,this.rankHead03_mask.visible=!1,this.rankHead04_mask.visible=!1,this.rankHead05_mask.visible=!1,this.rankHead01.source="icon_Royal-Club_s_png",this.rankHead02.source="icon_Horse-Market_n_png",this.rankHead03.source="icon_My-Inventory_n_png",this.rankHead04.visible=!1,this.rankHead05.visible=!1,this.btnBackImg.visible=!0,this.updateUI());this.setHorseXY(),(5!=this.curPage||5==this.curPage&&2!=this.subCurPage)&&(this.horseMarketData=null),5==this.curPage&&3==this.subCurPage?this.panel.getChildByName("sell_group").visible=!0:this.panel.getChildByName("sell_group").visible=!1,5==this.curPage&&2==this.subCurPage?this.panel.getChildByName("buynft_group").visible=!0:this.panel.getChildByName("buynft_group").visible=!1},e.prototype.testAddMain=function(){CommonTools.addCommonTips(this.tipsPanel,ConstValue.P_PUSHING_TR);var e=CommonTools.getDataJsonStr("AddMainCoin",1,{iAdd:5,iOpType:0});ConstValue.P_NET_OBJ.sendData(e)},e.prototype.testAddSub=function(){CommonTools.addCommonTips(this.tipsPanel,ConstValue.P_PUSHING_TR);var e=CommonTools.getDataJsonStr("AddSubCoin",1,{iAdd:5,iOpType:0});ConstValue.P_NET_OBJ.sendData(e)},e.prototype.onClick=function(t){return __awaiter(this,void 0,void 0,function(){var i,n,o,s,a,l,r,r,h,u,c,d,g,m,_,p,C,y,f,b,v,T,P,B,x,x,N,k,S;return __generator(this,function(I){switch(I.label){case 0:if(null!=this.context.loadingView&&!ConstValue.P_IS_DEBUG)return CommonTools.log("还在加载中......return "),[2];if(CommonAudioHandle.playEffect("playBomb_mp3",1),i=t.target.name,"btn_close"!=i&&"btn_close_edit"!=i&&this.removeGuide(),"btn_close"==i&&null==this.seventData&&this.showGuide(),CommonTools.log("==========name::::"+i),i.indexOf("lb_notice_click")>=0)return this.clickNotice(i),[2];if(i.indexOf("shop_item_click")>=0)return this.clickShopItem(i),[2];if(i.indexOf("rank_head_")>=0)return this.changePage(i),[2];switch(n=i){case"img_coin1_add":return[3,1];case"img_coin2_add":return[3,2];case"sell_btn_lb":return[3,3];case"buynft_btn_lb":return[3,4];case"btn_back_img":return[3,5];case"noend_tip":return[3,6];case"btn_tip":return[3,7];case"friend_rank_lb":return[3,8];case"btn_2v2":return[3,9];case"btn_close":return[3,10];case"btn_close_wx_vs":return[3,11];case"btn_start":return[3,12];case"btn_shop":return[3,13];case"btn_training_pve":return[3,14];case"btn_ranking":return[3,15];case"btn_gonggao":return[3,16];case"all_rank_lb":return[3,17];case"barrier_rank_lb":return[3,17];case"match_rank_lb":return[3,18];case"lv_rank_lb":return[3,19];case"btn_noticetip":return[3,20];case"btn_match_pvp":return[3,21];case"img_info":return[3,23];case"btn_friend_pvp":return[3,24];case"btn_noend_pve":return[3,25];case"btn_map_diy":return[3,26];case"btn_map_shop":return[3,28];case"btn_redtv":return[3,29];case"btn_map_bag":return[3,30];case"btn_select_role":return[3,31];case"btn_close_edit":return[3,32];case"btn_uplv_task":return[3,33];case"btn_skill":return[3,34];case"btn_maprank":return[3,35];case"btn_setting":return[3,36];case"scroll_notify":return[3,37];case"btn_one_lb":return[3,38];case"btn_two_lb":return[3,38];case"btn_three_lb":return[3,38];case"btn_four_lb":return[3,38];case"btn_buy":return[3,39];case"btn_confirm_modify":return[3,40]}return[3,41];case 1:return this.testAddMain(),[3,42];case 2:return this.testAddSub(),[3,42];case 3:return o=CommonTools.getDataJsonStr("SellNft",1,{nftIndex:this.horseIndexS}),ConstValue.P_NET_OBJ.sendData(o),[3,42];case 4:return s=CommonTools.getDataJsonStr("BuyNft",1,{nftIndex:this.horseIndexS,sAddress:ContractSol.sender}),ConstValue.P_NET_OBJ.sendData(s),[3,42];case 5:return 5==this.curPage&&0==ConstValue.cacheContract.nftLen?(CommonTools.addCommonTips(this.tipsPanel,ConstValue.P_NO_HORSE),[2]):(this.curPage=6,this.changePage("rank_head_01"),[3,42]);case 6:return a=CommonTools.getDataJsonStr("getHelp",1,{helpID:"1"}),ConstValue.P_NET_OBJ.sendData(a),[3,42];case 7:return l=CommonTools.getDataJsonStr("getHelp",1,{helpID:"2"}),ConstValue.P_NET_OBJ.sendData(l),[3,42];case 8:return CommonTools.addCommonTips(this.tipsPanel,"暂未开放"),[3,42];case 9:return CommonTools.addCommonTips(this.tipsPanel,"敬请期待"),[3,42];case 10:return this.closeNotice(),[3,42];case 11:return this.closeWxVsUI(),[3,42];case 12:return this.isMainRoomer?(r=CommonTools.getDataJsonStr("startGame1V1",1,{fightRoomKey:Main.roomkey}),ConstValue.P_NET_OBJ.sendData(r)):(r=CommonTools.getDataJsonStr("setReady1V1",1,{fightRoomKey:Main.roomkey}),ConstValue.P_NET_OBJ.sendData(r)),[3,42];case 13:return CommonTools.addCommonTips(this.tipsPanel,ConstValue.P_SEND_WAITING),[3,42];case 14:return 2==e.curGuide&&(e.curGuide=0,h=CommonTools.getDataJsonStr("getNextGuild",1,{}),ConstValue.P_NET_OBJ.sendData(h)),e.isTrainBrr=!0,u=CommonTools.getDataJsonStr("C2GEnterTrain",1,{}),ConstValue.P_NET_OBJ.sendData(u),[3,42];case 15:return c=CommonTools.getDataJsonStr("openRnakUI",1,{}),ConstValue.P_NET_OBJ.sendData(c),[3,42];case 16:return d=CommonTools.getDataJsonStr("getGonggao",1,{}),ConstValue.P_NET_OBJ.sendData(d),[3,42];case 17:return g=CommonTools.getDataJsonStr("getTotalGuankaRank",1,{}),ConstValue.P_NET_OBJ.sendData(g),[3,42];case 18:return m=CommonTools.getDataJsonStr("getTotalPvpRank",1,{}),ConstValue.P_NET_OBJ.sendData(m),[3,42];case 19:return _=CommonTools.getDataJsonStr("getTotalLvRank",1,{}),ConstValue.P_NET_OBJ.sendData(_),[3,42];case 20:return this.showNotice("resource/eui_skins/UserUI/NoticeUI.exml",i),[3,42];case 21:return 6==e.curGuide&&(e.curGuide=0,p=CommonTools.getDataJsonStr("getNextGuild",1,{}),ConstValue.P_NET_OBJ.sendData(p)),[4,this.context.loadResource("fighting",3)];case 22:return I.sent(),[3,42];case 23:return C=CommonTools.getDataJsonStr("getRoleDetail",1,{}),ConstValue.P_NET_OBJ.sendData(C),[3,42];case 24:return this.showNotice("resource/eui_skins/UserUI/SelectShareVsMapUI.exml",i),[3,42];case 25:return y=CommonTools.getDataJsonStr("C2GOpenWujinUI",1,{diffLevel:1}),ConstValue.P_NET_OBJ.sendData(y),[3,42];case 26:return 7==e.curGuide&&(e.curGuide=0,f=CommonTools.getDataJsonStr("getNextGuild",1,{}),ConstValue.P_NET_OBJ.sendData(f)),ConstValue.cacheUserInfo.btnCtrlData[5].openLv>ConstValue.cacheUserInfo.lv?(CommonTools.addCommonTips(this.tipsPanel,"等级"+ConstValue.cacheUserInfo.btnCtrlData[5].openLv+"级后开放"),[3,42]):[4,this.context.loadResource("diymap",4)];case 27:return I.sent(),[3,42];case 28:return b=CommonTools.getDataJsonStr("openShopUI",1,{iType:0}),ConstValue.P_NET_OBJ.sendData(b),[3,42];case 29:return this.showAD(5),[3,42];case 30:return v=CommonTools.getDataJsonStr("openBagUI",1,{iType:0}),ConstValue.P_NET_OBJ.sendData(v),[3,42];case 31:return T=CommonTools.getDataJsonStr("showAllClassList",1,{}),ConstValue.P_NET_OBJ.sendData(T),[3,42];case 32:return this.closeSub(),[3,42];case 33:return P=CommonTools.getDataJsonStr("showUpgradeReward",1,{}),ConstValue.P_NET_OBJ.sendData(P),[3,42];case 34:return B=CommonTools.getDataJsonStr("C2G_Open_MainUI",1,{}),ConstValue.P_NET_OBJ.sendData(B),[3,42];case 35:return null==ConstValue.P_MAP_OBJ&&(ConstValue.P_MAP_OBJ=new MapDIYModule(this.context,null,0)),[3,42];case 36:return this.showNotice("resource/eui_skins/UserUI/MainSetting.exml","btn_setting"),[3,42];case 37:return FightingModule.curBarrNo=29,this.showEditUI(i),[3,42];case 38:return this.clickShopPage(i),[3,42];case 39:return 1==this.shopUIType?3!=this.shopPayType?(x=CommonTools.getDataJsonStr("Buy",1,{iNo:this.shopItemNo,iType:this.shopPageType,num:1}),ConstValue.P_NET_OBJ.sendData(x)):(x=CommonTools.getDataJsonStr("playVidioBefore",1,{iNo:this.shopItemNo,iType:1,pageType:this.shopPageType}),ConstValue.P_NET_OBJ.sendData(x),this.showAD(3)):(N=CommonTools.getDataJsonStr("useItem",1,{iNo:this.shopItemNo,iType:this.shopPageType,iItemID:this.shopItemItemID}),ConstValue.P_NET_OBJ.sendData(N)),[3,42];case 40:if(k=this.panelSub.getChildByName("account_lb_txt"),""==k.text)return CommonTools.addCommonTips(this.tipsPanel,ConstValue.P_MODIFY_NULL_FAIL),[2];if(ConstValue.P_IS_DEBUG)CommonTools.addCommonTips(this.tipsPanel,ConstValue.P_SEND_MODIFY_SUCCESS),this.closeSub();else{if(this.sCurModifyValue=k.text,S="","scroll_notify"==this.sCurModifyBtn&&(S=CommonTools.getDataJsonStr("gmFunc",1,{gmCmd:this.sCurModifyValue})),""==S)return ConstValue.P_IS_INNER&&CommonTools.addCommonTips(this.tipsPanel,"btn_confirm_modify sData 为空"),[2];ConstValue.P_NET_OBJ.sendData(S)}return[3,42];case 41:return CommonTools.log("11111111 default"),[3,42];case 42:return[2]}})})},e.prototype.getConf=function(e,t,i){try{return ConstValue.P_CONFIG[e][t][i]}catch(n){return""}},e.prototype.onButtonClick=function(e){return __awaiter(this,void 0,void 0,function(){var e,t;return __generator(this,function(i){switch(i.label){case 0:return CommonTools.log("shareAppMessage-------1"),e=CommonTools.getDataJsonStr("gmFunc",1,{gmCmd:"test1v1"}),ConstValue.P_NET_OBJ.sendData(e),t=window.platform,[4,t.shareAppMessage(ConstValue.cacheUserInfo.id+"")];case 1:return i.sent(),CommonTools.log("shareAppMessage-------2"),[2]}})})},e.prototype.showNotice=function(e,t){this.curButton=t,this.maskBg=new eui.Image("bg_ppt_1_png"),this.maskBg.width=this.context.getStageWidth();var i=1334/this.context.getStageWidth();this.maskBg.height=750/i,this.context.addChild(this.maskBg),this.panelNotice=new eui.Panel,this.panelNotice.skinName=e,this.panelNotice.title="Title",this.panelNotice.horizontalCenter=0,this.panelNotice.verticalCenter=0,this.context.addChild(this.panelNotice),CommonTools.fixFix(this.context,this.panelNotice,1,0,0),this.tipsPanel=this.panelNotice,CommonButtonHandle.beginTouch(this.panelNotice.getChildByName("btn_close"),this),this.panelNotice.getChildByName("btn_close").addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.handlePanel(this.panelNotice,t),CommonTools.niceTip(this.panelNotice,1,this)},e.prototype.showRoleInfoUI=function(){this.maskBg2=new eui.Image("mask_layer_png"),this.maskBg2.width=this.context.getStageWidth(),this.maskBg2.height=this.context.getStageHeight(),this.context.addChild(this.maskBg2),this.panelSub=new eui.Panel,this.panelSub.skinName="resource/eui_skins/UserUI/RoleInfoUI.exml",this.panelSub.title="Title",this.panelSub.horizontalCenter=0,this.panelSub.verticalCenter=0,this.context.addChild(this.panelSub),CommonTools.fixFix(this.context,this.panelSub,1,0,0),this.tipsPanel=this.panelSub;var e=this.panelSub.getChildByName("lb_life"),t=this.panelSub.getChildByName("lb_boom"),i=this.panelSub.getChildByName("lb_speed"),n=this.panelSub.getChildByName("lb_power"),o=this.panelSub.getChildByName("lb_lv"),s=this.panelSub.getChildByName("lb_exp"),a=this.panelSub.getChildByName("info_name");e.text=this.roleDetailData.life,t.text=this.roleDetailData.cnt,i.text=this.roleDetailData.speed,n.text=this.roleDetailData.power,o.text=ConstValue.cacheUserInfo.lv,s.text=ConstValue.cacheUserInfo.curexp,a.text=ConstValue.cacheUserInfo.name,CommonButtonHandle.beginTouch(this.panelSub.getChildByName("btn_close"),this),this.panelSub.getChildByName("btn_close").addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){CommonTools.niceTip(this.panelSub,2,this)},this),this.bodyAniDown2=CommonTools.getAnimDraw(RES.getRes("p"+ConstValue.cacheUserInfo.iClass+"_special_json"),RES.getRes("p"+ConstValue.cacheUserInfo.iClass+"_special_png"),"0"),this.bodyAniDown2.play(-1),this.panelSub.addChild(this.bodyAniDown2),this.bodyAniDown2.x=580,this.bodyAniDown2.y=370},e.prototype.showBarrinfoUI=function(t){this.maskBg2=new eui.Image("mask_layer_png"),this.maskBg2.width=this.context.getStageWidth(),this.maskBg2.height=this.context.getStageHeight(),this.context.addChild(this.maskBg2),this.panelSub=new eui.Panel,this.panelSub.skinName="resource/eui_skins/UserUI/ViewHistoryPass.exml",this.panelSub.title="Title",this.panelSub.horizontalCenter=0,this.panelSub.verticalCenter=0,this.context.addChild(this.panelSub),CommonTools.fixFix(this.context,this.panelSub,1,0,0),this.panelSub.getChildByName("btn_close").addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){CommonTools.niceTip(this.panelSub,2,this)},this),this.panelSub.getChildByName("start_btn").addEventListener(egret.TouchEvent.TOUCH_TAP,function(i){e.isNoEnd=!0,FightingModule.curBarrNo=parseInt(t.iBarrierNo);var n=CommonTools.getDataJsonStr("C2GGotoBarrier",1,{barrierNo:parseInt(t.iBarrierNo)});ConstValue.P_NET_OBJ.sendData(n)},this);var i=this.panelSub.getChildByName("view_barr_title");parseInt(t.iBarrierNo)<10?i.text="第 0"+t.iBarrierNo+" 关":i.text="第 "+t.iBarrierNo+" 关";var n=this.panelSub.getChildByName("info_1");n.text=t.winRate+"%";var o=this.panelSub.getChildByName("info_2");
o.text=t.myTime+"s";var s=this.panelSub.getChildByName("info_3");s.text=t.serverBestname+" "+t.serverBsetTime+" s";for(var a=0;a<t.iStar;a++){var l=this.panelSub.getChildByName("star_0"+(a+1));l.source="start_01_png"}},e.prototype.showWxVsUI=function(e){this.maskBg2=new eui.Image("vs_bg_1v1_png"),this.maskBg2.width=this.context.getStageWidth(),this.maskBg2.height=this.context.getStageHeight(),this.context.addChild(this.maskBg2),this.showWxVsPanel=new eui.Panel,this.showWxVsPanel.skinName="resource/eui_skins/UserUI/WxVsWaitUI.exml",this.showWxVsPanel.title="Title",this.showWxVsPanel.horizontalCenter=0,this.showWxVsPanel.verticalCenter=0,this.context.addChild(this.showWxVsPanel),this.tipsPanel=this.showWxVsPanel,CommonTools.fixFix(this.context,this.showWxVsPanel,1,0,0),CommonButtonHandle.beginTouch(this.showWxVsPanel.getChildByName("btn_close_wx_vs"),this),this.showWxVsPanel.getChildByName("btn_close_wx_vs").addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),CommonButtonHandle.beginTouch(this.showWxVsPanel.getChildByName("btn_start"),this),this.showWxVsPanel.getChildByName("btn_start").addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.updateWxVsUI(e)},e.prototype.updateWxVsUI=function(e){var t=this.showWxVsPanel.getChildByName("left_online"),i=this.showWxVsPanel.getChildByName("left_name"),n=this.showWxVsPanel.getChildByName("left_ready"),o=this.showWxVsPanel.getChildByName("left_lv"),s=this.showWxVsPanel.getChildByName("right_online"),a=this.showWxVsPanel.getChildByName("right_name"),l=this.showWxVsPanel.getChildByName("right_ready"),r=this.showWxVsPanel.getChildByName("right_lv"),h=this.showWxVsPanel.getChildByName("btn_start"),u=[.3,.6,0,0,0,.3,.6,0,0,0,.3,.6,0,0,0,0,0,0,1,0],c=new egret.ColorMatrixFilter(u);if(1==e.lWaitInfo.length?(t.text=1==e.lWaitInfo[0].isOnline?"在线":"等待",i.text=e.lWaitInfo[0].name,n.text=1==e.lWaitInfo[0].isReady?"已准备":"等待",o.text="Lv."+e.lWaitInfo[0].iLv,e.lWaitInfo[0].rid==ConstValue.cacheUserInfo.id&&(this.isMainRoomer=!0),h.filters=[c],h.enabled=!1):(t.text=1==e.lWaitInfo[0].isOnline?"在线":"等待",i.text=e.lWaitInfo[0].name,n.text=1==e.lWaitInfo[0].isReady?"已准备":"等待",o.text="Lv."+e.lWaitInfo[0].iLv,s.text=1==e.lWaitInfo[1].isOnline?"在线":"等待",a.text=e.lWaitInfo[1].name,l.text=1==e.lWaitInfo[1].isReady?"已准备":"等待",r.text="Lv."+e.lWaitInfo[1].iLv,this.isMainRoomer?1==e.lWaitInfo[1].isOnline&&1==e.lWaitInfo[1].isReady?(h.filters=[],h.enabled=!0):(h.filters=[c],h.enabled=!1):1==e.lWaitInfo[1].isReady?(h.filters=[c],h.enabled=!1,h.label="就  绪"):(h.filters=[],h.enabled=!0,h.label="准  备")),null!=e.MapInfo.roleId&&(this.showWxVsPanel.getChildByName("img_wx_wenhao").visible=!1,new MapMiniDIYModule(this.showWxVsPanel,e.MapInfo.bgconf,e.MapInfo.layerconf,3)),1==e.lWaitInfo.length){var d=this.showWxVsPanel.getChildByName("img_lefthead");""!=e.lWaitInfo[0].head&&(d.source=e.lWaitInfo[0].head)}if(2==e.lWaitInfo.length){var d=this.showWxVsPanel.getChildByName("img_lefthead");""!=e.lWaitInfo[0].head&&(d.source=e.lWaitInfo[0].head);var g=this.showWxVsPanel.getChildByName("img_righthead");""!=e.lWaitInfo[1].head&&(g.source=e.lWaitInfo[1].head)}},e.prototype.showEditUI=function(e){this.panelSub=new eui.Panel,this.panelSub.skinName="resource/eui_skins/UserUI/EditUI.exml",this.panelSub.title="Title",this.panelSub.horizontalCenter=0,this.panelSub.verticalCenter=0,this.context.addChild(this.panelSub),this.tipsPanel=this.panelSub,CommonButtonHandle.beginTouch(this.panelSub.getChildByName("btn_close_edit"),this),this.panelSub.getChildByName("btn_close_edit").addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),CommonButtonHandle.beginTouch(this.panelSub.getChildByName("btn_confirm_modify"),this),this.panelSub.getChildByName("btn_confirm_modify").addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.panelSub.getChildByName("lb_edit_title").text=ConstValue.P_MODIFY_TITLE,this.sCurModifyBtn=e,"modify_nichen_btn"==e?this.panelSub.getChildByName("lb_desc").text=ConstValue.P_MODIFY_NICHENG:"modify_pwd_btn"==e?(this.panelSub.getChildByName("lb_old_pwd").text=ConstValue.P_MODIFY_OLD_PWD,this.panelSub.getChildByName("lb_desc").text=ConstValue.P_MODIFY_NEW_PWD,this.panelSub.getChildByName("lb_new_pwd").text=ConstValue.P_MODIFY_NEW_PWD,this.panelSub.getChildByName("lb_old_pwd").visible=!0,this.panelSub.getChildByName("bg_old").visible=!0,this.panelSub.getChildByName("account_lb_old").visible=!0,this.panelSub.getChildByName("account_lb_old").displayAsPassword=!0,this.panelSub.getChildByName("account_lb_txt").displayAsPassword=!0,this.panelSub.getChildByName("lb_new_pwd").visible=!0,this.panelSub.getChildByName("bg_new").visible=!0,this.panelSub.getChildByName("account_lb_new").visible=!0,this.panelSub.getChildByName("account_lb_new").displayAsPassword=!0):"modify_realname_btn"==e?this.panelSub.getChildByName("lb_desc").text=ConstValue.P_MODIFY_REALNAME:"modify_wx_btn"==e?this.panelSub.getChildByName("lb_desc").text=ConstValue.P_MODIFY_WX:"modify_beget_btn"==e?this.panelSub.getChildByName("lb_desc").text=ConstValue.P_MODIFY_BEGET:"scroll_notify"==e?(this.panelSub.getChildByName("lb_edit_title").text="gm",this.panelSub.getChildByName("lb_desc").text="输入命令："):"hall_question_btn"==e&&(this.panelSub.getChildByName("lb_edit_title").text="反馈",this.panelSub.getChildByName("lb_desc").text="问题描述：")},e.prototype.showChoiceUI=function(){if(null==this.choicePanel){this.choicePanel=new eui.Panel,this.choicePanel.skinName="resource/eui_skins/UserUI/OptionUI.exml",this.choicePanel.title="Title",this.context.addChild(this.choicePanel);var e=this.panel.getChildByName("btn_choice").x,t=this.panel.getChildByName("btn_choice").y;this.choicePanel.x=e-50,this.choicePanel.y=t+50}else this.context.removeChild(this.choicePanel),this.choicePanel=null},e.prototype.handleSkill=function(e,t){var i=0,n=function(t){var n=o.skillData[t],s=new eui.Panel;s.skinName="resource/eui_skins/UserUI/SkillGroup.exml",s.name="p_"+t,s.x=10,s.y=10+i*s.height,e.addChild(s);var a=s.getChildByName("group_1"),l=a.getChildByName("skill_icon");l.source=ConstValue.skill_conf[t].icon;var r=a.getChildByName("skill_name");r.text=n.name;var h=a.getChildByName("skill_lv");h.text="Lv."+n.curLv+"/"+n.maxLv;var u=a.getChildByName("skill_desc");u.text=n.desc;var c=a.getChildByName("skill_desc2");c.text="下一级 "+n.nextdesc;var d=a.getChildByName("skill_tip"),g=a.getChildByName("skill_pay"),m=a.getChildByName("skill_cost"),_=a.getChildByName("skill_learn"),p=a.getChildByName("skill_btn");1==n.isOpen?(d.visible=!1,1==n.costType||(2==n.costType?g.source="mini_zuanshi":3==n.costType&&(g.source="mini_tv_png")),m.text=n.cost,CommonButtonHandle.beginTouch(_,o),n.curLv>0&&(_.text="升级",_.strokeColor=15166535),_.addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){var i=CommonTools.getDataJsonStr("C2G_Upgrade",1,{SkillID:parseInt(t)});ConstValue.P_NET_OBJ.sendData(i)},o)):(g.visible=!1,m.visible=!1,_.visible=!1,p.visible=!1),i++},o=this;for(var s in this.skillData)n(s)},e.prototype.handleRank=function(e,t,i){var n={1:{matchbg:"rank_select_02_png",lvbg:"rank_select_01_png",barrbg:"rank_select_01_png"},2:{matchbg:"rank_select_01_png",lvbg:"rank_select_02_png",barrbg:"rank_select_01_png"},3:{matchbg:"rank_select_01_png",lvbg:"rank_select_01_png",barrbg:"rank_select_02_png"}},o={1:{matchsc:13298175,matchtc:7633371,lvsc:8095419,lvtc:10531804,barrsc:8095419,barrtc:10531804},2:{matchsc:8095419,matchtc:10531804,lvsc:13298175,lvtc:7633371,barrsc:8095419,barrtc:10531804},3:{matchsc:8095419,matchtc:10531804,lvsc:8095419,lvtc:10531804,barrsc:13298175,barrtc:7633371}},s=t.getChildByName("match_rank_bg");s.source=RES.getRes(n[i].matchbg);var a=t.getChildByName("lv_rank_bg");a.source=RES.getRes(n[i].lvbg);var l=t.getChildByName("barrier_rank_bg");l.source=RES.getRes(n[i].barrbg);var r=t.getChildByName("match_rank_lb");r.stroke=3,r.strokeColor=o[i].matchsc,r.textColor=o[i].matchtc;var h=t.getChildByName("lv_rank_lb");h.stroke=3,h.strokeColor=o[i].lvsc,h.textColor=o[i].lvtc;var u=t.getChildByName("barrier_rank_lb");u.stroke=3,u.strokeColor=o[i].barrsc,u.textColor=o[i].barrtc;for(var c in this.lRank){var d=this.lRank[c],g=parseInt(c),m=new eui.Panel;m.skinName="resource/eui_skins/UserUI/RankGroup.exml",m.name="p_"+c,m.y=g*m.height,e.addChild(m);var _=m.getChildByName("group_1"),p=_.getChildByName("rank");p.text=g+1+"";var C=_.getChildByName("name");C.text=d[1];var y=_.getChildByName("head");""!=d[2]&&(y.source=d[2]);var f=_.getChildByName("desc"),b=_.getChildByName("desc2"),v=_.getChildByName("lb"),T=_.getChildByName("lb2");1==i?(f.text=d[3],b.text=d[4]+"%"):2==i?(T.visible=!1,b.visible=!1,f.text=d[3],v.text="等级 ："):3==i&&(T.visible=!1,b.visible=!1,f.text=d[3],v.text="关卡 ：")}var P=t.getChildByName("myrankG"),B=P.getChildByName("myrank");B.text=this.sMyRankDesc;var x=P.getChildByName("name");x.text=this.lMyRank[1];var N=P.getChildByName("head");""!=ConstValue.cacheUserInfo.headPic&&(N.source=ConstValue.cacheUserInfo.headPic);var k=P.getChildByName("desc"),S=P.getChildByName("desc2"),I=P.getChildByName("lb"),w=P.getChildByName("lb2");1==i?(w.visible=!0,S.visible=!0,k.text=this.lMyRank[3],S.text=this.lMyRank[4]+"%",I.text="胜场 ："):2==i?(w.visible=!1,S.visible=!1,k.text=this.lMyRank[3],I.text="等级 ："):3==i&&(w.visible=!1,S.visible=!1,k.text=this.lMyRank[3],I.text="关卡 ：")},e.prototype.showAD=function(e){},e.prototype.handleLvReward=function(){var e=this.panelNotice.getChildByName("fighting_parent"),t=this.panelNotice.getChildByName("video_g");1!=ConstValue.videoIndx&&(CommonButtonHandle.beginTouch(t,this),t.addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){this.moveLvGet=!1,this.showAD(1)},this));var i=e.getChildByName("scroll"),n=i.getChildByName("scroll_group");n.removeChildren();var o=0;for(var s in this.lvRewardData)o++;var a=new eui.Panel;a.skinName="resource/eui_skins/UserUI/LvGetProGroup.exml",a.name="p_pro",a.x=1.89,a.y=198.4,a.width=130+190*(o-1),n.addChild(a);var l=a.getChildByName("group_1"),r=l.getChildByName("img_slot");r.width=130+190*(o-1);var h=l.getChildByName("img_pro");h.width=130+190*(ConstValue.cacheUserInfo.lv-1),o=0;var u=0,c=1;for(var s in this.lvRewardData){var d=this.lvRewardData[s],g=c,m=new eui.Panel;m.skinName="resource/eui_skins/UserUI/LvGetPointGroup.exml",m.name="p_"+s,m.x=34.5+185*(g-1),ConstValue.cacheUserInfo.lv==g&&(u=m.x),m.y=-6.44,n.addChild(m),o++;var _=m.getChildByName("group_1"),p=_.getChildByName("lb_lv");p.text="Lv."+d.iLv;var C=(_.getChildByName("img_role"),_.getChildByName("img_item")),y=_.getChildByName("rw_num"),f=_.getChildByName("img_select");0==d.iStatus?f.visible=!1:1==d.iStatus&&(f.source="sevent_get_png"),y.text=this.getConf("ItemData",d.id,"name")+"x"+d.rewardNun,C.source=this.getConf("ItemData",d.id,"res")+"_png",c++}this.moveLvGet&&(i.viewport.scrollH=u)},e.prototype.updateRoleClass=function(e){var t=this.panelNotice.getChildByName("lb_life"),i=this.panelNotice.getChildByName("lb_boom"),n=this.panelNotice.getChildByName("lb_speed"),o=this.panelNotice.getChildByName("lb_power"),s=this.panelNotice.getChildByName("lb_name"),a=this.panelNotice.getChildByName("img_buy_bg"),l=this.panelNotice.getChildByName("btn_gold"),r=(this.panelNotice.getChildByName("lb_gold"),this.panelNotice.getChildByName("btn_fight")),h=this.panelNotice.getChildByName("btn_buy"),u=this.panelNotice.getChildByName("btn_buy_lb"),c=this.panelNotice.getChildByName("lb_attr"),d=this.panelNotice.getChildByName("select_role_bg");d.source=ConstValue.role_select_bg[e];var g=this.roleClassData[e];t.text=g.life,i.text=g.cnt,n.text=g.speed,o.text=g.power,c.text=g.desc,s.text=g.name,1==g.isOwn?(a.visible=!1,l.visible=!1,h.visible=!1,u.visible=!1,r.visible=!0,1==g.isUse?r.label="出战中":r.label="出 战"):(r.visible=!1,a.visible=!0,l.visible=!0,h.visible=!0,u.visible=!0),null!=this.bodyAniDown&&(this.panelNotice.removeChild(this.bodyAniDown),this.bodyAniDown=null),this.bodyAniDown=CommonTools.getAnimDraw(RES.getRes("p"+g.iClass+"_special_json"),RES.getRes("p"+g.iClass+"_special_png"),"0"),this.bodyAniDown.play(-1),this.panelNotice.addChild(this.bodyAniDown),this.bodyAniDown.x=570,this.bodyAniDown.y=295;var m=this.panelNotice.getChildByName("coin_num_lb");m.text=ConstValue.cacheUserInfo.coin;var _=this.panelNotice.getChildByName("zuan_num_lb");_.text=ConstValue.cacheUserInfo.diamond},e.prototype.handleRoleClass=function(e,t){var i=function(t){var i=n.roleClassData[t],o=parseInt(t),s=new eui.Panel;s.skinName="resource/eui_skins/UserUI/RoleSelectUIGroup.exml",s.name="p_"+t,s.y=108*o,e.addChild(s);var a=s.getChildByName("group_1"),l=a.getChildByName("role_name");l.text=i.name;var r=a.getChildByName("img_selected");o>0&&(r.visible=!1);var h=a.getChildByName("role_head");h.source=ConstValue.role_select_img[t],s.addEventListener(egret.TouchEvent.TOUCH_TAP,function(i){for(var n=e.numChildren,o=0;n>o;o++){var s=e.getChildByName("p_"+o),a=s.getChildByName("group_1"),l=a.getChildByName("img_selected");l.visible=!1}r.visible=!0,this.roleSelectIdx=t,this.updateRoleClass(t)},n)},n=this;for(var o in this.roleClassData)i(o);this.updateRoleClass("0");var s=this.panelNotice.getChildByName("btn_fight"),a=this.panelNotice.getChildByName("btn_buy_lb");s.addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){var t=this.roleClassData[this.roleSelectIdx],i=CommonTools.getDataJsonStr("useClass",1,{iClass:t.iClass});ConstValue.P_NET_OBJ.sendData(i),ConstValue.cacheUserInfo.iClass=t.iClass},this),a.addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){var t=this.roleClassData[this.roleSelectIdx];this.buyClass=t.iClass;var i=CommonTools.getDataJsonStr("playVidioBefore",1,{iNo:t.iClass,iType:2,pageType:0});ConstValue.P_NET_OBJ.sendData(i),this.showAD(4)},this)},e.prototype.handleSeventDay=function(){if(this.initAD(),2!=ConstValue.videoIndx){var e=this.panelNotice.getChildByName("video_g");CommonButtonHandle.beginTouch(e,this),e.addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){this.showAD(2)},this)}for(var t=1;7>=t;t++){0==this.seventCur&&0==this.seventData[t.toString()].bGet&&(this.seventCur=t),this.seventCur==t&&1==this.seventData[t.toString()].bGet&&(this.seventGetState=!0);var i=this.panelNotice.getChildByName("item_icon_"+t);i.source=this.getConf("ItemData",this.seventData[t.toString()].itemNo,"res")+"_png";var n=this.panelNotice.getChildByName("lb_name_"+t);n.text=this.getConf("ItemData",this.seventData[t.toString()].itemNo,"name");var o=this.panelNotice.getChildByName("item_state_"+t);0==this.seventData[t.toString()].bGet?o.source="sevent_get_png":o.source="sevent_got_png"}},e.prototype.handleGetMyMaps=function(){var e=this.panelNotice.getChildByName("fighting_parent").getChildByName("scroll").getChildByName("scroll_group"),t=0,i=function(i){var o=n.selectMapData[i],s=new eui.Panel;s.skinName="resource/eui_skins/UserUI/MapViewGroup.exml",s.name="p_"+t,s.x+=40,s.y+=50+10*t+255*t,e.addChild(s),s.getChildByName("view_fight_btn").visible=!1,s.getChildByName("view_change_btn").visible=!1;var a=s.getChildByName("group_1"),l=a.getChildByName("lb_title");l.text=o.mapName;var r=a.getChildByName("lb_author");r.text=ConstValue.cacheUserInfo.name;var h=a.getChildByName("lb_sign");h.text=o.mapSign;var u=s.getChildByName("view_add_btn");u.label="邀 请",u.addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){this.closeNice(),this.selectKey=i;var t=CommonTools.getDataJsonStr("open1V1RoomByMap",1,{mapID:parseInt(this.selectKey)});ConstValue.P_NET_OBJ.sendData(t)},n),new MapMiniDIYModule(s,o.bgconf,o.layerconf,2),t++},n=this;for(var o in this.selectMapData)i(o)},e.prototype.handleSelectMap=function(){this.panelNotice.getChildByName("btn_random").addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){this.panelNotice.getChildByName("img_left").visible=!0,this.panelNotice.getChildByName("img_right").visible=!1},this),this.panelNotice.getChildByName("btn_mymap").addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){this.panelNotice.getChildByName("img_left").visible=!1,this.panelNotice.getChildByName("img_right").visible=!0},this),this.panelNotice.getChildByName("btn_certain_map").addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){if(this.panelNotice.getChildByName("img_left").visible){var t=CommonTools.getDataJsonStr("open1V1Room",1,{});ConstValue.P_NET_OBJ.sendData(t)}else{var i=CommonTools.getDataJsonStr("getMyMaps",1,{});ConstValue.P_NET_OBJ.sendData(i)}},this)},e.prototype.handleNoEnd=function(t,i){var n=25,o=128,s=1,a=i.getChildByName("lb_star_total"),l=i.getChildByName("lb_bg_total"),r=i.getChildByName("lb_bg_kuang");a.text="获得"+this.barrData.nowstar+"/"+this.barrData.totalstar+"颗星";var h=this.barrData.nowstar/this.barrData.totalstar*1;l.width=r.width*h;var u=i.getChildByName("guanka_layer");u.text="第"+this.barrLayer+"层";var c=function(i){var a=d.barrData.barrierList[i],l=new eui.Panel;l.skinName="resource/eui_skins/UserUI/noEndBarrStartGroup.exml",l.name="p_"+s;var r=s%6==0?6:s%6,h=0;h=s%6==0?s/6:s/6+1,l.x=n+165*(r-1),l.y=o+120*Math.floor(h-1),t.addChild(l);var u=l.getChildByName("group_1"),c=u.getChildByName("num_lb");if(c.text=a.barrierNo+"",1==a.isLock)c.visible=!1;else{var g=u.getChildByName("barr_lock");g.visible=!1}for(var m=1;m<=a.star&&!(m>3);m++){var _=u.getChildByName("star_0"+m);_.source="barr_pass_start_png"}l.addEventListener(egret.TouchEvent.TOUCH_TAP,function(t){if(1==a.isLock)return void CommonTools.addCommonTips(this.tipsPanel,"暂未解锁！");if(5==e.curGuide){if(1!=a.barrierNo)return void CommonTools.addCommonTips(this.tipsPanel,"请按引导指示！");e.curGuide=0;var i=CommonTools.getDataJsonStr("getNextGuild",1,{});ConstValue.P_NET_OBJ.sendData(i)}var n=CommonTools.getDataJsonStr("getBarrierInfo",1,{barrierNo:a.barrierNo});ConstValue.P_NET_OBJ.sendData(n)},d),s++},d=this;for(var g in this.barrData.barrierList)c(g);this.fixGuide5&&(this.fixGuide5=!1)},e.prototype.updateShopUI=function(e){var t=this.panelNotice.getChildByName("res_scroller");t.viewport.scrollV=0;var i=t.getChildByName("res_group");i.removeChildren();var n=0;this.panelNotice.getChildByName("t_shi"),this.panelNotice.getChildByName("t_zhuang"),this.panelNotice.getChildByName("t_pao1"),this.panelNotice.getChildByName("t_pao2"),this.panelNotice.getChildByName("t_te"),this.panelNotice.getChildByName("t_xiao"),this.panelNotice.getChildByName("t_dao"),this.panelNotice.getChildByName("t_ju");if(1==this.shopUIType)n=this.dShopOrBagData.lShopInfo.length;else if(n=this.dShopOrBagData.lItmeInfo.length,""!=this.shopItemClickName){var o=parseInt(this.shopItemClickName.replace("shop_item_click",""));o>=n&&(e=!0,this.shopItemClickName="")}for(var s=0;n>s;s++){var a=new eui.Panel;a.skinName="resource/eui_skins/UserUI/ShopItemGroup.exml",a.name="p_"+s;var l=5;2==this.shopUIType&&(l=20),a.x=l+180*(s%3)+5*(s%3),a.y=20+230*Math.floor(s/3)+20*Math.floor(s/3),i.addChild(a);var r=a.getChildByName("group_1"),h=r.getChildByName("shop_item_bg"),u=r.getChildByName("shop_item_pay"),c=r.getChildByName("shop_item_icon"),d=r.getChildByName("shop_item_click");d.name="shop_item_click"+s,d.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this);var g=r.getChildByName("shop_item_name"),m=r.getChildByName("shop_item_money"),_=r.getChildByName("shop_item_pay");if(1==this.shopUIType){c.source=this.getConf("shopData",this.dShopOrBagData.lShopInfo[s].iNo.toString(),"res")+"_png",g.text=this.getConf("shopData",this.dShopOrBagData.lShopInfo[s].iNo.toString(),"name");var p="";1==this.dShopOrBagData.lShopInfo[s].payType?p=this.dShopOrBagData.lShopInfo[s].NeedCoin:2==this.dShopOrBagData.lShopInfo[s].payType?(p=this.dShopOrBagData.lShopInfo[s].NeedDiamond,_.source="mini_zuanshi"):3==this.dShopOrBagData.lShopInfo[s].payType&&(p=this.dShopOrBagData.lShopInfo[s].NeedADTime,_.source="mini_tv_png"),m.text=p,0==s&&(h.source="shop_item_yes_png",e&&this.clickShopItem(d.name))}else{u.visible=!1,c.source=this.getConf("ItemData",this.dShopOrBagData.lItmeInfo[s].iNo.toString(),"res")+"_png",g.text=this.getConf("ItemData",this.dShopOrBagData.lItmeInfo[s].iNo.toString(),"name"),m.text="x "+this.dShopOrBagData.lItmeInfo[s].iNum;var C=r.getChildByName("shop_item_bg"),y=r.getChildByName("shop_item_name");y.y-=5,0==s?(C.source="bag_item_yes_png",e&&this.clickShopItem(d.name)):C.source="bag_item_not_png"}}},e.prototype.handlePanel=function(e,t){switch(t){case"btn_skill":var i=e.getChildByName("fighting_parent"),n=i.getChildByName("scroll");n.viewport.scrollV=0;var o=n.getChildByName("scroll_group");o.removeChildren(),i.getChildByName("btn_tip").addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),CommonButtonHandle.beginTouch(i.getChildByName("btn_tip"),this),this.handleSkill(o,i);break;case"btn_rank":var s=e.getChildByName("fighting_parent"),a=s.getChildByName("scroll");a.viewport.scrollV=0;var l=a.getChildByName("scroll_group");l.removeChildren(),s.getChildByName("all_rank_lb").addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),CommonButtonHandle.beginTouch(s.getChildByName("all_rank_lb"),this),s.getChildByName("friend_rank_lb").addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),CommonButtonHandle.beginTouch(s.getChildByName("friend_rank_lb"),this),s.getChildByName("match_rank_lb").addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),CommonButtonHandle.beginTouch(s.getChildByName("match_rank_lb"),this),s.getChildByName("lv_rank_lb").addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),CommonButtonHandle.beginTouch(s.getChildByName("lv_rank_lb"),this),s.getChildByName("barrier_rank_lb").addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),CommonButtonHandle.beginTouch(s.getChildByName("barrier_rank_lb"),this),this.handleRank(l,s,3);break;case"all_rank_lb":var r=e.getChildByName("fighting_parent"),h=r.getChildByName("scroll");h.viewport.scrollV=0;var u=h.getChildByName("scroll_group");u.removeChildren(),r.getChildByName("all_rank_bg").visible=!0,r.getChildByName("friend_rank_bg").visible=!1,this.handleRank(u,r,3);break;case"friend_rank_lb":var c=e.getChildByName("fighting_parent"),d=c.getChildByName("scroll");d.viewport.scrollV=0;var g=d.getChildByName("scroll_group");g.removeChildren(),c.getChildByName("all_rank_bg").visible=!1,c.getChildByName("friend_rank_bg").visible=!0;break;case"match_rank_lb":case"getTotalPvpRank":var m=e.getChildByName("fighting_parent"),_=m.getChildByName("scroll");_.viewport.scrollV=0;var p=_.getChildByName("scroll_group");p.removeChildren(),this.handleRank(p,m,1);break;case"lv_rank_lb":case"getTotalLvRank":var C=e.getChildByName("fighting_parent"),y=C.getChildByName("scroll");y.viewport.scrollV=0;var f=y.getChildByName("scroll_group");f.removeChildren(),this.handleRank(f,C,2);break;case"barrier_rank_lb":case"getTotalGuankaRank":var b=e.getChildByName("fighting_parent"),v=b.getChildByName("scroll");v.viewport.scrollV=0;var T=v.getChildByName("scroll_group");T.removeChildren(),this.handleRank(T,b,3);break;case"btn_map_shop":case"btn_map_bag":this.panelNotice.getChildByName("btn_one_lb").addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.panelNotice.getChildByName("btn_two_lb").addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.panelNotice.getChildByName("btn_three_lb").addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.panelNotice.getChildByName("btn_four_lb").addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),CommonButtonHandle.beginTouch(this.panelNotice.getChildByName("btn_buy"),this),this.panelNotice.getChildByName("btn_buy").addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.updateShopUI(!0);break;case"btn_noend_pve":var P=e.getChildByName("fighting_parent");P.removeChildren(),e.getChildByName("noend_tip").addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),CommonButtonHandle.beginTouch(e.getChildByName("noend_tip"),this),e.getChildByName("btn_left").addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){if(1==this.barrLayer)return void CommonTools.addCommonTips(this.tipsPanel,"当前为首页关卡");this.barrLayer--;var t=CommonTools.getDataJsonStr("C2GOpenWujinUI",1,{diffLevel:this.barrLayer});ConstValue.P_NET_OBJ.sendData(t)},this),e.getChildByName("btn_right").addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){if(this.barrLayer+1>this.barrData.totallayer)return void CommonTools.addCommonTips(this.tipsPanel,"当前为尾页关卡");this.barrLayer++;var t=CommonTools.getDataJsonStr("C2GOpenWujinUI",1,{diffLevel:this.barrLayer});ConstValue.P_NET_OBJ.sendData(t)},this),this.handleNoEnd(P,e);break;case"btn_setting":"1"==egret.localStorage.getItem("noVolume")?(this.panelNotice.getChildByName("img_left").visible=!1,this.panelNotice.getChildByName("img_right").visible=!0):ConstValue.musicOpen?(this.panelNotice.getChildByName("img_left").visible=!0,this.panelNotice.getChildByName("img_right").visible=!1):(this.panelNotice.getChildByName("img_left").visible=!1,this.panelNotice.getChildByName("img_right").visible=!0),this.panelNotice.getChildByName("btn_open_ms").addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){this.panelNotice.getChildByName("img_left").visible=!0,this.panelNotice.getChildByName("img_right").visible=!1,ConstValue.musicOpen=!0,egret.localStorage.setItem("noVolume","0"),CommonAudioHandle.play("mainmenu_mp3",0)},this),this.panelNotice.getChildByName("btn_close_ms").addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){this.panelNotice.getChildByName("img_left").visible=!1,this.panelNotice.getChildByName("img_right").visible=!0,ConstValue.musicOpen=!1,egret.localStorage.setItem("noVolume","1"),CommonAudioHandle.stopPlay(),CommonAudioHandle.curPlayName=""},this),this.panelNotice.getChildByName("login_out").addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){CommonAudioHandle.stopPlay(),CommonAudioHandle.curPlayName="",ConstValue.P_NET_OBJ.outLogin()},this);break;case"SeventDayReward":this.handleSeventDay();break;case"showUpgradeReward":this.handleLvReward();break;case"getMyMaps":this.handleGetMyMaps();break;case"btn_friend_pvp":this.handleSelectMap();break;case"btn_img_info":var B=e.getChildByName("fighting_parent"),x=B.getChildByName("scroll"),N=x.getChildByName("scroll_group");N.removeChildren(),this.handleRoleClass(N,B);break;case"btn_noticetip":var k=e.getChildByName("group_clear");if(k.getChildByName("lb_clear_click").addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),CommonButtonHandle.beginTouch(k.getChildByName("lb_clear_click"),this),ConstValue.P_IS_DEBUG,0){var S=CommonTools.getDataJsonStr("getAllMail",1,{roleId:ConstValue.cacheUserInfo.id});ConstValue.P_NET_OBJ.sendData(S)}else{var I=10,w=this.panelNotice.getChildByName("left_scroller"),O=w.getChildByName("left_group"),E=this.panelNotice.getChildByName("lb_title");E.text="标题：";var L=this.panelNotice.getChildByName("lb_mail_info");L.text="";for(var M=0;I>M;M++){var D=new eui.Panel;D.skinName="resource/eui_skins/UserUI/NoticeGroup.exml",D.name="p_"+M,D.y=72*M,O.addChild(D);var A=D.getChildByName("group_1");A.getChildByName("img_yellow").visible=!1;var R=A.getChildByName("lb_title");R.text="喜报！！"+(M+1);var U=A.getChildByName("lb_notice_click");U.name="lb_notice_click"+M,U.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),CommonButtonHandle.beginTouch(U,this)}}break;default:CommonTools.log("22222222 default")}},e.prototype.updateCoin=function(){var e=this.panel.getChildByName("coin_num_lb");e.text=ConstValue.cacheUserInfo.coin;var t=this.panel.getChildByName("zuan_num_lb");t.text=ConstValue.cacheUserInfo.diamond},e.prototype.handlePacket=function(t){return __awaiter(this,void 0,void 0,function(){var i,n,o,s,a,l,n,a,r,n,a,h,u,c,d,c,g,m,_,p,C,y,f;return __generator(this,function(b){switch(b.label){case 0:return"setName"!=t.f?[3,1]:(""!=t.m||1!=t.s?CommonTools.addCommonTips(this.tipsPanel,ConstValue.P_MODIFY_FAIL):(CommonTools.addCommonTips(this.tipsPanel,ConstValue.P_SEND_MODIFY_SUCCESS),this.panelNotice.getChildByName("nickName_lb").text=t.d.name,ConstValue.cacheUserInfo.name=t.d.name,this.closeSub()),[3,37]);case 1:return"gmFunc"!=t.f?[3,2]:(""!=t.m||1!=t.s?CommonTools.addCommonTips(this.tipsPanel,"执行失败"):CommonTools.addCommonTips(this.tipsPanel,"执行成功"),[3,37]);case 2:return"contract"!=t.f?[3,3]:(""!=t.m||1!=t.s||ContractSol.maincoin_increaseApproval(t.d.to,t.d.num),[3,37]);case 3:if("createNft"!=t.f)return[3,4];if(""!=t.m||1!=t.s);else{i=t.d.nftInfo,n=1,o=function(e){var t=i[e];FightingModule.Delay(500*n,function(){this.createMergeSuccessT(t)},s),n+=1},s=this;for(a in i)o(a);ConstValue.cacheContract.nftLen=n}return[3,37];case 4:if("getNftMarket"!=t.f&&"BuyNft"!=t.f)return[3,5];if(""!=t.m||1!=t.s);else{l=t.d.lMarketData,n=0;for(a in l)n+=1;n>0?(ConstValue.cacheContract.nftLen=n,this.horseMarketData=l):this.horseMarketData=null,5==this.curPage&&2==this.subCurPage&&this.changePage("rank_head_02")}return[3,37];case 5:if("getOwnNft"!=t.f)return[3,6];if(""!=t.m||1!=t.s);else{r=t.d.lOwnNftData,n=0;for(a in r)n+=1;n>0?this.horseOwnData=r:this.horseOwnData=null,5==this.curPage&&3==this.subCurPage&&this.changePage("rank_head_03")}return[3,37];case 6:return"AddMainCoin"!=t.f?[3,7]:(""!=t.m||1!=t.s||(this.updateMaincoin(t.d.mainCoin,!1),FightingModule.Delay(6e4,function(){ContractSol.maincoin_balanceOf(ContractSol.sender)},this)),[3,37]);case 7:return"AddSubCoin"!=t.f?[3,8]:(""!=t.m||1!=t.s||(this.updateSubcoin(t.d.subCoin,!1),FightingModule.Delay(6e4,function(){ContractSol.subcoin_balanceOf(ContractSol.sender)},this)),[3,37]);case 8:return"getPvpRankThree"!=t.f?[3,9]:(""!=t.m||1!=t.s,[3,37]);case 9:if("getHelp"!=t.f&&"getGonggao"!=t.f)return[3,10];if(""!=t.m||1!=t.s);else{if(1==ConstValue.p_USE_WALLET)return[2];CommonTools.addTipsPanel(this.context,t.d.name,t.d.content)}return[3,37];case 10:return"Room1v1Dismiss"!=t.f?[3,11]:(""!=t.m||1!=t.s||(CommonTools.addCommonTips(this.tipsPanel,"房间解散"),Main.roomkey=null,null!=this.showWxVsPanel&&CommonTools.niceTip(this.showWxVsPanel,2,this)),[3,37]);case 11:return"WaitingInfo"!=t.f?[3,12]:(""!=t.m||1!=t.s?CommonTools.addCommonTips(this.tipsPanel,ConstValue.P_ENTER_ROOM_FAIL):(null==ConstValue.P_FIGHT_OBJ&&(ConstValue.P_FIGHT_OBJ=new FightingModule(this.context)),t.d.state<2?ConstValue.P_FIGHT_OBJ.showVspanel():2==t.d.state&&(FightingModule.readyTwo=!0,this.context.dDataInfo2=t.d.player,null!=ConstValue.P_FIGHT_OBJ.playerData&&(FightingModule.readyRes=!0,ConstValue.P_FIGHT_OBJ.releaseVsPanel(),ConstValue.P_FIGHT_OBJ.updateInfo(t.d.player)))),[3,37]);case 12:return"syncMapData"!=t.f?[3,17]:""==t.m&&1==t.s?[3,13]:[3,16];case 13:return null!=ConstValue.cacheKeyGroup.fighting?[3,15]:(this.context.dDataInfo=t.d,[4,this.context.loadResource("fighting",6)]);case 14:return b.sent(),[3,16];case 15:null==ConstValue.P_FIGHT_OBJ&&(ConstValue.P_FIGHT_OBJ=new FightingModule(this.context)),ConstValue.P_FIGHT_OBJ.initMapData(t.d),FightingModule.readyTwo&&!FightingModule.readyRes&&(ConstValue.P_FIGHT_OBJ.releaseVsPanel(),ConstValue.P_FIGHT_OBJ.updateInfo(this.context.dDataInfo2)),b.label=16;case 16:return[3,37];case 17:return"openDiyMapUI"!=t.f?[3,18]:(""!=t.m||1!=t.s||null==ConstValue.P_MAP_OBJ&&(ConstValue.P_MAP_OBJ=new MapDIYModule(this.context,t.d,1)),[3,37]);case 18:return"showAllClassList"!=t.f&&"reflashClassList"!=t.f?[3,19]:(""!=t.m||1!=t.s||(this.roleClassData=t.d.allRoleList,null==this.panelNotice?this.showNotice("resource/eui_skins/UserUI/RoleSelectUI.exml","btn_img_info"):this.updateRoleClass(this.roleSelectIdx)),[3,37]);case 19:return"openShopUI"!=t.f?[3,20]:(""!=t.m||1!=t.s||(this.dShopOrBagData=t.d,this.shopUIType=1,null==this.panelNotice?this.showNotice("resource/eui_skins/UserUI/PayShopUI.exml","btn_map_shop"):(this.updateShopUI(!1),h=this.dShopOrBagData.lShopInfo.length,h>0&&this.clickShopItem(this.shopItemClickName))),[3,37]);case 20:return"openBagUI"!=t.f?[3,21]:(""!=t.m||1!=t.s||(this.dShopOrBagData=t.d,this.shopUIType=2,null==this.panelNotice?this.showNotice("resource/eui_skins/UserUI/BagUI.exml","btn_map_bag"):(this.updateShopUI(!1),this.clickShopItem(this.shopItemClickName))),[3,37]);case 21:return"Buy"!=t.f?[3,22]:(""!=t.m||1!=t.s||0==t.d.err&&(ConstValue.cacheUserInfo.coin=t.d.after_buy_data.coin,ConstValue.cacheUserInfo.diamond=t.d.after_buy_data.diamond,this.updateCoin()),[3,37]);
case 22:return"getMyMaps"!=t.f?[3,23]:(""!=t.m||1!=t.s||FightingModule.Delay(500,function(){null!=this.maskBg&&this.context.removeChild(this.maskBg),this.maskBg=null,null!=this.panelNotice&&this.context.removeChild(this.panelNotice),this.panelNotice=null,this.selectMapData=t.d,this.showNotice("resource/eui_skins/UserUI/MapViewUI.exml","getMyMaps")},this),[3,37]);case 23:return"C2GOpenWujinUI"!=t.f?[3,24]:(""!=t.m||1!=t.s||(this.barrData=t.d,null!=this.panelNotice?(u=this.panelNotice.getChildByName("fighting_parent"),u.removeChildren(),this.handleNoEnd(u,this.panelNotice)):(this.showNotice("resource/eui_skins/UserUI/noEndBarrUI.exml","btn_noend_pve"),4==e.curGuide&&(e.curGuide=0,this.fixGuide5||(c=CommonTools.getDataJsonStr("getNextGuild",1,{}),ConstValue.P_NET_OBJ.sendData(c))))),[3,37]);case 24:if("SeventDayReward"!=t.f)return[3,25];if(""!=t.m||1!=t.s);else{if(1==ConstValue.p_USE_WALLET)return[2];if(!e.isSafeArea)return[2];if(this.seventData=t.d,null!=this.curButton&&"SeventDayReward"!=this.curButton)return[2];null==this.panelNotice?this.showNotice("resource/eui_skins/UserUI/SeventDayGet.exml",t.f):this.handleSeventDay()}return[3,37];case 25:return"G2C_getWXInfo"!=t.f?[3,29]:""==t.m&&1==t.s?[3,26]:[3,28];case 26:return 2!=ConstValue.p_LOGIN_MODEL?[2]:[4,platform.getUserInfo()];case 27:d=b.sent(),c=CommonTools.getDataJsonStr("saveWXInfo",1,{head:d.avatarUrl,name:d.nickName,gender:d.gender}),ConstValue.P_NET_OBJ.sendData(c),b.label=28;case 28:return[3,37];case 29:return"saveWXInfo"!=t.f?[3,30]:(""!=t.m||1!=t.s||(g=this.panel.getChildByName("img_info"),""!=t.d.head&&(g.source=t.d.head,ConstValue.cacheUserInfo.headPic=t.d.head),m=this.panel.getChildByName("hall_id_lb"),m.text=t.d.name,ConstValue.cacheUserInfo.name=t.d.name),[3,37]);case 30:return"showUpgradeReward"!=t.f?[3,31]:(""!=t.m||1!=t.s||(this.lvRewardData=t.d.LvInfo,null==this.panelNotice?this.showNotice("resource/eui_skins/UserUI/RewardGet.exml",t.f):this.handleLvReward()),[3,37]);case 31:if("GuildInfo"!=t.f)return[3,32];if(""!=t.m||1!=t.s);else if(null!=this.seventData)e.curGuide=t.d.id;else if(5==t.d.id&&null==this.panelNotice)return this.fixGuide5=!0,[2];return[3,37];case 32:return"open1V1Room"!=t.f&&"open1V1RoomByMap"!=t.f?[3,36]:""==t.m&&1==t.s?[3,33]:[3,35];case 33:return CommonTools.log("shareAppMessage-------1"),Main.roomkey=t.d.roomkey,_=window.platform,[4,_.shareAppMessage(t.d.roomkey)];case 34:b.sent(),b.label=35;case 35:return[3,37];case 36:"showMatch1v1RoomUI"==t.f?""!=t.m||1!=t.s||(null!=this.panelNotice&&(null!=this.maskBg&&this.context.removeChild(this.maskBg),this.maskBg=null,this.context.removeChild(this.panelNotice),this.panelNotice=null),null!=t.d.roomID&&(Main.roomkey=t.d.roomID),null==this.showWxVsPanel?this.showWxVsUI(t.d):this.updateWxVsUI(t.d)):"getRoleDetail"==t.f?""!=t.m||1!=t.s||(this.roleDetailData=t.d,this.showRoleInfoUI()):"getBarrierInfo"==t.f?""!=t.m||1!=t.s||this.showBarrinfoUI(t.d):"C2G_Open_MainUI"==t.f?""!=t.m||1!=t.s||(this.skillData=t.d,null==this.panelNotice?this.showNotice("resource/eui_skins/UserUI/SkillUI.exml","btn_skill"):this.handlePanel(this.panelNotice,"btn_skill")):"reflashRoleData"==t.f?""!=t.m||1!=t.s||(ConstValue.cacheUserInfo.curexp=t.d.curexp,ConstValue.cacheUserInfo.lv=t.d.lv,ConstValue.cacheUserInfo.coin=t.d.coin,ConstValue.cacheUserInfo.diamond=t.d.diamond,ConstValue.cacheUserInfo.maxExp=t.d.exp,p=this.panel.getChildByName("img_lv_lb"),p.text=ConstValue.cacheUserInfo.lv,C=this.panel.getChildByName("img_exp_value"),C.width=1*ConstValue.cacheUserInfo.curexp/ConstValue.cacheUserInfo.maxExp*C.width,y=this.panel.getChildByName("coin_num_lb"),y.text=ConstValue.cacheUserInfo.coin,f=this.panel.getChildByName("zuan_num_lb"),f.text=ConstValue.cacheUserInfo.diamond):("openRnakUI"==t.f||"getTotalPvpRank"==t.f||"getTotalLvRank"==t.f||"getTotalGuankaRank"==t.f)&&(""!=t.m||1!=t.s||(this.lRank=t.d.lRank,this.lMyRank=t.d.myRank,this.sMyRankDesc=t.d.myRankDesc,"openRnakUI"==t.f?this.showNotice("resource/eui_skins/UserUI/NewRankUI.exml","btn_rank"):this.handlePanel(this.panelNotice,t.f),CommonTools.log("this.lRank-------------"+this.lRank))),b.label=37;case 37:return[2]}})})},e.prototype.closeNotice=function(){this.tipsPanel=this.panel,CommonTools.niceTip(this.panelNotice,2,this)},e.prototype.closeWxVsUI=function(){if(this.tipsPanel=this.panel,this.isMainRoomer){var e=CommonTools.getDataJsonStr("remove1V1Room",1,{});ConstValue.P_NET_OBJ.sendData(e),this.isMainRoomer=!1}else{Main.roomkey=null,null!=this.showWxVsPanel&&CommonTools.niceTip(this.showWxVsPanel,2,this);var e=CommonTools.getDataJsonStr("leaveGame1v1",1,{fightRoomKey:Main.roomkey});ConstValue.P_NET_OBJ.sendData(e)}},e.prototype.closeNice=function(){if(this.moveLvGet=!0,ConstValue.videoIndx=0,null!=this.showWxVsPanel&&null==this.panelNotice)null!=this.maskBg2&&this.context.removeChild(this.maskBg2),this.maskBg2=null,this.context.removeChild(this.showWxVsPanel),this.showWxVsPanel=null;else if(null!=this.panelSub)null!=this.bodyAniDown2&&(this.panelSub.removeChild(this.bodyAniDown2),this.bodyAniDown2=null),null!=this.maskBg2&&this.context.removeChild(this.maskBg2),this.maskBg2=null,this.context.removeChild(this.panelSub),this.panelSub=null;else{if("btn_setting"==this.curButton)this.panelNotice.getChildByName("btn_open_ms").removeEventListener(egret.TouchEvent.TOUCH_TAP),this.panelNotice.getChildByName("btn_close_ms").removeEventListener(egret.TouchEvent.TOUCH_TAP);else if("getMyMaps"==this.curButton){for(var t=this.panelNotice.getChildByName("fighting_parent").getChildByName("scroll").getChildByName("scroll_group"),i=t.numChildren,n=0;i>n;n++){var o=t.getChildAt(n);o.removeChildren()}t.removeChildren()}else"SeventDayReward"==this.curButton&&(this.seventData=null);this.curButton=null,null!=this.bodyAniDown&&(this.panelNotice.removeChild(this.bodyAniDown),this.bodyAniDown=null),null!=this.panelNotice&&this.context.removeChild(this.panelNotice),null!=this.maskBg&&this.context.removeChild(this.maskBg),this.maskBg=null,this.panelNotice=null,this.dShopOrBagData=null,this.shopPageType=0,this.shopItemNo=0,this.shopPayType=0,this.shopItemItemID=0,this.shopItemName="",this.shopItemClickName="",null!=this.seventData&&this.showNotice("resource/eui_skins/UserUI/SeventDayGet.exml","SeventDayReward")}e.curGuide>0&&5==e.curGuide&&(this.fixGuide5=!0,e.curGuide=4)},e.prototype.closeSub=function(){this.tipsPanel=this.panel,null!=this.maskBg2&&this.context.removeChild(this.maskBg2),this.maskBg2=null,null!=this.panelSub&&this.context.removeChild(this.panelSub),this.panelSub=null},e.prototype.clear=function(){if(this.removeGuide(),this.panel.removeChild(this.btnMatchAnim),this.btnMatchAnim=null,this.panel.removeChild(this.btnWxPvpAnim),this.btnWxPvpAnim=null,this.panel.removeChild(this.btnPveAnim),this.btnPveAnim=null,egret.Tween.removeTweens(this.notify_lb),null!=this.maskNew&&this.context.removeChild(this.maskNew),this.maskNew=null,this.closeSub(),null!=this.showWxVsPanel&&(this.context.removeChild(this.showWxVsPanel),this.showWxVsPanel=null),this.panelNotice){var e=this.panelNotice.getChildByName("fighting_parent");null!=e&&e.removeChildren(),this.context.removeChild(this.panelNotice),this.panelNotice=null}null!=this.panel&&(this.context.removeChild(this.panel),this.panel=null)},e.isNoEnd=!1,e.isTrainBrr=!1,e.pushBtnData=null,e.curGuide=0,e.isInitLogin=!0,e.isSafeArea=!0,e}();__reflect(HallModule.prototype,"HallModule");var LoginModule=function(){function e(e){this.context=e,this.init()}return e.prototype.init=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return this.objChild=this.context.addBackGround("login_bg_jpg"),this.context.addChild(this.objChild),this.panel=new eui.Panel,this.panel.skinName="resource/eui_skins/UserUI/LoginUI.exml",this.panel.title="Title",this.panel.horizontalCenter=0,this.panel.verticalCenter=0,this.context.addChild(this.panel),2==ConstValue.p_LOGIN_MODEL||1==ConstValue.p_USE_WALLET?(this.panel.getChildByName("account_lb_txt").visible=!1,this.panel.getChildByName("password_lb_txt").visible=!1,this.panel.getChildByName("account_lb_title").visible=!1,this.panel.getChildByName("password_lb_title").visible=!1,this.panel.getChildByName("btn_registe").visible=!1,this.panel.getChildByName("btn_login").visible=!1,this.panel.getChildByName("btn_login_wx").addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),CommonButtonHandle.beginTouch(this.panel.getChildByName("btn_login_wx"),this),CommonTools.fixFix(this.context,this.panel.getChildByName("btn_login_wx"),2,-15,-20)):(this.panel.getChildByName("btn_login").addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.panel.getChildByName("btn_registe").addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.panel.getChildByName("account_lb_txt").addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.panel.getChildByName("password_lb_txt").addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.panel.getChildByName("btn_login_wx").visible=!1,CommonTools.fixFix(this.context,this.panel.getChildByName("btn_login"),2,-60,10),CommonTools.fixFix(this.context,this.panel.getChildByName("btn_registe"),2,-60,10),CommonTools.fixFix(this.context,this.panel.getChildByName("account_lb_txt"),2,0,20),CommonTools.fixFix(this.context,this.panel.getChildByName("password_lb_txt"),2,0,10),CommonTools.fixFix(this.context,this.panel.getChildByName("account_lb_title"),2,0,20),CommonTools.fixFix(this.context,this.panel.getChildByName("password_lb_title"),2,0,10)),ConstValue.videoAd=null,ConstValue.videoAdOBJ=null,ConstValue.videoIndx=0,[2]})})},e.prototype.addCommonTips=function(e){CommonTools.addCommonTips(this.panel,e)},e.prototype.onClick=function(e){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(i){if(null!=this.context.loadingView&&!ConstValue.P_IS_DEBUG)return CommonTools.log("还在加载中......return "),[2];switch(this.bClick||(this.bClick=!0),t=e.target.name){case"btn_notice":this.showNotice("resource/eui_skins/UserUI/ShengminUI.exml",t);break;case"btn_close":this.closeNotice();break;case"btn_forgetpas":this.showNotice("resource/eui_skins/UserUI/GetPassword.exml",t);break;case"btn_registe":this.showNotice("resource/eui_skins/UserUI/RegisteUI.exml",t);break;case"btn_login":this.btnClickLogin();break;case"btn_login_wx":1==ConstValue.p_USE_WALLET?this.btnClickWalletLogin():(ConstValue.sysTips=[],ConstValue.oneTipsCnt=0,ConstValue.oneTipsCur=0,ConstValue.oneTips={},this.btnClickWxLogin());break;case"btn_nologinman":break;case"btn_verify_forget":CommonTools.addCommonTips(this.panel,ConstValue.P_SEND_VERIFY);break;case"btn_confirm_forget":this.btnClickConfirmForget();break;case"btn_verify_registe":CommonTools.addCommonTips(this.panel,ConstValue.P_SEND_VERIFY);break;case"btn_confirm_registe":this.btnClickConfirmRegiste();break;default:CommonTools.log("11111111 default")}return[2]})})},e.prototype.btnClickLogin=function(){return __awaiter(this,void 0,void 0,function(){var e,t,i;return __generator(this,function(n){switch(n.label){case 0:return e=this.panel.getChildByName("account_lb_txt"),""==e.text?(CommonTools.addCommonTips(this.panel,ConstValue.P_NULL_ACCOUNT),[2]):(t=this.panel.getChildByName("password_lb_txt"),""==t.text?(CommonTools.addCommonTips(this.panel,ConstValue.P_NULL_PASSWORD),[2]):ConstValue.P_IS_DEBUG?(this.clear(),[4,this.context.loadResource("preloadHall",2)]):[3,2]);case 1:return n.sent(),[3,3];case 2:i=CommonTools.getDataJsonStr("login",1,{account:e.text,password:t.text}),null==ConstValue.P_NET_OBJ?ConstValue.P_NET_OBJ=new WebSocketUtil(i):ConstValue.P_NET_OBJ.sendData(i),ConstValue.cacheUserAccount=e.text,ConstValue.cacheUserPwd=t.text,n.label=3;case 3:return[2]}})})},e.prototype.btnClickWxLogin=function(){return __awaiter(this,void 0,void 0,function(){var e,t,i;return __generator(this,function(n){switch(n.label){case 0:return[4,platform.login()];case 1:return e=n.sent(),t=JSON.parse(e),i=CommonTools.getDataJsonStr("loginWX",1,{openID:t.openid,sHead:"",sName:"",iGender:0}),null==ConstValue.P_NET_OBJ?ConstValue.P_NET_OBJ=new WebSocketUtil(i):ConstValue.P_NET_OBJ.sendData(i),[2]}})})},e.prototype.btnClickWalletLogin=function(){return __awaiter(this,void 0,void 0,function(){var e,t,i;return __generator(this,function(n){switch(n.label){case 0:return[4,platform.connectWallet()];case 1:return e=n.sent(),e?[4,platform.login()]:(CommonTools.addCommonTips(this.panel,ConstValue.P_NO_USER_ADDRESS),[2]);case 2:return t=n.sent(),t.indexOf("0x")>=0&&(ContractSol.sender=t,i=CommonTools.getDataJsonStr("loginWX",1,{openID:t,sHead:"",sName:"",iGender:0}),null==ConstValue.P_NET_OBJ?ConstValue.P_NET_OBJ=new WebSocketUtil(i):ConstValue.P_NET_OBJ.sendData(i)),[2]}})})},e.prototype.clear=function(){this.context.removeChild(this.objChild),this.context.removeChild(this.panel),ConstValue.P_LOGIN_OBJ=null},e.prototype.btnClickConfirmForget=function(){var e=this.panelNotice.getChildByName("password_lb_txt");if(""==e.text)return void CommonTools.addCommonTips(this.panel,ConstValue.P_NULL_PASSWORD);var t=this.panelNotice.getChildByName("verify_lb_txt");return""==t.text?void CommonTools.addCommonTips(this.panel,ConstValue.P_NULL_VERIFY):(CommonTools.addCommonTips(this.panel,ConstValue.P_SEND_MODIFY_SUCCESS),void this.closeNotice())},e.prototype.btnClickConfirmRegiste=function(){var e=this.panelNotice.getChildByName("invite_lb_txt");if(""==e.text)return void CommonTools.addCommonTips(this.panel,ConstValue.P_NULL_INVITE);var t=this.panelNotice.getChildByName("account_lb_txt");if(""==t.text)return void CommonTools.addCommonTips(this.panel,ConstValue.P_NULL_ACCOUNT);var i=this.panelNotice.getChildByName("password_lb_txt");if(""==i.text)return void CommonTools.addCommonTips(this.panel,ConstValue.P_NULL_PASSWORD);var n=this.panelNotice.getChildByName("verify_lb_txt");if(""==n.text)return void CommonTools.addCommonTips(this.panel,ConstValue.P_NULL_VERIFY);if(ConstValue.P_IS_DEBUG)CommonTools.addCommonTips(this.panel,ConstValue.P_SEND_REGISTE_SUCCESS),this.closeNotice();else{var o=CommonTools.getDataJsonStr("register",1,{account:t.text,password:i.text,pcode:e.text});null==ConstValue.P_NET_OBJ?ConstValue.P_NET_OBJ=new WebSocketUtil(o):ConstValue.P_NET_OBJ.sendData(o)}},e.prototype.showNotice=function(e,t){this.panelNotice=new eui.Panel,this.panelNotice.skinName=e,this.panelNotice.title="Title",this.panelNotice.horizontalCenter=0,this.panelNotice.verticalCenter=0,this.context.addChild(this.panelNotice),this.panelNotice.getChildByName("btn_close").addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.handlePanel(this.panelNotice,t)},e.prototype.handlePacket=function(e){return __awaiter(this,void 0,void 0,function(){var t,i,n;return __generator(this,function(o){switch(o.label){case 0:return"register"!=e.f?[3,1]:""!=e.m||1!=e.s?(CommonTools.addCommonTips(this.panel,ConstValue.P_SEND_REGISTE_FAIL),[2]):(CommonTools.addCommonTips(this.panel,ConstValue.P_SEND_REGISTE_SUCCESS),this.closeNotice(),[3,5]);case 1:return"login"!=e.f&&"loginWX"!=e.f?[3,2]:(CommonTools.log("11111111 -----------------------------22"),""!=e.m||1!=e.s?(CommonTools.addCommonTips(this.panel,ConstValue.P_SEND_LOGIN_FAIL),CommonTools.log("11111111 --------------------------------piercj default 1"),[2]):(ConstValue.cacheHasLoginSuccess||(CommonTools.log("11111111 --------------------------------piercj default 1"),t=CommonTools.getDataJsonStr("entergame",1,{}),ConstValue.P_NET_OBJ.sendData(t),ConstValue.cacheHasLoginSuccess=!0),[3,5]));case 2:return"entergame"!=e.f?[3,5]:""==e.m&&1==e.s?[3,3]:(CommonTools.addCommonTips(this.panel,ConstValue.P_SEND_HALLBACK_FAIL),[2]);case 3:for(ConstValue.cacheUserInfo=e.d,i=0;i<this.panel.numChildren;i++)n=this.panel.getChildAt(i),n.visible=!1;return[4,this.context.loadResource("preloadHall",2)];case 4:o.sent(),this.clear(),o.label=5;case 5:return[2]}})})},e.prototype.handlePanel=function(e,t){switch(t){case"btn_forgetpas":e.getChildByName("btn_verify_forget").addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),e.getChildByName("btn_confirm_forget").addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this);break;case"btn_registe":e.getChildByName("btn_verify_registe").addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),e.getChildByName("btn_confirm_registe").addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this);break;default:CommonTools.log("22222222 default")}},e.prototype.closeNotice=function(){null!=this.panelNotice&&this.context.removeChild(this.panelNotice),this.panelNotice=null},e}();__reflect(LoginModule.prototype,"LoginModule");var MapDIYModule=function(){function e(t,i,n){if(this.initRow=9,this.initColumn=11,this.firstItemX=494.88,this.firstItemY=100.84,this.groundItemW=58,this.groundItemH=55,this.groundOffX=0,this.groundOffY=0,this.curFunc=1,this.curtype=1,this.curRes="",this.isShow=!1,this.posScrollerClose=0,this.resTitle=4,this.selectList={},this.txtMapName="输入地图名字",this.txtMapSign="输入地图个性签名",this.mapKey=0,this.testGround2=[1,1,1,1,1,1,2,2,1,1,1,1,1,1,1,1,1,2,1,2,1,1,1,1,1,3,1,1,2,2,1,1,1,3,2,2,1,1,1,2,2,3,1,1,1,1,3,1,1,1,2,2,1,1,1,1,2,1,1,1,1,2,3,2,1,1,1,1,1,1,1,1,2,3,2,1,1,1,1,1,1,1,1,2,3,2,1,1,1,1,1,1,1,1,2,3,2,1,1],this.testMap2=[0,0,0,0,0,0,0,0,5,6,0,0,5,0,0,0,0,0,6,5,6,0,0,0,0,0,0,0,0,6,5,6,0,0,0,0,0,0,5,0,6,5,6,0,0,0,13,0,0,0,0,6,5,6,0,0,9,6,0,0,0,0,0,0,0,0,0,9,6,0,0,0,0,6,5,6,0,0,9,6,0,0,0,0,6,5,6,0,0,12,11,0,0,0,0,6,5,6,0],this.iType=n,this.context=t,this.iType>0){this.maskBg=new eui.Image("bg_ppt_1_png"),this.maskBg.width=this.context.getStageWidth();var o=1334/this.context.getStageWidth();this.maskBg.height=750/o,this.context.addChild(this.maskBg),this.panel=new eui.Panel,this.panel.skinName="resource/eui_skins/UserUI/mapDIYUI.exml",this.panel.title="Title",this.panel.horizontalCenter=0,this.panel.verticalCenter=0,this.context.addChild(this.panel),this.tipsPanel=this.panel,1==n?(this.testGround=i.DefaultBg,e.defaultData=i.DefaultBg,null!=ConstValue.P_HALL_OBJ&&(ConstValue.P_HALL_OBJ.clear(),ConstValue.P_HALL_OBJ=null)):2==n?this.testGround=e.defaultData:(this.testGround=i.bgconf,this.testMap=i.layerconf),CommonTools.fixFix(this.context,this.panel,1,0,0),this.backBtn=new eui.Image("btn_back_png"),this.backBtn.width=60,this.backBtn.height=60,this.backBtn.x=44,this.backBtn.y=10,this.backBtn.name="goback_btn",this.context.addChild(this.backBtn),this.backBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.matrix=[[0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0]],this.grid=new PF.Grid(11,9,this.matrix),this.op=new PF.Option,this.op.allowDiagonal=!1,this.finder=new PF.AStarFinder(this.op),this.initScene(),"1"!=egret.localStorage.getItem("mapdiy0")&&new GuideModule(this.context,999,null,null)}else{var s=CommonTools.getDataJsonStr("getNewRank",1,{});ConstValue.P_NET_OBJ.sendData(s)}}return e.prototype.initConfig=function(){var e=this;LZMA.decompress(EBitUtil.getArr(new egret.ByteArray(RES.getRes("config_json"))),function(t){ConstValue.P_CONFIG=JSON.parse(t),e.initScene()},function(e){})},e.prototype.initMapData=function(e){},e.prototype.addCommonTips=function(e){CommonTools.addCommonTips(this.tipsPanel,e)},e.prototype.addGuideTips=function(t){if(null!=e.guide_tip_new[t]&&"1"!=egret.localStorage.getItem(t)){egret.localStorage.setItem(t,"1");var i=new eui.Panel;i.skinName="resource/eui_skins/UserUI/GuideTipsGroup.exml",i.name="p_"+t;var n=i.getChildByName("group_1"),o=n.getChildByName("tip");o.text=e.guide_tip_new[t].tip,ConstValue.deviveNormalScale>2?(i.x=1060,i.y=380):(i.x=1060,i.y=380),this.panel.addChild(i),FightingModule.Delay(5e3,function(){this.panel.removeChild(i),i=null},this)}},e.prototype.initScene=function(){this.panel.getChildByName("btn_ground_lb").addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.panel.getChildByName("btn_block_lb").addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.panel.getChildByName("btn_decorate_lb").addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.panel.getChildByName("STYLE_BTN").addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.panel.getChildByName("lb_1p").addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.panel.getChildByName("lb_2p").addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.panel.getChildByName("lb_eraser").addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.panel.getChildByName("lb_save").addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.panel.getChildByName("btn_rank").addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.panel.getChildByName("btn_mymap").addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.btn=this.panel.getChildByName("STYLE_BTN"),this.btnGround=this.panel.getChildByName("btn_ground"),this.btnBlock=this.panel.getChildByName("btn_block"),this.btnDecorate=this.panel.getChildByName("btn_decorate"),this.tDi=this.panel.getChildByName("t_di"),this.tBiao=this.panel.getChildByName("t_biao"),this.tZhang=this.panel.getChildByName("t_zhang"),this.tAi=this.panel.getChildByName("t_ai"),this.tZhuang=this.panel.getChildByName("t_zhuang"),this.tShi=this.panel.getChildByName("t_shi");var t=this.panel.getChildByName("coin_num_lb");t.text=ConstValue.cacheUserInfo.coin;var i=this.panel.getChildByName("zuan_num_lb");i.text=ConstValue.cacheUserInfo.diamond,e.ONE_P="",e.TWO_P="";for(var n=0,o=0;o<this.initRow;o++)for(var s=function(t){var i=a.groundItemW,s=a.groundItemH,l=a.groundOffX,r=a.groundOffY;o>0&&(r=7),t>0&&(l=4);var h=a.firstItemX+i*t+l*t,u=a.firstItemY+s*o+r*o,c={img:"res_"+a.testGround[n]+"_png",x:h,y:u,name:"ground_"+n,curIdx:n},d=new Fight.MapItem(c);if(d.setRow(o),d.setColumn(t),d.setType(ConstValue.P_CONFIG.MapBase[a.testGround[n].toString()].Type),a.panel.addChild(d),d.scaleX=.7,d.scaleY=.7,e.groundLayerSubObj[n.toString()]=d,d.itemRange[0]=497+55*t+6*t,d.itemRange[1]=d.itemRange[0]+55,d.itemRange[2]=103+55*o+7*o,d.itemRange[3]=d.itemRange[2]+55,d.setRes(a.testGround[n]),d.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){return""==this.curRes&&1==this.curFunc?void CommonTools.addCommonTips(this.panel,"请选择左侧资源"):(this.addGuideTips("mapdiy1"),void d.checkRange2(this.curRes,this.curtype,this.curFunc))},a),d.addEventListener(egret.TouchEvent.TOUCH_MOVE,function(){return""==this.curRes&&1==this.curFunc?void CommonTools.addCommonTips(this.panel,"请选择左侧资源"):(this.addGuideTips("mapdiy1"),void d.checkRange2(this.curRes,this.curtype,this.curFunc))},a),3==a.iType)if(a.testMap[n]>0&&a.testMap[n]<100){var g="res_"+a.testMap[n]+"_png",m=ConstValue.P_CONFIG.MapBase[a.testMap[n].toString()];d.checkRange2(g,m.Type,1)}else a.testMap[n]>100&&(119==a.testMap[n]?d.checkRange2(null,2,3):d.checkRange2(null,2,4));n++},a=this,l=0;l<this.initColumn;l++)s(l);this.drawDownList(),this.resGroup=this.panel.getChildByName("res_scroller").getChildByName("res_group"),this.initResList(4,1),3==this.iType&&this.clickBolck()},e.prototype.initResList=function(e,t){var i=this.panel.getChildByName("res_scroller");i.viewport.scrollV=0,this.resGroup.removeChildren(),this.selectList={};var n=0,o=function(i){var o=ConstValue.P_CONFIG.MapBase[i];if(o.mapType==e&&o.Type==t){var a=new eui.Image(o.res+"_png"),l=new eui.Image("diy_item_bg_png");s.resGroup.addChild(l),s.resGroup.addChild(a);var r=100,h=30,u=10,c=0;if(1==t?(r=82,h=0,u=0):2==t&&(h=28,u=0,3>n&&(c=5)),a.x=n%3*82+10+n%3*10,a.y=parseInt(n/3+"")*r+10+10*parseInt(n/3+"")-h-parseInt(n/3+"")*u+c,1==t?(l.x=a.x-2.25,l.y=a.y-2.5):(l.x=a.x-2,l.y=a.y+24,l.scaleY=1.15),0==n){s.curFunc=1,s.curRes=o.res+"_png";for(var d in s.selectList){var g=s.selectList[d];g.source="diy_item_bg_png"}l.source="diy_select_kuan_png"}n++,s.selectList[n.toString()]=l,a.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.curFunc=1,this.curRes=o.res+"_png";for(var e in this.selectList){var t=this.selectList[e];t.source="diy_item_bg_png"}l.source="diy_select_kuan_png"},s)}},s=this;for(var a in ConstValue.P_CONFIG.MapBase)o(a)},e.prototype.viewMapSubLayer=function(t){for(var i in e.groundLayerSubObj){var n=e.groundLayerSubObj[i];n.viewSub(t)}},e.prototype.clickGround=function(){this.initResList(this.resTitle,1),this.viewMapSubLayer(!1),this.curFunc=1,this.curtype=1,this.btnGround.source="diy_page_yes_png",this.btnBlock.source="diy_page_not_png",this.btnDecorate.source="diy_page_not_png",this.tDi.textColor=16242333,this.tBiao.textColor=16242333,this.tZhang.textColor=14005920,this.tAi.textColor=14005920,this.tZhuang.textColor=14005920,this.tShi.textColor=14005920},e.prototype.closeNice=function(){this.tipsPanel=this.panel,null!=this.panelSave&&this.context.removeChild(this.panelSave),this.panelSave=null,null!=this.panelRank&&this.context.removeChild(this.panelRank),this.panelRank=null,null!=this.maskBg2&&this.context.removeChild(this.maskBg2),0==this.iType&&this.clear()},e.prototype.clickBolck=function(){this.initResList(this.resTitle,2),this.viewMapSubLayer(!0),this.curFunc=1,this.curtype=2,this.btnGround.source="diy_page_not_png",this.btnBlock.source="diy_page_yes_png",this.btnDecorate.source="diy_page_not_png",this.tDi.textColor=14005920,this.tBiao.textColor=14005920,this.tZhang.textColor=16242333,this.tAi.textColor=16242333,this.tZhuang.textColor=14005920,this.tShi.textColor=14005920},e.prototype.onClick=function(e){return __awaiter(this,void 0,void 0,function(){var t,i,n,o,s,a,l,r,h;return __generator(this,function(u){switch(t=e.target.name,CommonTools.log("==========name::::"+t),t){case"STYLE_BTN":this.changeListType();break;case"btn_rank":i=CommonTools.getDataJsonStr("getNewRank",1,{}),ConstValue.P_NET_OBJ.sendData(i);break;case"btn_mymap":n=CommonTools.getDataJsonStr("getMyMaps",1,{}),ConstValue.P_NET_OBJ.sendData(n);break;case"btn_close":CommonTools.niceTip(this.panelRank,2,this);break;case"btn_ground_lb":this.addGuideTips("mapdiy1"),this.clickGround();break;case"btn_block_lb":this.addGuideTips("mapdiy2"),this.clickBolck();break;case"btn_decorate_lb":this.addGuideTips("mapdiy3"),this.initResList(this.resTitle,3),this.viewMapSubLayer(!0),this.curFunc=1,this.curtype=3,this.btnGround.source="diy_page_not_png",this.btnBlock.source="diy_page_not_png",this.btnDecorate.source="diy_page_yes_png",this.tDi.textColor=14005920,this.tBiao.textColor=14005920,this.tZhang.textColor=14005920,this.tAi.textColor=14005920,this.tZhuang.textColor=16242333,this.tShi.textColor=16242333;break;case"goback_btn":this.clear();break;case"lb_1p":if(this.addGuideTips("mapdiy4"),1==this.curtype)return CommonTools.addCommonTips(this.panel,"当前在地表层，请选择障碍层或者装饰层"),[2];this.curFunc=3;break;case"lb_2p":if(this.addGuideTips("mapdiy5"),1==this.curtype)return CommonTools.addCommonTips(this.panel,"当前在地表层，请选择障碍层或者装饰层"),[2];this.curFunc=4;break;case"lb_eraser":this.addGuideTips("mapdiy6"),this.curFunc=2;break;case"btn_close_edit":CommonTools.niceTip(this.panelSave,2,this);break;case"btn_confirm_modify":this.saveMap();break;case"lb_save":if(!this.checkGroundValidate())return CommonTools.addCommonTips(this.panel,"地表层不能有空块"),[2];if(!this.checkPlayers())return CommonTools.addCommonTips(this.panel,"需要完整p1和p2,请设置位置"),[2];if(!this.checkPathValidate())return CommonTools.addCommonTips(this.panel,"玩家间不联通，请合理设计"),[2];this.saveMap();break;case"lb_new":o=this.panelRank.getChildByName("match_rank_bg"),s=this.panelRank.getChildByName("lv_rank_bg"),o.source="map_rank_normal_png",s.source="map_rank_select_png",a=CommonTools.getDataJsonStr("getNewRank",1,{}),ConstValue.P_NET_OBJ.sendData(a);break;case"lb_hot":l=this.panelRank.getChildByName("match_rank_bg"),r=this.panelRank.getChildByName("lv_rank_bg"),l.source="map_rank_select_png",r.source="map_rank_normal_png",h=CommonTools.getDataJsonStr("getHopRank",1,{}),ConstValue.P_NET_OBJ.sendData(h);break;default:CommonTools.log("11111111 default")}return[2]})})},e.prototype.changeListType=function(){this.isShow?(this.isShow=!1,this.scroller.visible=!1):(this.isShow=!0,this.scroller.visible=!0)},e.prototype.drawDownList=function(){var e=["基础主题","吃货主题","暗黑主题","春节主题"];this.list=new eui.List,this.list.width=308,this.list.dataProvider=new eui.ArrayCollection(e),this.list.selectedIndex=3,this.list.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onChange,this);var t=new eui.Scroller;t.height=200,t.viewport=this.list,t.x=161,t.y=161,t.visible=!1,this.panel.addChild(t),this.scroller=t},e.prototype.onChange=function(e){this.resTitle=this.list.selectedIndex+1,this.initResList(this.resTitle,1),this.viewMapSubLayer(!1),this.curtype=1,this.changeListType(),this.clickGround()},e.prototype.clear=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return this.iType>0&&(this.context.removeChild(this.backBtn),this.context.removeChild(this.panel),this.panel=null,e.groundLayerSubObj={}),[4,this.context.loadResource("preloadHall",2)];case 1:return t.sent(),this.context=null,ConstValue.P_MAP_OBJ=null,[2]}})})},e.prototype.updateByClickAdd=function(){this.context.removeChild(this.panel),e.groundLayerSubObj={},ConstValue.P_MAP_OBJ=null,ConstValue.P_MAP_OBJ=new e(this.context,null,2)},e.prototype.updateByClickModify=function(t){this.context.removeChild(this.panel),e.groundLayerSubObj={},ConstValue.P_MAP_OBJ=null,ConstValue.P_MAP_OBJ=new e(this.context,t,3),ConstValue.P_MAP_OBJ.mapKey=t.id},e.prototype.checkGroundValidate=function(){for(var t in e.groundLayerSubObj){var i=e.groundLayerSubObj[t];if(i.groundEmpty)return!1}return!0},e.prototype.checkPlayers=function(){var t=!1,i=!1;for(var n in e.groundLayerSubObj){var o=e.groundLayerSubObj[n];119==o.isPlayer?t=!0:120==o.isPlayer&&(i=!0)}return t&&i?!0:!1},e.prototype.getPath=function(e,t,i,n){var o=this.grid.clone();return this.finder.findPath(e,t,i,n,o)},e.prototype.checkPathValidate=function(){var t=-1,i=-1,n=-1,o=-1,s=!1;for(var a in e.groundLayerSubObj){var l=e.groundLayerSubObj[a];2==l.subType&&0==l.isPlayer&&this.grid.setWalkableAt(l.getColumn(),l.getRow(),!1),119==l.isPlayer?(t=l.getColumn(),i=l.getRow()):120==l.isPlayer&&(n=l.getColumn(),o=l.getRow())}var r=this.getPath(t,i,n,o);r.length>0&&(s=!0);for(var a in e.groundLayerSubObj){var l=e.groundLayerSubObj[a];2==l.subType&&0==l.isPlayer&&this.grid.setWalkableAt(l.getColumn(),l.getRow(),!0)}return s},e.prototype.saveMap=function(){for(var t in this.testMap2)this.testMap2[t]=0;for(var t in e.groundLayerSubObj){var i=e.groundLayerSubObj[t];this.testGround2[parseInt(t)]=i.res,i.subType>0&&(this.testMap2[parseInt(t)]=i.resSub)}var n=CommonTools.getDataJsonStr("saveMap",1,{lBgConf:this.testGround2,lLayerConf:this.testMap2,mapName:"",mapSign:"",mapkey:this.mapKey});ConstValue.P_NET_OBJ.sendData(n)},e.prototype.openSaveUI=function(){this.maskBg2=new eui.Image("mask_layer_png"),this.maskBg2.width=this.context.getStageWidth(),this.maskBg2.height=this.context.getStageHeight(),this.context.addChild(this.maskBg2),this.panelSave=new eui.Panel,this.panelSave.skinName="resource/eui_skins/UserUI/SaveMapTipUI.exml",this.panelSave.title="Title",this.panelSave.horizontalCenter=0,this.panelSave.verticalCenter=0,this.context.addChild(this.panelSave),CommonTools.niceTip(this.panelSave,1,this);var e=this.panelSave.getChildByName("map_name_tx");e.text=this.txtMapName;var t=this.panelSave.getChildByName("map_sign_tx");t.text=this.txtMapSign,CommonButtonHandle.beginTouch(this.panelSave.getChildByName("btn_close_edit"),this),this.panelSave.getChildByName("btn_close_edit").addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),CommonButtonHandle.beginTouch(this.panelSave.getChildByName("btn_confirm_modify"),this),this.panelSave.getChildByName("btn_confirm_modify").addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this)},e.prototype.openRankUI=function(e){this.iType>0?this.maskBg2=new eui.Image("mask_layer_png"):this.maskBg2=new eui.Image("bg_ppt_1_png"),this.maskBg2.width=this.context.getStageWidth(),this.maskBg2.height=this.context.getStageHeight(),this.context.addChild(this.maskBg2),this.panelRank=new eui.Panel,this.panelRank.skinName="resource/eui_skins/UserUI/MapRankUI.exml",this.panelRank.title="Title",this.panelRank.horizontalCenter=0,this.panelRank.verticalCenter=0,this.context.addChild(this.panelRank),CommonTools.fixFix(this.context,this.panelRank,1,0,0),CommonTools.niceTip(this.panelRank,1,this),this.updateRankUI(e,1),CommonButtonHandle.beginTouch(this.panelRank.getChildByName("btn_close"),this),this.panelRank.getChildByName("btn_close").addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.panelRank.getChildByName("lb_new").addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.panelRank.getChildByName("lb_hot").addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this)
},e.prototype.openViewUI=function(e){this.maskBg2=new eui.Image("mask_layer_png"),this.maskBg2.width=this.context.getStageWidth(),this.maskBg2.height=this.context.getStageHeight(),this.context.addChild(this.maskBg2),this.panelRank=new eui.Panel,this.panelRank.skinName="resource/eui_skins/UserUI/MapViewUI.exml",this.panelRank.title="Title",this.panelRank.horizontalCenter=0,this.panelRank.verticalCenter=0,this.context.addChild(this.panelRank),CommonTools.fixFix(this.context,this.panelRank,1,0,0),CommonTools.niceTip(this.panelRank,1,this);var t=this.panelRank.getChildByName("fighting_parent").getChildByName("scroll").getChildByName("scroll_group"),i=0,n=function(n){var s=e[n],a=new eui.Panel;a.skinName="resource/eui_skins/UserUI/MapViewGroup.exml",a.name="p_"+i,a.x+=8,a.y+=15+1*i+290*i,t.addChild(a),a.getChildByName("view_add").visible=!1,a.getChildByName("view_add_btn").visible=!1;var l=a.getChildByName("group_1"),r=l.getChildByName("lb_title");r.text=s.mapName;var h=l.getChildByName("lb_author");h.text=ConstValue.cacheUserInfo.name;var u=l.getChildByName("lb_sign");if(u.text=s.mapSign,a.getChildByName("view_fight_btn").addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){var i=CommonTools.getDataJsonStr("setFightMap",1,{mapId:s.id});ConstValue.P_NET_OBJ.sendData(i);for(var n=t.numChildren,o=0;n>o;o++){var l=t.getChildByName("p_"+o),r=l.getChildByName("fighting_lb_png");null!=r&&l.removeChild(r)}var h=new eui.Image("fighting_lb_png");h.name="fighting_lb_png",a.addChild(h),h.x=6,h.y=6},o),a.getChildByName("view_change_btn").addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){CommonTools.niceTip(this.panelRank,2,this),this.updateByClickModify(s)},o),new MapMiniDIYModule(a,s.bgconf,s.layerconf,2),1==s.isFight){var c=new eui.Image("fighting_lb_png");c.name="fighting_lb_png",a.addChild(c),c.x=6,c.y=6}i++},o=this;for(var s in e)n(s);var a=new eui.Panel;a.skinName="resource/eui_skins/UserUI/MapViewGroup.exml",a.name="p_"+i,a.x+=8,a.y+=15+1*i+290*i,t.addChild(a);var l=a.getChildByName("group_1");l.visible=!1,a.getChildByName("view_fight_btn").visible=!1,a.getChildByName("view_change_btn").visible=!1,a.getChildByName("view_add_btn").addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){CommonTools.niceTip(this.panelRank,2,this),this.updateByClickAdd()},this),CommonButtonHandle.beginTouch(this.panelRank.getChildByName("btn_close"),this),this.panelRank.getChildByName("btn_close").addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this)},e.prototype.updateRankUI=function(e,t){this.tipsPanel=this.panelRank;var i=this.panelRank.getChildByName("fighting_parent").getChildByName("scroll");i.viewport.scrollV=0;var n=this.panelRank.getChildByName("fighting_parent").getChildByName("scroll").getChildByName("scroll_group");n.removeChildren();var o=function(i){var o=e[i],a=new eui.Panel;a.skinName="resource/eui_skins/UserUI/MapRankGroup.exml",a.name="p_"+i,a.x+=8,a.y+=15+3*parseInt(i)+255*parseInt(i),n.addChild(a);var l=a.getChildByName("group_1"),r=l.getChildByName("lb_title");r.text=o.mapName;var h=l.getChildByName("lb_author");h.text=o.name;var u=l.getChildByName("lb_sign");u.text=o.mapSign;var c=l.getChildByName("like_num");c.text=o.like;var d=l.getChildByName("like_heart");CommonButtonHandle.beginTouch(d,s),d.addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){var i=CommonTools.getDataJsonStr("addLike",1,{rid:o.rid,mapKey:o.mapkey,iType:t});ConstValue.P_NET_OBJ.sendData(i)},s),new MapMiniDIYModule(a,o.lBgconf,o.lLayerconf,1)},s=this;for(var a in e)o(a)},e.prototype.handlePacket=function(e){"saveMap"==e.f?""!=e.m||1!=e.s||(this.mapKey=e.d.mapkey):"getNewRank"==e.f?""!=e.m||1!=e.s||(null!=this.panelRank?this.updateRankUI(e.d.lnewRank,1):this.openRankUI(e.d.lnewRank)):"getHopRank"==e.f?""!=e.m||1!=e.s||this.updateRankUI(e.d.lhotRank,2):"getMyMaps"==e.f&&(""!=e.m||1!=e.s||this.openViewUI(e.d))},e.groundLayerSubObj={},e.ONE_P="",e.TWO_P="",e.defaultData={},e.guide_tip_new={mapdiy1:{tip:"地表层是人物的行走区域哦！～"},mapdiy2:{tip:"障碍层是不可以被炸开哒！～"},mapdiy3:{tip:"炸开装饰有机会获得道具哦！～"},mapdiy4:{tip:"摆放自己的出生位置！～"},mapdiy5:{tip:"摆放敌人的出生位置！～"},mapdiy6:{tip:"可以抹掉你想抹掉的地方！～"}},e}();__reflect(MapDIYModule.prototype,"MapDIYModule");var MapMiniDIYModule=function(e){function t(t,i,n,o){var s=e.call(this)||this;return s.initRow=9,s.initColumn=11,s.firstItemX=494.88,s.firstItemY=100.84,s.groundItemW=58,s.groundItemH=55,s.groundOffX=0,s.groundOffY=0,s.testGround2=[1,24,24,1,2,2,2,1,1,1,26,1,1,1,1,1,1,1,1,1,1,1,2,2,1,1,1,2,3,1,1,1,1,2,2,1,1,1,1,1,1,1,1,1,2,1,1,1,25,1,2,1,1,1,1,1,1,1,3,1,1,1,1,2,1,1,1,1,1,1,1,1,1,1,2,1,1,1,1,1,1,1,1,1,1,2,1,2,1,1,1,1,3,3,1,1,2,2,2],s.testMap2=[119,0,7,7,16,21,16,7,7,0,0,0,4,4,20,21,4,21,20,4,4,0,0,0,9,9,16,4,16,9,9,0,0,6,19,5,5,11,4,11,5,5,16,6,6,19,5,11,0,4,0,11,5,16,6,6,19,5,5,11,4,11,7,5,16,6,0,0,0,4,16,4,16,4,0,0,0,0,4,4,4,12,19,12,4,4,4,0,0,20,20,12,16,19,16,12,20,20,120],s.type=1,s.context=t,s.type=o,s.panel=new eui.Panel,s.panel.skinName="resource/eui_skins/UserUI/mapMiniDIYUI.exml",s.panel.title="Title",s.context.addChild(s.panel),s.testGround=i,s.testMap=n,s.initScene(),s}return __extends(t,e),t.prototype.initConfig=function(){var e=this;LZMA.decompress(EBitUtil.getArr(new egret.ByteArray(RES.getRes("config_json"))),function(t){ConstValue.P_CONFIG=JSON.parse(t),e.initScene()},function(e){})},t.prototype.initScene=function(){for(var e=0,t=0;t<this.initRow;t++)for(var i=0;i<this.initColumn;i++){var n=this.groundItemW,o=this.groundItemH,s=this.groundOffX,a=this.groundOffY;t>0&&(a=7),i>0&&(s=4);var l=this.firstItemX+n*i+s*i,r=this.firstItemY+o*t+a*t,h={img:"res_"+this.testGround[e]+"_png",x:l,y:r,name:"ground_"+e,curIdx:e},u=new Fight.MapItem(h);if(u.setRow(t),u.setColumn(i),u.setType(ConstValue.P_CONFIG.MapBase[this.testGround[e].toString()].Type),this.panel.addChild(u),u.scaleX=.7,u.scaleY=.7,u.itemRange[0]=497+55*i+6*i,u.itemRange[1]=u.itemRange[0]+55,u.itemRange[2]=103+55*t+7*t,u.itemRange[3]=u.itemRange[2]+55,u.setRes(this.testGround[e]),this.testMap[e]>0&&this.testMap[e]<100){var c="res_"+this.testMap[e]+"_png";u.addMiniBlock(c)}else this.testMap[e]>100&&u.addMiniPlayer(this.testMap[e]);e++}this.panel.scaleX=.4,this.panel.scaleY=.4,1==this.type?(this.panel.x=180,this.panel.y=-20):2==this.type?(this.panel.x=-220,this.panel.y=-30,this.panel.scaleX=.48,this.panel.scaleY=.48):3==this.type&&(this.panel.x=112,this.panel.y=116,this.panel.scaleX=.66,this.panel.scaleY=.66)},t}(egret.DisplayObjectContainer);__reflect(MapMiniDIYModule.prototype,"MapMiniDIYModule");var AIUtil0=function(){function e(e,t,i,n,o){this.aiObj=null,this.iCmd=0,this.curPathPointIndex=0,this.boxMap={},this.curBoxMapIdex=0,this.workMap={},this.isVirtualOpen=!1,this.iOpenState=!1,this.delayFunc=null,this.delayTimer=null,this.isSameCR=!1,this.aiObj=e,this.aiObj.aiRobot=!0,this.initRow=i,this.initColumn=n,1==o?this.matrix=[[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0]]:2==o&&(this.matrix=[[0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0]]),this.grid=new PF.Grid(n,i,this.matrix),this.op=new PF.Option,this.op.allowDiagonal=!1,this.finder=new PF.AStarFinder(this.op);for(var s=0,a=0;i>a;a++)for(var l=0;n>l;l++){if(t[s]>0&&t[s]<100){this.grid.setWalkableAt(l,a,!1);var r=ConstValue.P_CONFIG.MapBase[t[s].toString()].Type;if(3==r){var h=Math.abs(this.aiObj.getColumn()-l);null==this.boxMap[h.toString()]&&(this.boxMap[h.toString()]={}),this.boxMap[h.toString()][l+"_"+a]=[l,a]}}s++}for(var a=0;i>a;a++)for(var l=0;n>l;l++){var u=this.getPath(l,a);u.length>0&&(this.workMap[l+"_"+a]=[l,a])}}return e.prototype.beNotifyHasFood=function(e,t){CommonTools.logAI("----------------***卧槽有东西吃了,看下能到达吗 "+e+"_"+t);var i=this.getPath(e,t);i.length>0?(CommonTools.logAI("----------------***就在眼前，去吃"),this.isVirtualOpen=!1,this.iCmd=3,this.removeDelay(),this.resetMove(i),CommonTools.logAI("move------55555555555555555555555555555555"),this.moveNext()):CommonTools.logAI("----------------***蛋疼无路可以过去吃")},e.prototype.moveNext=function(){if(this.iOpenState){if(this.isConnectEnemy())if(CommonTools.logAI("----------------***发现敌人"),this.isHasBoom()){CommonTools.logAI("----------------***发现有炸弹"),CommonTools.logAI("----------------***赶紧逃跑"),this.iCmd=1;var e=this.getSafePath(),t=this.getPath(e[0],e[1]);this.resetMove(t)}else{var i=this.getPath(this.getOtherPlayer().getColumn(),this.getOtherPlayer().getRow());i.length>0&&(CommonTools.logAI("----------------***杀啊。。。"),this.iCmd=2,this.resetMove(i))}else if(CommonTools.logAI("----------------***没有发现敌人"),this.isHasBoom()){if(!this.isSameCR){CommonTools.logAI("----------------***发现有炸弹"),CommonTools.logAI("----------------***赶紧逃跑");var e=this.getSafePath();CommonTools.logAI("----------------***safePath:"+e);var t=this.getPath(e[0],e[1]);t.length>0&&(this.iCmd=1,this.resetMove(t))}}else{CommonTools.logAI("----------------***不危险，找箱子"),this.isSameCR=!1;var n=this.getNextBox();if(1==this.iCmd&&(this.iCmd=0),null!=n&&0==this.iCmd){this.grid.setWalkableAt(n[0],n[1],!0),this.isVirtualOpen=!0;var o=this.getPath(n[0],n[1]);this.grid.setWalkableAt(n[0],n[1],!1),o.length>0&&(CommonTools.logAI("----------------***找箱子"),this.iCmd=2,this.resetMove(o))}}if(0==this.iCmd)return CommonTools.logAI("----------------***没有命令，主人"),CommonTools.logAI("move------6666666666666666666666666666666666"),void this.moveNext();this.curPathPointIndex++,CommonTools.logAI("this.iCmd------------aaaaaaaaaaaa----------"+this.iCmd+" this.curPathPointIndex:"+this.curPathPointIndex+" this.curPath:"+this.curPath);var s=this.curPath.length;if(this.isVirtualOpen&&(s=this.curPath.length-1),this.curPathPointIndex>=s)if(this.curPathPointIndex=0,this.isVirtualOpen){this.isVirtualOpen=!1,CommonTools.logAI("----------------***找到箱子了，要放炮了");var a=CommonTools.getDataJsonStr("syncPut",1,{x:this.aiObj.x,y:this.aiObj.y,idx:parseInt(this.aiObj.curMapIdx),playerID:this.aiObj.roleId});ConstValue.P_NET_OBJ.sendData2(a)}else if(CommonTools.logAI("----------------***到达终点，找下一件事情做"),1==this.iCmd)CommonTools.logAI("----------------***逃生中，躲3秒"),this.isConnectEnemy()?(this.removeDelay(),this.delayFunc=function(){CommonTools.logAI("move------7777777777777777777777777777777777"),1==this.iCmd&&(CommonTools.log("move------7777777777777777777777777777777777"),this.moveNext())},this.Delay(10)):(this.removeDelay(),this.delayFunc=function(){CommonTools.logAI("move------7777777777777777777777777777777777"),1==this.iCmd&&this.moveNext()},this.Delay(3800));else if(3==this.iCmd)CommonTools.logAI("----------------***吃了东西了"),this.iCmd=0,CommonTools.logAI("move------8888888888888888888888888888888888888888"),this.moveNext();else if(2==this.iCmd){CommonTools.logAI("----------------***炸死个扑街");var a=CommonTools.getDataJsonStr("syncPut",1,{x:this.aiObj.x,y:this.aiObj.y,idx:parseInt(this.aiObj.curMapIdx),playerID:this.aiObj.roleId});ConstValue.P_NET_OBJ.sendData2(a)}else CommonTools.logAI("move------999999999999999999999999999999999999"),this.moveNext();else{if(1==this.iCmd&&this.curPathPointIndex>=4&&this.isConnectEnemy()){CommonTools.logAI("----------------***逃跑也放雷");var a=CommonTools.getDataJsonStr("syncPut",1,{x:this.aiObj.x,y:this.aiObj.y,idx:parseInt(this.aiObj.curMapIdx),playerID:this.aiObj.roleId});ConstValue.P_NET_OBJ.sendData2(a)}this.move(this.curPath[this.curPathPointIndex][0],this.curPath[this.curPathPointIndex][1])}}},e.prototype.resetMove=function(e){this.curPathPointIndex=0,this.curPath=e},e.prototype.openBlock=function(e,t){this.setWalkAble(e,t,!0);var i=e+"_"+t;this.workMap[i]=[e,t],CommonTools.printMap(this.workMap);var n="";for(var o in this.boxMap){var s=this.boxMap[o];for(var a in s){var l=s[a];if(l[0]==e&&l[1]==t){n=o;break}}if(""!=n)break}""!=n&&(this.boxMap[n][e+"_"+t]=null,delete this.boxMap[n][e+"_"+t]);for(var o=0;o<this.initRow;o++)for(var a=0;a<this.initColumn;a++){var r=this.getPath(a,o);r.length>0&&null==this.workMap[a+"_"+o]&&(this.workMap[a+"_"+o]=[a,o])}},e.prototype.Delay=function(e){this.delayTimer=new egret.Timer(e,1),this.delayTimer.addEventListener(egret.TimerEvent.TIMER,this.delayFunc,this),this.delayTimer.start()},e.prototype.removeDelay=function(){null!=this.delayTimer&&(this.delayTimer.stop(),this.delayTimer.removeEventListener(egret.TimerEvent.TIMER,this.delayFunc,this),this.delayTimer=null,this.delayFunc=null)},e.prototype.getNextBox=function(){var e=this.boxMap[this.curBoxMapIdex.toString()],t=0;for(var i in e)t++;for(;0==t;){if(this.curBoxMapIdex++,this.curBoxMapIdex>=this.initColumn)return null;e=this.boxMap[this.curBoxMapIdex.toString()];for(var i in e)t++}for(var i in e){CommonTools.logAI("getNextBox************************tBox[i]:"+e[i]),this.grid.setWalkableAt(e[i][0],e[i][1],!0);var n=this.getPath(e[i][0],e[i][1]);if(this.grid.setWalkableAt(e[i][0],e[i][1],!1),n.length>0)return e[i]}return CommonTools.logAI("getNextBox************xxxxxx***no box*********"),this.curBoxMapIdex++,this.getNextBox()},e.prototype.isHasBoom=function(){if(this.isConnectEnemy())for(var e in FightingModule.bulletLayerSubObj)return!0;else for(var e in FightingModule.bulletLayerSubObj){var t=FightingModule.bulletLayerSubObj[e];if(t.owner.roleId==this.aiObj.roleId)return!0}return!1},e.prototype.getSafePath=function(){var e=null,t=100;if(CommonTools.printMap(this.workMap),this.isConnectEnemy())for(var i in this.workMap){var n=this.workMap[i],o=!0;for(var s in FightingModule.bulletLayerSubObj){var a=FightingModule.bulletLayerSubObj[s];if(a.getColumn()==n[0]||a.getRow()==n[1]){o=!1;break}}if(o){var l=this.getPath(n[0],n[1]);l.length>0&&l.length<t&&(t=l.length,e=n)}}else for(var i in this.workMap){var n=this.workMap[i],o=!0;for(var s in FightingModule.bulletLayerSubObj){var a=FightingModule.bulletLayerSubObj[s];if(a.owner.roleId==this.aiObj.roleId&&(a.getColumn()==n[0]||a.getRow()==n[1])){o=!1;break}}if(o){var l=this.getPath(n[0],n[1]);l.length>0&&l.length<t&&(t=l.length,e=n,CommonTools.logAI("getSafePath----miniLenChoose-----------------"+e))}}if(null!=e)return e;this.isSameCR=!0,t=0;for(var i in this.workMap){var n=this.workMap[i],l=this.getPath(n[0],n[1]);l.length>t&&(t=l.length,e=n,CommonTools.logAI("getSafePath--22--miniLenChoose-----------------"+e))}return null!=e?e:null},e.prototype.getPath=function(e,t){var i=this.grid.clone();return this.finder.findPath(this.aiObj.getColumn(),this.aiObj.getRow(),e,t,i)},e.prototype.startAI=function(){},e.prototype.stopAI=function(){this.iOpenState=!1},e.prototype.isConnectEnemy=function(){var e=this.getPath(this.getOtherPlayer().getColumn(),this.getOtherPlayer().getRow());return 0==e.length?!1:!0},e.prototype.setWalkAble=function(e,t,i){this.grid.setWalkableAt(e,t,i)},e.prototype.getOtherPlayer=function(){for(var e in FightingModule.playerLayerSubObj){var t=FightingModule.playerLayerSubObj[e];if(t.roleId!=this.aiObj.roleId&&0==t.isAI)return t}return null},e.prototype.move=function(e,t){var i=this.aiObj;null==this.aiObj.func&&(this.aiObj.func=function(e){i.setMoving(!0),i.move(-1,!0)},this.aiObj.addEventListener(egret.Event.ENTER_FRAME,this.aiObj.func,this.aiObj)),this.aiObj.setMoving(!0),this.aiObj.moveDetail(e,t)},e.prototype.clear=function(){this.aiObj=null,this.grid=null,this.op=null,this.finder=null,this.matrix=null,this.curPath=null,this.boxMap={},this.workMap={},this.removeDelay()},e}();__reflect(AIUtil0.prototype,"AIUtil0");var AIUtil1=function(){function e(e,t,i,n,o){this.aiObj=null,this.iCmd=0,this.curPathPointIndex=0,this.boxMap={},this.curBoxMapIdex=0,this.workMap={},this.isVirtualOpen=!1,this.iOpenState=!1,this.delayFunc=null,this.delayTimer=null,this.isSameCR=!1,this.isTrueConnectEnemy=!1,this.aiObj=e,this.aiObj.aiRobot=!0,this.initRow=i,this.initColumn=n,1==o?this.matrix=[[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0]]:2==o&&(this.matrix=[[0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0]]),this.grid=new PF.Grid(n,i,this.matrix),this.op=new PF.Option,this.op.allowDiagonal=!1,this.finder=new PF.AStarFinder(this.op);for(var s=0,a=0;i>a;a++)for(var l=0;n>l;l++){if(t[s]>0&&t[s]<100){this.grid.setWalkableAt(l,a,!1);var r=ConstValue.P_CONFIG.MapBase[t[s].toString()].Type;if(3==r){var h=Math.abs(this.aiObj.getColumn()-l);null==this.boxMap[h.toString()]&&(this.boxMap[h.toString()]={}),this.boxMap[h.toString()][l+"_"+a]=[l,a]}}s++}for(var a=0;i>a;a++)for(var l=0;n>l;l++){var u=this.getPath(l,a);u.length>0&&(this.workMap[l+"_"+a]=[l,a])}}return e.prototype.beNotifyHasFood=function(e,t){CommonTools.logAI("----------------***卧槽有东西吃了,看下能到达吗 "+e+"_"+t);var i=this.getPath(e,t);i.length>0?(CommonTools.logAI("----------------***就在眼前，去吃"),this.isVirtualOpen=!1,this.iCmd=3,this.removeDelay(),this.resetMove(i),CommonTools.logAI("move------55555555555555555555555555555555"),this.moveNext()):CommonTools.logAI("----------------***蛋疼无路可以过去吃")},e.prototype.moveNext=function(){if(this.iOpenState){if(this.isConnectEnemy())if(this.isTrueConnectEnemy=!0,CommonTools.logAI("----------------***发现敌人"),this.isHasBoom()){CommonTools.logAI("----------------***发现有炸弹"),CommonTools.logAI("----------------***赶紧逃跑"),this.iCmd=1;var e=this.getSafePath(),t=this.getPath(e[0],e[1]);this.resetMove(t)}else{var i=this.getPath(this.getOtherPlayer().getColumn(),this.getOtherPlayer().getRow());i.length>0&&(CommonTools.logAI("----------------***杀啊。。。"),this.iCmd=2,this.resetMove(i))}else if(CommonTools.logAI("----------------***没有发现敌人"),this.isHasBoom()){if(!this.isSameCR){CommonTools.logAI("----------------***发现有炸弹"),CommonTools.logAI("----------------***赶紧逃跑");var e=this.getSafePath();CommonTools.logAI("----------------***safePath:"+e);var t=this.getPath(e[0],e[1]);t.length>0&&(this.iCmd=1,this.resetMove(t))}}else{CommonTools.logAI("----------------***不危险，找箱子"),this.isSameCR=!1;var n=this.getNextBox();if(1==this.iCmd&&(this.iCmd=0),null!=n&&0==this.iCmd){this.grid.setWalkableAt(n[0],n[1],!0),this.isVirtualOpen=!0;var o=this.getPath(n[0],n[1]);this.grid.setWalkableAt(n[0],n[1],!1),o.length>0&&(CommonTools.logAI("----------------***找箱子"),this.iCmd=2,this.resetMove(o))}}if(0==this.iCmd)return CommonTools.logAI("----------------***没有命令，主人"),CommonTools.logAI("move------6666666666666666666666666666666666"),void this.moveNext();this.curPathPointIndex++,CommonTools.logAI("this.iCmd------------aaaaaaaaaaaa----------"+this.iCmd+" this.curPathPointIndex:"+this.curPathPointIndex+" this.curPath:"+this.curPath);var s=this.curPath.length;if(this.isVirtualOpen&&(s=this.curPath.length-1),this.curPathPointIndex>=s)if(this.curPathPointIndex=0,this.isVirtualOpen){this.isVirtualOpen=!1,CommonTools.logAI("----------------***找到箱子了，要放炮了");var a=CommonTools.getDataJsonStr("syncPut",1,{x:this.aiObj.x,y:this.aiObj.y,idx:parseInt(this.aiObj.curMapIdx),playerID:this.aiObj.roleId});ConstValue.P_NET_OBJ.sendData2(a)}else if(CommonTools.logAI("----------------***到达终点，找下一件事情做"),1==this.iCmd)CommonTools.logAI("----------------***逃生中，躲3秒"),this.isConnectEnemy()?(CommonTools.logAI("move------7777777777777777777777777777777777a"),this.removeDelay(),this.delayFunc=function(){CommonTools.logAI("move------77777777777777777777777777777777771"),1==this.iCmd&&(CommonTools.log("move------77777777777777777777777777777777772"),this.moveNext())},this.Delay(10)):(CommonTools.logAI("move------7777777777777777777777777777777777b"),this.removeDelay(),this.delayFunc=function(){CommonTools.logAI("move------77777777777777777777777777777777773"),1==this.iCmd&&this.moveNext()},this.isTrueConnectEnemy?this.Delay(1e3):this.Delay(3800));else if(3==this.iCmd)CommonTools.logAI("----------------***吃了东西了"),this.iCmd=0,CommonTools.logAI("move------8888888888888888888888888888888888888888"),this.moveNext();else if(2==this.iCmd){CommonTools.logAI("----------------***炸死个扑街");var a=CommonTools.getDataJsonStr("syncPut",1,{x:this.aiObj.x,y:this.aiObj.y,idx:parseInt(this.aiObj.curMapIdx),playerID:this.aiObj.roleId});ConstValue.P_NET_OBJ.sendData2(a)}else CommonTools.logAI("move------999999999999999999999999999999999999"),this.moveNext();else{if(1==this.iCmd&&this.curPathPointIndex>=4&&this.isConnectEnemy()){CommonTools.logAI("----------------***逃跑也放雷");var a=CommonTools.getDataJsonStr("syncPut",1,{x:this.aiObj.x,y:this.aiObj.y,idx:parseInt(this.aiObj.curMapIdx),playerID:this.aiObj.roleId});ConstValue.P_NET_OBJ.sendData2(a)}this.move(this.curPath[this.curPathPointIndex][0],this.curPath[this.curPathPointIndex][1])}}},e.prototype.resetMove=function(e){this.curPathPointIndex=0,this.curPath=e},e.prototype.openBlock=function(e,t){this.setWalkAble(e,t,!0);var i=e+"_"+t;this.workMap[i]=[e,t],CommonTools.printMap(this.workMap);var n="";for(var o in this.boxMap){var s=this.boxMap[o];for(var a in s){var l=s[a];if(l[0]==e&&l[1]==t){n=o;break}}if(""!=n)break}""!=n&&(this.boxMap[n][e+"_"+t]=null,delete this.boxMap[n][e+"_"+t]);for(var o=0;o<this.initRow;o++)for(var a=0;a<this.initColumn;a++){var r=this.getPath(a,o);r.length>0&&null==this.workMap[a+"_"+o]&&(this.workMap[a+"_"+o]=[a,o])}},e.prototype.Delay=function(e){this.delayTimer=new egret.Timer(e,1),this.delayTimer.addEventListener(egret.TimerEvent.TIMER,this.delayFunc,this),this.delayTimer.start()},e.prototype.removeDelay=function(){null!=this.delayTimer&&(this.delayTimer.stop(),this.delayTimer.removeEventListener(egret.TimerEvent.TIMER,this.delayFunc,this),this.delayTimer=null,this.delayFunc=null)},e.prototype.getNextBox=function(){var e=this.boxMap[this.curBoxMapIdex.toString()],t=0;for(var i in e)t++;for(;0==t;){if(this.curBoxMapIdex++,this.curBoxMapIdex>=this.initColumn)return null;e=this.boxMap[this.curBoxMapIdex.toString()];for(var i in e)t++}for(var i in e)if(CommonTools.logAI("getNextBox************************tBox[i]:"+e[i]),29!=FightingModule.curBarrNo&&30!=FightingModule.curBarrNo||9!=e[i][0]||0!=e[i][1]){this.grid.setWalkableAt(e[i][0],e[i][1],!0);var n=this.getPath(e[i][0],e[i][1]);if(this.grid.setWalkableAt(e[i][0],e[i][1],!1),n.length>0)return e[i]}return CommonTools.logAI("getNextBox************xxxxxx***no box*********"),this.curBoxMapIdex++,this.getNextBox()},e.prototype.isHasBoom=function(){if(this.isConnectEnemy())for(var e in FightingModule.bulletLayerSubObj){var t=FightingModule.bulletLayerSubObj[e];if(Math.abs(this.aiObj.getColumn()-t.getColumn())<=2&&Math.abs(this.aiObj.getRow()-t.getRow())<=2)return!0}else for(var e in FightingModule.bulletLayerSubObj){var t=FightingModule.bulletLayerSubObj[e];if(t.owner.roleId==this.aiObj.roleId)return!0}return!1},e.prototype.getSafePath=function(){var e=null,t=100;if(CommonTools.printMap(this.workMap),this.isConnectEnemy())for(var i in this.workMap){var n=this.workMap[i],o=!0;for(var s in FightingModule.bulletLayerSubObj){var a=FightingModule.bulletLayerSubObj[s];if(a.getColumn()==n[0]||a.getRow()==n[1]){o=!1;break}}if(o){var l=this.getPath(n[0],n[1]);l.length>0&&l.length<t&&(t=l.length,e=n)}}else for(var i in this.workMap){var n=this.workMap[i],o=!0;for(var s in FightingModule.bulletLayerSubObj){var a=FightingModule.bulletLayerSubObj[s];if(a.owner.roleId==this.aiObj.roleId&&(a.getColumn()==n[0]||a.getRow()==n[1])){o=!1;break}}if(o){var l=this.getPath(n[0],n[1]);l.length>0&&l.length<t&&(t=l.length,e=n,CommonTools.logAI("getSafePath----miniLenChoose-----------------"+e))}}if(null!=e)return e;this.isSameCR=!0,t=0;for(var i in this.workMap){var n=this.workMap[i],l=this.getPath(n[0],n[1]);l.length>t&&(t=l.length,e=n,CommonTools.logAI("getSafePath--22--miniLenChoose-----------------"+e))}return null!=e?e:null},e.prototype.getPath=function(e,t){var i=this.grid.clone();return this.finder.findPath(this.aiObj.getColumn(),this.aiObj.getRow(),e,t,i)},e.prototype.startAI=function(){this.iOpenState=!0,this.isConnectEnemy()?this.moveNext():(CommonTools.logAI("----------------***开局"),this.moveNext())},e.prototype.stopAI=function(){this.iOpenState=!1},e.prototype.isConnectEnemy=function(){var e=this.getPath(this.getOtherPlayer().getColumn(),this.getOtherPlayer().getRow());return 0==e.length?!1:!0},e.prototype.setWalkAble=function(e,t,i){this.grid.setWalkableAt(e,t,i)},e.prototype.getOtherPlayer=function(){for(var e in FightingModule.playerLayerSubObj){var t=FightingModule.playerLayerSubObj[e];if(t.roleId!=this.aiObj.roleId&&0==t.isAI)return t}return null},e.prototype.move=function(e,t){var i=this.aiObj;null==this.aiObj.func&&(this.aiObj.func=function(e){i.setMoving(!0),i.move(-1,!0)},this.aiObj.addEventListener(egret.Event.ENTER_FRAME,this.aiObj.func,this.aiObj)),this.aiObj.setMoving(!0),this.aiObj.moveDetail(e,t)},e.prototype.clear=function(){this.aiObj=null,this.grid=null,this.op=null,this.finder=null,this.matrix=null,this.curPath=null,this.boxMap={},this.workMap={},this.removeDelay()},e}();__reflect(AIUtil1.prototype,"AIUtil1");var AIUtil2=function(){function e(e,t,i,n,o){this.aiObj=null,this.iCmd=0,this.curPathPointIndex=0,this.boxMap={},this.curBoxMapIdex=0,this.workMap={},this.isVirtualOpen=!1,this.iOpenState=!1,this.delayFunc=null,this.delayTimer=null,this.isSameCR=!1,this.isStartFlag=!0,this.aiObj=e,this.aiObj.aiRobot=!0,this.initRow=i,this.initColumn=n,1==o?this.matrix=[[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0]]:2==o&&(this.matrix=[[0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0]]),this.grid=new PF.Grid(n,i,this.matrix),this.op=new PF.Option,this.op.allowDiagonal=!1,this.finder=new PF.AStarFinder(this.op);for(var s=0,a=0;i>a;a++)for(var l=0;n>l;l++){if(t[s]>0&&t[s]<100){this.grid.setWalkableAt(l,a,!1);var r=ConstValue.P_CONFIG.MapBase[t[s].toString()].Type;if(3==r){var h=Math.abs(this.aiObj.getColumn()-l);null==this.boxMap[h.toString()]&&(this.boxMap[h.toString()]={}),this.boxMap[h.toString()][l+"_"+a]=[l,a]}}s++}for(var a=0;i>a;a++)for(var l=0;n>l;l++){var u=this.getPath(l,a);u.length>0&&(this.workMap[l+"_"+a]=[l,a])}}return e.prototype.beNotifyHasFood=function(e,t){CommonTools.logAI("----------------***卧槽有东西吃了,看下能到达吗 "+e+"_"+t);var i=this.getPath(e,t);i.length>0?(CommonTools.logAI("----------------***就在眼前，去吃"),this.isVirtualOpen=!1,this.iCmd=3,this.removeDelay(),this.resetMove(i),CommonTools.logAI("move------55555555555555555555555555555555"),this.moveNext()):CommonTools.logAI("----------------***蛋疼无路可以过去吃")},e.prototype.moveNext=function(){if(this.iOpenState){if(this.isConnectEnemy())if(CommonTools.logAI("----------------***发现敌人"),this.isHasBoom()){CommonTools.logAI("----------------***发现有炸弹"),CommonTools.logAI("----------------***赶紧逃跑"),this.iCmd=1;var e=this.getSafePath(),t=this.getPath(e[0],e[1]);this.resetMove(t)}else{var i=this.getPath(this.getOtherPlayer().getColumn(),this.getOtherPlayer().getRow());i.length>0&&(CommonTools.logAI("----------------***杀啊。。。"),this.iCmd=2,this.resetMove(i))}else if(CommonTools.logAI("----------------***没有发现敌人"),this.isHasBoom()){if(!this.isSameCR){CommonTools.logAI("----------------***发现有炸弹"),CommonTools.logAI("----------------***赶紧逃跑");var e=this.getSafePath();CommonTools.logAI("----------------***safePath:"+e);var t=this.getPath(e[0],e[1]);t.length>0&&(this.iCmd=1,this.resetMove(t))}}else{CommonTools.logAI("----------------***不危险，找箱子"),this.isSameCR=!1;var n=this.getNextBox();if(1==this.iCmd&&(this.iCmd=0),null!=n&&0==this.iCmd){this.grid.setWalkableAt(n[0],n[1],!0),this.isVirtualOpen=!0;var o=this.getPath(n[0],n[1]);this.grid.setWalkableAt(n[0],n[1],!1),o.length>0&&(CommonTools.logAI("----------------***找箱子"),this.iCmd=2,this.resetMove(o))}}if(0==this.iCmd)return CommonTools.logAI("----------------***没有命令，主人"),CommonTools.logAI("move------6666666666666666666666666666666666"),void this.moveNext();this.curPathPointIndex++,CommonTools.logAI("this.iCmd------------aaaaaaaaaaaa----------"+this.iCmd+" this.curPathPointIndex:"+this.curPathPointIndex+" this.curPath:"+this.curPath);var s=this.curPath.length;if(this.isVirtualOpen&&(s=this.curPath.length-1),this.curPathPointIndex>=s)if(this.curPathPointIndex=0,this.isVirtualOpen){this.isVirtualOpen=!1,CommonTools.logAI("----------------***找到箱子了，要放炮了");var a=CommonTools.getDataJsonStr("syncPut",1,{x:this.aiObj.x,y:this.aiObj.y,idx:parseInt(this.aiObj.curMapIdx),playerID:this.aiObj.roleId});ConstValue.P_NET_OBJ.sendData2(a)}else if(CommonTools.logAI("----------------***到达终点，找下一件事情做"),1==this.iCmd)CommonTools.logAI("----------------***逃生中，躲3秒"),this.isConnectEnemy()?(this.removeDelay(),this.delayFunc=function(){CommonTools.logAI("move------7777777777777777777777777777777777"),1==this.iCmd&&(CommonTools.log("move------7777777777777777777777777777777777"),this.moveNext())},this.Delay(10)):(this.removeDelay(),this.delayFunc=function(){CommonTools.logAI("move------7777777777777777777777777777777777"),1==this.iCmd&&this.moveNext()},this.Delay(3800));else if(3==this.iCmd)CommonTools.logAI("----------------***吃了东西了"),this.iCmd=0,CommonTools.logAI("move------8888888888888888888888888888888888888888"),this.moveNext();else if(2==this.iCmd){CommonTools.logAI("----------------***炸死个扑街");var a=CommonTools.getDataJsonStr("syncPut",1,{x:this.aiObj.x,y:this.aiObj.y,idx:parseInt(this.aiObj.curMapIdx),playerID:this.aiObj.roleId});ConstValue.P_NET_OBJ.sendData2(a)}else CommonTools.logAI("move------999999999999999999999999999999999999"),this.moveNext();else{if(1==this.iCmd&&this.curPathPointIndex>=4&&this.isConnectEnemy()){CommonTools.logAI("----------------***逃跑也放雷");var a=CommonTools.getDataJsonStr("syncPut",1,{x:this.aiObj.x,y:this.aiObj.y,idx:parseInt(this.aiObj.curMapIdx),playerID:this.aiObj.roleId});ConstValue.P_NET_OBJ.sendData2(a)}this.move(this.curPath[this.curPathPointIndex][0],this.curPath[this.curPathPointIndex][1])}}},e.prototype.resetMove=function(e){this.curPathPointIndex=0,this.curPath=e},e.prototype.openBlock=function(e,t){this.setWalkAble(e,t,!0);var i=e+"_"+t;this.workMap[i]=[e,t],CommonTools.printMap(this.workMap);var n="";for(var o in this.boxMap){var s=this.boxMap[o];for(var a in s){var l=s[a];if(l[0]==e&&l[1]==t){n=o;break}}if(""!=n)break}""!=n&&(this.boxMap[n][e+"_"+t]=null,delete this.boxMap[n][e+"_"+t]);for(var o=0;o<this.initRow;o++)for(var a=0;a<this.initColumn;a++){var r=this.getPath(a,o);r.length>0&&null==this.workMap[a+"_"+o]&&(this.workMap[a+"_"+o]=[a,o])}},e.prototype.Delay=function(e){this.delayTimer=new egret.Timer(e,1),this.delayTimer.addEventListener(egret.TimerEvent.TIMER,this.delayFunc,this),this.delayTimer.start()},e.prototype.removeDelay=function(){null!=this.delayTimer&&(this.delayTimer.stop(),this.delayTimer.removeEventListener(egret.TimerEvent.TIMER,this.delayFunc,this),this.delayTimer=null,this.delayFunc=null)},e.prototype.getNextBox=function(){var e=this.boxMap[this.curBoxMapIdex.toString()],t=0;for(var i in e)t++;for(;0==t;){if(this.curBoxMapIdex++,this.curBoxMapIdex>=this.initColumn)return null;e=this.boxMap[this.curBoxMapIdex.toString()];for(var i in e)t++}for(var i in e)if(CommonTools.logAI("getNextBox************************tBox[i]:"+e[i]),29!=FightingModule.curBarrNo&&30!=FightingModule.curBarrNo||9!=e[i][0]||0!=e[i][1]){this.grid.setWalkableAt(e[i][0],e[i][1],!0);var n=this.getPath(e[i][0],e[i][1]);if(this.grid.setWalkableAt(e[i][0],e[i][1],!1),n.length>0){if(!this.isStartFlag)return e[i];this.isStartFlag=!1}}return CommonTools.logAI("getNextBox************xxxxxx***no box*********"),this.curBoxMapIdex++,this.getNextBox()},e.prototype.isHasBoom=function(){if(this.isConnectEnemy())for(var e in FightingModule.bulletLayerSubObj)return!0;else for(var e in FightingModule.bulletLayerSubObj){var t=FightingModule.bulletLayerSubObj[e];if(t.owner.roleId==this.aiObj.roleId)return!0}return!1},e.prototype.getSafePath=function(){var e=null,t=100;if(CommonTools.printMap(this.workMap),this.isConnectEnemy())for(var i in this.workMap){var n=this.workMap[i],o=!0;
for(var s in FightingModule.bulletLayerSubObj){var a=FightingModule.bulletLayerSubObj[s];if(a.getColumn()==n[0]||a.getRow()==n[1]){o=!1;break}}if(o){var l=this.getPath(n[0],n[1]);l.length>0&&l.length<t&&(t=l.length,e=n)}}else for(var i in this.workMap){var n=this.workMap[i],o=!0;for(var s in FightingModule.bulletLayerSubObj){var a=FightingModule.bulletLayerSubObj[s];if(a.owner.roleId==this.aiObj.roleId&&(a.getColumn()==n[0]||a.getRow()==n[1])){o=!1;break}}if(o){var l=this.getPath(n[0],n[1]);l.length>0&&l.length<t&&(t=l.length,e=n,CommonTools.logAI("getSafePath----miniLenChoose-----------------"+e))}}if(null!=e)return e;this.isSameCR=!0,t=0;for(var i in this.workMap){var n=this.workMap[i],l=this.getPath(n[0],n[1]);l.length>t&&(t=l.length,e=n,CommonTools.logAI("getSafePath--22--miniLenChoose-----------------"+e))}return null!=e?e:null},e.prototype.getPath=function(e,t){var i=this.grid.clone();return this.finder.findPath(this.aiObj.getColumn(),this.aiObj.getRow(),e,t,i)},e.prototype.startAI=function(){this.iOpenState=!0,this.isConnectEnemy()?this.moveNext():(CommonTools.logAI("----------------***开局"),this.moveNext())},e.prototype.stopAI=function(){this.iOpenState=!1},e.prototype.isConnectEnemy=function(){var e=this.getPath(this.getOtherPlayer().getColumn(),this.getOtherPlayer().getRow());return 0==e.length?!1:!0},e.prototype.setWalkAble=function(e,t,i){this.grid.setWalkableAt(e,t,i)},e.prototype.getOtherPlayer=function(){for(var e in FightingModule.playerLayerSubObj){var t=FightingModule.playerLayerSubObj[e];if(t.roleId!=this.aiObj.roleId&&0==t.isAI)return t}return null},e.prototype.move=function(e,t){var i=this.aiObj;null==this.aiObj.func&&(this.aiObj.func=function(e){i.setMoving(!0),i.move(-1,!0)},this.aiObj.addEventListener(egret.Event.ENTER_FRAME,this.aiObj.func,this.aiObj)),this.aiObj.setMoving(!0),this.aiObj.moveDetail(e,t)},e.prototype.clear=function(){this.aiObj=null,this.grid=null,this.op=null,this.finder=null,this.matrix=null,this.curPath=null,this.boxMap={},this.workMap={},this.removeDelay()},e}();__reflect(AIUtil2.prototype,"AIUtil2");var AIUtil3=function(){function e(e,t,i,n,o){this.aiObj=null,this.iCmd=0,this.curPathPointIndex=0,this.boxMap={},this.curBoxMapIdex=0,this.workMap={},this.isVirtualOpen=!1,this.iOpenState=!1,this.delayFunc=null,this.delayTimer=null,this.isSameCR=!1,this.aiObj=e,this.aiObj.aiRobot=!0,this.initRow=i,this.initColumn=n,1==o?this.matrix=[[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0]]:2==o&&(this.matrix=[[0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0]]),this.grid=new PF.Grid(n,i,this.matrix),this.op=new PF.Option,this.op.allowDiagonal=!1,this.finder=new PF.AStarFinder(this.op);for(var s=0,a=0;i>a;a++)for(var l=0;n>l;l++){if(t[s]>0&&t[s]<100){this.grid.setWalkableAt(l,a,!1);var r=ConstValue.P_CONFIG.MapBase[t[s].toString()].Type;if(3==r){var h=Math.abs(this.aiObj.getColumn()-l);null==this.boxMap[h.toString()]&&(this.boxMap[h.toString()]={}),this.boxMap[h.toString()][l+"_"+a]=[l,a]}}s++}for(var a=0;i>a;a++)for(var l=0;n>l;l++){var u=this.getPath(l,a);u.length>0&&(this.workMap[l+"_"+a]=[l,a])}}return e.prototype.beNotifyHasFood=function(e,t){CommonTools.logAI("----------------***卧槽有东西吃了,看下能到达吗 "+e+"_"+t);var i=this.getPath(e,t);i.length>0?(CommonTools.logAI("----------------***就在眼前，去吃"),this.isVirtualOpen=!1,this.iCmd=3,this.removeDelay(),this.resetMove(i),CommonTools.logAI("move------55555555555555555555555555555555"),this.moveNext()):CommonTools.logAI("----------------***蛋疼无路可以过去吃")},e.prototype.moveNext=function(){if(this.iOpenState){if(this.isConnectEnemy())if(CommonTools.logAI("----------------***发现敌人"),this.isHasBoom()){CommonTools.logAI("----------------***发现有炸弹"),CommonTools.logAI("----------------***赶紧逃跑"),this.iCmd=1;var e=this.getSafePath(),t=this.getPath(e[0],e[1]);this.resetMove(t)}else{var i=this.getPath(this.getOtherPlayer().getColumn(),this.getOtherPlayer().getRow());i.length>0&&(CommonTools.logAI("----------------***杀啊。。。"),this.iCmd=2,this.resetMove(i))}else if(CommonTools.logAI("----------------***没有发现敌人"),this.isHasBoom()){if(!this.isSameCR){CommonTools.logAI("----------------***发现有炸弹"),CommonTools.logAI("----------------***赶紧逃跑");var e=this.getSafePath();CommonTools.logAI("----------------***safePath:"+e);var t=this.getPath(e[0],e[1]);t.length>0&&(this.iCmd=1,this.resetMove(t))}}else{CommonTools.logAI("----------------***不危险，找箱子"),this.isSameCR=!1;var n=this.getNextBox();if(1==this.iCmd&&(this.iCmd=0),null!=n&&0==this.iCmd){this.grid.setWalkableAt(n[0],n[1],!0),this.isVirtualOpen=!0;var o=this.getPath(n[0],n[1]);this.grid.setWalkableAt(n[0],n[1],!1),o.length>0&&(CommonTools.logAI("----------------***找箱子"),this.iCmd=2,this.resetMove(o))}}if(0==this.iCmd)return CommonTools.logAI("----------------***没有命令，主人"),CommonTools.logAI("move------6666666666666666666666666666666666"),void this.moveNext();this.curPathPointIndex++,CommonTools.logAI("this.iCmd------------aaaaaaaaaaaa----------"+this.iCmd+" this.curPathPointIndex:"+this.curPathPointIndex+" this.curPath:"+this.curPath);var s=this.curPath.length;if(this.isVirtualOpen&&(s=this.curPath.length-1),this.curPathPointIndex>=s)if(this.curPathPointIndex=0,this.isVirtualOpen){this.isVirtualOpen=!1,CommonTools.logAI("----------------***找到箱子了，要放炮了");var a=CommonTools.getDataJsonStr("syncPut",1,{x:this.aiObj.x,y:this.aiObj.y,idx:parseInt(this.aiObj.curMapIdx),playerID:this.aiObj.roleId});ConstValue.P_NET_OBJ.sendData2(a)}else if(CommonTools.logAI("----------------***到达终点，找下一件事情做"),1==this.iCmd)CommonTools.logAI("----------------***逃生中，躲3秒"),this.isConnectEnemy()?(this.removeDelay(),this.delayFunc=function(){CommonTools.logAI("move------7777777777777777777777777777777777"),1==this.iCmd&&(CommonTools.log("move------7777777777777777777777777777777777"),this.moveNext())},this.Delay(10)):(this.removeDelay(),this.delayFunc=function(){CommonTools.logAI("move------7777777777777777777777777777777777"),1==this.iCmd&&this.moveNext()},this.Delay(3800));else if(3==this.iCmd)CommonTools.logAI("----------------***吃了东西了"),this.iCmd=0,CommonTools.logAI("move------8888888888888888888888888888888888888888"),this.moveNext();else if(2==this.iCmd){CommonTools.logAI("----------------***炸死个扑街");var a=CommonTools.getDataJsonStr("syncPut",1,{x:this.aiObj.x,y:this.aiObj.y,idx:parseInt(this.aiObj.curMapIdx),playerID:this.aiObj.roleId});ConstValue.P_NET_OBJ.sendData2(a)}else CommonTools.logAI("move------999999999999999999999999999999999999"),this.moveNext();else{if(1==this.iCmd&&this.curPathPointIndex>=4&&this.isConnectEnemy()){CommonTools.logAI("----------------***逃跑也放雷");var a=CommonTools.getDataJsonStr("syncPut",1,{x:this.aiObj.x,y:this.aiObj.y,idx:parseInt(this.aiObj.curMapIdx),playerID:this.aiObj.roleId});ConstValue.P_NET_OBJ.sendData2(a)}this.move(this.curPath[this.curPathPointIndex][0],this.curPath[this.curPathPointIndex][1])}}},e.prototype.resetMove=function(e){this.curPathPointIndex=0,this.curPath=e},e.prototype.openBlock=function(e,t){this.setWalkAble(e,t,!0);var i=e+"_"+t;this.workMap[i]=[e,t],CommonTools.printMap(this.workMap);var n="";for(var o in this.boxMap){var s=this.boxMap[o];for(var a in s){var l=s[a];if(l[0]==e&&l[1]==t){n=o;break}}if(""!=n)break}""!=n&&(this.boxMap[n][e+"_"+t]=null,delete this.boxMap[n][e+"_"+t]);for(var o=0;o<this.initRow;o++)for(var a=0;a<this.initColumn;a++){var r=this.getPath(a,o);r.length>0&&null==this.workMap[a+"_"+o]&&(this.workMap[a+"_"+o]=[a,o])}},e.prototype.Delay=function(e){this.delayTimer=new egret.Timer(e,1),this.delayTimer.addEventListener(egret.TimerEvent.TIMER,this.delayFunc,this),this.delayTimer.start()},e.prototype.removeDelay=function(){null!=this.delayTimer&&(this.delayTimer.stop(),this.delayTimer.removeEventListener(egret.TimerEvent.TIMER,this.delayFunc,this),this.delayTimer=null,this.delayFunc=null)},e.prototype.getNextBox=function(){var e=this.boxMap[this.curBoxMapIdex.toString()],t=0;for(var i in e)t++;for(;0==t;){if(this.curBoxMapIdex++,this.curBoxMapIdex>=this.initColumn)return null;e=this.boxMap[this.curBoxMapIdex.toString()];for(var i in e)t++}for(var i in e)if(CommonTools.logAI("getNextBox************************tBox[i]:"+e[i]),29!=FightingModule.curBarrNo&&30!=FightingModule.curBarrNo||9!=e[i][0]||0!=e[i][1]){this.grid.setWalkableAt(e[i][0],e[i][1],!0);var n=this.getPath(e[i][0],e[i][1]);if(this.grid.setWalkableAt(e[i][0],e[i][1],!1),n.length>0)return e[i]}return CommonTools.logAI("getNextBox************xxxxxx***no box*********"),this.curBoxMapIdex++,this.getNextBox()},e.prototype.isHasBoom=function(){if(this.isConnectEnemy())for(var e in FightingModule.bulletLayerSubObj)return!0;else for(var e in FightingModule.bulletLayerSubObj){var t=FightingModule.bulletLayerSubObj[e];if(t.owner.roleId==this.aiObj.roleId)return!0}return!1},e.prototype.getSafePath=function(){var e=null,t=100;if(CommonTools.printMap(this.workMap),this.isConnectEnemy())for(var i in this.workMap){var n=this.workMap[i],o=!0;for(var s in FightingModule.bulletLayerSubObj){var a=FightingModule.bulletLayerSubObj[s];if(a.getColumn()==n[0]||a.getRow()==n[1]){o=!1;break}}if(o){var l=this.getPath(n[0],n[1]);l.length>0&&l.length<t&&(t=l.length,e=n)}}else for(var i in this.workMap){var n=this.workMap[i],o=!0;for(var s in FightingModule.bulletLayerSubObj){var a=FightingModule.bulletLayerSubObj[s];if(a.owner.roleId==this.aiObj.roleId&&(a.getColumn()==n[0]||a.getRow()==n[1])){o=!1;break}}if(o){var l=this.getPath(n[0],n[1]);l.length>0&&l.length<t&&(t=l.length,e=n,CommonTools.logAI("getSafePath----miniLenChoose-----------------"+e))}}if(null!=e)return e;this.isSameCR=!0,t=0;for(var i in this.workMap){var n=this.workMap[i],l=this.getPath(n[0],n[1]);l.length>t&&(t=l.length,e=n,CommonTools.logAI("getSafePath--22--miniLenChoose-----------------"+e))}return null!=e?e:null},e.prototype.getPath=function(e,t){var i=this.grid.clone();return this.finder.findPath(this.aiObj.getColumn(),this.aiObj.getRow(),e,t,i)},e.prototype.startAI=function(){this.iOpenState=!0,this.isConnectEnemy()?this.moveNext():(CommonTools.logAI("----------------***开局"),this.moveNext())},e.prototype.stopAI=function(){this.iOpenState=!1},e.prototype.isConnectEnemy=function(){var e=this.getPath(this.getOtherPlayer().getColumn(),this.getOtherPlayer().getRow());return 0==e.length?!1:!0},e.prototype.setWalkAble=function(e,t,i){this.grid.setWalkableAt(e,t,i)},e.prototype.getOtherPlayer=function(){for(var e in FightingModule.playerLayerSubObj){var t=FightingModule.playerLayerSubObj[e];if(t.roleId!=this.aiObj.roleId&&0==t.isAI)return t}return null},e.prototype.move=function(e,t){var i=this.aiObj;null==this.aiObj.func&&(this.aiObj.func=function(e){i.setMoving(!0),i.move(-1,!0)},this.aiObj.addEventListener(egret.Event.ENTER_FRAME,this.aiObj.func,this.aiObj)),this.aiObj.setMoving(!0),this.aiObj.moveDetail(e,t)},e.prototype.clear=function(){this.aiObj=null,this.grid=null,this.op=null,this.finder=null,this.matrix=null,this.curPath=null,this.boxMap={},this.workMap={},this.removeDelay()},e}();__reflect(AIUtil3.prototype,"AIUtil3");var Fight;!function(e){var t=function(e){function t(t){var i=e.call(this)||this;return i.whichSide=0,i.sideDes="",i.owner=null,i.effDic={},i.curLen=1,i.nextDic={},i.leftShowLimit=100,i.rightShowLimit=100,i.upShowLimit=100,i.downShowLimit=100,i.leftShowLimit2=100,i.rightShowLimit2=100,i.upShowLimit2=100,i.downShowLimit2=100,i.preBobo=null,i.bulletLen=1,i.hitMap={},i.whichSide=t.side,2==t.PPSkinID?i.sideDes="paopao_ice":3==t.PPSkinID?i.sideDes="paopao_mars":4==t.PPSkinID?i.sideDes="paopao_doughnut":5==t.PPSkinID?i.sideDes="paopao_watermelon":6==t.PPSkinID?i.sideDes="paopao_volleyball":i.sideDes="paopao",i.bodyAni=CommonTools.getAnimDraw(RES.getRes(i.sideDes+"_json"),RES.getRes(i.sideDes+"_png"),"0"),1==ConstValue.P_FIGHT_OBJ.APP_MODE?(i.bodyAni.scaleX=1.4,i.bodyAni.scaleY=1.4,i.bodyAni.x+=2,i.bodyAni.y-=5):(i.scaleX=.7,i.scaleY=.7,i.bodyAni.scaleX=1.6,i.bodyAni.scaleY=1.6,i.bodyAni.x-=12,i.bodyAni.y-=15),i.addChild(i.bodyAni),i.x=t.x,i.y=t.y,i.name=t.name,i.curIdx=t.curIdx,i.bodyAni.play(-1),i}return __extends(t,e),t.prototype.setOwner=function(e){this.owner=e,this.bulletLen=this.owner.bulletLen},t.prototype.baozha=function(){FightingModule.Delay(3e3,function(){this.drawBaozha();for(var e in this.hitMap){var t=this.hitMap[e],i=0;if(1==this.owner.isAI&&(i=this.owner.roleId),this.owner.isMainPlayer||1==this.owner.isAI){var n=CommonTools.getDataJsonStr("syncBoomZhuan",1,{paopaoID:this.name,x:this.x,y:this.y,idx:this.curIdx,breakidx:t.getCurIdx(),playerID:i});ConstValue.P_NET_OBJ.sendData2(n)}}for(var e in FightingModule.bulletLayerSubObj){var t=FightingModule.bulletLayerSubObj[e],o=t.getPreBobo();if(null!=o)for(var s in o)s==this.name&&t.beBaozha()}},this)},t.prototype.beBaozha=function(){this.drawBaozha();for(var e in this.hitMap){var t=this.hitMap[e],i=0;if(1==this.owner.isAI&&(i=this.owner.roleId),this.owner.isMainPlayer||1==this.owner.isAI){var n=CommonTools.getDataJsonStr("syncBoomZhuan",1,{paopaoID:this.name,x:this.x,y:this.y,idx:this.curIdx,breakidx:t.getCurIdx(),playerID:i});ConstValue.P_NET_OBJ.sendData2(n)}}},t.prototype.setLeftLimit=function(e){this.leftShowLimit=e},t.prototype.setRightLimit=function(e){this.rightShowLimit=e},t.prototype.setDownLimit=function(e){this.downShowLimit=e},t.prototype.setUpLimit=function(e){this.upShowLimit=e},t.prototype.getLeftLimit=function(){return this.leftShowLimit},t.prototype.getRightLimit=function(){return this.rightShowLimit},t.prototype.getDownLimit=function(){return this.downShowLimit},t.prototype.getUpLimit=function(){return this.upShowLimit},t.prototype.setLeftLimit2=function(e){this.leftShowLimit2=e},t.prototype.setRightLimit2=function(e){this.rightShowLimit2=e},t.prototype.setDownLimit2=function(e){this.downShowLimit2=e},t.prototype.setUpLimit2=function(e){this.upShowLimit2=e},t.prototype.getLeftLimit2=function(){return this.leftShowLimit2},t.prototype.getRightLimit2=function(){return this.rightShowLimit2},t.prototype.getDownLimit2=function(){return this.downShowLimit2},t.prototype.getUpLimit2=function(){return this.upShowLimit2},t.prototype.getCurIdx=function(){return this.curIdx},t.prototype.checkHit=function(e,t,i){try{var n=0;1==this.owner.isAI&&(n=this.owner.roleId);for(var o in FightingModule.playerLayerSubObj){var s=FightingModule.playerLayerSubObj[o];if("zhong"==t){if(FightingModule.groundLayerSubObjDanger[this.column+"_"+this.row].dangerCount++,FightingModule.groundLayerSubObjDanger[this.column+"_"+this.row].dangerPaoPaoObj=this,s.getRow()==this.row&&s.getColumn()==this.column){var a=CommonTools.getDataJsonStr("syncBoomPlayer",1,{paopaoID:this.name,x:this.x,y:this.y,idx:this.curIdx,killrid:s.roleId,killidx:parseInt(s.curMapIdx),playerID:n});return ConstValue.P_NET_OBJ.sendData2(a),!0}}else if("up"==t){if(this.bulletLen!=this.curLen&&(FightingModule.groundLayerSubObjDanger[this.column+"_"+(this.row-i)].dangerCount++,FightingModule.groundLayerSubObjDanger[this.column+"_"+(this.row-i)].dangerPaoPaoObj=this),s.getColumn()==this.column&&this.row-i==s.getRow()){var a=CommonTools.getDataJsonStr("syncBoomPlayer",1,{paopaoID:this.name,x:this.x,y:this.y,idx:this.curIdx,killrid:s.roleId,killidx:parseInt(s.curMapIdx),playerID:n});return ConstValue.P_NET_OBJ.sendData2(a),!0}}else if("down"==t){if(this.bulletLen!=this.curLen&&(FightingModule.groundLayerSubObjDanger[this.column+"_"+(this.row+i)].dangerCount++,FightingModule.groundLayerSubObjDanger[this.column+"_"+(this.row+i)].dangerPaoPaoObj=this),s.getColumn()==this.column&&this.row+i==s.getRow()){var a=CommonTools.getDataJsonStr("syncBoomPlayer",1,{paopaoID:this.name,x:this.x,y:this.y,idx:this.curIdx,killrid:s.roleId,killidx:parseInt(s.curMapIdx),playerID:n});return ConstValue.P_NET_OBJ.sendData2(a),!0}}else if("left"==t){if(this.bulletLen!=this.curLen&&(FightingModule.groundLayerSubObjDanger[this.column-i+"_"+this.row].dangerCount++,FightingModule.groundLayerSubObjDanger[this.column-i+"_"+this.row].dangerPaoPaoObj=this),s.getRow()==this.row&&this.column-i==s.getColumn()){var a=CommonTools.getDataJsonStr("syncBoomPlayer",1,{paopaoID:this.name,x:this.x,y:this.y,idx:this.curIdx,killrid:s.roleId,killidx:parseInt(s.curMapIdx),playerID:n});return ConstValue.P_NET_OBJ.sendData2(a),!0}}else if("right"==t&&(this.bulletLen!=this.curLen&&(FightingModule.groundLayerSubObjDanger[this.column+i+"_"+this.row].dangerCount++,FightingModule.groundLayerSubObjDanger[this.column+i+"_"+this.row].dangerPaoPaoObj=this),s.getRow()==this.row&&this.column+i==s.getColumn())){var a=CommonTools.getDataJsonStr("syncBoomPlayer",1,{paopaoID:this.name,x:this.x,y:this.y,idx:this.curIdx,killrid:s.roleId,killidx:parseInt(s.curMapIdx),playerID:n});return ConstValue.P_NET_OBJ.sendData2(a),!0}}}catch(l){CommonTools.logError("checkHit==================error "+l)}return!1},t.prototype.markLimit=function(){for(var e in FightingModule.mapLayerSubObj){var t=FightingModule.mapLayerSubObj[e.toString()];if(1!=t.getType()){if(t.getRow()==this.getRow()){if(t.getColumn()<this.getColumn()){var i=this.getColumn()-t.getColumn();this.bulletLen>=i&&this.getLeftLimit()>i&&(this.setLeftLimit(i),this.hitMap.leftHitMap=t)}if(t.getColumn()>this.getColumn()){var n=t.getColumn()-this.getColumn();this.bulletLen>=n&&this.getRightLimit()>n&&(this.setRightLimit(n),this.hitMap.rightHitMap=t)}}if(t.getColumn()==this.getColumn()){if(t.getRow()<this.getRow()){var o=this.getRow()-t.getRow();this.bulletLen>=o&&this.getUpLimit()>o&&(this.setUpLimit(o),this.hitMap.upHitMap=t)}if(t.getRow()>this.getRow()){var s=t.getRow()-this.getRow();if(this.bulletLen>=s&&this.getDownLimit()>s&&(this.setDownLimit(s),this.hitMap.downHitMap=t),1==s){var a=FightingModule.mapLayer.getChildIndex(t);FightingModule.mapLayer.getChildIndex(this)>FightingModule.mapLayer.getChildIndex(t)&&FightingModule.mapLayer.setChildIndex(this,a)}}}}}var l=this.getColumn()+1;this.bulletLen>=l&&this.getLeftLimit()>l&&this.setLeftLimit(l);var r=ConstValue.P_FIGHT_OBJ.getInitColumn()-this.getColumn();this.bulletLen>=r&&this.getRightLimit()>r&&this.setRightLimit(r);var h=this.getRow()+1;this.bulletLen>=h&&this.getUpLimit()>h&&this.setUpLimit(h);var u=ConstValue.P_FIGHT_OBJ.getInitRow()-this.getRow();this.bulletLen>=u&&this.getDownLimit()>u&&this.setDownLimit(u)},t.prototype.drawBaozha=function(){try{CommonAudioHandle.playEffect("boom_mp3",1);for(var e in FightingModule.aiSubObj){var t=FightingModule.aiSubObj[e];t.setWalkAble(this.column,this.row,!0)}this.removeChild(this.bodyAni),this.bodyAni=null,this.markLimit(),1==this.bulletLen?(this.effDic.zhong_1=CommonTools.getAnimDraw(RES.getRes("baozha_zhong_anim_json"),RES.getRes("baozha_zhong_anim_png"),"0"),this.addChild(this.effDic.zhong_1),this.effDic.zhong_1.play(-1),this.checkHit(this.effDic.zhong_1,"zhong",this.curLen),this.effDic.up_1=CommonTools.getAnimDraw(RES.getRes("baozha_last_anim_json"),RES.getRes("baozha_last_anim_png"),"0"),this.addChild(this.effDic.up_1),this.effDic.up_1.play(1),this.curLen>=this.upShowLimit&&(this.effDic.up_1.visible=!1),this.effDic.up_1.visible&&this.checkHit(this.effDic.up_1,"up",this.curLen),this.effDic.down_1=CommonTools.getAnimDraw(RES.getRes("baozha_last_anim_json"),RES.getRes("baozha_last_anim_png"),"0"),this.addChild(this.effDic.down_1),this.effDic.down_1.play(1),this.effDic.down_1.scaleY="-1",this.curLen>=this.downShowLimit&&(this.effDic.down_1.visible=!1),this.effDic.down_1.visible&&this.checkHit(this.effDic.down_1,"down",this.curLen),this.effDic.right_1=CommonTools.getAnimDraw(RES.getRes("baozha_last_anim_json"),RES.getRes("baozha_last_anim_png"),"0"),this.addChild(this.effDic.right_1),this.effDic.right_1.play(1),this.effDic.right_1.rotation=90,this.curLen>=this.rightShowLimit&&(this.effDic.right_1.visible=!1),this.effDic.right_1.visible&&this.checkHit(this.effDic.right_1,"right",this.curLen),this.effDic.left_1=CommonTools.getAnimDraw(RES.getRes("baozha_last_anim_json"),RES.getRes("baozha_last_anim_png"),"0"),this.addChild(this.effDic.left_1),this.effDic.left_1.play(1),this.effDic.left_1.rotation=-90,this.curLen>=this.leftShowLimit&&(this.effDic.left_1.visible=!1),this.effDic.left_1.visible&&this.checkHit(this.effDic.left_1,"left",this.curLen),1==ConstValue.P_FIGHT_OBJ.APP_MODE?(this.effDic.zhong_1.y+=28,this.effDic.up_1.y-=55,this.effDic.left_1.x-=70,this.effDic.left_1.y+=15,this.effDic.right_1.x+=70,this.effDic.right_1.y+=15,this.effDic.down_1.y+=82):(this.effDic.zhong_1.x-=12,this.effDic.zhong_1.y+=10,this.effDic.up_1.x-=10,this.effDic.up_1.y-=45,this.effDic.left_1.x-=70,this.effDic.left_1.y+=0,this.effDic.right_1.x+=58,this.effDic.right_1.y+=0,this.effDic.down_1.x-=13,this.effDic.down_1.y+=68),this.effDic.up_1.once(egret.Event.COMPLETE,function(e){this.effDic.up_1.visible&&(FightingModule.groundLayerSubObjDanger[this.column+"_"+(this.row-1)].dangerCount=0),this.removeChild(this.effDic.up_1),this.effDic.up_1=null,delete this.effDic.up_1},this),this.effDic.down_1.once(egret.Event.COMPLETE,function(e){this.effDic.down_1.visible&&(FightingModule.groundLayerSubObjDanger[this.column+"_"+(this.row+1)].dangerCount=0),this.removeChild(this.effDic.down_1),this.effDic.down_1=null,delete this.effDic.down_1},this),this.effDic.right_1.once(egret.Event.COMPLETE,function(e){this.effDic.right_1.visible&&(FightingModule.groundLayerSubObjDanger[this.column+1+"_"+this.row].dangerCount=0),this.removeChild(this.effDic.right_1),this.effDic.right_1=null,delete this.effDic.right_1},this),this.effDic.left_1.once(egret.Event.COMPLETE,function(e){this.effDic.left_1.visible&&(FightingModule.groundLayerSubObjDanger[this.column-1+"_"+this.row].dangerCount=0),this.removeChild(this.effDic.left_1),this.effDic.left_1=null,delete this.effDic.left_1,this.effDic.zhong_1.visible&&(FightingModule.groundLayerSubObjDanger[this.column+"_"+this.row].dangerCount=0),this.removeChild(this.effDic.zhong_1),this.effDic.zhong_1=null,delete this.effDic.zhong_1,null!=FightingModule.bulletLayerSubObj[this.name]&&(FightingModule.mapLayer.removeChild(this),FightingModule.bulletLayerSubObj[this.name]=null,delete FightingModule.bulletLayerSubObj[this.name])},this)):(this.effDic["zhong_"+this.bulletLen]=CommonTools.getAnimDraw(RES.getRes("baozha_zhong_anim_json"),RES.getRes("baozha_zhong_anim_png"),"0"),this.addChild(this.effDic["zhong_"+this.bulletLen]),this.effDic["zhong_"+this.bulletLen].play(-1),1==ConstValue.P_FIGHT_OBJ.APP_MODE?this.effDic["zhong_"+this.bulletLen].y+=22:(this.effDic["zhong_"+this.bulletLen].x-=15,this.effDic["zhong_"+this.bulletLen].y+=6),this.checkHit(this.effDic["zhong_"+this.bulletLen],"zhong",this.curLen),this.addNext(this.effDic["zhong_"+this.bulletLen].x,this.effDic["zhong_"+this.bulletLen].y))}catch(i){CommonTools.logError("drawBaozha==================error "+i)}},t.prototype.addNext=function(e,t){FightingModule.Delay(20,function(){try{this.nextDic["up_"+this.curLen]=new eui.Image(RES.getRes("baozha_jie_png")),this.addChild(this.nextDic["up_"+this.curLen]),this.nextDic["up_"+this.curLen].x=e-47,this.nextDic["up_"+this.curLen].y=t-180-80*(this.curLen-1),this.curLen>=this.upShowLimit&&(this.nextDic["up_"+this.curLen].visible=!1),this.nextDic["up_"+this.curLen].visible&&this.checkHit(this.nextDic["up_"+this.curLen],"up",this.curLen),this.nextDic["down_"+this.curLen]=new eui.Image(RES.getRes("baozha_jie_png")),this.addChild(this.nextDic["down_"+this.curLen]),this.nextDic["down_"+this.curLen].y=t+160+80*(this.curLen-1),this.nextDic["down_"+this.curLen].scaleY="-1",this.curLen>=this.downShowLimit&&(this.nextDic["down_"+this.curLen].visible=!1),this.nextDic["down_"+this.curLen].visible&&this.checkHit(this.nextDic["down_"+this.curLen],"down",this.curLen),1==ConstValue.P_FIGHT_OBJ.APP_MODE?this.nextDic["down_"+this.curLen].x=e-47:this.nextDic["down_"+this.curLen].x=e-44,this.nextDic["right_"+this.curLen]=new eui.Image(RES.getRes("baozha_jie_png")),this.addChild(this.nextDic["right_"+this.curLen]),this.nextDic["right_"+this.curLen].x=e+169+80*(this.curLen-1),this.nextDic["right_"+this.curLen].y=t-62,this.nextDic["right_"+this.curLen].rotation=90,this.curLen>=this.rightShowLimit&&(this.nextDic["right_"+this.curLen].visible=!1),this.nextDic["right_"+this.curLen].visible&&this.checkHit(this.nextDic["right_"+this.curLen],"right",this.curLen),this.nextDic["left_"+this.curLen]=new eui.Image(RES.getRes("baozha_jie_png")),this.addChild(this.nextDic["left_"+this.curLen]),this.nextDic["left_"+this.curLen].x=e-169-80*(this.curLen-1),this.nextDic["left_"+this.curLen].y=t-62,this.nextDic["left_"+this.curLen].rotation=90,this.nextDic["left_"+this.curLen].scaleY="-1",this.curLen>=this.leftShowLimit&&(this.nextDic["left_"+this.curLen].visible=!1),this.nextDic["left_"+this.curLen].visible&&this.checkHit(this.nextDic["left_"+this.curLen],"left",this.curLen),this.curLen++,this.bulletLen==this.curLen?(this.baozhaLastEff(this.nextDic["up_"+(this.curLen-1)].x,this.nextDic["up_"+(this.curLen-1)].y,1),this.baozhaLastEff(this.nextDic["down_"+(this.curLen-1)].x,this.nextDic["down_"+(this.curLen-1)].y,2),this.baozhaLastEff(this.nextDic["right_"+(this.curLen-1)].x,this.nextDic["right_"+(this.curLen-1)].y,3),this.baozhaLastEff(this.nextDic["left_"+(this.curLen-1)].x,this.nextDic["left_"+(this.curLen-1)].y,4)):this.addNext(e,t)}catch(i){CommonTools.logError("addNext==================error "+i)}},this)},t.prototype.removePre=function(e){FightingModule.Delay(20,function(){try{0==e?(this.effDic["zhong_"+this.bulletLen].visible&&(FightingModule.groundLayerSubObjDanger[this.column+"_"+this.row].dangerCount=0),this.removeChild(this.effDic["zhong_"+this.bulletLen]),this.effDic["zhong_"+this.bulletLen]=null,delete this.effDic["zhong_"+this.bulletLen],null!=FightingModule.bulletLayerSubObj[this.name]&&(FightingModule.mapLayer.removeChild(this),FightingModule.bulletLayerSubObj[this.name]=null,delete FightingModule.bulletLayerSubObj[this.name])):(this.nextDic["up_"+e].visible&&(FightingModule.groundLayerSubObjDanger[this.column+"_"+(this.row-e)].dangerCount=0),this.removeChild(this.nextDic["up_"+e]),this.nextDic["up_"+e]=null,delete this.nextDic["up_"+e],this.nextDic["down_"+e].visible&&(FightingModule.groundLayerSubObjDanger[this.column+"_"+(this.row+e)].dangerCount=0),this.removeChild(this.nextDic["down_"+e]),this.nextDic["down_"+e]=null,delete this.nextDic["down_"+e],this.nextDic["right_"+e].visible&&(FightingModule.groundLayerSubObjDanger[this.column+e+"_"+this.row].dangerCount=0),this.removeChild(this.nextDic["right_"+e]),this.nextDic["right_"+e]=null,delete this.nextDic["right_"+e],this.nextDic["left_"+e].visible&&(FightingModule.groundLayerSubObjDanger[this.column-e+"_"+this.row].dangerCount=0),this.removeChild(this.nextDic["left_"+e]),this.nextDic["left_"+e]=null,delete this.nextDic["left_"+e],this.removePre(e-1))}catch(t){CommonTools.logError("removePre==================error "+t)}},this)},t.prototype.baozhaLastEff=function(e,t,i){try{1==i?(this.effDic.up_1=CommonTools.getAnimDraw(RES.getRes("baozha_last_anim_json"),RES.getRes("baozha_last_anim_png"),"0"),this.addChild(this.effDic.up_1),this.effDic.up_1.play(1),this.effDic.up_1.x=e+48,this.effDic.up_1.y=t+30,this.effDic.up_1.once(egret.Event.COMPLETE,function(e){this.effDic.up_1.visible&&(FightingModule.groundLayerSubObjDanger[this.column+"_"+(this.row-this.curLen)].dangerCount=0),this.removeChild(this.effDic.up_1),this.effDic.up_1=null,delete this.effDic.up_1},this),this.curLen>=this.upShowLimit&&(this.effDic.up_1.visible=!1),this.effDic.up_1.visible&&this.checkHit(this.nextDic.up_1,"up",this.curLen)):2==i?(this.effDic.down_1=CommonTools.getAnimDraw(RES.getRes("baozha_last_anim_json"),RES.getRes("baozha_last_anim_png"),"0"),this.addChild(this.effDic.down_1),this.effDic.down_1.play(1),this.effDic.down_1.x=e+48,this.effDic.down_1.y=t-30,this.effDic.down_1.scaleY="-1",this.effDic.down_1.once(egret.Event.COMPLETE,function(e){this.effDic.down_1.visible&&(FightingModule.groundLayerSubObjDanger[this.column+"_"+(this.row+this.curLen)].dangerCount=0),this.removeChild(this.effDic.down_1),this.effDic.down_1=null,delete this.effDic.down_1},this),this.curLen>=this.downShowLimit&&(this.effDic.down_1.visible=!1),this.effDic.down_1.visible&&this.checkHit(this.nextDic.down_1,"down",this.curLen)):3==i?(this.effDic.right_1=CommonTools.getAnimDraw(RES.getRes("baozha_last_anim_json"),RES.getRes("baozha_last_anim_png"),"0"),this.addChild(this.effDic.right_1),this.effDic.right_1.play(1),this.effDic.right_1.x=e-25,this.effDic.right_1.y=t+47,this.effDic.right_1.rotation=90,this.effDic.right_1.once(egret.Event.COMPLETE,function(e){this.effDic.right_1.visible&&(FightingModule.groundLayerSubObjDanger[this.column+this.curLen+"_"+this.row].dangerCount=0),this.removeChild(this.effDic.right_1),this.effDic.right_1=null,delete this.effDic.right_1},this),this.curLen>=this.rightShowLimit&&(this.effDic.right_1.visible=!1),this.effDic.right_1.visible&&this.checkHit(this.nextDic.right_1,"right",this.curLen)):4==i&&(this.effDic.left_1=CommonTools.getAnimDraw(RES.getRes("baozha_last_anim_json"),RES.getRes("baozha_last_anim_png"),"0"),this.addChild(this.effDic.left_1),this.effDic.left_1.play(1),this.effDic.left_1.x=e+35,this.effDic.left_1.y=t+47,this.effDic.left_1.rotation=90,this.effDic.left_1.scaleY="-1",this.effDic.left_1.once(egret.Event.COMPLETE,function(e){this.effDic.left_1.visible&&(FightingModule.groundLayerSubObjDanger[this.column-this.curLen+"_"+this.row].dangerCount=0),this.removeChild(this.effDic.left_1),this.effDic.left_1=null,delete this.effDic.left_1,this.removePre(this.bulletLen-1)},this),this.curLen>=this.leftShowLimit&&(this.effDic.left_1.visible=!1),this.effDic.left_1.visible&&this.checkHit(this.nextDic.left_1,"left",this.curLen))}catch(n){CommonTools.logError("baozhaLastEff==================error "+n)}},t.prototype.setRow=function(e){this.row=e},t.prototype.getRow=function(){return this.row},t.prototype.setColumn=function(e){this.column=e},t.prototype.getColumn=function(){return this.column},t.prototype.setPreBobo=function(e){null==this.preBobo&&(this.preBobo={}),this.preBobo[e]=1},t.prototype.getPreBobo=function(){return this.preBobo},t}(egret.DisplayObjectContainer);e.Bullet=t,__reflect(t.prototype,"Fight.Bullet")}(Fight||(Fight={}));var Fight;!function(e){var t=function(e){function t(t){var i=e.call(this)||this;return i.subType=0,i.itemRange=[0,0,0,0],i.isPlayer=0,i.groundEmpty=!1,i.dangerCount=0,i.dangerPaoPaoObj=null,i.showImg=new eui.Image(t.img),i.x=t.x,i.y=t.y,i.name=t.name,i.curIdx=t.curIdx,i.addChild(i.showImg),i}return __extends(t,e),t.prototype.setBoundRec=function(e){this.boundRec=e},t.prototype.getBoundRec=function(){return this.boundRec},t.prototype.checkRange=function(e,t,i,n,o){if(e>=this.itemRange[0]&&e<this.itemRange[1]&&t>=this.itemRange[2]&&t<this.itemRange[3])if(1==n){this.removeChild(this.showImg);var s=i;if(2==o)s="diy_add_big_item_png",this.groundEmpty=!0;else{this.groundEmpty=!1;var a=s.split("_");this.res=parseInt(a[1])}this.showImg=new eui.Image(s),this.addChild(this.showImg)}else{if(this.sub&&(this.removeChild(this.sub),this.sub=null,this.subType=0,this.isPlayer>0&&(119==this.isPlayer?MapDIYModule.ONE_P="":MapDIYModule.TWO_P="",this.isPlayer=0)),2==o)return;var s=i;if(3==o&&""!=MapDIYModule.ONE_P)return;if(4==o&&""!=MapDIYModule.TWO_P)return;if(3==o&&(MapDIYModule.ONE_P=this.name,this.isPlayer=119,s="diy_1p_png"),4==o&&(MapDIYModule.TWO_P=this.name,this.isPlayer=120,s="diy_2p_png"),this.isPlayer>0)this.resSub=this.isPlayer;else{var a=s.split("_");this.resSub=parseInt(a[1])}this.sub=new eui.Image(s),this.subType=n,this.addChild(this.sub),this.sub.y-=38,this.isPlayer>0&&(this.sub.y-=38)}},t.prototype.checkRange2=function(e,t,i){if(CommonTools.log("------curIdx:"+this.curIdx+" column:"+this.column+" row:"+this.row),1==t){this.removeChild(this.showImg);var n=e;if(2==i)n="diy_add_big_item_png",this.groundEmpty=!0;else{this.groundEmpty=!1;var o=n.split("_");this.res=parseInt(o[1])}this.showImg=new eui.Image(n),this.addChild(this.showImg)
}else{if(this.sub&&(this.removeChild(this.sub),this.sub=null,this.subType=0,this.isPlayer>0&&(119==this.isPlayer?MapDIYModule.ONE_P="":MapDIYModule.TWO_P="",this.isPlayer=0)),2==i)return;var n=e;if(3==i&&""!=MapDIYModule.ONE_P)return;if(4==i&&""!=MapDIYModule.TWO_P)return;if(3==i&&(MapDIYModule.ONE_P=this.name,this.isPlayer=119,n="diy_1p_png"),4==i&&(MapDIYModule.TWO_P=this.name,this.isPlayer=120,n="diy_2p_png"),this.isPlayer>0)this.resSub=this.isPlayer;else{var o=n.split("_");this.resSub=parseInt(o[1])}this.sub=new eui.Image(n),this.subType=t,this.addChild(this.sub),this.sub.y-=38,this.isPlayer>0&&(this.sub.y-=38)}},t.prototype.addMiniBlock=function(e){this.sub=new eui.Image(e),this.addChild(this.sub),this.sub.y-=38},t.prototype.addMiniPlayer=function(e){var t="";t=119==e?"diy_1p_png":"diy_2p_png",this.sub=new eui.Image(t),this.addChild(this.sub),this.sub.y-=76},t.prototype.viewSub=function(e){if(this.sub)if(e){var t=this.sub.source,i=this.sub.x,n=this.sub.y;this.removeChild(this.sub),this.sub=new eui.Image(t),this.sub.x=i,this.sub.y=n,this.addChild(this.sub)}else this.sub.visible=!1},t.prototype.setRow=function(e){this.row=e},t.prototype.getRow=function(){return this.row},t.prototype.setColumn=function(e){this.column=e},t.prototype.getColumn=function(){return this.column},t.prototype.setType=function(e){this.type=e},t.prototype.getType=function(){return this.type},t.prototype.getCurIdx=function(){return this.curIdx},t.prototype.getSubType=function(){return this.subType},t.prototype.setRes=function(e){this.res=e},t.prototype.addSub=function(e,t){if(this.sub=e,this.subType=t,this.addChild(this.sub),7==t?(this.sub.y-=35,this.sub.scaleX=1,this.sub.scaleY=1):(this.sub.x+=8,this.sub.y+=8,this.sub.scaleX=1.2,this.sub.scaleY=1.2),this.notifyToAI(),ConstValue.P_FIGHT_OBJ.getMainPlayer().removeGuideTips("3"),"1"!=egret.localStorage.getItem(ConstValue.guide_tips[4].saveKey)&&null!=this.sub){this.showAnim=egret.Tween.get(this.sub);for(var i=0;50>i;i++)this.showAnim.to({alpha:.1},400),this.showAnim.to({alpha:1},400)}},t.prototype.notifyToAI=function(){for(var e in FightingModule.aiSubObj){var t=FightingModule.aiSubObj[e];t.beNotifyHasFood(this.column,this.row)}},t.prototype.clearSub=function(){null!=this.sub&&7!=this.subType&&-1!=this.subType&&(null!=this.showAnim&&(egret.Tween.removeTweens(this.sub),this.showAnim=null,ConstValue.P_FIGHT_OBJ.getMainPlayer().removeGuideTips("4")),this.removeChild(this.sub),this.sub=null,this.subType=0),null!=this.sub&&7==this.subType&&(this.subType=-1,FightingModule.Delay(3e3,function(){this.subType=7},this))},t}(egret.DisplayObjectContainer);e.MapItem=t,__reflect(t.prototype,"Fight.MapItem")}(Fight||(Fight={}));var Mst1=function(){function e(e,t,i,n,o){this.aiObj=null,this.iCmd=0,this.curPathPointIndex=0,this.boxMap={},this.curBoxMapIdex=0,this.workMap={},this.isVirtualOpen=!1,this.iOpenState=!1,this.delayFunc=null,this.delayTimer=null,this.noTarget=!1,this.isStopByBullet=!1,this.isFirstMove=!0,this.releaseAiCnt=0,this.aiObj=e,this.bornRow=this.aiObj.getRow(),this.bornColumn=this.aiObj.getColumn(),this.aiObj.aiRobot=!0,this.initRow=i,this.initColumn=n,1==o?this.matrix=[[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0]]:2==o&&(this.matrix=[[0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0]]),this.grid=new PF.Grid(n,i,this.matrix),this.op=new PF.Option,this.op.allowDiagonal=!1,this.finder=new PF.AStarFinder(this.op);for(var s=0,a=0;i>a;a++)for(var l=0;n>l;l++){if(t[s]>0&&t[s]<100){this.grid.setWalkableAt(l,a,!1);var r=ConstValue.P_CONFIG.MapBase[t[s].toString()].Type;if(3==r){var h=Math.abs(this.aiObj.getColumn()-l);null==this.boxMap[h.toString()]&&(this.boxMap[h.toString()]={}),this.boxMap[h.toString()][l+"_"+a]=[l,a]}}s++}for(var a=0;i>a;a++)for(var l=0;n>l;l++){var u=this.getPath(l,a);u.length>0&&(this.workMap[l+"_"+a]=[l,a])}}return e.prototype.runToHim=function(){var e=this.getPath(this.getOtherPlayer().getColumn(),this.getOtherPlayer().getRow());e.length>0&&(CommonTools.logAI("----------------***杀啊。。。"),this.iCmd=2,this.resetMove(e))},e.prototype.walkNoTarget=function(){this.resetStop(),CommonTools.logAI("----------------***无目的走");var e=this.getSafePath(),t=this.getPath(e[0],e[1]);t.length>0&&(this.iCmd=1,this.resetMove(t))},e.prototype.moveNext=function(){if(this.iOpenState){if(this.aiObj.getColumn()==ConstValue.P_FIGHT_OBJ.getMainPlayer().getColumn()&&this.aiObj.getRow()==ConstValue.P_FIGHT_OBJ.getMainPlayer().getRow()){this.stopAI();var e=CommonTools.getDataJsonStr("kill_player_by_monster",1,{attacker_pid:this.aiObj.roleId,beattacker_pid:ConstValue.P_FIGHT_OBJ.getMainPlayer().roleId});return void ConstValue.P_NET_OBJ.sendData2(e)}if(this.isConnectEnemy()&&!this.isStopByBullet?(CommonTools.logAI("----------------***发现敌人"),0==this.iCmd&&this.runToHim()):(this.isStopByBullet?CommonTools.logAI("----------------***发现子弹，躲开"):CommonTools.logAI("----------------***没有发现敌人"),0==this.iCmd&&this.walkNoTarget()),0==this.iCmd)return CommonTools.logAI("----------------***没有命令，主人"),CommonTools.logAI("move------6666666666666666666666666666666666"),void this.moveNext();this.curPathPointIndex++,CommonTools.logAI("this.iCmd------------aaaaaaaaaaaa----------"+this.iCmd+" this.curPathPointIndex:"+this.curPathPointIndex+" this.curPath:"+this.curPath);var t=this.curPath.length;if(this.curPathPointIndex>=t)return this.curPathPointIndex=0,this.iCmd=0,CommonTools.logAI("----------------***到达终点，找下一件事情做"),CommonTools.logAI("move------999999999999999999999999999999999999"),void(this.isFirstMove?(this.delayFunc=this.moveNext,this.Delay(1e3),0==this.releaseAiCnt&&(this.releaseAiCnt+=1)):this.moveNext());if(this.isFirstMove=!1,1==this.releaseAiCnt){this.releaseAiCnt+=1;var e=CommonTools.getDataJsonStr("rescue_monster",1,{monsterId:this.aiObj.roleId});ConstValue.P_NET_OBJ.sendData2(e)}this.move(this.curPath[this.curPathPointIndex][0],this.curPath[this.curPathPointIndex][1])}},e.prototype.resetMove=function(e){this.curPathPointIndex=0,this.curPath=e},e.prototype.beNotifyHasFood=function(e,t){},e.prototype.openBlock=function(e,t){this.setWalkAble(e,t,!0);var i=e+"_"+t;this.workMap[i]=[e,t],CommonTools.printMap(this.workMap);var n="";for(var o in this.boxMap){var s=this.boxMap[o];for(var a in s){var l=s[a];if(l[0]==e&&l[1]==t){n=o;break}}if(""!=n)break}""!=n&&(this.boxMap[n][e+"_"+t]=null,delete this.boxMap[n][e+"_"+t]);for(var o=0;o<this.initRow;o++)for(var a=0;a<this.initColumn;a++){var r=this.getPath(a,o);r.length>0&&null==this.workMap[a+"_"+o]&&(this.workMap[a+"_"+o]=[a,o])}},e.prototype.Delay=function(e){this.delayTimer=new egret.Timer(e,1),this.delayTimer.addEventListener(egret.TimerEvent.TIMER,this.delayFunc,this),this.delayTimer.start()},e.prototype.removeDelay=function(){null!=this.delayTimer&&(this.delayTimer.stop(),this.delayTimer.removeEventListener(egret.TimerEvent.TIMER,this.delayFunc,this),this.delayTimer=null,this.delayFunc=null)},e.prototype.getSafePath=function(){try{CommonTools.logAI("getSafePath----xxxxx-----------------");var e=null,t=100;if(CommonTools.printMap(this.workMap),this.isStopByBullet)for(var i in this.workMap){var n=this.workMap[i],o=!0;for(var s in FightingModule.bulletLayerSubObj){var a=FightingModule.bulletLayerSubObj[s];if(a.getColumn()==n[0]||a.getRow()==n[1]){o=!1;break}}if(o){var l=this.getPath(n[0],n[1]);if(l.length>0&&l.length<t){t=l.length,e=n,CommonTools.logAI("getSafePath----miniLenChoose--------a---------"+e);break}}}else{t=0;var r=CommonTools.getRandomFloor(10,!1),h=0;for(var i in this.workMap){if(h>=r)break;var n=this.workMap[i];if(Math.abs(n[0]-this.aiObj.getColumn())>=1&&Math.abs(n[0]-this.aiObj.getColumn())<=this.aiObj.getLWalkAreaColumn()&&Math.abs(n[0]-this.bornColumn)<=this.aiObj.getLWalkAreaColumn()||Math.abs(n[1]-this.aiObj.getRow())>=1&&Math.abs(n[1]-this.aiObj.getRow())<=this.aiObj.getLWalkAreaRow()&&Math.abs(n[1]-this.bornRow)<=this.aiObj.getLWalkAreaRow()){var l=this.getPath(n[0],n[1]);l.length>0&&l.length>t&&(t=l.length,e=n,CommonTools.logAI("getSafePath----miniLenChoose--------b---------"+e+" this.aiObj.roleId"+this.aiObj.roleId),h++)}}}if(null!=e)return e;t=0;for(var i in this.workMap){var n=this.workMap[i],l=this.getPath(n[0],n[1]);l.length>t&&(t=l.length,e=n,CommonTools.logAI("getSafePath--22--miniLenChoose-----------------"+e))}if(null!=e)return e}catch(u){CommonTools.logError("getSafePath========mst==========error "+u)}return null},e.prototype.getPath=function(e,t){var i=this.grid.clone();return this.finder.findPath(this.aiObj.getColumn(),this.aiObj.getRow(),e,t,i)},e.prototype.startAI=function(){this.iOpenState=!0,this.isConnectEnemy()||(CommonTools.logAI("----------------***开局"),this.moveNext())},e.prototype.stopAI=function(){this.iOpenState=!1},e.prototype.setStop=function(){this.isStopByBullet=!0,this.iCmd=0},e.prototype.resetStop=function(){this.isStopByBullet&&(this.isStopByBullet=!1)},e.prototype.isConnectEnemy=function(){var e=this.getPath(this.getOtherPlayer().getColumn(),this.getOtherPlayer().getRow());return 0==e.length?!1:Math.abs(this.getOtherPlayer().getColumn()-this.aiObj.getColumn())<=3&&Math.abs(this.getOtherPlayer().getRow()-this.aiObj.getRow())<=3?!0:!1},e.prototype.setWalkAble=function(e,t,i){this.grid.setWalkableAt(e,t,i)},e.prototype.getOtherPlayer=function(){for(var e in FightingModule.playerLayerSubObj){var t=FightingModule.playerLayerSubObj[e];if(t.roleId!=this.aiObj.roleId&&0==t.isAI)return t}return null},e.prototype.move=function(e,t){var i=this.aiObj;null==this.aiObj.func&&(this.aiObj.func=function(e){i.setMoving(!0),i.move(-1,!0),CommonTools.log("-------------xxx11  ")},this.aiObj.addEventListener(egret.Event.ENTER_FRAME,this.aiObj.func,this.aiObj)),this.aiObj.setMoving(!0),this.aiObj.moveDetail(e,t)},e.prototype.clear=function(){this.aiObj=null,this.grid=null,this.op=null,this.finder=null,this.matrix=null,this.curPath=null,this.boxMap={},this.workMap={},this.removeDelay()},e}();__reflect(Mst1.prototype,"Mst1");var Fight;!function(e){var t=function(t){function i(e){var i=t.call(this)||this;i.xDis=3,i.yDis=3,i.uTime=100,i.whichSide=0,i.sideDes="",i.bulletLen=4,i.life=1,i.speed=1,i.isMainPlayer=!1,i.isMoving=!1,i.curDirect=-1,i.row=-1,i.column=-1,i.keyDir=-1,i.keyBoom=-1,i.aiRobot=!1,i.endX=-1,i.endY=-1,i.fixAIX=0,i.fixAIY=0,i.isAI=0,i.markLeft=0,i.markRight=0,i.death=!1,i.iClass=1,i.isStatic=!1,i.preStop="0",i.buffPlaying=!1,i.isFirstMove=!0,i.aiLevel=0,i.lWalkArea=[3,3],i.freeWalk={1:[0,2,3],2:[0,3],3:[0,1,3],4:[0,1],5:[0,1,2],6:[1,2],7:[1,2,3],8:[2,3]};var n=e.pObj;return i.roleId=n.uid,i.aiLevel=n.aiLevel,i.lWalkArea=n.lWalkArea,i.roleId==ConstValue.cacheUserInfo.id&&(i.isMainPlayer=!0),i.life=n.life,i.speed=n.speed,i.bulletLen=n.power,i.iClass=n.iClass,i.whichSide=e.side,i.bodyName=new eui.Label(n.name),i.isAI=e.isAI,1==i.whichSide?(i.sideDes="p"+i.iClass,i.bodyName.textColor=16710910,i.bodyName.stroke=4,i.bodyName.strokeColor=1603060):(i.sideDes="p"+i.iClass,i.bodyName.textColor=16710910,i.bodyName.stroke=4,i.bodyName.strokeColor=15877656),i.aiLevel>=50&&(i.sideDes="pai"+i.iClass),i.bodyName.texAlign="center",i.bodyAniUp=CommonTools.getAnimDraw(RES.getRes(i.sideDes+"_03_json"),RES.getRes(i.sideDes+"_03_png"),"0"),i.bodyAniDown=CommonTools.getAnimDraw(RES.getRes(i.sideDes+"_01_json"),RES.getRes(i.sideDes+"_01_png"),"0"),i.bodyAniLeft=CommonTools.getAnimDraw(RES.getRes(i.sideDes+"_02_json"),RES.getRes(i.sideDes+"_02_png"),"0"),i.bodyAniRight=CommonTools.getAnimDraw(RES.getRes(i.sideDes+"_04_json"),RES.getRes(i.sideDes+"_04_png"),"0"),i.aiLevel<50?(i.bodyAniDownStatic=CommonTools.getAnimDraw(RES.getRes(i.sideDes+"_static_json"),RES.getRes(i.sideDes+"_static_png"),"0"),i.bodyAniUpStatic=CommonTools.getAnimDraw(RES.getRes(i.sideDes+"_static_03_json"),RES.getRes(i.sideDes+"_static_03_png"),"0"),i.bodyAniLeftStatic=CommonTools.getAnimDraw(RES.getRes(i.sideDes+"_static_02_json"),RES.getRes(i.sideDes+"_static_02_png"),"0"),i.bodyAniRightStatic=CommonTools.getAnimDraw(RES.getRes(i.sideDes+"_static_04_json"),RES.getRes(i.sideDes+"_static_04_png"),"0")):(i.bodyAniDownStatic=i.bodyAniDown,i.bodyAniUpStatic=i.bodyAniUp,i.bodyAniLeftStatic=i.bodyAniLeft,i.bodyAniRightStatic=i.bodyAniRight),i.bodyAni=i.bodyAniDownStatic,i.addChildAt(i.bodyAni,0),i.bodyName.x-=i.bodyName.width/2,i.bodyName.y-=128,i.aiLevel<50&&i.addChild(i.bodyName),i.x=e.x,i.y=e.y,i.name=e.name,i.bodyAni.play(-1),2==ConstValue.P_FIGHT_OBJ.APP_MODE&&(i.xDis=1.5,i.yDis=1.5),i.aiLevel>=50&&(i.xDis=.8,i.yDis=.8),i}return __extends(i,t),i.prototype.setBoundRec=function(e){this.boundRec=e},i.prototype.getBoundRec=function(){return this.boundRec},i.prototype.getLWalkAreaRow=function(){return this.lWalkArea[0]},i.prototype.getLWalkAreaColumn=function(){return this.lWalkArea[1]},i.prototype.setMoving=function(e){if(this.isMoving=e,!this.isMoving){switch(this.isStatic=!0,null!=this.bodyAni&&(this.removeChild(this.bodyAni),this.bodyAni=null),this.curDirect){case 0:null==this.bodyAni&&(this.bodyAni=this.bodyAniUpStatic,this.bodyAni.play(-1));break;case 1:null==this.bodyAni&&(this.bodyAni=this.bodyAniRightStatic,this.bodyAni.play(-1));break;case 2:null==this.bodyAni&&(this.bodyAni=this.bodyAniDownStatic,this.bodyAni.play(-1));break;case 3:null==this.bodyAni&&(this.bodyAni=this.bodyAniLeftStatic,this.bodyAni.play(-1))}this.addChildAt(this.bodyAni,0)}},i.prototype.moveDetail=function(e,t){return this.endX=e,this.endY=t,this.column==e?t>=this.row?void this.move(2,!1):void this.move(0,!1):this.row==t?e>=this.column?void this.move(1,!1):void this.move(3,!1):void 0},i.prototype.findOwnAi=function(){for(var e in FightingModule.aiSubObj){var t=FightingModule.aiSubObj[e];if(t.aiObj.roleId==this.roleId)return t}return null},i.prototype.addBuff=function(e){this.buffPlaying||(this.buffPlaying=!0,2==e?(this.buffAnim=CommonTools.getAnimDraw(RES.getRes("take_chicken_json"),RES.getRes("take_chicken_png"),"0"),this.buffAnim.x-=55,this.buffAnim.y-=110,this.buffAnim.scaleX=1.2,this.buffAnim.scaleY=1.2):1==e&&(this.buffAnim=CommonTools.getAnimDraw(RES.getRes("take_dog_json"),RES.getRes("take_dog_png"),"0"),this.buffAnim.x-=87,this.buffAnim.y-=85,this.buffAnim.scaleX=1.8,this.buffAnim.scaleY=1.8),this.buffAnim.play(1),this.buffAnim.once(egret.Event.COMPLETE,function(e){this.buffPlaying=!1;try{this.removeChild(this.buffAnim)}catch(t){CommonTools.logError("Destroy addBuff====error=====")}},this),this.addChild(this.buffAnim))},i.prototype.addGuideTips=function(e){this.panelT=new eui.Panel,this.panelT.skinName="resource/eui_skins/UserUI/GuideTipsGroup.exml",this.panelT.name="p_"+e;var t=this.panelT.getChildByName("group_1"),i=t.getChildByName("tip");i.text=ConstValue.guide_tips[e].tip,this.panelT.x-=160,this.panelT.y-=200,this.addChild(this.panelT),"5"==e&&FightingModule.Delay(3e3,function(){this.removeTips()},this)},i.prototype.removeTips=function(){null!=this.panelT&&(this.removeChild(this.panelT),this.panelT=null)},i.prototype.removeGuideTips=function(e){if(this.isMainPlayer&&null!=this.panelT){var t=ConstValue.guide_tips[e].saveKey;"1"!=egret.localStorage.getItem(t)&&(egret.localStorage.setItem(t,"1"),this.removeTips(),ConstValue.P_FIGHT_OBJ.removeJump(),"1"==e?ConstValue.P_FIGHT_OBJ.showGuide(!0):parseInt(e)>=2&&ConstValue.P_FIGHT_OBJ.showGuide(!1))}},i.prototype.changeIndex=function(e,t){1==t?FightingModule.mapLayer.setChildIndex(this,FightingModule.mapLayer.getChildIndex(e)+1):2==t&&FightingModule.mapLayer.setChildIndex(this,FightingModule.mapLayer.getChildIndex(e)-1)},i.prototype.move=function(e,t){try{if(this.removeGuideTips("1"),!this.isMoving)return;this.speed>6&&(this.speed=6),1==this.speed&&(this.speed=2.1),2==this.speed&&(this.speed=2.8),3==this.speed&&(this.speed=3.4),5==this.speed&&(this.speed=4.7),6==this.speed&&(this.speed=5.4);var i=this.xDis+1.6*this.speed,n=this.yDis+1.6*this.speed;if(-1==e&&(e=-1==this.curDirect?1:this.curDirect),this.isMainPlayer)for(var o in FightingModule.aiSubObj){var s=FightingModule.aiSubObj[o];if(s.aiObj.getColumn()==this.column&&s.aiObj.getRow()==this.row&&s.visible&&s.aiObj.aiLevel>=50){s.stopAI();var a=CommonTools.getDataJsonStr("kill_player_by_monster",1,{attacker_pid:s.aiObj.roleId,beattacker_pid:this.roleId});return void ConstValue.P_NET_OBJ.sendData2(a)}}if(this.aiRobot&&this.column==this.endX&&this.row==this.endY)if(this.aiLevel>=50&&this.findOwnAi().resetStop(),0==e||2==e){if(!(this.fixAIY<=50))return this.setMoving(!1),this.removeEventListener(egret.Event.ENTER_FRAME,this.func,this),this.func=null,this.keyDir=-1,this.fixAIY=0,void this.findOwnAi().moveNext();this.fixAIY+=n}else if(1==e||3==e){if(!(this.fixAIX<=50))return this.setMoving(!1),this.removeEventListener(egret.Event.ENTER_FRAME,this.func,this),this.func=null,this.keyDir=-1,this.fixAIX=0,void this.findOwnAi().moveNext();this.fixAIX+=i}if(e!=this.curDirect||this.isStatic||this.isFirstMove){switch(this.isFirstMove=!1,this.isStatic=!1,null!=this.bodyAni&&(this.removeChild(this.bodyAni),this.bodyAni=null),this.curDirect=e,e){case 0:null==this.bodyAni&&(this.bodyAni=this.bodyAniUp,this.bodyAni.play(-1));break;case 1:null==this.bodyAni&&(this.bodyAni=this.bodyAniRight,this.bodyAni.play(-1));break;case 2:null==this.bodyAni&&(this.bodyAni=this.bodyAniDown,this.bodyAni.play(-1));break;case 3:null==this.bodyAni&&(this.bodyAni=this.bodyAniLeft,this.bodyAni.play(-1))}this.addChildAt(this.bodyAni,0)}var l=!1;if(3==e){if(this.x<=FightingModule.mapLeftLimit)return void this.aiNext();for(var o in FightingModule.mapLayerSubObj){var s=FightingModule.mapLayerSubObj[o];if(s.getRow()==this.row&&s.getColumn()+1==this.column&&this.x-18<=s.x+s.width){i=0;break}}for(var o in FightingModule.bulletLayerSubObj){var s=FightingModule.groundLayerSubObj[FightingModule.bulletLayerSubObj[o].getCurIdx()];if(s.getRow()==this.row&&s.getColumn()+1==this.column&&this.x-10<=s.x+s.width){i=0,l=!0;break}}}else if(0==e){if(this.y<=FightingModule.mapUpLimit)return void this.aiNext();for(var o in FightingModule.mapLayerSubObj){var s=FightingModule.mapLayerSubObj[o];if(s.getColumn()==this.column&&s.getRow()+1==this.row&&this.y<=s.y+s.height){n=0;break}if(s.getColumn()-1==this.column&&s.getRow()+1==this.row&&Math.abs(s.x-this.x)<15.5&&Math.abs(s.y-this.y)<111.1&&!this.aiRobot){n=0;break}if(s.getColumn()+1==this.column&&s.getRow()+1==this.row&&Math.abs(s.x-this.x)<80.6&&Math.abs(s.y-this.y)<111.1&&!this.aiRobot){n=0;break}}for(var o in FightingModule.bulletLayerSubObj){var s=FightingModule.groundLayerSubObj[FightingModule.bulletLayerSubObj[o].getCurIdx()];if(s.getColumn()==this.column&&s.getRow()+1==this.row&&this.y-20<=s.y+s.height){n=0,l=!0;break}}}else if(2==e){if(this.y>=FightingModule.mapDownLimit)return void this.aiNext();for(var o in FightingModule.mapLayerSubObj){var s=FightingModule.mapLayerSubObj[o];if(this.y>=630&&(n=0),s.getColumn()==this.column&&s.getRow()-1==this.row&&this.y+20>=s.y){n=0;break}if(s.getColumn()+1==this.column&&s.getRow()-1==this.row&&Math.abs(this.x-s.x)<80&&Math.abs(this.y-s.y)<5.3&&!this.aiRobot){n=0;break}if(s.getColumn()-1==this.column&&s.getRow()-1==this.row&&Math.abs(this.x-s.x)<11.5&&Math.abs(this.y-s.y)<5.3&&!this.aiRobot){n=0;break}}for(var o in FightingModule.bulletLayerSubObj){var s=FightingModule.groundLayerSubObj[FightingModule.bulletLayerSubObj[o].getCurIdx()];if(s.getColumn()==this.column&&s.getRow()-1==this.row&&this.y+50>=s.y){n=0,l=!0;break}}}else if(1==e){if(this.x>=FightingModule.mapRightLimit)return void this.aiNext();for(var o in FightingModule.mapLayerSubObj){var s=FightingModule.mapLayerSubObj[o];if(s.getRow()==this.row&&s.getColumn()-1==this.column&&this.x+38>=s.x){i=0;break}}for(var o in FightingModule.bulletLayerSubObj){var s=FightingModule.groundLayerSubObj[FightingModule.bulletLayerSubObj[o].getCurIdx()];if(s.getRow()==this.row&&s.getColumn()-1==this.column&&this.x+38>=s.x){i=0,l=!0;break}}}if(this.aiRobot&&!l){if((0==e||2==e)&&0==n)return this.setMoving(!1),this.removeEventListener(egret.Event.ENTER_FRAME,this.func,this),this.func=null,this.keyDir=-1,this.fixAIY=0,void this.findOwnAi().moveNext();if((1==e||3==e)&&0==i)return this.setMoving(!1),this.removeEventListener(egret.Event.ENTER_FRAME,this.func,this),this.func=null,this.keyDir=-1,this.fixAIX=0,void this.findOwnAi().moveNext()}if(this.aiLevel>=50&&l)return this.setMoving(!1),this.removeEventListener(egret.Event.ENTER_FRAME,this.func,this),this.func=null,this.keyDir=-1,this.aiLevel>=50&&this.findOwnAi().setStop(),void this.findOwnAi().moveNext();if(this.aiLevel<50&&l&&(this.setMoving(!1),this.removeEventListener(egret.Event.ENTER_FRAME,this.func,this),this.func=null,this.keyDir=-1,this.findOwnAi().moveNext()),e==this.curDirect&&!t)return;switch(e){case 0:null==this.bodyAni&&(this.bodyAni=this.bodyAniUp,this.bodyAni.play(-1)),this.y=this.y-n;break;case 1:null==this.bodyAni&&(this.bodyAni=this.bodyAniRight,this.bodyAni.play(-1)),this.x=this.x+i;break;case 2:null==this.bodyAni&&(this.bodyAni=this.bodyAniDown,this.bodyAni.play(-1)),this.y=this.y+n;break;case 3:null==this.bodyAni&&(this.bodyAni=this.bodyAniLeft,this.bodyAni.play(-1)),this.x=this.x-i}if(this.addChildAt(this.bodyAni,0),this.markPosition(e),this.isMainPlayer&&!FightingModule.aiPVE){var a=CommonTools.getDataJsonStr("syncPos",1,{x:this.x,y:this.y,direction:this.curDirect,speed:this.speed,idx:parseInt(this.curMapIdx),playerID:0});ConstValue.P_NET_OBJ.sendData2(a)}var r=0,h=null,u=null;for(var o in FightingModule.playerLayerSubObj){var s=FightingModule.playerLayerSubObj[o];null==h?(r=s.y,h=s):s.y>r?(u=h,h=s):u=s}var c=FightingModule.mapLayer.getChildIndex(h),d=FightingModule.mapLayer.getChildIndex(u);d>c&&Math.abs(h.getRow()-u.getRow())<=1&&Math.abs(h.getColumn()-u.getColumn())<=1&&FightingModule.mapLayer.swapChildren(h,u)}catch(g){CommonTools.logError("move=====================error===="+g)}},i.prototype.aiNext=function(){this.aiRobot&&(this.setMoving(!1),this.removeEventListener(egret.Event.ENTER_FRAME,this.func,this),this.func=null,this.keyDir=-1,this.fixAIY=0,this.findOwnAi().moveNext())},i.prototype.fire=function(t,i){this.removeGuideTips("2"),CommonAudioHandle.playEffect("playBomb_mp3",1),this.aiRobot&&2==this.findOwnAi().iCmd&&(this.findOwnAi().iCmd=0),this.markPosition(-1);var n=FightingModule.groundLayerSubObj[i];this.bulletX=n.x+41,this.bulletY=n.y+41-10;var o=ConstValue.P_FIGHT_OBJ.getPlayerDataByRid(this.roleId+""),s={side:1,x:this.bulletX,y:this.bulletY,name:t,curIdx:i,PPSkinID:o.PPSkinID},a=new e.Bullet(s);a.setOwner(this),a.setRow(n.getRow()),a.setColumn(n.getColumn());for(var l in FightingModule.aiSubObj){var r=FightingModule.aiSubObj[l];r.setWalkAble(n.getColumn(),n.getRow(),!1)}FightingModule.mapLayer.addChild(a),FightingModule.bulletLayerSubObj[a.name]=a,a.setRightLimit(this.bulletLen+1),a.setLeftLimit(this.bulletLen+1),a.setDownLimit(this.bulletLen+1),a.setUpLimit(this.bulletLen+1),a.setRightLimit2(this.bulletLen+1),a.setLeftLimit2(this.bulletLen+1),a.setDownLimit2(this.bulletLen+1),a.setUpLimit2(this.bulletLen+1),FightingModule.mapLayer.swapChildren(a,this),this.markPosition(-1);for(var l in FightingModule.mapLayerSubObj){var h=FightingModule.mapLayerSubObj[l.toString()];if(1!=h.getType()){if(h.getRow()==a.getRow()){if(h.getColumn()<a.getColumn()){var u=a.getColumn()-h.getColumn();this.bulletLen>=u&&a.getLeftLimit2()>u&&a.setLeftLimit2(u)}if(h.getColumn()>a.getColumn()){var c=h.getColumn()-a.getColumn();this.bulletLen>=c&&a.getRightLimit2()>c&&a.setRightLimit2(c)}}if(h.getColumn()==a.getColumn()){if(h.getRow()<a.getRow()){var d=a.getRow()-h.getRow();this.bulletLen>=d&&a.getUpLimit2()>d&&a.setUpLimit2(d)}if(h.getRow()>a.getRow()){var g=h.getRow()-a.getRow();this.bulletLen>=g&&a.getDownLimit2()>g&&a.setDownLimit2(g)}}}}var m=a.getColumn()+1;this.bulletLen>=m&&a.getLeftLimit2()>m&&a.setLeftLimit2(m);var _=ConstValue.P_FIGHT_OBJ.getInitColumn()-a.getColumn();this.bulletLen>=_&&a.getRightLimit2()>_&&a.setRightLimit2(_);var p=a.getRow()+1;this.bulletLen>=p&&a.getUpLimit2()>p&&a.setUpLimit2(p);var C=ConstValue.P_FIGHT_OBJ.getInitRow()-a.getRow();this.bulletLen>=C&&a.getDownLimit2()>C&&a.setDownLimit2(C);var y=!0;for(var l in FightingModule.bulletLayerSubObj)if(l!=a.name){var r=FightingModule.bulletLayerSubObj[l];if(a.getRow()==r.getRow()&&a.getColumn()==r.getColumn())if(y=!1,null!=r.getPreBobo())for(var f in r.getPreBobo()){var b=FightingModule.bulletLayerSubObj[f];a.setPreBobo(b.name)}else a.setPreBobo(r.name);else if(a.getRow()==r.getRow()){if(a.getColumn()>r.getColumn()){if(r.getRightLimit2()>=a.getColumn()-r.getColumn())if(y=!1,null!=r.getPreBobo())for(var f in r.getPreBobo()){var b=FightingModule.bulletLayerSubObj[f];a.setPreBobo(b.name)}else a.setPreBobo(r.name)}else if(r.getLeftLimit2()>=r.getColumn()-a.getColumn())if(y=!1,null!=r.getPreBobo())for(var f in r.getPreBobo()){var b=FightingModule.bulletLayerSubObj[f];a.setPreBobo(b.name)}else a.setPreBobo(r.name)}else if(a.getColumn()==r.getColumn())if(r.getRow()>a.getRow()){if(r.getUpLimit2()>=r.getRow()-a.getRow())if(null!=r.getPreBobo())for(var f in r.getPreBobo()){var b=FightingModule.bulletLayerSubObj[f];a.setPreBobo(b.name)}else a.setPreBobo(r.name)}else if(r.getDownLimit2()>=a.getRow()-r.getRow())if(null!=r.getPreBobo())for(var f in r.getPreBobo()){var b=FightingModule.bulletLayerSubObj[f];a.setPreBobo(b.name)}else a.setPreBobo(r.name)}y&&a.baozha(),this.aiRobot&&this.findOwnAi().moveNext()},i.prototype.markPosition=function(e){var t,i=1e4,n=0,o=0,s=null,a=5,l=41,r=null;for(var h in FightingModule.groundLayerSubObj){var u=FightingModule.groundLayerSubObj[h],c=new egret.Point(this.x+a,this.y+l),d=u.x+41,g=u.y+41,m=new egret.Point(d,g),_=egret.Point.distance(c,m);i>=_&&(t=h,i=_,n=d,o=g,s=u),(7==u.getSubType()||-1==u.getSubType())&&(r=u)}this.curMapIdx=t,this.bulletX=n,this.bulletY=o-10,this.groundObj=s,this.row=this.groundObj.getRow(),this.column=this.groundObj.getColumn();for(var h in FightingModule.mapLayerSubObj){var p=FightingModule.mapLayerSubObj[h];if(p.getRow()<=this.row&&FightingModule.mapLayer.getChildIndex(p)>=FightingModule.mapLayer.getChildIndex(this)&&this.changeIndex(p,1),p.getRow()-1==this.row&&p.getColumn()==this.column&&FightingModule.mapLayer.getChildIndex(p)<=FightingModule.mapLayer.getChildIndex(this)){this.changeIndex(p,2);break}}if(this.groundObj.getSubType()>0){CommonTools.log("吃东西啦》。。。。。。");var C=0;if(1==this.isAI&&(C=this.roleId),this.isMainPlayer||1==this.isAI){CommonAudioHandle.playEffect("eatProp_mp3",1);var y=CommonTools.getDataJsonStr("pickItem",1,{itype:this.groundObj.getSubType(),idx:parseInt(this.curMapIdx),playerID:C});ConstValue.P_NET_OBJ.sendData2(y)}this.groundObj.clearSub(),this.aiRobot&&3==this.findOwnAi().iCmd&&(this.findOwnAi().iCmd=0,this.findOwnAi().moveNext())}var f=FightingModule.groundLayerSubObjDanger[this.groundObj.getColumn()+"_"+this.groundObj.getRow()];if(f.dangerCount>0&&!this.death){this.death=!0;var C=0;1==this.isAI&&(C=this.roleId);var y=CommonTools.getDataJsonStr("syncBoomPlayer",1,{paopaoID:this.groundObj.dangerPaoPaoObj.name,x:this.groundObj.dangerPaoPaoObj.x,y:this.groundObj.dangerPaoPaoObj.y,idx:this.groundObj.dangerPaoPaoObj.curIdx,killrid:this.roleId,killidx:parseInt(this.curMapIdx),playerID:C});ConstValue.P_NET_OBJ.sendData2(y)}if(this.isMainPlayer)for(var h in FightingModule.aiSubObj){var p=FightingModule.aiSubObj[h];if(p.aiObj.getColumn()==this.column&&p.aiObj.getRow()==this.row&&p.visible&&p.aiObj.aiLevel>=50){p.stopAI();var y=CommonTools.getDataJsonStr("kill_player_by_monster",1,{attacker_pid:p.aiObj.roleId,beattacker_pid:this.roleId});return void ConstValue.P_NET_OBJ.sendData2(y)}}},i.prototype.getRow=function(){return this.row},i.prototype.getColumn=function(){return this.column},i.prototype.clear=function(){null!=this.func&&(this.removeEventListener(egret.Event.ENTER_FRAME,this.func,this),this.func=null),this.bodyAniUp=null,this.bodyAniDown=null,this.bodyAniLeft=null,this.bodyAniRight=null,this.bodyAniUpStatic=null,this.bodyAniDownStatic=null,this.bodyAniLeftStatic=null,this.bodyAniRightStatic=null,this.bodyAni=null,this.buffAnim=null},i}(egret.DisplayObjectContainer);e.Player=t,__reflect(t.prototype,"Fight.Player")}(Fight||(Fight={}));