var __reflect=this&&this.__reflect||function(e,t,i){e.__class__=t,i?i.push(t):i=[t],e.__types__=e.__types__?i.concat(e.__types__):i},__extends=this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);i.prototype=t.prototype,e.prototype=new i},__awaiter=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))(function(o,s){function a(e){try{r(n.next(e))}catch(t){s(t)}}function l(e){try{r(n["throw"](e))}catch(t){s(t)}}function r(e){e.done?o(e.value):new i(function(t){t(e.value)}).then(a,l)}r((n=n.apply(e,t||[])).next())})},__generator=this&&this.__generator||function(e,t){function i(e){return function(t){return n([e,t])}}function n(i){if(o)throw new TypeError("Generator is already executing.");for(;r;)try{if(o=1,s&&(a=s[2&i[0]?"return":i[0]?"throw":"next"])&&!(a=a.call(s,i[1])).done)return a;switch(s=0,a&&(i=[0,a.value]),i[0]){case 0:case 1:a=i;break;case 4:return r.label++,{value:i[1],done:!1};case 5:r.label++,s=i[1],i=[0];continue;case 7:i=r.ops.pop(),r.trys.pop();continue;default:if(a=r.trys,!(a=a.length>0&&a[a.length-1])&&(6===i[0]||2===i[0])){r=0;continue}if(3===i[0]&&(!a||i[1]>a[0]&&i[1]<a[3])){r.label=i[1];break}if(6===i[0]&&r.label<a[1]){r.label=a[1],a=i;break}if(a&&r.label<a[2]){r.label=a[2],r.ops.push(i);break}a[2]&&r.ops.pop(),r.trys.pop();continue}i=t.call(e,r)}catch(n){i=[6,n],s=0}finally{o=a=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}var o,s,a,l,r={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return l={next:i(0),"throw":i(1),"return":i(2)},"function"==typeof Symbol&&(l[Symbol.iterator]=function(){return this}),l},ResourceUtils=function(){function e(){this._groupIndex=0,this._configs=new Array,this._groups={},RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceLoadProgress,this),RES.addEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this)}return e.prototype.addConfig=function(e,t){this._configs.push([e,t])},e.prototype.loadConfig=function(e,t){this._onConfigComplete=e,this._onConfigCompleteTarget=t,this.loadNextConfig()},e.prototype.loadNextConfig=function(){if(0==this._configs.length)return this._onConfigComplete.call(this._onConfigCompleteTarget),this._onConfigComplete=null,void(this._onConfigCompleteTarget=null);var e=this._configs.shift();RES.addEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigCompleteHandle,this),RES.loadConfig(e[0],e[1])},e.prototype.onConfigCompleteHandle=function(e){RES.removeEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigCompleteHandle,this),this.loadNextConfig()},e.prototype.loadGroup=function(e,t,i,n){this._groups[e]=[t,i,n],RES.loadGroup(e)},e.prototype.loadGroups=function(e,t,i,n,o){RES.createGroup(e,t,!0),this.loadGroup(e,i,n,o)},e.prototype.pilfererLoadGroup=function(e,t){void 0===t&&(t=null);var i="pilferer_"+e;t||(t=[e]),RES.createGroup(i,t,!0),RES.loadGroup(i,-1)},e.prototype.onResourceLoadComplete=function(e){var t=e.groupName;if(this._groups[t]){var i=this._groups[t][0],n=this._groups[t][2];null!=i&&i.call(n),this._groups[t]=null,delete this._groups[t]}},e.prototype.onResourceLoadProgress=function(e){var t=e.groupName;if(this._groups[t]){var i=this._groups[t][1],n=this._groups[t][2];null!=i&&i.call(n,e.itemsLoaded,e.itemsTotal)}},e.prototype.onResourceLoadError=function(e){egret.error(e.groupName+"资源组有资源加载失败"),this.onResourceLoadComplete(e)},e.prototype.loadResource=function(e,t,i,n,o){void 0===e&&(e=[]),void 0===t&&(t=[]),void 0===i&&(i=null),void 0===n&&(n=null),void 0===o&&(o=null);var s=e.concat(t),a="loadGroup"+this._groupIndex++;RES.createGroup(a,s,!0),this._groups[a]=[i,n,o],RES.loadGroup(a)},e}();__reflect(ResourceUtils.prototype,"ResourceUtils");var PathUtils=function(){function e(){}return Object.defineProperty(e,"RESOURC",{get:function(){return 1==ConstValue.p_LOGIN_MODEL&&(e.CDN_URL=""),e.CDN_URL+e.RESOURC_URL},enumerable:!0,configurable:!0}),Object.defineProperty(e,"NOTICE",{get:function(){return 1==ConstValue.p_LOGIN_MODEL&&(e.CDN_URL=""),e.CDN_URL+e.RESOURC_URL+e.NOTICE_URL},enumerable:!0,configurable:!0}),e.CND_URL_49YOU="",e.CDN_URL="https://www.iogood.cn:442/pptcdn/",e.RESOURC_URL="resource/",e.NOTICE_URL="notice/",e.Version_Default_Res="default.res.json?v=201812010101",e.Version_Default_Thm="default.thm.json?v=201807100101",e}();__reflect(PathUtils.prototype,"PathUtils");var Main=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.isLoaded=!1,t.dDataInfo=null,t.dDataInfo2=null,t}return __extends(t,e),t.prototype.createChildren=function(){e.prototype.createChildren.call(this),egret.lifecycle.addLifecycleListener(function(e){CommonTools.log("===========onPause")}),egret.lifecycle.onPause=function(){CommonTools.log("===========onPause")},egret.lifecycle.onResume=function(){egret.ticker.resume(),null==ConstValue.cacheUserInfo||ConstValue.P_NET_OBJ.socket.connected||ConstValue.P_NET_OBJ.out_relogin(),CommonTools.log("===========onResume")},egret.ImageLoader.crossOrigin="anonymous";var t=new AssetAdapter;egret.registerImplementation("eui.IAssetAdapter",t),egret.registerImplementation("eui.IThemeAdapter",new ThemeAdapter),this.runGame()["catch"](function(e){CommonTools.log(e)})},t.prototype.runGame=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return[4,this.loadResource("pre_preload",1)];case 1:return e.sent(),[2]}})})},t.prototype.doNext=function(e){if(this.stage.removeChild(this.loadingView),this.loadingView=null,1==e)ConstValue.P_LOGIN_OBJ=new LoginModule(this);else if(2==e)ConstValue.P_HALL_OBJ=new HallModule(this);else if(3==e)if(ConstValue.P_IS_DEBUG);else{var t=CommonTools.getDataJsonStr("enterPPRoom",1,{});ConstValue.P_NET_OBJ.sendData(t)}else if(4==e)if(ConstValue.P_IS_DEBUG);else{var t=CommonTools.getDataJsonStr("openDiyMapUI",1,{theme:1});ConstValue.P_NET_OBJ.sendData(t)}else 5==e?ConstValue.P_IS_DEBUG:6==e&&(ConstValue.P_IS_DEBUG||(null==ConstValue.P_FIGHT_OBJ&&(ConstValue.P_FIGHT_OBJ=new FightingModule(this)),ConstValue.P_FIGHT_OBJ.initMapData(this.dDataInfo),FightingModule.readyTwo&&!FightingModule.readyRes&&(ConstValue.P_FIGHT_OBJ.releaseVsPanel(),ConstValue.P_FIGHT_OBJ.updateInfo(this.dDataInfo2))));null==ConstValue.P_CONTEXT&&(ConstValue.P_CONTEXT=this)},t.prototype.loadResource=function(e,t){return __awaiter(this,void 0,void 0,function(){var i;return __generator(this,function(n){switch(n.label){case 0:return n.trys.push([0,5,,6]),this.loadingView=new LoadingUI(this.stage.stageWidth,this.stage.stageHeight,this),this.stage.addChildAt(this.loadingView,1),this.isLoaded?[3,1]:(CommonTools.resourceMgr.addConfig(PathUtils.RESOURC+PathUtils.Version_Default_Res,PathUtils.RESOURC),CommonTools.resourceMgr.loadConfig(this.onLoginConfigComplete,this),[3,4]);case 1:return null!=ConstValue.cacheKeyGroup[e]?[3,3]:[4,RES.loadGroup(e,0,this.loadingView)];case 2:n.sent(),ConstValue.cacheKeyGroup[e]=1,n.label=3;case 3:ConstValue.P_IS_DEBUG&&this.stage.removeChild(this.loadingView),this.doNext(t),n.label=4;case 4:return[3,6];case 5:return i=n.sent(),console.error(i),[3,6];case 6:return[2]}})})},t.prototype.onLoginConfigComplete=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return[4,this.loadTheme()];case 1:return e.sent(),[4,RES.loadGroup("pre_preload",0,this.loadingView)];case 2:return e.sent(),this.isLoaded=!0,ConstValue.cacheKeyGroup.preload=1,ConstValue.P_IS_DEBUG&&this.stage.removeChild(this.loadingView),this.doNext(1),[2]}})})},t.prototype.loadResourceBlackground=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return CommonTools.log("loadBlackGround=================2"),[4,RES.loadGroup(e,0,null)];case 1:return t.sent(),CommonTools.log("loadBlackGround=================2_1"),[2]}})})},t.prototype.addBackGround=function(e){var t=this.createBitmapByName(e),i=this.stage.stageWidth+50,n=this.stage.stageHeight+50;return t.width=i,t.height=n,t.y=-25,t.x=-25,t},t.prototype.getStageWidth=function(){return this.stage.stageWidth},t.prototype.getStageHeight=function(){return this.stage.stageHeight},t.prototype.getClientWidth=function(){return document.documentElement.clientWidth},t.prototype.getClientHeight=function(){return document.documentElement.clientHeight},t.prototype.loadTheme=function(){var e=this;return new Promise(function(t,i){var n=new eui.Theme(PathUtils.RESOURC+PathUtils.Version_Default_Thm,e.stage);n.addEventListener(eui.UIEvent.COMPLETE,function(){t()},e)})},t.prototype.createGameScene=function(){var e=this.stage.stageWidth;this.stage.stageHeight;this.addChild(this.addBackGround("bg_jpg"));var t=new egret.Shape;t.graphics.beginFill(0,.5),t.graphics.drawRect(0,0,e,172),t.graphics.endFill(),t.y=33,this.addChild(t);var i=this.createBitmapByName("egret_icon_png");this.addChild(i),i.x=26,i.y=33;var n=new egret.Shape;n.graphics.lineStyle(2,16777215),n.graphics.moveTo(0,0),n.graphics.lineTo(0,117),n.graphics.endFill(),n.x=172,n.y=61,this.addChild(n);var o=new egret.TextField;o.textColor=16777215,o.width=e-172,o.textAlign="center",o.text="Hello Egret",o.size=24,o.x=172,o.y=80,this.addChild(o);var s=new egret.TextField;this.addChild(s),s.alpha=0,s.width=e-172,s.textAlign=egret.HorizontalAlign.CENTER,s.size=24,s.textColor=16777215,s.x=172,s.y=135,this.textfield=s;var a=new eui.Button;a.label="Click!",a.horizontalCenter=0,a.verticalCenter=0,this.addChild(a),a.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onButtonClick,this),CommonTools.log("createGameScene=============done")},t.prototype.createBitmapByName=function(e){var t=new egret.Bitmap,i=RES.getRes(e);return t.texture=i,t},t.prototype.startAnimation=function(e){var t=this,i=new egret.HtmlTextParser,n=e.map(function(e){return i.parse(e)}),o=this.textfield,s=-1,a=function(){s++,s>=n.length&&(s=0);var e=n[s];o.textFlow=e;var i=egret.Tween.get(o);i.to({alpha:1},200),i.wait(2e3),i.to({alpha:0},200),i.call(a,t)};a()},t.getResUtil=function(e){return RES.getRes(e)},t.prototype.onButtonClick=function(e){var t=new eui.Panel;t.title="Title",t.horizontalCenter=0,t.verticalCenter=0,this.addChild(t)},t.roomkey=null,t}(eui.UILayer);__reflect(Main.prototype,"Main");var DebugPlatform=function(){function e(){}return e.prototype.getUserInfo=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2,{nickName:"username"}]})})},e.prototype.login=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return CommonTools.log("-----DebugPlatform--------login"),[2]})})},e.prototype.updateInfo=function(e){},e.prototype.shareAppMessage=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return CommonTools.log("-------DebugPlatform------shareAppMessage"),[2]})})},e.prototype.showShareMenu=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return CommonTools.log("-------DebugPlatform------showShareMenu"),[2]})})},e.prototype.onWxShow=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return CommonTools.log("-------DebugPlatform------onWxShow"),[2]})})},e}();__reflect(DebugPlatform.prototype,"DebugPlatform",["Platform"]),window.platform||(window.platform=new DebugPlatform);var ThemeAdapter=function(){function e(){}return e.prototype.getTheme=function(e,t,i,n){function o(e){t.call(n,e)}function s(t){t.resItem.url==e&&(RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,s,null),i.call(n))}var a=this;"undefined"!=typeof generateEUI?egret.callLater(function(){t.call(n,generateEUI)},this):"undefined"!=typeof generateEUI2?RES.getResByUrl("resource/gameEui.bin",function(e,i){window.JSONParseClass.setData(e),o(e),egret.callLater(function(){t.call(n,generateEUI2)},a)},this,RES.ResourceItem.TYPE_BIN):(RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,s,null),RES.getResByUrl(e,o,this,RES.ResourceItem.TYPE_TEXT))},e}();__reflect(ThemeAdapter.prototype,"ThemeAdapter",["eui.IThemeAdapter"]);var CommonAudioHandle=function(){function e(){}return e.play=function(t,i){null!=e.channel&&e.channel.stop();var n=RES.getRes(t);n.type=egret.Sound.MUSIC,e.channel=n.play(0,i)},e.setVolume=function(t){null!=e.channel&&(e.channel.volume=t)},e.playEffect=function(e,t){var i=RES.getRes(e);i.play(0,t)},e.stop=function(){null!=e.channel&&(e.channel.stop(),e.channel=null)},e}();__reflect(CommonAudioHandle.prototype,"CommonAudioHandle");var CommonButtonHandle=function(){function e(){}return e.beginTouch=function(t,i){t.addEventListener(egret.TouchEvent.TOUCH_BEGIN,e.onButtonClickBegin,i),t.addEventListener(egret.TouchEvent.TOUCH_END,e.onButtonClickEnd,i),t.addEventListener(egret.TouchEvent.TOUCH_MOVE,e.onButtonClickEnd,i)},e.onButtonClickBegin=function(e){e.target.scaleX="0.9",e.target.scaleY="0.9",CommonAudioHandle.playEffect("playBomb_mp3",1)},e.onButtonClickEnd=function(e){e.target.scaleX="1",e.target.scaleY="1"},e}();__reflect(CommonButtonHandle.prototype,"CommonButtonHandle");var CommonTools=function(){function e(){}return e.addShapeBG=function(e,t){var i=new egret.Shape;return i.graphics.beginFill(2301984,.6),i.graphics.drawRect(0,0,e,t),i.graphics.endFill(),i},e.niceTip=function(e,t,i){if(1==t){e.scaleX=.5,e.scaleY=.5;var n=1,o=1;ConstValue.deviveNormalScale>2&&(n=ConstValue.deviveScale,o=ConstValue.deviveScale);var s=egret.Tween.get(e);s.to({scaleX:1,scaleY:1},90),s.to({scaleX:1.05,scaleY:1.05},80),s.to({scaleX:n,scaleY:n},100)}else{var s=egret.Tween.get(e);s.to({scaleX:1.05,scaleY:1.05},100),s.to({scaleX:0,scaleY:0,visible:!1},200),s.call(function(){i.closeNice()},this)}},e.fixFix=function(e,t,i,n,o){var s=750,a=e.getStageHeight(),l=a/s;ConstValue.deviveScale=l;var r=1*e.getClientWidth()/e.getClientHeight();if(ConstValue.deviveNormalScale=r,!(2>r)){var h=0,u=0;if(1==i?h=t.y:2==i?u=s-t.y:3==i&&(u=s-t.y),t.scaleX=l,t.scaleY=l,1==i){var c=(1-l)/2;t.y=h*l+a*c+o,t.x=t.x+n}else if(2==i){var c=(1-l)/2;t.y=a-u*l+a*c+o,t.x=t.x+n}}},e.addCommonTips=function(e,t){var i=e.stage.stageWidth,n=e.stage.stageHeight,o=new eui.Panel;o.skinName="resource/eui_skins/UserUI/CommonTips.exml";var s=i/2-o.width/2,a=n/2-o.height/2;o.x=s,o.y=a;var l=o.getChildByName("lb_tips_txt");l.text=t,e.addChild(o);var r=function(){e.removeChild(o)},h=a-120,u=egret.Tween.get(o);u.to({y:h},500),u.wait(1e3),u.call(r)},e.getDataJsonStr=function(e,t,i){var n={};return n.f=e,n.s=t,n.d=i,JSON.stringify(n)},e.getAnimDraw=function(e,t,i){var n,o=new egret.MovieClipDataFactory(e,t);return n=""==i?new egret.MovieClip(o.generateMovieClipData()):new egret.MovieClip(o.generateMovieClipData(i))},e.deepCopyMap=function(e){var t={};for(var i in e){var n=e[i];t[i]=n}return t},e.printMap=function(e){if(ConstValue.p_is_PRINT_MAP){console.log("-----startMap------");var t=0;for(var i in e){e[i];console.log("-----srcMap--key----"+i),t++}console.log("-----endMap------len:"+t)}},e.printObject=function(e){var t="";for(var i in e){var n=e[i];t+=i+" = "+n+"\n"}console.log("-----printObject------description:"+t)},e.getRandomFloor=function(e,t){return t?Math.floor(Math.random()*e):Math.floor(Math.random()*e==0?1:Math.random()*e)},e.log=function(e){ConstValue.P_IS_INNER&&console.log(e)},e.logError=function(e){ConstValue.p_is_PRINT_ERROR&&console.log(e)},e.logDebug=function(e){ConstValue.p_is_PRINT_DEBUG&&console.log(e)},e.logAI=function(e){ConstValue.p_is_PRINT_AI&&console.log(e)},e.logAIPath=function(e){ConstValue.p_is_PRINT_AI_PATH&&console.log(e)},e.resourceMgr=new ResourceUtils,e}();__reflect(CommonTools.prototype,"CommonTools");var ConstValue=function(){function e(){}return e.P_BAR_LABEL="资源加载中",e.P_BAR_LABEL2="^_^.每个场景部分地图较大，首次加载可能需要几分钟  喝杯茶吧，以后再次加载将会秒速进入",e.P_BAR_LABEL3="资源加载中",e.P_NULL_ACCOUNT="请输入账号",e.P_NULL_PASSWORD="请输入密码",e.P_NULL_INVITE="请输入推广号",e.P_NULL_VERIFY="请输入验证码",e.P_SEND_VERIFY="验证码发送成功",e.P_SEND_MODIFY_SUCCESS="修改成功",e.P_SEND_REGISTE_SUCCESS="注册成功",e.P_SEND_REGISTE_FAIL="用户名已存在",e.P_SEND_LOGIN_FAIL="用户名或密码错误",e.P_SEND_LOGIN_SUCCESS="登录成功",e.P_SEND_WAITING="敬请期待",e.P_SEND_HALLBACK_FAIL="网络异常，进入大厅失败",e.P_COPY_SUCCESS="复制成功",e.P_MODIFY_NULL_FAIL="修改内容不能为空",e.P_MODIFY_TITLE="信息",e.P_MODIFY_NICHENG="修改昵称：",e.P_MODIFY_OLD_PWD="旧密码：",e.P_MODIFY_NEW_PWD="新密码：",e.P_MODIFY_REALNAME="修改名字：",e.P_MODIFY_WX="修改微信：",e.P_MODIFY_BEGET="修改比例：",e.P_MODIFY_FAIL="修改失败，请稍后再试",e.P_MODIFY_PWD_FAIL="新密码2次输入有误",e.P_ENTER_ROOM_FAIL="进入房间失败",e.P_WAIT_NEXT="请等待下轮开始",e.P_IS_DEBUG=!1,e.P_IS_INNER=!0,e.p_is_PRINT_ERROR=!0,e.p_is_PRINT_DEBUG=!1,e.p_is_PRINT_AI=!1,e.p_is_PRINT_AI_PATH=!1,e.p_is_PRINT_MAP=!1,e.p_LOGIN_MODEL=1,e.P_NET_OBJ=null,e.P_LOGIN_OBJ=null,e.P_HALL_OBJ=null,e.P_FIGHT_OBJ=null,e.P_MAP_OBJ=null,e.P_CONTEXT=null,e.P_CONFIG=null,e.cacheUserAccount="",e.cacheUserPwd="",e.cacheHasLoginSuccess=!1,e.cacheUserInfo=null,e.cacheKeyGroup={},e.gatewayType=0,e.deviveScale=1,e.deviveNormalScale=1.7,e.role_select_img={0:"role_select_p1_png",1:"role_select_p2_png",2:"role_select_p1_png"},e}();__reflect(ConstValue.prototype,"ConstValue");var EBitUtil=function(){function e(){}return e.isSetBit=function(e,t){return t>31?!1:(e&1<<t)>0},e.SetBit=function(e,t){return t>31?e:e|1<<t},e.ClearBit=function(e,t){return t>31?e:e&~(1<<t)},e.getArr=function(e){var t=[];for(e.position=0;e.bytesAvailable>0;)t.push(e.readByte());return t},e}();__reflect(EBitUtil.prototype,"EBitUtil");var LoadingUI=function(e){function t(t,i,n){var o=e.call(this)||this;return o.iScreenWidth=t,o.iScreenHeight=i,o.context=n,o.createView(),o}return __extends(t,e),t.prototype.createView=function(){if(null==ConstValue.cacheKeyGroup.preload){CommonTools.log("=====================not load preload ,use mask");var e=new egret.Shape;e.graphics.beginFill(0,1),e.graphics.drawRect(0,0,this.iScreenWidth,this.iScreenHeight),e.graphics.endFill(),this.addChild(e)}else{if(CommonTools.log("=====================load preload ,use ui"),null==ConstValue.P_LOGIN_OBJ){var t=new eui.Image("login_bg_ppt_png");t.width=this.iScreenWidth,t.height=this.iScreenHeight,this.addChild(t)}this.pBar=new eui.ProgressBar,this.pBar.maximum=100,this.pBar.minimum=0,this.pBar.width=544,this.pBar.height=104,this.addChild(this.pBar),this.pBar.value=0,this.pBar.x=400,this.pBar.y=600,this.pBar.labelFunction=this.barLabelFunction,CommonTools.fixFix(this.context,this.pBar,2,40,0)}this.textField3=new egret.TextField,this.addChild(this.textField3),this.textField3.y=620,this.textField3.x=420,this.textField3.width=480,this.textField3.height=100,this.textField3.size=20,this.textField3.textAlign="center",null!=ConstValue.cacheKeyGroup.preload&&(this.textField3.textColor=519),CommonTools.fixFix(this.context,this.textField3,2,40,0)},t.prototype.barLabelFunction=function(e,t){return""},t.prototype.onProgress=function(e,t){var i=e/(1*t)*100;i=Math.ceil(i),null!=this.pBar&&(this.pBar.value=i),this.textField3.text=ConstValue.P_BAR_LABEL3+"...("+i+"%)"},t}(egret.Sprite);__reflect(LoadingUI.prototype,"LoadingUI",["RES.PromiseTaskReporter"]);var AssetAdapter=function(){function e(){}return e.prototype.getAsset=function(e,t,i){function n(n){t.call(i,n,e)}if(RES.hasRes(e)){var o=RES.getRes(e);o?n(o):RES.getResAsync(e,n,this)}else RES.getResByUrl(e,n,this,RES.ResourceItem.TYPE_IMAGE)},e}();__reflect(AssetAdapter.prototype,"AssetAdapter",["eui.IAssetAdapter"]);var WebSocketUtil=function(e){function t(t){var i=e.call(this)||this;return i.zipAndAes=!0,i.ip="134.175.171.37",i.ipUrl="wss://www.iogood.cn:441",i.zipPort=18024,i.freePort=8011,i.sCurData="",i.text="TestWebSocket",i.protoId=1,i.sCurData=t,i.initWebSocket(),i.timer=new egret.Timer(3e4,0),i.timer.addEventListener(egret.TimerEvent.TIMER,i.timerFunc,i),i.timer.addEventListener(egret.TimerEvent.TIMER_COMPLETE,i.timerComFunc,i),i.timer.start(),i}return __extends(t,e),t.prototype.socketConnect=function(){this.zipAndAes?1==ConstValue.p_LOGIN_MODEL?this.socket.connect(this.ip,this.zipPort):2==ConstValue.p_LOGIN_MODEL&&this.socket.connectByUrl(this.ipUrl):this.socket.connect(this.ip,this.freePort)},t.prototype.timerFunc=function(){if(CommonTools.log("计时"),t.reloginCnt>=5&&!this.socket.connected)return this.timer.stop(),void this.outLogin();if(this.socket.connected){var e=new egret.ByteArray;e.writeByte(0),e.writeByte(0),e.position=0,this.socket.writeBytes(e,0,e.bytesAvailable),CommonTools.log("======heart beat==========sendData... "+e.bytesAvailable+" byte.toString:"+this.Bytes2Str(e.bytes))}else t.reloginCnt++,this.socketConnect()},t.prototype.timerComFunc=function(){CommonTools.log("计时结束")},t.prototype.initStateText=function(){this.stateText=new egret.TextField,this.stateText.size=22,this.stateText.text=this.text,this.stateText.width=480,this.addChild(this.stateText)},t.prototype.initWebSocket=function(){CommonTools.log("==============initWebSocket"),this.socket=new egret.WebSocket,this.socket.type=egret.WebSocket.TYPE_BINARY,this.socket.addEventListener(egret.ProgressEvent.SOCKET_DATA,this.onReceiveMessage,this),this.socket.addEventListener(egret.Event.CONNECT,this.onSocketOpen,this),this.socket.addEventListener(egret.Event.CLOSE,this.onSocketClose,this),this.socket.addEventListener(egret.IOErrorEvent.IO_ERROR,this.onSocketError,this),this.socketConnect()},t.prototype.trim=function(e){return e.replace(/(^\s*)|(\s*$)/g,"")},t.prototype.makeJsonObj=function(e){var t=e.replace(/{/g,"").replace(/}/g,""),i=t.split(","),n={};for(var o in i){var s=i[o].split(":");n[s[0]]=s[1]}},t.prototype.handleRecJsonStr=function(e){try{var t=JSON.parse(e);switch(t.f){case"register":case"login":case"entergame":case"loginWX":ConstValue.P_LOGIN_OBJ.handlePacket(t);break;case"gmFunc":case"WaitingInfo":case"syncMapData":case"openRnakUI":case"getTotalPvpRank":case"getTotalLvRank":case"openDiyMapUI":case"openShopUI":case"openBagUI":case"Buy":case"C2GOpenWujinUI":case"C2GGotoBarrier":case"SeventDayReward":case"open1V1Room":case"open1V1RoomByMap":case"showMatch1v1RoomUI":case"Room1v1Dismiss":case"showAllClassList":case"reflashClassList":ConstValue.P_HALL_OBJ.handlePacket(t);break;case"refreshInfo":null!=ConstValue.cacheUserInfo&&(ConstValue.cacheUserInfo=t.d);break;case"notify":CommonTools.addCommonTips(ConstValue.P_CONTEXT,t.d.tips);break;case"syncPosBroadcase":case"syncPut":case"syncBoomZhuan":case"syncpickItem":case"gameResult":case"gameGuanKaResult":ConstValue.P_FIGHT_OBJ.handlePacket(t);break;case"getMyMaps":null==ConstValue.P_MAP_OBJ?ConstValue.P_HALL_OBJ.handlePacket(t):ConstValue.P_MAP_OBJ.handlePacket(t);break;case"saveMap":case"getNewRank":case"getHopRank":ConstValue.P_MAP_OBJ.handlePacket(t)}}catch(i){CommonTools.log("handleRecJsonStr====error====="+e),CommonTools.log("handleRecJsonStr====error====="+i)}},t.prototype.out_relogin=function(){ConstValue.P_HALL_OBJ?ConstValue.P_NET_OBJ.relogin():ConstValue.P_NET_OBJ.relogin2()},t.prototype.sendData=function(e){if(this.sCurData=e,!this.socket.connected)return this.socketConnect(),void this.out_relogin();var t=function(e){return new Blob([e]).size};if(CommonTools.log(" ====11111 "+this.bToString(this.stringToByte(e))),this.zipAndAes){var i=new egret.ByteArray;i.endian=egret.Endian.LITTLE_ENDIAN,i.writeByte(0),i.writeByte(0),i.writeByte(1),this.protoId+=1,i.writeUnsignedShort(this.protoId),i.endian=egret.Endian.BIG_ENDIAN;for(var n=this.stringToByte(e),o=0;o<n.length;o++)i.writeByte(n[o]);i.position=0;var s=JSZip.compressions.DEFLATE.compressgzip(i.bytes,{level:6}),a=new egret.ByteArray;a._writeUint8Array(s),a.position=0;var l=new egret.ByteArray;l.endian=egret.Endian.LITTLE_ENDIAN,l.writeUnsignedShort(a.bytesAvailable),i.endian=egret.Endian.BIG_ENDIAN,l.writeBytes(a),l.position=0,this.socket.writeBytes(l,0,l.bytesAvailable)}else{var i=new egret.ByteArray;i.endian=egret.Endian.LITTLE_ENDIAN,i.writeUnsignedShort(t(e)+5),i.writeByte(0),i.writeByte(0),i.writeByte(1),this.protoId+=1,i.writeUnsignedShort(this.protoId),i.endian=egret.Endian.BIG_ENDIAN,i.writeUTFBytes(e),i.position=0,this.socket.writeBytes(i,0,i.bytesAvailable)}this.sCurData=""},t.prototype.sendData2=function(e){if(this.sCurData=e,!this.socket.connected)return this.socketConnect(),void this.out_relogin();var t=function(e){return new Blob([e]).size};if(CommonTools.log(" ====11111 "+this.bToString(this.stringToByte(e))),this.zipAndAes){var i=new egret.ByteArray;i.endian=egret.Endian.LITTLE_ENDIAN,i.writeByte(0),i.writeByte(1),i.writeByte(1),this.protoId+=1,i.writeUnsignedShort(this.protoId),i.endian=egret.Endian.BIG_ENDIAN;for(var n=this.stringToByte(e),o=0;o<n.length;o++)i.writeByte(n[o]);i.position=0;var s=JSZip.compressions.DEFLATE.compressgzip(i.bytes,{level:6}),a=new egret.ByteArray;a._writeUint8Array(s),a.position=0;var l=new egret.ByteArray;l.endian=egret.Endian.LITTLE_ENDIAN,l.writeUnsignedShort(a.bytesAvailable),i.endian=egret.Endian.BIG_ENDIAN,l.writeBytes(a),l.position=0,this.socket.writeBytes(l,0,l.bytesAvailable)}else{var i=new egret.ByteArray;i.endian=egret.Endian.LITTLE_ENDIAN,i.writeUnsignedShort(t(e)+5),i.writeByte(0),i.writeByte(1),i.writeByte(1),this.protoId+=1,i.writeUnsignedShort(this.protoId),i.endian=egret.Endian.BIG_ENDIAN,i.writeUTFBytes(e),i.position=0,this.socket.writeBytes(i,0,i.bytesAvailable)}this.sCurData=""},t.prototype.Bytes2Str=function(e){for(var t="",i=0;i<e.length;i++){var n=e[i].toString(16);1==n.length&&(n="0"+n),t+=i==e.length-1?n:n+"-"}return t},t.prototype.Bytes2Str2=function(e){for(var t="",i=0;i<e.length;i++)t+=i==e.length-1?e[i]+"":e[i]+"-";return t},t.prototype.Bytes2StrNoFix=function(e){for(var t="",i=0;i<e.length;i++){var n=e[i].toString(16);1==n.length&&(n="0"+n),t+=n}return t},t.prototype.stringToByte=function(e){var t,i,n=new Array;t=e.length;for(var o=0;t>o;o++)i=e.charCodeAt(o),i>=65536&&1114111>=i?(n.push(i>>18&7|240),n.push(i>>12&63|128),n.push(i>>6&63|128),n.push(63&i|128)):i>=2048&&65535>=i?(n.push(i>>12&15|224),n.push(i>>6&63|128),n.push(63&i|128)):i>=128&&2047>=i?(n.push(i>>6&31|192),n.push(63&i|128)):n.push(255&i);return n},t.prototype.bToString=function(e){if("string"==typeof e)return e;for(var t="",i=e,n=0;n<i.length;n++){var o=i[n].toString(2),s=o.match(/^1+?(?=0)/);if(s&&8==o.length){for(var a=s[0].length,l=i[n].toString(2).slice(7-a),r=1;a>r;r++)l+=i[r+n].toString(2).slice(2);t+=String.fromCharCode(parseInt(l,2)),n+=a-1}else t+=String.fromCharCode(i[n])}return t},t.prototype.outLogin=function(){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),null!=ConstValue.P_HALL_OBJ&&ConstValue.P_HALL_OBJ.clear(),null!=ConstValue.P_FIGHT_OBJ&&ConstValue.P_FIGHT_OBJ.clear2(),[4,ConstValue.P_CONTEXT.loadResource("pre_preload",1)];case 1:return t.sent(),[3,3];case 2:return e=t.sent(),CommonTools.log("outLogin-----------back console"),[3,3];case 3:return[2]}})})},t.prototype.relogin=function(){t.reloginCnt++;var e=CommonTools.getDataJsonStr("relogin",1,{pid:ConstValue.cacheUserInfo.id,token:ConstValue.cacheUserInfo.token});this.sendData(e)},t.prototype.relogin2=function(){t.reloginCnt++;var e=CommonTools.getDataJsonStr("relogin",1,{pid:ConstValue.cacheUserInfo.id,token:ConstValue.cacheUserInfo.token});this.sendData2(e)},t.prototype.onSocketOpen=function(){t.reloginCnt=0,CommonTools.log("================onSocketOpen..."),""!=this.sCurData&&this.sendData(this.sCurData)},t.prototype.onSocketClose=function(){CommonTools.log("------onSocketClose"),this.out_relogin()},t.prototype.onSocketError=function(){CommonTools.log("------onSocketError")},t.prototype.onReceiveMessage=function(e){var t=new egret.ByteArray;if(this.socket.readBytes(t),t.length>2){t.endian=egret.Endian.LITTLE_ENDIAN;var i=t.readShort();if(this.zipAndAes){for(var n=new egret.ByteArray,o=2;o<t.bytes.length;o++)n.writeByte(t.bytes[o]);n.position=0;var s=SnappyJS.uncompress(n.bytes),a=new egret.ByteArray(s);a.endian=egret.Endian.LITTLE_ENDIAN;a.readByte(),a.readByte(),a.readByte(),a.readShort();a.endian=egret.Endian.BIG_ENDIAN;var l=a.readUTFBytes(a.bytesAvailable);CommonTools.log("------onReceiveMessage 收到数据:"+l),this.handleRecJsonStr(l)}else{t.readByte(),t.readByte(),t.readShort();t.endian=egret.Endian.BIG_ENDIAN;var l=t.readUTFBytes(t.bytesAvailable);CommonTools.log("------onReceiveMessage 收到数据:"+l),CommonTools.log("------onReceiveMessage 收到数据: iLen "+i)}}else CommonTools.log("------onReceiveMessage length<=2---")},t.prototype.trace=function(e){this.text=this.text+"\n"+e,this.stateText.text=this.text,egret.log(e)},t.reloginCnt=0,t}(egret.DisplayObjectContainer);__reflect(WebSocketUtil.prototype,"WebSocketUtil");var FightingModule=function(){function e(e){this.pMainRole="",this.p1=119,this.p2=120,this.controlerHit_x=28,this.controlerHit_y=183,this.r=104,this.controlerHit_x_c=132,this.controlerHit_y_c=287,this.initRow=7,this.initColumn=9,this.firstItemX=167,this.firstItemY=134,this.groundItemW=82,this.groundItemH=82,this.groundOffX=-25,this.groundOffY=-28,this.APP_MODE=1,this.FIGHT_MODE=1,this.scaleX=1,this.scaleY=1,this.playerData=null,this.playerLen=0,this.curPlayer=null,this.vsPanel=null,this.resultPanel=null,this.miniGamePanel=null,this.otherCount=0,this.counterTimer=null,this.countDown=3,this.backBtn=null,this.initCnt=0,this.testGround=[1,1,1,1,1,1,2,2,1,1,1,1,1,1,1,2,1,2,1,1,1,3,1,1,2,2,1,3,2,2,1,1,1,2,2,3,1,1,3,1,1,1,2,2,1,1,2,1,1,1,1,2,3,2,1,1,1,1,1,1,2,3,2],this.testMap=[1,1,1,1,1,1,2,6,1,1,119,1,1,1,1,2,6,1,1,1,1,1,1,1,2,6,1,3,2,2,1,1,120,2,6,1,1,1,13,1,1,1,2,6,1,1,9,6,1,1,1,2,6,1,1,12,11,1,1,1,2,6,1],this.testGround2=[1,1,1,1,1,1,2,2,1,1,1,1,1,1,1,1,1,2,1,2,1,1,1,1,1,3,1,1,2,2,1,1,1,3,2,2,1,1,1,2,2,3,1,1,1,1,3,1,1,1,2,2,1,1,1,1,2,1,1,1,1,2,3,2,1,1,1,1,1,1,1,1,2,3,2,1,1,1,1,1,1,1,1,2,3,2,1,1,1,1,1,1,1,1,2,3,2,1,1],this.testMap2=[0,0,0,0,0,0,0,0,5,6,0,0,119,0,0,0,0,0,6,5,6,0,0,0,0,0,0,0,0,6,5,6,0,0,0,0,0,0,120,0,6,5,6,0,0,0,13,0,0,0,0,6,5,6,0,0,9,6,0,0,0,0,0,0,0,0,0,9,6,0,0,0,0,6,5,6,0,0,9,6,0,0,0,0,6,5,6,0,0,12,11,0,0,0,0,6,5,6,0],CommonAudioHandle.play("mainmenu_mp3",0),CommonTools.log("=init===1=========="),this.context=e,this.maskBg=new eui.Image("bg_ppt_1_png"),this.maskBg.width=this.context.getStageWidth(),this.maskBg.height=this.context.getStageHeight(),this.context.addChild(this.maskBg),this.panel=new eui.Panel,this.panel.skinName="resource/eui_skins/UserUI/fightingUI.exml",this.panel.title="Title",this.panel.horizontalCenter=0,this.panel.verticalCenter=0,this.context.addChild(this.panel),this.backBtn=new eui.Image("btn_back_png"),this.backBtn.width=60,this.backBtn.height=60,this.backBtn.x=44,this.backBtn.y=10,this.backBtn.name="back_btn",this.context.addChild(this.backBtn),this.backBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.infoPanel=new eui.Panel,this.infoPanel.skinName="resource/eui_skins/UserUI/FightInfoGroup.exml",this.infoPanel.title="TitleInfo",this.infoPanel.x=0,this.infoPanel.y=110,this.infoPanel.scaleX=.6,this.infoPanel.scaleY=.6,this.context.addChild(this.infoPanel),CommonTools.log("=init===2=========="),CommonTools.fixFix(this.context,this.panel,1,0,0),this.initConfig(),ConstValue.gatewayType=1,Main.roomkey=null}return e.prototype.initConfig=function(){LZMA.decompress(EBitUtil.getArr(new egret.ByteArray(RES.getRes("config_json"))),function(e){ConstValue.P_CONFIG=JSON.parse(e)},function(e){})},e.prototype.initMapData=function(e){this.APP_MODE=e.map_mode,this.FIGHT_MODE=e.fight_mode,this.testGround=e.bgConf,this.testMap=e.layerConf,this.playerData=e.player},e.prototype.setControl=function(e,t){var i=Math.atan2(t-this.controlerHit_y_c,e-this.controlerHit_x_c),n=i*(180/Math.PI),o=this.controlerHit_x+this.r*Math.cos(3.14*n/180),s=this.controlerHit_y+this.r*Math.sin(3.14*n/180);this.controlerHit.x=o,this.controlerHit.y=s},e.prototype.myKeyDown=function(e){if(CommonTools.logDebug("keydown =====code:"+e.keyCode),87==e.keyCode||83==e.keyCode||65==e.keyCode||68==e.keyCode){var t=ConstValue.P_FIGHT_OBJ.getMainPlayer();t.keyDir!=e.keyCode&&(null!=t.func&&(t.setMoving(!1),t.removeEventListener(egret.Event.ENTER_FRAME,t.func,t),t.func=null),t.func=function(e){t.setMoving(!0),t.move(-1,!0)
},t.addEventListener(egret.Event.ENTER_FRAME,t.func,t),t.keyDir=e.keyCode),87==e.keyCode&&(t.setMoving(!0),t.move(0,!1)),83==e.keyCode&&(t.setMoving(!0),t.move(2,!1)),65==e.keyCode&&(t.setMoving(!0),t.move(3,!1)),68==e.keyCode&&(t.setMoving(!0),t.move(1,!1))}if(74==e.keyCode){var i=ConstValue.P_FIGHT_OBJ.getMainPlayer();i.markPosition(-1);var n=CommonTools.getDataJsonStr("syncPut",1,{x:i.x,y:i.y,idx:parseInt(i.curMapIdx),playerID:0});ConstValue.P_NET_OBJ.sendData2(n)}},e.prototype.myKeyUp=function(t){if(CommonTools.logDebug("keyup =====code:"+t.keyCode),87==t.keyCode||83==t.keyCode||65==t.keyCode||68==t.keyCode){ConstValue.P_FIGHT_OBJ.controlerHit.x=ConstValue.P_FIGHT_OBJ.controlerHit_x,ConstValue.P_FIGHT_OBJ.controlerHit.y=ConstValue.P_FIGHT_OBJ.controlerHit_y;var i=ConstValue.P_FIGHT_OBJ.getMainPlayer();if(i.setMoving(!1),i.removeEventListener(egret.Event.ENTER_FRAME,i.func,i),i.func=null,i.keyDir=-1,!e.aiPVE){var n=CommonTools.getDataJsonStr("syncPos",1,{x:i.x,y:i.y,direction:-1,speed:i.speed,idx:parseInt(i.curMapIdx),playerID:0});ConstValue.P_NET_OBJ.sendData2(n)}}},e.prototype.initScene=function(){if(!(this.initCnt>0)){this.initCnt++,2==this.APP_MODE&&(this.initRow=9,this.initColumn=11,this.scaleX=.8,this.scaleY=.8),e.groundLayer=this.panel.getChildByName("fighting_parent").getChildByName("ground_layer"),e.playerLayer=this.panel.getChildByName("fighting_parent").getChildByName("player_layer"),e.bulletLayer=this.panel.getChildByName("fighting_parent").getChildByName("bullet_layer"),e.mapLayer=this.panel.getChildByName("fighting_parent").getChildByName("map_layer"),2==this.APP_MODE?(this.panel.getChildByName("fighting_parent").getChildByName("fighting_platform").width=802,this.panel.getChildByName("fighting_parent").getChildByName("fighting_platform").height=670,this.panel.getChildByName("fighting_parent").x=156,this.panel.getChildByName("fighting_parent").y=-50):1==this.APP_MODE&&(this.panel.getChildByName("fighting_parent").x=145,this.panel.getChildByName("fighting_parent").y=-45),this.controlerParent=this.panel.getChildByName("controler_parent"),this.controlerHit=this.panel.getChildByName("controler_parent").getChildByName("controler_hit_btn"),this.panel.getChildByName("test").addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){var t=CommonTools.getDataJsonStr("test",1,{v:1});ConstValue.P_NET_OBJ.sendData2(t)},this),this.panel.getChildByName("boom_btn").addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){var t=this.getMainPlayer();t.markPosition(-1);var i=CommonTools.getDataJsonStr("syncPut",1,{x:t.x,y:t.y,idx:parseInt(t.curMapIdx),playerID:0});ConstValue.P_NET_OBJ.sendData2(i)},this),this.controlerParent.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(e){var t=this.getMainPlayer();null!=t.func&&(t.setMoving(!1),t.removeEventListener(egret.Event.ENTER_FRAME,t.func,t),t.func=null),t.func=function(e){t.setMoving(!0),t.move(-1,!0)},t.addEventListener(egret.Event.ENTER_FRAME,t.func,t)},this),document.addEventListener("keydown",this.myKeyDown),document.addEventListener("keyup",this.myKeyUp),this.controlerParent.addEventListener(egret.TouchEvent.TOUCH_END,function(t){this.controlerHit.x=this.controlerHit_x,this.controlerHit.y=this.controlerHit_y;var i=this.getMainPlayer();if(i.setMoving(!1),i.removeEventListener(egret.Event.ENTER_FRAME,i.func,i),i.func=null,!e.aiPVE){var n=CommonTools.getDataJsonStr("syncPos",1,{x:i.x,y:i.y,direction:-1,speed:i.speed,idx:parseInt(i.curMapIdx),playerID:0});ConstValue.P_NET_OBJ.sendData2(n)}},this),this.controlerParent.addEventListener(egret.TouchEvent.TOUCH_MOVE,function(e){CommonTools.log("=e.localX, e.localY========x:::="+e.localX+" y:::"+e.localY);var t=this.getMainPlayer();e.localX>=this.controlerHit_x_c&&e.localY>=this.controlerHit_y_c?e.localX-this.controlerHit_x_c>=e.localY-this.controlerHit_y_c?(CommonTools.log("四-------右"),t.setMoving(!0),t.move(1,!1)):(CommonTools.log("四-------下"),t.setMoving(!0),t.move(2,!1)):e.localX>=this.controlerHit_x_c&&e.localY<=this.controlerHit_y_c?e.localX-this.controlerHit_x_c>=this.controlerHit_y_c-e.localY?(CommonTools.log("一-------右"),t.setMoving(!0),t.move(1,!1)):(CommonTools.log("一-------上"),t.setMoving(!0),t.move(0,!1)):e.localX<=this.controlerHit_x_c&&e.localY<=this.controlerHit_y_c?this.controlerHit_x_c-e.localX>=this.controlerHit_y_c-e.localY?(CommonTools.log("二-------左"),t.setMoving(!0),t.move(3,!1)):(CommonTools.log("二-------上"),t.setMoving(!0),t.move(0,!1)):e.localX<=this.controlerHit_x_c&&e.localY>=this.controlerHit_y_c&&(this.controlerHit_x_c-e.localX>=e.localY-this.controlerHit_y_c?(CommonTools.log("三-------左"),t.setMoving(!0),t.move(3,!1)):(CommonTools.log("三-------下"),t.setMoving(!0),t.move(2,!1))),this.setControl(e.localX,e.localY)},this);for(var t=0,i=0;i<this.initRow;i++)for(var n=0;n<this.initColumn;n++){var o=this.groundItemW,s=this.groundItemH,a=this.groundOffX,l=this.groundOffY;2==this.APP_MODE&&n>0&&(a=-32,o=this.groundItemW*this.scaleX),2==this.APP_MODE&&i>0&&(l=-32,s=this.groundItemH*this.scaleY);var r=this.firstItemX+o*n+a,h=this.firstItemY+s*i+l,u={img:"res_"+this.testGround[t]+"_png",x:r,y:h,name:"ground_"+t,curIdx:t},c=new Fight.MapItem(u);c.setRow(i),c.setColumn(n),c.setType(ConstValue.P_CONFIG.MapBase[this.testGround[t].toString()].Type),2==this.APP_MODE&&(c.scaleX=this.scaleX,c.scaleY=this.scaleY),e.groundLayer.addChild(c),e.groundLayerSubObj[t.toString()]=c,e.groundLayerSubObjDanger[c.getColumn()+"_"+c.getRow()]=c;var d=-48;if(2==this.APP_MODE&&(d=-42),this.testMap[t]<=3&&(d=-9),this.testMap[t]>100&&this.playerLen<=this.getPlayerTotal()){this.playerLen++;var g={},m=null,p=!1;if(this.testMap[t]==this.p1){var _=this.getPlayerBySize(1),C=40,y=0;2==this.APP_MODE&&(C=28),g={pObj:_,side:1,x:r+C,y:h+y,name:"role1",isAI:_.isAI,iClass:_.iClass},p=!0}else{var _=this.getPlayerBySize(2),C=40,f=0;2==this.APP_MODE&&(C=28),g={pObj:_,side:2,x:r+C,y:h+f,name:"role2",isAI:_.isAI,iClass:_.iClass}}if(m=new Fight.Player(g),m.roleId==ConstValue.cacheUserInfo.id&&(this.curPlayer=m),2==this.APP_MODE&&(m.scaleX=this.scaleX,m.scaleY=this.scaleY),e.playerLayer.addChild(m),m.markPosition(-1),e.playerLayerSubObj[t.toString()]=m,1==m.isAI){var b=new AIUtil(m,this.testMap,this.initRow,this.initColumn,this.APP_MODE);e.aiSubObj[t.toString()]=b,e.aiPVE=!0}CommonTools.log("init player x,y "+m.x+" "+m.y)}else if(this.testMap[t]>0&&this.testMap[t]<100){var v={img:"res_"+this.testMap[t]+"_png",x:r,y:h+d,name:"mapitem_"+t,curIdx:t},T=new Fight.MapItem(v);T.setRow(i),T.setColumn(n),T.setType(ConstValue.P_CONFIG.MapBase[this.testMap[t].toString()].Type),2==this.APP_MODE&&(T.scaleX=this.scaleX,T.scaleY=this.scaleY),e.mapLayer.addChild(T),e.mapLayerSubObj[t.toString()]=T}t++}}},e.prototype.getPlayerBySize=function(e){for(var t in this.playerData){var i=this.playerData[t];if(i.player_side==e)return i}return null},e.prototype.getPlayerTotal=function(){var e=0;for(var t in this.playerData)e++;return e},e.prototype.onClick=function(e){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(i){switch(t=e.target.name,CommonTools.log("==========name::::"+t),t){case"replay_btn":case"replay_fail_btn":this.replay();break;case"replay_btn_guanka":this.replayGuanka();break;case"goback_btn":case"back_btn":case"goback_fail_btn":this.clear();break;default:CommonTools.log("11111111 default")}return[2]})})},e.prototype.showResultpanel=function(e,t,i){if(null==this.resultPanel){this.maskResultBg=new eui.Image("mask_layer_png"),this.maskResultBg.width=this.context.getStageWidth(),this.maskResultBg.height=this.context.getStageHeight(),this.context.addChild(this.maskResultBg),this.resultPanel=new eui.Panel,this.resultPanel.horizontalCenter=0,this.resultPanel.verticalCenter=0,this.resultPanel.skinName="resource/eui_skins/UserUI/FightResultUI.exml",this.context.addChild(this.resultPanel),CommonTools.fixFix(this.context,this.resultPanel,1,0,0);var n=this.resultPanel.getChildByName("replay_btn");CommonButtonHandle.beginTouch(n,this),n.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this);var o=this.resultPanel.getChildByName("goback_btn");CommonButtonHandle.beginTouch(o,this),o.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this);var s=this.resultPanel.getChildByName("share_btn");CommonButtonHandle.beginTouch(s,this),s.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this);var a=this.resultPanel.getChildByName("goback_fail_btn");CommonButtonHandle.beginTouch(a,this),a.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this);var l=this.resultPanel.getChildByName("replay_fail_btn");CommonButtonHandle.beginTouch(l,this),l.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.resultPanel.getChildByName("gold_lb").text=i.coin;var r=this.resultPanel.getChildByName("gold_add_img_01"),h=this.resultPanel.getChildByName("gold_add_img_02"),u=this.resultPanel.getChildByName("gold_add_img_03");if(i.addcoin<10)h.visible=!1,u.visible=!1,r.source="digital_1_json."+i.addcoin;else if(i.addcoin<100){u.visible=!1;var c=Math.floor(i.addcoin/10),d=i.addcoin%10;r.source="digital_1_json."+c,h.source="digital_1_json."+d}else{var g=Math.floor(i.addcoin/100),m=i.addcoin%100,c=Math.floor(m/10),d=m%10;r.source="digital_1_json."+g,h.source="digital_1_json."+c,u.source="digital_1_json."+d}var p=this.resultPanel.getChildByName("exp_add_img_01"),_=this.resultPanel.getChildByName("exp_add_img_02"),C=this.resultPanel.getChildByName("exp_add_img_03");if(i.addExp<10)_.visible=!1,C.visible=!1,p.source="digital_2_json."+i.addExp;else if(i.addExp<100){C.visible=!1;var c=Math.floor(i.addExp/10),d=i.addExp%10;p.source="digital_2_json."+c,_.source="digital_2_json."+d}else{var g=Math.floor(i.addExp/100),m=i.addExp%100,c=Math.floor(m/10),d=m%10;p.source="digital_2_json."+g,_.source="digital_2_json."+c,C.source="digital_2_json."+d}var y=this.resultPanel.getChildByName("win_title_img");0==i.win?(y.source=RES.getRes("fail_png"),CommonAudioHandle.playEffect("failure_mp3",1),n.visible=!1,s.visible=!1,o.visible=!1):(CommonAudioHandle.playEffect("success_mp3",1),a.visible=!1,l.visible=!1);var f=this.resultPanel.getChildByName("right_name_lb");f.text=t.name;var b=this.resultPanel.getChildByName("left_name_lb");b.text=e.name,CommonTools.niceTip(this.resultPanel,1,this)}},e.prototype.showGuanKaResultpanel=function(e,t,i){if(null==this.resultPanel){this.maskResultBg=new eui.Image("mask_layer_png"),this.maskResultBg.width=this.context.getStageWidth(),this.maskResultBg.height=this.context.getStageHeight(),this.context.addChild(this.maskResultBg),this.resultPanel=new eui.Panel,this.resultPanel.horizontalCenter=0,this.resultPanel.verticalCenter=0,this.resultPanel.skinName="resource/eui_skins/UserUI/FightGuanKaResultUI.exml",this.context.addChild(this.resultPanel),CommonTools.fixFix(this.context,this.resultPanel,1,0,0);var n=this.resultPanel.getChildByName("replay_btn_guanka");CommonButtonHandle.beginTouch(n,this),n.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this);var o=this.resultPanel.getChildByName("goback_btn");CommonButtonHandle.beginTouch(o,this),o.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this);var s=this.resultPanel.getChildByName("share_btn");CommonButtonHandle.beginTouch(s,this),s.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.resultPanel.getChildByName("gold_lb").text=i.coin;var a=this.resultPanel.getChildByName("gold_add_img_01"),l=this.resultPanel.getChildByName("gold_add_img_02"),r=this.resultPanel.getChildByName("gold_add_img_03");if(i.addcoin<10)l.visible=!1,r.visible=!1,a.source="digital_1_json."+i.addcoin;else if(i.addcoin<100){r.visible=!1;var h=Math.floor(i.addcoin/10),u=i.addcoin%10;a.source="digital_1_json."+h,l.source="digital_1_json."+u}else{var c=Math.floor(i.addcoin/100),d=i.addcoin%100,h=Math.floor(d/10),u=d%10;a.source="digital_1_json."+c,l.source="digital_1_json."+h,r.source="digital_1_json."+u}var g=this.resultPanel.getChildByName("exp_add_img_01"),m=this.resultPanel.getChildByName("exp_add_img_02"),p=this.resultPanel.getChildByName("exp_add_img_03");if(i.addExp<10)m.visible=!1,p.visible=!1,g.source="digital_2_json."+i.addExp;else if(i.addExp<100){p.visible=!1;var h=Math.floor(i.addExp/10),u=i.addExp%10;g.source="digital_2_json."+h,m.source="digital_2_json."+u}else{var c=Math.floor(i.addExp/100),d=i.addExp%100,h=Math.floor(d/10),u=d%10;g.source="digital_2_json."+c,m.source="digital_2_json."+h,p.source="digital_2_json."+u}var _=this.resultPanel.getChildByName("win_title_img");0==i.win?(_.source=RES.getRes("fail_png"),CommonAudioHandle.playEffect("failure_mp3",1)):CommonAudioHandle.playEffect("success_mp3",1);for(var C=1;C<=i.star;C++){var y=this.resultPanel.getChildByName("star_0"+C);y.source="barr_pass_start_png"}var f=this.resultPanel.getChildByName("lb_guanka");f.text=i.GuanKaDesc,CommonTools.niceTip(this.resultPanel,1,this)}},e.prototype.closeResultpanel=function(){null!=this.resultPanel&&(this.context.removeChild(this.resultPanel),this.resultPanel=null),null!=this.maskResultBg&&(this.context.removeChild(this.maskResultBg),this.maskResultBg=null)},e.prototype.closeNice=function(){},e.prototype.isAiVs=function(){for(var t in e.aiSubObj)return!0;return!1},e.prototype.showVsMiniGamepanel=function(){if(null==this.miniGamePanel){this.maskMiniBg=new eui.Image("fighting_vs_png"),this.maskMiniBg.width=this.context.getStageWidth(),this.maskMiniBg.height=this.context.getStageHeight(),this.context.addChild(this.maskMiniBg),this.miniGamePanel=new eui.Panel,this.miniGamePanel.horizontalCenter=0,this.miniGamePanel.verticalCenter=0,this.miniGamePanel.skinName="resource/eui_skins/UserUI/FightingVsMiniGameUI.exml",this.context.addChild(this.miniGamePanel),CommonTools.fixFix(this.context,this.miniGamePanel,1,0,0);var e=this.miniGamePanel.getChildByName("time_countdown"),t=(this.miniGamePanel.getChildByName("my_click_num_lb"),this.miniGamePanel.getChildByName("other_click_num_lb"));this.miniGamePanel.getChildByName("click_btn").addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){if(this.countDown>0)return void CommonTools.addCommonTips(this.context,"倒计时中...");var t=CommonTools.getDataJsonStr("normalClick",1,{});ConstValue.P_NET_OBJ.sendData2(t)},this),this.miniGamePanel.getChildByName("giveup_btn").addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){},this),this.miniGamePanel.getChildByName("use_btn").addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){},this),this.counterTimer=new egret.Timer(1e3,0),this.counterTimer.addEventListener(egret.TimerEvent.TIMER,function(){0==this.countDown?(e.visible=!1,0==this.otherCount?CommonTools.addCommonTips(this.context,"开始抢夺！！GO"):CommonTools.addCommonTips(this.context,"扑街，7头！！加油，加油...冇吃饭啊，丢"),this.isAiVs()&&(this.otherCount++,t.text=this.otherCount+" 对手")):(this.countDown--,e.text=this.countDown)},this),this.counterTimer.start()}},e.prototype.updateClickData=function(t){var i=this.miniGamePanel.getChildByName("my_click_num_lb"),n=this.miniGamePanel.getChildByName("other_click_num_lb");for(var o in e.playerLayerSubObj){var s=e.playerLayerSubObj[o];s.roleId==t.uid&&(1==s.whichSide?i.text=s.name+" "+t.click:n.text=s.name+" "+t.click)}},e.prototype.showVspanel=function(){null==this.vsPanel&&(this.maskVsBg=new eui.Image("fighting_vs_png"),this.maskVsBg.width=this.context.getStageWidth(),this.maskVsBg.height=this.context.getStageHeight(),this.context.addChild(this.maskVsBg),this.vsPanel=new eui.Panel,this.vsPanel.horizontalCenter=0,this.vsPanel.verticalCenter=0,this.vsPanel.skinName="resource/eui_skins/UserUI/FightingVsUI.exml",this.context.addChild(this.vsPanel),CommonTools.fixFix(this.context,this.vsPanel,1,0,0))},e.prototype.releaseVsPanel=function(){null!=this.vsPanel?this.vsPanel.getChildByName("match_tip").text="匹配成功":(this.showVspanel(),this.vsPanel.getChildByName("match_tip").text="匹配成功"),e.Delay(3e3,function(){if(null!=this.vsPanel&&(this.context.removeChild(this.vsPanel),this.vsPanel=null),null!=this.maskVsBg&&(this.context.removeChild(this.maskVsBg),this.maskVsBg=null),this.initScene(),null==this.miniGamePanel)for(var t in e.aiSubObj){var i=e.aiSubObj[t];i.startAI()}},this)},e.prototype.releaseMiniGamePanel=function(){null!=this.miniGamePanel&&(this.context.removeChild(this.miniGamePanel),this.miniGamePanel=null),null!=this.maskMiniBg&&(this.context.removeChild(this.maskMiniBg),this.maskMiniBg=null)},e.prototype.updateInfo=function(e){var t=e[ConstValue.cacheUserInfo.id];this.infoPanel.getChildByName("group_1").getChildByName("heart_num_lb").text=t.life,this.infoPanel.getChildByName("group_1").getChildByName("spead_num_lb").text=t.speed,this.infoPanel.getChildByName("group_1").getChildByName("boom_num_lb").text=t.paopaocount,this.infoPanel.getChildByName("group_1").getChildByName("fire_num_lb").text=t.power},e.prototype.getMainPlayer=function(){return this.curPlayer},e.prototype.getPlayerById=function(t){for(var i in e.playerLayerSubObj){var n=e.playerLayerSubObj[i];if(n.roleId==t)return n}return null},e.Delay=function(e,t,i){var n=new egret.Timer(e,1);n.addEventListener(egret.TimerEvent.TIMER,t,i),n.start()},e.prototype.getInitRow=function(){return this.initRow},e.prototype.getInitColumn=function(){return this.initColumn},e.prototype.syncMove=function(e){var t=this.getPlayerById(e.rid);if(!t.isMainPlayer)return t.x=e.x,t.y=e.y,-1==e.direction?void(null!=t.func&&(t.setMoving(!1),t.removeEventListener(egret.Event.ENTER_FRAME,t.func,t),t.func=null)):void(null==t.func?(t.func=function(e){t.setMoving(!0),t.move(-1,!0)},t.addEventListener(egret.Event.ENTER_FRAME,t.func,t),t.setMoving(!0),t.move(e.direction,!1)):(t.setMoving(!0),t.move(e.direction,!1)))},e.prototype.getMapObjByIdx=function(t){for(var i in e.mapLayerSubObj){var n=e.mapLayerSubObj[i];if(n.getCurIdx()==t)return n}return null},e.prototype.syncBoomZhuan=function(t){var i=this.getMapObjByIdx(t.breakidx);for(var n in e.aiSubObj){var o=e.aiSubObj[n];o.openBlock(i.getColumn(),i.getRow())}var s=CommonTools.getAnimDraw(RES.getRes("SpeedNet_json"),RES.getRes("SpeedNet_png"),"0");e.mapLayer.addChild(s);var a=i.x,l=i.y;s.x=a,s.y=l,e.mapLayer.removeChild(i),e.mapLayerSubObj[t.breakidx.toString()]=null,delete e.mapLayerSubObj[t.breakidx.toString()],s.scaleX=3,s.scaleY=3,s.x+=40,s.y+=70,s.play(1),s.once(egret.Event.COMPLETE,function(i){if(null!=t.effect.type){var n=null;1==t.effect.type?n=new eui.Image(RES.getRes("mini_res_json.mini_speed")):3==t.effect.type?n=new eui.Image(RES.getRes("mini_res_json.mini_weili")):2==t.effect.type&&(n=new eui.Image(RES.getRes("mini_res_json.mini_boom"))),e.groundLayerSubObj[t.breakidx.toString()].addSub(n,t.effect.type)}e.mapLayer.removeChild(s)},this)},e.prototype.clear=function(){return __awaiter(this,void 0,void 0,function(){var t,i,n;return __generator(this,function(o){switch(o.label){case 0:for(t in e.aiSubObj)i=e.aiSubObj[t],i.stopAI();return this.context.removeChild(this.backBtn),this.backBtn=null,n=CommonTools.getDataJsonStr("exitPPRoom",1,{}),ConstValue.P_NET_OBJ.sendData(n),this.closeResultpanel(),this.context.removeChild(this.panel),e.groundLayer.removeChildren(),e.groundLayer=null,e.playerLayer.removeChildren(),e.playerLayer=null,e.bulletLayer.removeChildren(),e.bulletLayer=null,e.mapLayer.removeChildren(),e.mapLayer=null,e.groundLayerSubObj={},e.playerLayerSubObj={},e.bulletLayerSubObj={},e.mapLayerSubObj={},e.groundLayerSubObjDanger={},this.context.dDataInfo=null,this.context.dDataInfo2=null,e.aiSubObj={},e.aiPVE=!1,document.removeEventListener("keydown",this.myKeyDown),document.removeEventListener("keyup",this.myKeyUp),[4,this.context.loadResource("preloadHall",2)];case 1:return o.sent(),ConstValue.P_FIGHT_OBJ=null,[2]}})})},e.prototype.clear2=function(){for(var t in e.aiSubObj){var i=e.aiSubObj[t];i.stopAI()}this.context.removeChild(this.backBtn),this.backBtn=null;var n=CommonTools.getDataJsonStr("exitPPRoom",1,{});ConstValue.P_NET_OBJ.sendData(n),this.closeResultpanel(),this.context.removeChild(this.panel),e.groundLayer.removeChildren(),e.groundLayer=null,e.playerLayer.removeChildren(),e.playerLayer=null,e.bulletLayer.removeChildren(),e.bulletLayer=null,e.mapLayer.removeChildren(),e.mapLayer=null,e.groundLayerSubObj={},e.playerLayerSubObj={},e.bulletLayerSubObj={},e.mapLayerSubObj={},e.groundLayerSubObjDanger={},this.context.dDataInfo=null,this.context.dDataInfo2=null,e.aiSubObj={},e.aiPVE=!1,document.removeEventListener("keydown",this.myKeyDown),document.removeEventListener("keyup",this.myKeyUp),ConstValue.P_FIGHT_OBJ=null},e.prototype.replay=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return this.clear(),[4,this.context.loadResource("fighting",3)];case 1:return e.sent(),[2]}})})},e.prototype.replayGuanka=function(){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(t){return this.clear(),e=CommonTools.getDataJsonStr("C2GGotoBarrier",1,{barrierNo:1}),ConstValue.P_NET_OBJ.sendData(e),[2]})})},e.prototype.handlePacket=function(t){if("syncPosBroadcase"==t.f)""!=t.m||1!=t.s||this.syncMove(t.d);else if("syncPut"==t.f)if(""!=t.m||1!=t.s);else{if(null==t.d.rid)return;var i=this.getPlayerById(t.d.rid);i.fire(t.d.paopaoID,t.d.idx)}else if("syncBoomZhuan"==t.f)if(""!=t.m||1!=t.s);else{if(null==t.d.breakidx)return;this.syncBoomZhuan(t.d)}else if("syncpickItem"==t.f)if(""!=t.m||1!=t.s);else{for(var n in t.d.player){var o=t.d.player[n],s=this.getPlayerById(o.uid);s.speed=o.speed,s.bulletLen=o.power}this.updateInfo(t.d.player),CommonAudioHandle.playEffect("eatProp_mp3",1)}else if("gameResult"==t.f)if(""!=t.m||1!=t.s);else{var a=null,l=null,r=null;for(var n in t.d.player){var o=t.d.player[n];0==o.win?r=o:l=o,o.uid==ConstValue.cacheUserInfo.id&&(a=o)}this.showResultpanel(l,r,a);for(var n in e.aiSubObj){var o=e.aiSubObj[n];o.stopAI()}}else if("gameGuanKaResult"==t.f)if(""!=t.m||1!=t.s);else{var a=null,l=null,r=null;for(var n in t.d.player){var o=t.d.player[n];0==o.win?r=o:l=o,o.uid==ConstValue.cacheUserInfo.id&&(a=o)}this.showGuanKaResultpanel(l,r,a);for(var n in e.aiSubObj){var o=e.aiSubObj[n];o.stopAI()}}else if("miniGameInfo"==t.f)if(""!=t.m||1!=t.s);else{ConstValue.P_FIGHT_OBJ.showVsMiniGamepanel();for(var n in e.aiSubObj){var o=e.aiSubObj[n];o.stopAI()}}else"UpdateClick"==t.f&&(""!=t.m||1!=t.s||this.updateClickData(t.d))},e.groundLayerSubObj={},e.groundLayerSubObjDanger={},e.playerLayerSubObj={},e.bulletLayerSubObj={},e.mapLayerSubObj={},e.mapLayerLock=!1,e.mapLeftLimit=177,e.mapUpLimit=106,e.mapRightLimit=823,e.mapDownLimit=649,e.aiSubObj={},e.aiPVE=!1,e.readyTwo=!1,e.readyRes=!1,e}();__reflect(FightingModule.prototype,"FightingModule");var HallModule=function(){function e(t){this.sCurModifyBtn="",this.sCurModifyValue="",this.sCurModifyValue2="",this.shopUIType=1,this.shopPageType=0,this.shopItemNo=0,this.shopItemItemID=0,this.shopItemName="",this.barrLayer=1,this.seventCur=0,this.seventGetState=!1,this.shopItemClickName="",this.showWxVsPanel=null,this.isMainRoomer=!1,this.roleSelectIdx="0",this.isdisplay=!1,this.context=t,e.isNoEnd=!1,this.initConfig()}return e.prototype.initConfig=function(){var e=this;LZMA.decompress(EBitUtil.getArr(new egret.ByteArray(RES.getRes("config_json"))),function(t){ConstValue.P_CONFIG=JSON.parse(t),e.init()},function(e){})},e.prototype.init=function(){CommonAudioHandle.play("mainmenu_mp3",0),this.panel=new eui.Panel,this.panel.skinName="resource/eui_skins/UserUI/HallUI.exml",this.panel.title="Title",this.panel.horizontalCenter=0,this.panel.verticalCenter=0,this.context.addChild(this.panel),this.panel.getChildByName("btn_match_pvp").addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.panel.getChildByName("btn_map_diy").addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.panel.getChildByName("btn_map_shop").addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.panel.getChildByName("btn_map_bag").addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.panel.getChildByName("btn_noend_pve").addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.panel.getChildByName("btn_friend_pvp").addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.panel.getChildByName("img_info").addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),CommonTools.fixFix(this.context,this.panel.getChildByName("btn_map_diy"),2,0,0),CommonTools.fixFix(this.context,this.panel.getChildByName("btn_map_shop"),2,0,30),CommonTools.fixFix(this.context,this.panel.getChildByName("btn_map_bag"),2,0,0),CommonTools.fixFix(this.context,this.panel.getChildByName("btn_match_pvp"),2,0,0),CommonTools.fixFix(this.context,this.panel.getChildByName("btn_training_pve"),2,0,0),CommonTools.fixFix(this.context,this.panel.getChildByName("btn_noend_pve"),2,0,0),CommonTools.fixFix(this.context,this.panel.getChildByName("btn_friend_pvp"),2,0,0),CommonTools.fixFix(this.context,this.panel.getChildByName("btn_setting"),2,0,0),CommonTools.fixFix(this.context,this.panel.getChildByName("btn_ranking"),2,0,0),CommonTools.fixFix(this.context,this.panel.getChildByName("btn_vip"),2,0,30),CommonTools.fixFix(this.context,this.panel.getChildByName("btn_activity"),2,0,30),CommonTools.fixFix(this.context,this.panel.getChildByName("btn_shop"),1,0,10),CommonTools.fixFix(this.context,this.panel.getChildByName("info_grp"),1,44,10),CommonTools.fixFix(this.context,this.panel.getChildByName("img_head_bg"),1,34,10),CommonTools.fixFix(this.context,this.panel.getChildByName("img_info"),1,44,10),CommonTools.fixFix(this.context,this.panel.getChildByName("img_exp_bg"),1,27,10),CommonTools.fixFix(this.context,this.panel.getChildByName("img_exp_value"),1,27,10),CommonTools.fixFix(this.context,this.panel.getChildByName("img_coin_bg"),1,-10,10),CommonTools.fixFix(this.context,this.panel.getChildByName("img_zuan_bg"),1,0,10),CommonTools.fixFix(this.context,this.panel.getChildByName("btn_noticetip"),1,0,10),CommonTools.fixFix(this.context,this.panel.getChildByName("hall_id_lb"),1,34,10),CommonTools.fixFix(this.context,this.panel.getChildByName("coin_num_lb"),1,-10,10),CommonTools.fixFix(this.context,this.panel.getChildByName("zuan_num_lb"),1,-10,10),CommonTools.fixFix(this.context,this.panel.getChildByName("img_lv_lb"),1,30,10),CommonTools.fixFix(this.context,this.panel.getChildByName("rank_grounp_main"),1,44,10);var e=this.panel.getChildByName("img_info");""!=ConstValue.cacheUserInfo.headPic&&(e.source=ConstValue.cacheUserInfo.headPic);var t=this.panel.getChildByName("hall_id_lb");t.text=ConstValue.cacheUserInfo.name;var i=this.panel.getChildByName("img_lv_lb");i.text=ConstValue.cacheUserInfo.lv;var n=this.panel.getChildByName("img_exp_value");n.width=1*ConstValue.cacheUserInfo.exp/1e5*n.width;var o=this.panel.getChildByName("coin_num_lb");o.text=ConstValue.cacheUserInfo.coin;var s=this.panel.getChildByName("zuan_num_lb");if(s.text=ConstValue.cacheUserInfo.diamond,null!=ConstValue.cacheUserInfo&&1==ConstValue.cacheUserInfo.gm&&(CommonButtonHandle.beginTouch(this.panel.getChildByName("btn_gm"),this),this.panel.getChildByName("btn_gm").addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this)),CommonTools.fixFix(this.context,this.panel.getChildByName("btn_gm"),2,44,0),ConstValue.gatewayType=0,CommonTools.log("--Main.roomkey--------"+Main.roomkey),null!=Main.roomkey){CommonTools.log("--Main.roomkey----xxxx----"+Main.roomkey);var a=CommonTools.getDataJsonStr("enter1V1Room",1,{fightRoomKey:Main.roomkey});ConstValue.P_NET_OBJ.sendData(a)}},e.prototype.clickNotice=function(e){for(var t=this.panelNotice.getChildByName("left_scroller"),i=t.getChildByName("left_group"),n=this.panelNotice.getChildByName("lb_title"),o=this.panelNotice.getChildByName("lb_mail_info"),s=i.numChildren,a=parseInt(e.replace("lb_notice_click","")),l=0;s>l;l++){var r=i.getChildByName("p_"+l),h=r.getChildByName("group_1");if(l==a){h.getChildByName("img_yellow").visible=!0,h.getChildByName("img_red").visible=!1;var u=h.getChildByName("img_letter");u.source=RES.getRes("mail_open2_png"),n.text="标题：喜报！！"+(l+1),o.text="恭喜用户1000"+l+"喜获超级大奖xxxxxxxxxxxxxx"}else h.getChildByName("img_yellow").visible=!1}},e.prototype.clickShopItem=function(e){this.shopItemClickName=e;var t=this.panelNotice.getChildByName("res_scroller"),i=t.getChildByName("res_group"),n=this.panelNotice.getChildByName("shop_show_icon"),o=this.panelNotice.getChildByName("shop_show_info"),s=this.panelNotice.getChildByName("lb_gold");s.text=ConstValue.cacheUserInfo.coin;var a=this.panelNotice.getChildByName("lb_diamond");a.text=ConstValue.cacheUserInfo.diamond;var l=i.numChildren,r=parseInt(e.replace("shop_item_click",""));1==this.shopUIType?(this.shopItemNo=this.dShopOrBagData.lShopInfo[r].iNo,o.text=this.getConf("ItemData",this.dShopOrBagData.lShopInfo[r].iNo.toString(),"desc"),this.shopItemName=this.getConf("ItemData",this.dShopOrBagData.lShopInfo[r].iNo.toString(),"name")):(this.shopItemNo=this.dShopOrBagData.lItmeInfo[r].iNo,this.shopItemItemID=this.dShopOrBagData.lItmeInfo[r].iItemID,o.text=this.getConf("ItemData",this.dShopOrBagData.lItmeInfo[r].iNo.toString(),"desc"),this.shopItemName=this.getConf("ItemData",this.dShopOrBagData.lItmeInfo[r].iNo.toString(),"name"));for(var h=0;l>h;h++){var u=i.getChildByName("p_"+h),c=u.getChildByName("group_1"),d=c.getChildByName("shop_item_icon"),g=c.getChildByName("shop_item_bg"),m="shop_item_not_png",p="shop_item_yes_png";2==this.shopUIType&&(m="bag_item_not_png",p="bag_item_yes_png"),h==r?(n.source=d.source,g.source=p):g.source=m}},e.prototype.clickShopPage=function(e){var t=this.panelNotice.getChildByName("btn_fashion"),i=this.panelNotice.getChildByName("btn_paopao"),n=this.panelNotice.getChildByName("btn_texiao"),o=this.panelNotice.getChildByName("btn_daoju"),s=this.panelNotice.getChildByName("t_shi"),a=this.panelNotice.getChildByName("t_zhuang"),l=this.panelNotice.getChildByName("t_pao1"),r=this.panelNotice.getChildByName("t_pao2"),h=this.panelNotice.getChildByName("t_te"),u=this.panelNotice.getChildByName("t_xiao"),c=this.panelNotice.getChildByName("t_dao"),d=this.panelNotice.getChildByName("t_ju"),g="shop_page_not_png",m="shop_page_yes_png",p=16773583,_=15371313;2==this.shopUIType&&(g="rank_select_01_png",m="rank_select_02_png",p=10531804,_=7633371);var C=1;switch(e){case"btn_one_lb":t.source=m,i.source=g,n.source=g,o.source=g,s.textColor=_,a.textColor=_,l.textColor=p,r.textColor=p,h.textColor=p,u.textColor=p,c.textColor=p,d.textColor=p,C=1;break;case"btn_two_lb":t.source=g,i.source=m,n.source=g,o.source=g,s.textColor=p,a.textColor=p,l.textColor=_,r.textColor=_,h.textColor=p,u.textColor=p,c.textColor=p,d.textColor=p,C=2;break;case"btn_three_lb":t.source=g,i.source=g,n.source=m,o.source=g,s.textColor=p,a.textColor=p,l.textColor=p,r.textColor=p,h.textColor=_,u.textColor=_,c.textColor=p,d.textColor=p,C=3;break;case"btn_four_lb":t.source=g,i.source=g,n.source=g,o.source=m,s.textColor=p,a.textColor=p,l.textColor=p,r.textColor=p,h.textColor=p,u.textColor=p,c.textColor=_,d.textColor=_,C=4}if(1==this.shopUIType){this.shopPageType=C-1;var y=CommonTools.getDataJsonStr("openShopUI",1,{iType:this.shopPageType});ConstValue.P_NET_OBJ.sendData(y)}else{this.shopPageType=C-1;var y=CommonTools.getDataJsonStr("openBagUI",1,{iType:this.shopPageType});ConstValue.P_NET_OBJ.sendData(y)}},e.prototype.onClick=function(e){return __awaiter(this,void 0,void 0,function(){var t,i,n,n,o,s,a,l,r,h,u,c,d,g,m;return __generator(this,function(p){switch(p.label){case 0:if(null!=this.context.loadingView&&!ConstValue.P_IS_DEBUG)return CommonTools.log("还在加载中......return "),[2];if(t=e.target.name,CommonTools.log("==========name::::"+t),t.indexOf("lb_notice_click")>=0)return this.clickNotice(t),[2];if(t.indexOf("shop_item_click")>=0)return this.clickShopItem(t),[2];switch(i=t){case"btn_close":return[3,1];case"btn_close_wx_vs":return[3,2];case"btn_start":return[3,3];case"btn_shop":return[3,4];case"btn_rank":return[3,5];case"all_rank_lb":return[3,6];case"match_rank_lb":return[3,6];case"lv_rank_lb":return[3,7];case"btn_noticetip":return[3,8];case"btn_match_pvp":return[3,9];case"btn_friend_pvp":return[3,11];case"btn_noend_pve":return[3,12];case"btn_map_diy":return[3,13];
case"btn_map_shop":return[3,15];case"btn_map_bag":return[3,16];case"img_info":return[3,17];case"btn_close_edit":return[3,18];case"btn_gm":return[3,19];case"btn_one_lb":return[3,20];case"btn_two_lb":return[3,20];case"btn_three_lb":return[3,20];case"btn_four_lb":return[3,20];case"btn_buy":return[3,21];case"btn_confirm_modify":return[3,22]}return[3,23];case 1:return this.closeNotice(),[3,24];case 2:return this.closeWxVsUI(),[3,24];case 3:return this.isMainRoomer?(n=CommonTools.getDataJsonStr("startGame1V1",1,{fightRoomKey:Main.roomkey}),ConstValue.P_NET_OBJ.sendData(n)):(n=CommonTools.getDataJsonStr("setReady1V1",1,{fightRoomKey:Main.roomkey}),ConstValue.P_NET_OBJ.sendData(n)),[3,24];case 4:return CommonTools.addCommonTips(this.context,ConstValue.P_SEND_WAITING),[3,24];case 5:return o=CommonTools.getDataJsonStr("openRnakUI",1,{}),ConstValue.P_NET_OBJ.sendData(o),[3,24];case 6:return s=CommonTools.getDataJsonStr("getTotalPvpRank",1,{}),ConstValue.P_NET_OBJ.sendData(s),[3,24];case 7:return a=CommonTools.getDataJsonStr("getTotalLvRank",1,{}),ConstValue.P_NET_OBJ.sendData(a),[3,24];case 8:return this.showNotice("resource/eui_skins/UserUI/NoticeUI.exml",t),[3,24];case 9:return[4,this.context.loadResource("fighting",3)];case 10:return p.sent(),[3,24];case 11:return this.showNotice("resource/eui_skins/UserUI/SelectShareVsMapUI.exml",t),[3,24];case 12:return l=CommonTools.getDataJsonStr("C2GOpenWujinUI",1,{diffLevel:1}),ConstValue.P_NET_OBJ.sendData(l),[3,24];case 13:return[4,this.context.loadResource("diymap",4)];case 14:return p.sent(),[3,24];case 15:return r=CommonTools.getDataJsonStr("openShopUI",1,{iType:0}),ConstValue.P_NET_OBJ.sendData(r),[3,24];case 16:return h=CommonTools.getDataJsonStr("openBagUI",1,{iType:0}),ConstValue.P_NET_OBJ.sendData(h),[3,24];case 17:return u=CommonTools.getDataJsonStr("showAllClassList",1,{}),ConstValue.P_NET_OBJ.sendData(u),[3,24];case 18:return this.closeSub(),[3,24];case 19:return this.showEditUI(t),[3,24];case 20:return this.clickShopPage(t),[3,24];case 21:return 1==this.shopUIType?(c=CommonTools.getDataJsonStr("Buy",1,{iNo:this.shopItemNo,iType:this.shopPageType,num:1}),ConstValue.P_NET_OBJ.sendData(c)):(d=CommonTools.getDataJsonStr("useItem",1,{iNo:this.shopItemNo,iType:this.shopPageType,iItemID:this.shopItemItemID}),ConstValue.P_NET_OBJ.sendData(d)),[3,24];case 22:if(g=this.panelSub.getChildByName("account_lb_txt"),""==g.text)return CommonTools.addCommonTips(this.context,ConstValue.P_MODIFY_NULL_FAIL),[2];if(ConstValue.P_IS_DEBUG)CommonTools.addCommonTips(this.context,ConstValue.P_SEND_MODIFY_SUCCESS),this.closeSub();else{if(this.sCurModifyValue=g.text,m="","btn_gm"==this.sCurModifyBtn&&(m=CommonTools.getDataJsonStr("gmFunc",1,{gmCmd:this.sCurModifyValue})),""==m)return ConstValue.P_IS_INNER&&CommonTools.addCommonTips(this.context,"btn_confirm_modify sData 为空"),[2];ConstValue.P_NET_OBJ.sendData(m)}return[3,24];case 23:return CommonTools.log("11111111 default"),[3,24];case 24:return[2]}})})},e.prototype.getConf=function(e,t,i){try{return ConstValue.P_CONFIG[e][t][i]}catch(n){return""}},e.prototype.onButtonClick=function(e){return __awaiter(this,void 0,void 0,function(){var e,t;return __generator(this,function(i){switch(i.label){case 0:return CommonTools.log("shareAppMessage-------1"),e=CommonTools.getDataJsonStr("gmFunc",1,{gmCmd:"test1v1"}),ConstValue.P_NET_OBJ.sendData(e),t=window.platform,[4,t.shareAppMessage(ConstValue.cacheUserInfo.id+"")];case 1:return i.sent(),CommonTools.log("shareAppMessage-------2"),[2]}})})},e.prototype.showNotice=function(e,t){this.maskBg=new eui.Image("mask_layer_png"),this.maskBg.width=this.context.getStageWidth(),this.maskBg.height=this.context.getStageHeight(),this.context.addChild(this.maskBg),this.panelNotice=new eui.Panel,this.panelNotice.skinName=e,this.panelNotice.title="Title",this.panelNotice.horizontalCenter=0,this.panelNotice.verticalCenter=0,this.context.addChild(this.panelNotice),CommonTools.fixFix(this.context,this.panelNotice,1,0,0),CommonButtonHandle.beginTouch(this.panelNotice.getChildByName("btn_close"),this),this.panelNotice.getChildByName("btn_close").addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.handlePanel(this.panelNotice,t),CommonTools.niceTip(this.panelNotice,1,this)},e.prototype.showRoleInfoUI=function(){var e=this.roleClassData[this.roleSelectIdx];this.maskBg2=new eui.Image("mask_layer_png"),this.maskBg2.width=this.context.getStageWidth(),this.maskBg2.height=this.context.getStageHeight(),this.context.addChild(this.maskBg2),this.panelSub=new eui.Panel,this.panelSub.skinName="resource/eui_skins/UserUI/RoleInfoUI.exml",this.panelSub.title="Title",this.panelSub.horizontalCenter=0,this.panelSub.verticalCenter=0,this.context.addChild(this.panelSub),CommonTools.fixFix(this.context,this.panelSub,1,0,0);var t=this.panelSub.getChildByName("lb_life"),i=this.panelSub.getChildByName("lb_boom"),n=this.panelSub.getChildByName("lb_speed"),o=this.panelSub.getChildByName("lb_power"),s=this.panelSub.getChildByName("lb_lv"),a=this.panelSub.getChildByName("lb_exp");t.text=e.life,i.text=e.cnt,n.text=e.speed,o.text=e.power,s.text=ConstValue.cacheUserInfo.lv,a.text=ConstValue.cacheUserInfo.curexp,CommonButtonHandle.beginTouch(this.panelSub.getChildByName("btn_close"),this),this.panelSub.getChildByName("btn_close").addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){CommonTools.niceTip(this.panelSub,2,this)},this),this.bodyAniDown2=CommonTools.getAnimDraw(RES.getRes("p"+e.iClass+"_static_json"),RES.getRes("p"+e.iClass+"_static_png"),"0"),this.bodyAniDown2.play(-1),this.panelSub.addChild(this.bodyAniDown2),this.bodyAniDown2.x=660,this.bodyAniDown2.y=520},e.prototype.showWxVsUI=function(e){this.maskBg2=new eui.Image("vs_bg_1v1_png"),this.maskBg2.width=this.context.getStageWidth(),this.maskBg2.height=this.context.getStageHeight(),this.context.addChild(this.maskBg2),this.showWxVsPanel=new eui.Panel,this.showWxVsPanel.skinName="resource/eui_skins/UserUI/WxVsWaitUI.exml",this.showWxVsPanel.title="Title",this.showWxVsPanel.horizontalCenter=0,this.showWxVsPanel.verticalCenter=0,this.context.addChild(this.showWxVsPanel),CommonTools.fixFix(this.context,this.showWxVsPanel,1,0,0),CommonButtonHandle.beginTouch(this.showWxVsPanel.getChildByName("btn_close_wx_vs"),this),this.showWxVsPanel.getChildByName("btn_close_wx_vs").addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),CommonButtonHandle.beginTouch(this.showWxVsPanel.getChildByName("btn_start"),this),this.showWxVsPanel.getChildByName("btn_start").addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.updateWxVsUI(e)},e.prototype.updateWxVsUI=function(e){var t=this.showWxVsPanel.getChildByName("left_online"),i=this.showWxVsPanel.getChildByName("left_name"),n=this.showWxVsPanel.getChildByName("left_ready"),o=this.showWxVsPanel.getChildByName("right_online"),s=this.showWxVsPanel.getChildByName("right_name"),a=this.showWxVsPanel.getChildByName("right_ready"),l=this.showWxVsPanel.getChildByName("btn_start"),r=[.3,.6,0,0,0,.3,.6,0,0,0,.3,.6,0,0,0,0,0,0,1,0],h=new egret.ColorMatrixFilter(r);if(1==e.lWaitInfo.length?(t.text=1==e.lWaitInfo[0].isOnline?"在线":"等待",i.text=e.lWaitInfo[0].name,n.text=1==e.lWaitInfo[0].isReady?"已准备":"等待",e.lWaitInfo[0].rid==ConstValue.cacheUserInfo.id&&(this.isMainRoomer=!0),l.filters=[h],l.enabled=!1):(t.text=1==e.lWaitInfo[0].isOnline?"在线":"等待",i.text=e.lWaitInfo[0].name,n.text=1==e.lWaitInfo[0].isReady?"已准备":"等待",o.text=1==e.lWaitInfo[1].isOnline?"在线":"等待",s.text=e.lWaitInfo[1].name,a.text=1==e.lWaitInfo[1].isReady?"已准备":"等待",this.isMainRoomer?1==e.lWaitInfo[1].isOnline&&1==e.lWaitInfo[1].isReady?(l.filters=[],l.enabled=!0):(l.filters=[h],l.enabled=!1):1==e.lWaitInfo[1].isReady?(l.filters=[h],l.enabled=!1,l.label="就  绪"):(l.filters=[],l.enabled=!0,l.label="准  备")),null!=e.MapInfo.roleId&&(this.showWxVsPanel.getChildByName("img_wx_wenhao").visible=!1,new MapMiniDIYModule(this.showWxVsPanel,e.MapInfo.bgconf,e.MapInfo.layerconf,3)),1==e.lWaitInfo.length){var u=this.showWxVsPanel.getChildByName("img_lefthead");""!=e.lWaitInfo[0].head&&(u.source=e.lWaitInfo[0].head)}if(2==e.lWaitInfo.length){var u=this.showWxVsPanel.getChildByName("img_lefthead");""!=e.lWaitInfo[0].head&&(u.source=e.lWaitInfo[0].head);var c=this.showWxVsPanel.getChildByName("img_righthead");""!=e.lWaitInfo[1].head&&(c.source=e.lWaitInfo[1].head)}},e.prototype.showEditUI=function(e){this.panelSub=new eui.Panel,this.panelSub.skinName="resource/eui_skins/UserUI/EditUI.exml",this.panelSub.title="Title",this.panelSub.horizontalCenter=0,this.panelSub.verticalCenter=0,this.context.addChild(this.panelSub),CommonButtonHandle.beginTouch(this.panelSub.getChildByName("btn_close_edit"),this),this.panelSub.getChildByName("btn_close_edit").addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),CommonButtonHandle.beginTouch(this.panelSub.getChildByName("btn_confirm_modify"),this),this.panelSub.getChildByName("btn_confirm_modify").addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.panelSub.getChildByName("lb_edit_title").text=ConstValue.P_MODIFY_TITLE,this.sCurModifyBtn=e,"modify_nichen_btn"==e?this.panelSub.getChildByName("lb_desc").text=ConstValue.P_MODIFY_NICHENG:"modify_pwd_btn"==e?(this.panelSub.getChildByName("lb_old_pwd").text=ConstValue.P_MODIFY_OLD_PWD,this.panelSub.getChildByName("lb_desc").text=ConstValue.P_MODIFY_NEW_PWD,this.panelSub.getChildByName("lb_new_pwd").text=ConstValue.P_MODIFY_NEW_PWD,this.panelSub.getChildByName("lb_old_pwd").visible=!0,this.panelSub.getChildByName("bg_old").visible=!0,this.panelSub.getChildByName("account_lb_old").visible=!0,this.panelSub.getChildByName("account_lb_old").displayAsPassword=!0,this.panelSub.getChildByName("account_lb_txt").displayAsPassword=!0,this.panelSub.getChildByName("lb_new_pwd").visible=!0,this.panelSub.getChildByName("bg_new").visible=!0,this.panelSub.getChildByName("account_lb_new").visible=!0,this.panelSub.getChildByName("account_lb_new").displayAsPassword=!0):"modify_realname_btn"==e?this.panelSub.getChildByName("lb_desc").text=ConstValue.P_MODIFY_REALNAME:"modify_wx_btn"==e?this.panelSub.getChildByName("lb_desc").text=ConstValue.P_MODIFY_WX:"modify_beget_btn"==e?this.panelSub.getChildByName("lb_desc").text=ConstValue.P_MODIFY_BEGET:"btn_gm"==e?(this.panelSub.getChildByName("lb_edit_title").text="gm",this.panelSub.getChildByName("lb_desc").text="输入命令："):"hall_question_btn"==e&&(this.panelSub.getChildByName("lb_edit_title").text="反馈",this.panelSub.getChildByName("lb_desc").text="问题描述：")},e.prototype.showChoiceUI=function(){if(null==this.choicePanel){this.choicePanel=new eui.Panel,this.choicePanel.skinName="resource/eui_skins/UserUI/OptionUI.exml",this.choicePanel.title="Title",this.context.addChild(this.choicePanel);var e=this.panel.getChildByName("btn_choice").x,t=this.panel.getChildByName("btn_choice").y;this.choicePanel.x=e-50,this.choicePanel.y=t+50}else this.context.removeChild(this.choicePanel),this.choicePanel=null},e.prototype.handleRank=function(e,t){for(var i in this.lRank){var n=this.lRank[i],o=parseInt(i);CommonTools.log("lRank-------i:"+i);var s=new eui.Panel;s.skinName="resource/eui_skins/UserUI/RankGroup.exml",s.name="p_"+i,s.y=72*o,e.addChild(s);var a=s.getChildByName("group_1"),l=a.getChildByName("rank");l.text=o+1+"";var r=a.getChildByName("name");r.name=n[1];var h=a.getChildByName("desc");h.text="胜场 ： "+n[3]+"   胜率："+n[4]+"%"}var u=t.getChildByName("myrankG"),c=u.getChildByName("myrank");c.text=this.sMyRankDesc;var d=u.getChildByName("name");d.text=this.lMyRank[1];var g=u.getChildByName("desc");g.text="胜场 ： "+this.lMyRank[3]+"   胜率："+this.lMyRank[4]+"%"},e.prototype.updateRoleClass=function(e){var t=this.panelNotice.getChildByName("lb_life"),i=this.panelNotice.getChildByName("lb_boom"),n=this.panelNotice.getChildByName("lb_speed"),o=this.panelNotice.getChildByName("lb_power"),s=this.panelNotice.getChildByName("lb_name"),a=this.panelNotice.getChildByName("img_buy_bg"),l=this.panelNotice.getChildByName("btn_gold"),r=this.panelNotice.getChildByName("lb_gold"),h=this.panelNotice.getChildByName("btn_fight"),u=this.panelNotice.getChildByName("btn_buy"),c=this.panelNotice.getChildByName("lb_attr"),d=this.roleClassData[e];t.text=d.life,i.text=d.cnt,n.text=d.speed,o.text=d.power,c.text=d.desc,s.text=d.name,1==d.isOwn?(a.visible=!1,l.visible=!1,r.visible=!1,u.visible=!1,h.visible=!0,1==d.isUse?h.label="出战中":h.label="出 战"):(h.visible=!1,a.visible=!0,l.visible=!0,r.visible=!0,u.visible=!0,r.text=d.price),null!=this.bodyAniDown&&(this.panelNotice.removeChild(this.bodyAniDown),this.bodyAniDown=null),this.bodyAniDown=CommonTools.getAnimDraw(RES.getRes("p"+d.iClass+"_static_json"),RES.getRes("p"+d.iClass+"_static_png"),"0"),this.bodyAniDown.play(-1),this.panelNotice.addChild(this.bodyAniDown),this.bodyAniDown.x=695,this.bodyAniDown.y=400},e.prototype.handleRoleClass=function(e,t){var i=function(t){var i=n.roleClassData[t],o=parseInt(t),s=new eui.Panel;s.skinName="resource/eui_skins/UserUI/RoleSelectUIGroup.exml",s.name="p_"+t,s.y=125*o,e.addChild(s);var a=s.getChildByName("group_1"),l=a.getChildByName("role_name");l.text=i.name;var r=a.getChildByName("img_selected");o>0&&(r.visible=!1);var h=a.getChildByName("role_head");h.source=ConstValue.role_select_img[t],s.addEventListener(egret.TouchEvent.TOUCH_TAP,function(i){for(var n=e.numChildren,o=0;n>o;o++){var s=e.getChildByName("p_"+o),a=s.getChildByName("group_1"),l=a.getChildByName("img_selected");l.visible=!1}r.visible=!0,this.roleSelectIdx=t,this.updateRoleClass(t)},n)},n=this;for(var o in this.roleClassData)i(o);this.updateRoleClass("0");var s=this.panelNotice.getChildByName("btn_fight"),a=this.panelNotice.getChildByName("btn_buy"),l=this.panelNotice.getChildByName("lb_role_click");s.addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){var t=this.roleClassData[this.roleSelectIdx],i=CommonTools.getDataJsonStr("useClass",1,{iClass:t.iClass});ConstValue.P_NET_OBJ.sendData(i)},this),a.addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){var t=this.roleClassData[this.roleSelectIdx],i=CommonTools.getDataJsonStr("buyClass",1,{iClass:t.iClass});ConstValue.P_NET_OBJ.sendData(i)},this),l.addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){this.showRoleInfoUI()},this)},e.prototype.handleSeventDay=function(){for(var e=1;7>=e;e++){0==this.seventCur&&0==this.seventData[e.toString()].bGet&&(this.seventCur=e),this.seventCur==e&&1==this.seventData[e.toString()].bGet&&(this.seventGetState=!0);var t=this.panelNotice.getChildByName("item_icon_"+e);t.source=this.getConf("ItemData",this.seventData[e.toString()].itemNo,"res")+"_png";var i=this.panelNotice.getChildByName("lb_name_"+e);i.text=this.getConf("ItemData",this.seventData[e.toString()].itemNo,"name");var n=this.panelNotice.getChildByName("item_state_"+e);0==this.seventData[e.toString()].bGet?n.source="sevent_get_png":n.source="sevent_got_png",this.panelNotice.getChildByName("item_lb_"+e).addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){var t=e.target.name,i=parseInt(t.replace("item_lb_",""));if(i>this.seventCur)CommonTools.addCommonTips(this.context,"请领取第"+this.seventCur+"天奖励！");else if(this.seventGetState)CommonTools.addCommonTips(this.context,"已领取当天奖励");else{var n=CommonTools.getDataJsonStr("getSeventDayReward",1,{});ConstValue.P_NET_OBJ.sendData(n)}},this)}},e.prototype.handleGetMyMaps=function(){var e=this.panelNotice.getChildByName("fighting_parent").getChildByName("scroll").getChildByName("scroll_group"),t=0,i=function(i){var o=n.selectMapData[i],s=new eui.Panel;s.skinName="resource/eui_skins/UserUI/MapViewGroup.exml",s.name="p_"+t,s.x+=40,s.y+=50+10*t+255*t,e.addChild(s),s.getChildByName("view_fight_btn").visible=!1,s.getChildByName("view_change_btn").visible=!1;var a=s.getChildByName("group_1"),l=a.getChildByName("lb_title");l.text=o.mapName;var r=a.getChildByName("lb_author");r.text=ConstValue.cacheUserInfo.name;var h=a.getChildByName("lb_sign");h.text=o.mapSign;var u=s.getChildByName("view_add_btn");u.label="邀 请",u.addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){this.selectKey=i;var t=CommonTools.getDataJsonStr("open1V1RoomByMap",1,{mapID:parseInt(this.selectKey)});ConstValue.P_NET_OBJ.sendData(t)},n),new MapMiniDIYModule(s,o.bgconf,o.layerconf,2),t++},n=this;for(var o in this.selectMapData)i(o)},e.prototype.handleSelectMap=function(){this.panelNotice.getChildByName("btn_random").addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){this.panelNotice.getChildByName("img_left").visible=!0,this.panelNotice.getChildByName("img_right").visible=!1},this),this.panelNotice.getChildByName("btn_mymap").addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){this.panelNotice.getChildByName("img_left").visible=!1,this.panelNotice.getChildByName("img_right").visible=!0},this),this.panelNotice.getChildByName("btn_certain_map").addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){if(this.closeNotice(),this.panelNotice.getChildByName("img_left").visible){var t=CommonTools.getDataJsonStr("open1V1Room",1,{});ConstValue.P_NET_OBJ.sendData(t)}else{var i=CommonTools.getDataJsonStr("getMyMaps",1,{});ConstValue.P_NET_OBJ.sendData(i)}},this)},e.prototype.handleNoEnd=function(t,i){var n=25,o=128,s=1,a=i.getChildByName("lb_star_total"),l=i.getChildByName("lb_bg_total");a.text="获得"+this.barrData.nowstar+"/"+this.barrData.totalstar+"颗星";var r=this.barrData.nowstar/this.barrData.totalstar*1;l.width=l.width*r;var h=i.getChildByName("guanka_layer");h.text="第"+this.barrLayer+"层",i.getChildByName("btn_left").addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){if(1==this.barrLayer)return void CommonTools.addCommonTips(this.context,"当前为首页关卡");this.barrLayer--;var t=CommonTools.getDataJsonStr("C2GOpenWujinUI",1,{diffLevel:this.barrLayer});ConstValue.P_NET_OBJ.sendData(t)},this),i.getChildByName("btn_right").addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){if(this.barrLayer+1>this.barrData.totallayer)return void CommonTools.addCommonTips(this.context,"当前为尾页关卡");this.barrLayer++;var t=CommonTools.getDataJsonStr("C2GOpenWujinUI",1,{diffLevel:this.barrLayer});ConstValue.P_NET_OBJ.sendData(t)},this);var u=function(i){var a=c.barrData.barrierList[i],l=new eui.Panel;l.skinName="resource/eui_skins/UserUI/noEndBarrStartGroup.exml",l.name="p_"+s;var r=s%6==0?6:s%6,h=0;h=s%6==0?s/6:s/6+1,l.x=n+165*(r-1),l.y=o+120*Math.floor(h-1),t.addChild(l);var u=l.getChildByName("group_1"),d=u.getChildByName("num_lb");d.text=a.barrierNo+"";for(var g=1;g<=a.star&&!(g>3);g++){var m=u.getChildByName("star_0"+g);m.source="barr_pass_start_png"}l.addEventListener(egret.TouchEvent.TOUCH_TAP,function(t){e.isNoEnd=!0;var i=CommonTools.getDataJsonStr("C2GGotoBarrier",1,{barrierNo:a.barrierNo});ConstValue.P_NET_OBJ.sendData(i)},c),s++},c=this;for(var d in this.barrData.barrierList)u(d)},e.prototype.updateShopUI=function(e){var t=this.panelNotice.getChildByName("res_scroller"),i=t.getChildByName("res_group");i.removeChildren();var n=0;if(1==this.shopUIType)n=this.dShopOrBagData.lShopInfo.length;else if(n=this.dShopOrBagData.lItmeInfo.length,""!=this.shopItemClickName){var o=parseInt(this.shopItemClickName.replace("shop_item_click",""));o>=n&&(e=!0,this.shopItemClickName="")}for(var s=0;n>s;s++){var a=new eui.Panel;a.skinName="resource/eui_skins/UserUI/ShopItemGroup.exml",a.name="p_"+s;var l=5;2==this.shopUIType&&(l=20),a.x=l+180*(s%3)+5*(s%3),a.y=20+230*Math.floor(s/3)+20*Math.floor(s/3),i.addChild(a);var r=a.getChildByName("group_1"),h=r.getChildByName("shop_item_bg"),u=r.getChildByName("shop_item_pay"),c=r.getChildByName("shop_item_icon"),d=r.getChildByName("shop_item_click");d.name="shop_item_click"+s,d.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this);var g=r.getChildByName("shop_item_name"),m=r.getChildByName("shop_item_money");if(1==this.shopUIType)c.source=this.getConf("ItemData",this.dShopOrBagData.lShopInfo[s].iNo.toString(),"res")+"_png",g.text=this.getConf("ItemData",this.dShopOrBagData.lShopInfo[s].iNo.toString(),"name"),m.text=this.dShopOrBagData.lShopInfo[s].NeedCoin,0==s&&(h.source="shop_item_yes_png",e&&this.clickShopItem(d.name));else{u.visible=!1,c.source=this.getConf("ItemData",this.dShopOrBagData.lItmeInfo[s].iNo.toString(),"res")+"_png",g.text=this.getConf("ItemData",this.dShopOrBagData.lItmeInfo[s].iNo.toString(),"name"),m.text="x "+this.dShopOrBagData.lItmeInfo[s].iNum;var p=r.getChildByName("shop_item_bg"),_=r.getChildByName("shop_item_name");_.y-=5,0==s?(p.source="bag_item_yes_png",e&&this.clickShopItem(d.name)):p.source="bag_item_not_png"}}},e.prototype.handlePanel=function(e,t){switch(t){case"btn_rank":var i=e.getChildByName("fighting_parent"),n=i.getChildByName("scroll"),o=n.getChildByName("scroll_group");o.removeChildren(),i.getChildByName("all_rank_lb").addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),CommonButtonHandle.beginTouch(i.getChildByName("all_rank_lb"),this),i.getChildByName("friend_rank_lb").addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),CommonButtonHandle.beginTouch(i.getChildByName("friend_rank_lb"),this),i.getChildByName("match_rank_lb").addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),CommonButtonHandle.beginTouch(i.getChildByName("match_rank_lb"),this),i.getChildByName("lv_rank_lb").addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),CommonButtonHandle.beginTouch(i.getChildByName("lv_rank_lb"),this),this.handleRank(o,i);break;case"all_rank_lb":var s=e.getChildByName("fighting_parent"),a=s.getChildByName("scroll"),l=a.getChildByName("scroll_group");l.removeChildren(),s.getChildByName("all_rank_bg").visible=!0,s.getChildByName("friend_rank_bg").visible=!1,this.handleRank(l,s);break;case"friend_rank_lb":var r=e.getChildByName("fighting_parent"),h=r.getChildByName("scroll"),u=h.getChildByName("scroll_group");u.removeChildren(),r.getChildByName("all_rank_bg").visible=!1,r.getChildByName("friend_rank_bg").visible=!0;break;case"match_rank_lb":case"getTotalPvpRank":var c=e.getChildByName("fighting_parent"),d=c.getChildByName("scroll"),g=d.getChildByName("scroll_group");g.removeChildren();var m=c.getChildByName("match_rank_bg");m.source=RES.getRes("rank_select_02_png");var p=c.getChildByName("lv_rank_bg");p.source=RES.getRes("rank_select_01_png"),this.handleRank(g,c);break;case"lv_rank_lb":case"getTotalLvRank":var _=e.getChildByName("fighting_parent"),C=_.getChildByName("scroll"),y=C.getChildByName("scroll_group");y.removeChildren();var f=_.getChildByName("match_rank_bg");f.source=RES.getRes("rank_select_01_png");var b=_.getChildByName("lv_rank_bg");b.source=RES.getRes("rank_select_02_png"),this.handleRank(y,_);break;case"btn_map_shop":case"btn_map_bag":this.panelNotice.getChildByName("btn_one_lb").addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.panelNotice.getChildByName("btn_two_lb").addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.panelNotice.getChildByName("btn_three_lb").addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.panelNotice.getChildByName("btn_four_lb").addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),CommonButtonHandle.beginTouch(this.panelNotice.getChildByName("btn_buy"),this),this.panelNotice.getChildByName("btn_buy").addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.updateShopUI(!0);break;case"btn_noend_pve":var v=e.getChildByName("fighting_parent");v.removeChildren(),this.handleNoEnd(v,e);break;case"SeventDayReward":this.handleSeventDay();break;case"getMyMaps":this.handleGetMyMaps();break;case"btn_friend_pvp":this.handleSelectMap();break;case"btn_img_info":var T=e.getChildByName("fighting_parent"),x=T.getChildByName("scroll"),B=x.getChildByName("scroll_group");B.removeChildren(),this.handleRoleClass(B,T);break;case"btn_noticetip":var N=e.getChildByName("group_clear");if(N.getChildByName("lb_clear_click").addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),CommonButtonHandle.beginTouch(N.getChildByName("lb_clear_click"),this),ConstValue.P_IS_DEBUG,0){var I=CommonTools.getDataJsonStr("getAllMail",1,{roleId:ConstValue.cacheUserInfo.id});ConstValue.P_NET_OBJ.sendData(I)}else{var P=10,w=this.panelNotice.getChildByName("left_scroller"),D=w.getChildByName("left_group"),S=this.panelNotice.getChildByName("lb_title");S.text="标题：";var E=this.panelNotice.getChildByName("lb_mail_info");E.text="";for(var k=0;P>k;k++){var L=new eui.Panel;L.skinName="resource/eui_skins/UserUI/NoticeGroup.exml",L.name="p_"+k,L.y=72*k,D.addChild(L);var O=L.getChildByName("group_1");O.getChildByName("img_yellow").visible=!1;var R=O.getChildByName("lb_title");R.text="喜报！！"+(k+1);var M=O.getChildByName("lb_notice_click");M.name="lb_notice_click"+k,M.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),CommonButtonHandle.beginTouch(M,this)}}break;default:CommonTools.log("22222222 default")}},e.prototype.handlePacket=function(e){return __awaiter(this,void 0,void 0,function(){var t,i;return __generator(this,function(n){switch(n.label){case 0:return"setName"!=e.f?[3,1]:(""!=e.m||1!=e.s?CommonTools.addCommonTips(this.context,ConstValue.P_MODIFY_FAIL):(CommonTools.addCommonTips(this.context,ConstValue.P_SEND_MODIFY_SUCCESS),this.panelNotice.getChildByName("nickName_lb").text=e.d.name,ConstValue.cacheUserInfo.name=e.d.name,this.closeSub()),[3,23]);case 1:return"gmFunc"!=e.f?[3,2]:(""!=e.m||1!=e.s?CommonTools.addCommonTips(this.context,"执行失败"):CommonTools.addCommonTips(this.context,"执行成功"),[3,23]);case 2:return"Room1v1Dismiss"!=e.f?[3,3]:(""!=e.m||1!=e.s||(CommonTools.addCommonTips(this.context,"房间解散"),Main.roomkey=null,null!=this.showWxVsPanel&&CommonTools.niceTip(this.showWxVsPanel,2,this)),[3,23]);case 3:return"WaitingInfo"!=e.f?[3,4]:(""!=e.m||1!=e.s?CommonTools.addCommonTips(this.context,ConstValue.P_ENTER_ROOM_FAIL):(null==ConstValue.P_FIGHT_OBJ&&(ConstValue.P_FIGHT_OBJ=new FightingModule(this.context)),e.d.state<2?ConstValue.P_FIGHT_OBJ.showVspanel():2==e.d.state&&(FightingModule.readyTwo=!0,this.context.dDataInfo2=e.d.player,null!=ConstValue.P_FIGHT_OBJ.playerData&&(FightingModule.readyRes=!0,ConstValue.P_FIGHT_OBJ.releaseVsPanel(),ConstValue.P_FIGHT_OBJ.updateInfo(e.d.player)))),[3,23]);case 4:return"syncMapData"!=e.f?[3,9]:""==e.m&&1==e.s?[3,5]:[3,8];case 5:return null!=ConstValue.cacheKeyGroup.fighting?[3,7]:(this.context.dDataInfo=e.d,[4,this.context.loadResource("fighting",6)]);case 6:return n.sent(),[3,8];case 7:null==ConstValue.P_FIGHT_OBJ&&(ConstValue.P_FIGHT_OBJ=new FightingModule(this.context)),ConstValue.P_FIGHT_OBJ.initMapData(e.d),FightingModule.readyTwo&&!FightingModule.readyRes&&(ConstValue.P_FIGHT_OBJ.releaseVsPanel(),ConstValue.P_FIGHT_OBJ.updateInfo(this.context.dDataInfo2)),n.label=8;case 8:return[3,23];case 9:return"openDiyMapUI"!=e.f?[3,10]:(""!=e.m||1!=e.s||null==ConstValue.P_MAP_OBJ&&(ConstValue.P_MAP_OBJ=new MapDIYModule(this.context,e.d,1)),[3,23]);case 10:return"showAllClassList"!=e.f&&"reflashClassList"!=e.f?[3,11]:(""!=e.m||1!=e.s||(this.roleClassData=e.d.allRoleList,null==this.panelNotice?this.showNotice("resource/eui_skins/UserUI/RoleSelectUI.exml","btn_img_info"):this.updateRoleClass(this.roleSelectIdx)),[3,23]);case 11:return"openShopUI"!=e.f?[3,12]:(""!=e.m||1!=e.s||(this.dShopOrBagData=e.d,this.shopUIType=1,null==this.panelNotice?this.showNotice("resource/eui_skins/UserUI/PayShopUI.exml","btn_map_shop"):(this.updateShopUI(!1),t=this.dShopOrBagData.lShopInfo.length,t>0&&this.clickShopItem(this.shopItemClickName))),[3,23]);case 12:return"openBagUI"!=e.f?[3,13]:(""!=e.m||1!=e.s||(this.dShopOrBagData=e.d,this.shopUIType=2,null==this.panelNotice?this.showNotice("resource/eui_skins/UserUI/BagUI.exml","btn_map_bag"):(this.updateShopUI(!1),this.clickShopItem(this.shopItemClickName))),[3,23]);case 13:return"Buy"!=e.f?[3,14]:(""!=e.m||1!=e.s||0==e.d.err,[3,23]);case 14:return"getMyMaps"!=e.f?[3,15]:(""!=e.m||1!=e.s||FightingModule.Delay(500,function(){this.selectMapData=e.d,this.showNotice("resource/eui_skins/UserUI/MapViewUI.exml","getMyMaps")},this),[3,23]);case 15:return"C2GOpenWujinUI"!=e.f?[3,16]:(""!=e.m||1!=e.s||(this.barrData=e.d,this.showNotice("resource/eui_skins/UserUI/noEndBarrUI.exml","btn_noend_pve")),[3,23]);case 16:return"C2GGotoBarrier"!=e.f?[3,17]:(""!=e.m||1!=e.s,[3,23]);case 17:return"SeventDayReward"!=e.f?[3,18]:(""!=e.m||1!=e.s||(this.seventData=e.d,null==this.panelNotice?this.showNotice("resource/eui_skins/UserUI/SeventDayGet.exml",e.f):this.handleSeventDay()),[3,23]);case 18:return"open1V1Room"!=e.f&&"open1V1RoomByMap"!=e.f?[3,22]:""==e.m&&1==e.s?[3,19]:[3,21];case 19:return CommonTools.log("shareAppMessage-------1"),Main.roomkey=e.d.roomkey,i=window.platform,[4,i.shareAppMessage(e.d.roomkey)];case 20:n.sent(),n.label=21;case 21:return[3,23];case 22:"showMatch1v1RoomUI"==e.f?""!=e.m||1!=e.s||(null!=e.d.roomID&&(Main.roomkey=e.d.roomID),null==this.showWxVsPanel?this.showWxVsUI(e.d):this.updateWxVsUI(e.d)):("openRnakUI"==e.f||"getTotalPvpRank"==e.f||"getTotalLvRank"==e.f)&&(""!=e.m||1!=e.s||(this.lRank=e.d.lRank,this.lMyRank=e.d.myRank,this.sMyRankDesc=e.d.myRankDesc,"openRnakUI"==e.f?this.showNotice("resource/eui_skins/UserUI/NewRankUI.exml","btn_rank"):this.handlePanel(this.panelNotice,e.f),CommonTools.log("this.lRank-------------"+this.lRank))),n.label=23;case 23:return[2]}})})},e.prototype.closeNotice=function(){CommonTools.niceTip(this.panelNotice,2,this)},e.prototype.closeWxVsUI=function(){if(this.isMainRoomer){var e=CommonTools.getDataJsonStr("remove1V1Room",1,{});ConstValue.P_NET_OBJ.sendData(e),this.isMainRoomer=!1}else{var e=CommonTools.getDataJsonStr("leaveGame1v1",1,{fightRoomKey:Main.roomkey});ConstValue.P_NET_OBJ.sendData(e)}CommonTools.niceTip(this.showWxVsPanel,2,this)},e.prototype.closeNice=function(){null!=this.showWxVsPanel&&null==this.panelNotice?(null!=this.maskBg2&&this.context.removeChild(this.maskBg2),this.maskBg2=null,this.context.removeChild(this.showWxVsPanel),this.showWxVsPanel=null):null!=this.panelSub&&null!=this.panelNotice?(null!=this.bodyAniDown2&&(this.panelSub.removeChild(this.bodyAniDown2),this.bodyAniDown2=null),null!=this.maskBg2&&this.context.removeChild(this.maskBg2),this.maskBg2=null,this.context.removeChild(this.panelSub),this.panelSub=null):(null!=this.bodyAniDown&&(this.panelNotice.removeChild(this.bodyAniDown),this.bodyAniDown=null),null!=this.panelNotice&&this.context.removeChild(this.panelNotice),null!=this.maskBg&&this.context.removeChild(this.maskBg),this.maskBg=null,this.panelNotice=null,this.dShopOrBagData=null,this.shopPageType=0,this.shopItemNo=0,this.shopItemItemID=0,this.shopItemName="",this.shopItemClickName="")},e.prototype.closeSub=function(){null!=this.panelSub&&this.context.removeChild(this.panelSub),this.panelSub=null},e.prototype.clear=function(){this.closeSub(),this.context.removeChild(this.panel),ConstValue.P_HALL_OBJ=null},e.isNoEnd=!1,e}();__reflect(HallModule.prototype,"HallModule");var LoginModule=function(){function e(e){this.context=e,this.init()}return e.prototype.init=function(){return __awaiter(this,void 0,void 0,function(){var e,t,i,n;return __generator(this,function(o){switch(o.label){case 0:return this.objChild=this.context.addBackGround("bg_ppt_1_png"),this.context.addChild(this.objChild),this.panel=new eui.Panel,this.panel.skinName="resource/eui_skins/UserUI/LoginUI.exml",this.panel.title="Title",this.panel.horizontalCenter=0,this.panel.verticalCenter=0,this.context.addChild(this.panel),this.panel.getChildByName("btn_login").addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.panel.getChildByName("btn_registe").addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.panel.getChildByName("account_lb_txt").addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.panel.getChildByName("password_lb_txt").addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),CommonTools.fixFix(this.context,this.panel.getChildByName("btn_login"),2,-60,10),CommonTools.fixFix(this.context,this.panel.getChildByName("btn_registe"),2,-60,10),CommonTools.fixFix(this.context,this.panel.getChildByName("account_lb_txt"),2,0,20),CommonTools.fixFix(this.context,this.panel.getChildByName("password_lb_txt"),2,0,10),CommonTools.fixFix(this.context,this.panel.getChildByName("account_lb_title"),2,0,20),CommonTools.fixFix(this.context,this.panel.getChildByName("password_lb_title"),2,0,10),2!=ConstValue.p_LOGIN_MODEL?[3,3]:[4,platform.login()];
case 1:return e=o.sent(),t=JSON.parse(e),[4,platform.getUserInfo()];case 2:i=o.sent(),CommonTools.printObject(i),n=CommonTools.getDataJsonStr("loginWX",1,{openID:t.openid,sHead:i.avatarUrl,sName:i.nickName,iGender:i.gender}),null==ConstValue.P_NET_OBJ?ConstValue.P_NET_OBJ=new WebSocketUtil(n):ConstValue.P_NET_OBJ.sendData(n),o.label=3;case 3:return[2]}})})},e.prototype.onClick=function(e){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(i){if(null!=this.context.loadingView&&!ConstValue.P_IS_DEBUG)return CommonTools.log("还在加载中......return "),[2];switch(this.bClick||(this.bClick=!0),t=e.target.name){case"btn_notice":this.showNotice("resource/eui_skins/UserUI/ShengminUI.exml",t);break;case"btn_close":this.closeNotice();break;case"btn_forgetpas":this.showNotice("resource/eui_skins/UserUI/GetPassword.exml",t);break;case"btn_registe":this.showNotice("resource/eui_skins/UserUI/RegisteUI.exml",t);break;case"btn_login":this.btnClickLogin();break;case"btn_nologinman":break;case"btn_verify_forget":CommonTools.addCommonTips(this.context,ConstValue.P_SEND_VERIFY);break;case"btn_confirm_forget":this.btnClickConfirmForget();break;case"btn_verify_registe":CommonTools.addCommonTips(this.context,ConstValue.P_SEND_VERIFY);break;case"btn_confirm_registe":this.btnClickConfirmRegiste();break;default:CommonTools.log("11111111 default")}return[2]})})},e.prototype.btnClickLogin=function(){return __awaiter(this,void 0,void 0,function(){var e,t,i;return __generator(this,function(n){switch(n.label){case 0:return e=this.panel.getChildByName("account_lb_txt"),""==e.text?(CommonTools.addCommonTips(this.context,ConstValue.P_NULL_ACCOUNT),[2]):(t=this.panel.getChildByName("password_lb_txt"),""==t.text?(CommonTools.addCommonTips(this.context,ConstValue.P_NULL_PASSWORD),[2]):ConstValue.P_IS_DEBUG?(this.clear(),[4,this.context.loadResource("preloadHall",2)]):[3,2]);case 1:return n.sent(),[3,3];case 2:i=CommonTools.getDataJsonStr("login",1,{account:e.text,password:t.text}),null==ConstValue.P_NET_OBJ?ConstValue.P_NET_OBJ=new WebSocketUtil(i):ConstValue.P_NET_OBJ.sendData(i),ConstValue.cacheUserAccount=e.text,ConstValue.cacheUserPwd=t.text,n.label=3;case 3:return[2]}})})},e.prototype.clear=function(){this.context.removeChild(this.objChild),this.context.removeChild(this.panel),ConstValue.P_LOGIN_OBJ=null},e.prototype.btnClickConfirmForget=function(){var e=this.panelNotice.getChildByName("password_lb_txt");if(""==e.text)return void CommonTools.addCommonTips(this.context,ConstValue.P_NULL_PASSWORD);var t=this.panelNotice.getChildByName("verify_lb_txt");return""==t.text?void CommonTools.addCommonTips(this.context,ConstValue.P_NULL_VERIFY):(CommonTools.addCommonTips(this.context,ConstValue.P_SEND_MODIFY_SUCCESS),void this.closeNotice())},e.prototype.btnClickConfirmRegiste=function(){var e=this.panelNotice.getChildByName("invite_lb_txt");if(""==e.text)return void CommonTools.addCommonTips(this.context,ConstValue.P_NULL_INVITE);var t=this.panelNotice.getChildByName("account_lb_txt");if(""==t.text)return void CommonTools.addCommonTips(this.context,ConstValue.P_NULL_ACCOUNT);var i=this.panelNotice.getChildByName("password_lb_txt");if(""==i.text)return void CommonTools.addCommonTips(this.context,ConstValue.P_NULL_PASSWORD);var n=this.panelNotice.getChildByName("verify_lb_txt");if(""==n.text)return void CommonTools.addCommonTips(this.context,ConstValue.P_NULL_VERIFY);if(ConstValue.P_IS_DEBUG)CommonTools.addCommonTips(this.context,ConstValue.P_SEND_REGISTE_SUCCESS),this.closeNotice();else{var o=CommonTools.getDataJsonStr("register",1,{account:t.text,password:i.text,pcode:e.text});null==ConstValue.P_NET_OBJ?ConstValue.P_NET_OBJ=new WebSocketUtil(o):ConstValue.P_NET_OBJ.sendData(o)}},e.prototype.showNotice=function(e,t){this.panelNotice=new eui.Panel,this.panelNotice.skinName=e,this.panelNotice.title="Title",this.panelNotice.horizontalCenter=0,this.panelNotice.verticalCenter=0,this.context.addChild(this.panelNotice),this.panelNotice.getChildByName("btn_close").addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.handlePanel(this.panelNotice,t)},e.prototype.handlePacket=function(e){return __awaiter(this,void 0,void 0,function(){var t,i,n;return __generator(this,function(o){switch(o.label){case 0:return"register"!=e.f?[3,1]:""!=e.m||1!=e.s?(CommonTools.addCommonTips(this.context,ConstValue.P_SEND_REGISTE_FAIL),[2]):(CommonTools.addCommonTips(this.context,ConstValue.P_SEND_REGISTE_SUCCESS),this.closeNotice(),[3,5]);case 1:return"login"!=e.f&&"loginWX"!=e.f?[3,2]:(CommonTools.log("11111111 -----------------------------22"),""!=e.m||1!=e.s?(CommonTools.addCommonTips(this.context,ConstValue.P_SEND_LOGIN_FAIL),CommonTools.log("11111111 --------------------------------piercj default 1"),[2]):(ConstValue.cacheHasLoginSuccess||(CommonTools.log("11111111 --------------------------------piercj default 1"),t=CommonTools.getDataJsonStr("entergame",1,{}),ConstValue.P_NET_OBJ.sendData(t),ConstValue.cacheHasLoginSuccess=!0),[3,5]));case 2:return"entergame"!=e.f?[3,5]:""==e.m&&1==e.s?[3,3]:(CommonTools.addCommonTips(this.context,ConstValue.P_SEND_HALLBACK_FAIL),[2]);case 3:for(ConstValue.cacheUserInfo=e.d,i=1;i<this.panel.numChildren;i++)n=this.panel.getChildAt(i),n.visible=!1;return[4,this.context.loadResource("preloadHall",2)];case 4:o.sent(),this.clear(),o.label=5;case 5:return[2]}})})},e.prototype.handlePanel=function(e,t){switch(t){case"btn_forgetpas":e.getChildByName("btn_verify_forget").addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),e.getChildByName("btn_confirm_forget").addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this);break;case"btn_registe":e.getChildByName("btn_verify_registe").addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),e.getChildByName("btn_confirm_registe").addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this);break;default:CommonTools.log("22222222 default")}},e.prototype.closeNotice=function(){null!=this.panelNotice&&this.context.removeChild(this.panelNotice),this.panelNotice=null},e}();__reflect(LoginModule.prototype,"LoginModule");var MapDIYModule=function(){function e(t,i,n){this.initRow=9,this.initColumn=11,this.firstItemX=494.88,this.firstItemY=100.84,this.groundItemW=58,this.groundItemH=55,this.groundOffX=0,this.groundOffY=0,this.curFunc=1,this.curtype=1,this.curRes="",this.isShow=!1,this.posScrollerClose=0,this.resTitle=1,this.selectList={},this.txtMapName="输入地图名字",this.txtMapSign="输入地图个性签名",this.mapKey=0,this.testGround2=[1,1,1,1,1,1,2,2,1,1,1,1,1,1,1,1,1,2,1,2,1,1,1,1,1,3,1,1,2,2,1,1,1,3,2,2,1,1,1,2,2,3,1,1,1,1,3,1,1,1,2,2,1,1,1,1,2,1,1,1,1,2,3,2,1,1,1,1,1,1,1,1,2,3,2,1,1,1,1,1,1,1,1,2,3,2,1,1,1,1,1,1,1,1,2,3,2,1,1],this.testMap2=[0,0,0,0,0,0,0,0,5,6,0,0,5,0,0,0,0,0,6,5,6,0,0,0,0,0,0,0,0,6,5,6,0,0,0,0,0,0,5,0,6,5,6,0,0,0,13,0,0,0,0,6,5,6,0,0,9,6,0,0,0,0,0,0,0,0,0,9,6,0,0,0,0,6,5,6,0,0,9,6,0,0,0,0,6,5,6,0,0,12,11,0,0,0,0,6,5,6,0],this.iType=n,this.context=t,this.maskBg=new eui.Image("bg_ppt_1_png"),this.maskBg.width=this.context.getStageWidth(),this.maskBg.height=this.context.getStageHeight(),this.context.addChild(this.maskBg),this.panel=new eui.Panel,this.panel.skinName="resource/eui_skins/UserUI/mapDIYUI.exml",this.panel.title="Title",this.panel.horizontalCenter=0,this.panel.verticalCenter=0,this.context.addChild(this.panel),1==n?(this.testGround=i.DefaultBg,e.defaultData=i.DefaultBg):2==n?this.testGround=e.defaultData:(this.testGround=i.bgconf,this.testMap=i.layerconf),CommonTools.fixFix(this.context,this.panel,1,0,0);var o=new eui.Image("btn_back_png");o.width=60,o.height=60,o.x=44,o.y=10,o.name="goback_btn",this.context.addChild(o),o.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.matrix=[[0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0]],this.grid=new PF.Grid(11,9,this.matrix),this.op=new PF.Option,this.op.allowDiagonal=!1,this.finder=new PF.AStarFinder(this.op),this.initConfig()}return e.prototype.initConfig=function(){var e=this;LZMA.decompress(EBitUtil.getArr(new egret.ByteArray(RES.getRes("config_json"))),function(t){ConstValue.P_CONFIG=JSON.parse(t),e.initScene()},function(e){})},e.prototype.initMapData=function(e){},e.prototype.initScene=function(){this.panel.getChildByName("btn_ground_lb").addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.panel.getChildByName("btn_block_lb").addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.panel.getChildByName("btn_decorate_lb").addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.panel.getChildByName("STYLE_BTN").addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.panel.getChildByName("lb_1p").addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.panel.getChildByName("lb_2p").addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.panel.getChildByName("lb_eraser").addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.panel.getChildByName("lb_save").addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.panel.getChildByName("btn_rank").addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.panel.getChildByName("btn_mymap").addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.btn=this.panel.getChildByName("STYLE_BTN"),this.btnGround=this.panel.getChildByName("btn_ground"),this.btnBlock=this.panel.getChildByName("btn_block"),this.btnDecorate=this.panel.getChildByName("btn_decorate"),this.tDi=this.panel.getChildByName("t_di"),this.tBiao=this.panel.getChildByName("t_biao"),this.tZhang=this.panel.getChildByName("t_zhang"),this.tAi=this.panel.getChildByName("t_ai"),this.tZhuang=this.panel.getChildByName("t_zhuang"),this.tShi=this.panel.getChildByName("t_shi");var t=this.panel.getChildByName("coin_num_lb");t.text=ConstValue.cacheUserInfo.coin;var i=this.panel.getChildByName("zuan_num_lb");i.text=ConstValue.cacheUserInfo.diamond,e.ONE_P="",e.TWO_P="";for(var n=0,o=0;o<this.initRow;o++)for(var s=function(t){var i=a.groundItemW,s=a.groundItemH,l=a.groundOffX,r=a.groundOffY;o>0&&(r=7),t>0&&(l=4);var h=a.firstItemX+i*t+l*t,u=a.firstItemY+s*o+r*o,c={img:"res_"+a.testGround[n]+"_png",x:h,y:u,name:"ground_"+n,curIdx:n},d=new Fight.MapItem(c);if(d.setRow(o),d.setColumn(t),d.setType(ConstValue.P_CONFIG.MapBase[a.testGround[n].toString()].Type),a.panel.addChild(d),d.scaleX=.7,d.scaleY=.7,e.groundLayerSubObj[n.toString()]=d,d.itemRange[0]=497+55*t+6*t,d.itemRange[1]=d.itemRange[0]+55,d.itemRange[2]=103+55*o+7*o,d.itemRange[3]=d.itemRange[2]+55,d.setRes(a.testGround[n]),d.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){return""==this.curRes&&1==this.curFunc?void CommonTools.addCommonTips(this.context,"请选择左侧资源"):void d.checkRange2(this.curRes,this.curtype,this.curFunc)},a),d.addEventListener(egret.TouchEvent.TOUCH_MOVE,function(){return""==this.curRes&&1==this.curFunc?void CommonTools.addCommonTips(this.context,"请选择左侧资源"):void d.checkRange2(this.curRes,this.curtype,this.curFunc)},a),3==a.iType)if(a.testMap[n]>0&&a.testMap[n]<100){var g="res_"+a.testMap[n]+"_png",m=ConstValue.P_CONFIG.MapBase[a.testMap[n].toString()];d.checkRange2(g,m.Type,1)}else a.testMap[n]>100&&(119==a.testMap[n]?d.checkRange2(null,2,3):d.checkRange2(null,2,4));n++},a=this,l=0;l<this.initColumn;l++)s(l);this.drawDownList(),this.resGroup=this.panel.getChildByName("res_scroller").getChildByName("res_group"),this.initResList(1,1),3==this.iType&&this.clickBolck()},e.prototype.initResList=function(e,t){this.resGroup.removeChildren(),this.selectList={};var i=0,n=function(n){var s=ConstValue.P_CONFIG.MapBase[n];if(s.mapType==e&&s.Type==t){var a=new eui.Image(s.res+"_png"),l=new eui.Image("diy_item_bg_png");o.resGroup.addChild(l),o.resGroup.addChild(a);var r=100,h=30,u=10,c=0;if(1==t?(r=82,h=0,u=0):2==t&&(h=28,u=0,3>i&&(c=5)),a.x=i%3*82+10+i%3*10,a.y=parseInt(i/3+"")*r+10+10*parseInt(i/3+"")-h-parseInt(i/3+"")*u+c,1==t?(l.x=a.x-2.25,l.y=a.y-2.5):(l.x=a.x-2,l.y=a.y+24,l.scaleY=1.15),0==i){o.curFunc=1,o.curRes=s.res+"_png";for(var d in o.selectList){var g=o.selectList[d];g.source="diy_item_bg_png"}l.source="diy_select_kuan_png"}i++,o.selectList[i.toString()]=l,a.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.curFunc=1,this.curRes=s.res+"_png";for(var e in this.selectList){var t=this.selectList[e];t.source="diy_item_bg_png"}l.source="diy_select_kuan_png"},o)}},o=this;for(var s in ConstValue.P_CONFIG.MapBase)n(s)},e.prototype.viewMapSubLayer=function(t){for(var i in e.groundLayerSubObj){var n=e.groundLayerSubObj[i];n.viewSub(t)}},e.prototype.clickGround=function(){this.initResList(this.resTitle,1),this.viewMapSubLayer(!1),this.curFunc=1,this.curtype=1,this.btnGround.source="diy_page_yes_png",this.btnBlock.source="diy_page_not_png",this.btnDecorate.source="diy_page_not_png",this.tDi.textColor=16242333,this.tBiao.textColor=16242333,this.tZhang.textColor=14005920,this.tAi.textColor=14005920,this.tZhuang.textColor=14005920,this.tShi.textColor=14005920},e.prototype.closeNice=function(){null!=this.panelSave&&this.context.removeChild(this.panelSave),this.panelSave=null,null!=this.panelRank&&this.context.removeChild(this.panelRank),this.panelRank=null,null!=this.maskBg2&&this.context.removeChild(this.maskBg2)},e.prototype.clickBolck=function(){this.initResList(this.resTitle,2),this.viewMapSubLayer(!0),this.curFunc=1,this.curtype=2,this.btnGround.source="diy_page_not_png",this.btnBlock.source="diy_page_yes_png",this.btnDecorate.source="diy_page_not_png",this.tDi.textColor=14005920,this.tBiao.textColor=14005920,this.tZhang.textColor=16242333,this.tAi.textColor=16242333,this.tZhuang.textColor=14005920,this.tShi.textColor=14005920},e.prototype.onClick=function(e){return __awaiter(this,void 0,void 0,function(){var t,i,n,o,s,a,l,r,h;return __generator(this,function(u){switch(t=e.target.name,CommonTools.log("==========name::::"+t),t){case"STYLE_BTN":this.changeListType();break;case"btn_rank":i=CommonTools.getDataJsonStr("getNewRank",1,{}),ConstValue.P_NET_OBJ.sendData(i);break;case"btn_mymap":n=CommonTools.getDataJsonStr("getMyMaps",1,{}),ConstValue.P_NET_OBJ.sendData(n);break;case"btn_close":CommonTools.niceTip(this.panelRank,2,this);break;case"btn_ground_lb":this.clickGround();break;case"btn_block_lb":this.clickBolck();break;case"btn_decorate_lb":this.initResList(this.resTitle,3),this.viewMapSubLayer(!0),this.curFunc=1,this.curtype=3,this.btnGround.source="diy_page_not_png",this.btnBlock.source="diy_page_not_png",this.btnDecorate.source="diy_page_yes_png",this.tDi.textColor=14005920,this.tBiao.textColor=14005920,this.tZhang.textColor=14005920,this.tAi.textColor=14005920,this.tZhuang.textColor=16242333,this.tShi.textColor=16242333;break;case"goback_btn":this.clear();break;case"lb_1p":if(1==this.curtype)return CommonTools.addCommonTips(this.context,"当前在地表层，请选择障碍层或者装饰层"),[2];this.curFunc=3;break;case"lb_2p":if(1==this.curtype)return CommonTools.addCommonTips(this.context,"当前在地表层，请选择障碍层或者装饰层"),[2];this.curFunc=4;break;case"lb_eraser":this.curFunc=2;break;case"btn_close_edit":CommonTools.niceTip(this.panelSave,2,this);break;case"btn_confirm_modify":this.saveMap();break;case"lb_save":if(!this.checkGroundValidate())return CommonTools.addCommonTips(this.context,"地表层不能有空块"),[2];if(!this.checkPlayers())return CommonTools.addCommonTips(this.context,"需要完整p1和p2,请设置位置"),[2];if(!this.checkPathValidate())return CommonTools.addCommonTips(this.context,"玩家间不联通，请合理设计"),[2];this.openSaveUI();break;case"lb_new":o=this.panelRank.getChildByName("match_rank_bg"),s=this.panelRank.getChildByName("lv_rank_bg"),o.source="map_rank_normal_png",s.source="map_rank_select_png",a=CommonTools.getDataJsonStr("getNewRank",1,{}),ConstValue.P_NET_OBJ.sendData(a);break;case"lb_hot":l=this.panelRank.getChildByName("match_rank_bg"),r=this.panelRank.getChildByName("lv_rank_bg"),l.source="map_rank_select_png",r.source="map_rank_normal_png",h=CommonTools.getDataJsonStr("getHopRank",1,{}),ConstValue.P_NET_OBJ.sendData(h);break;default:CommonTools.log("11111111 default")}return[2]})})},e.prototype.changeListType=function(){this.isShow?(this.isShow=!1,this.scroller.visible=!1):(this.isShow=!0,this.scroller.visible=!0)},e.prototype.drawDownList=function(){var e=["基础主题","吃货主题","暗黑主题"];this.list=new eui.List,this.list.width=170,this.list.dataProvider=new eui.ArrayCollection(e),this.list.selectedIndex=0,this.list.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onChange,this);var t=new eui.Scroller;t.height=200,t.viewport=this.list,t.x=this.btn.x,t.y=this.btn.y+this.btn.height,t.visible=!1,this.panel.addChild(t),this.scroller=t},e.prototype.onChange=function(e){this.resTitle=this.list.selectedIndex+1,this.initResList(this.resTitle,1),this.viewMapSubLayer(!1),this.curtype=1,this.changeListType(),this.clickGround()},e.prototype.clear=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return this.context.removeChild(this.panel),e.groundLayerSubObj={},[4,this.context.loadResource("preloadHall",2)];case 1:return t.sent(),ConstValue.P_MAP_OBJ=null,[2]}})})},e.prototype.updateByClickAdd=function(){this.context.removeChild(this.panel),e.groundLayerSubObj={},ConstValue.P_MAP_OBJ=null,ConstValue.P_MAP_OBJ=new e(this.context,null,2)},e.prototype.updateByClickModify=function(t){this.context.removeChild(this.panel),e.groundLayerSubObj={},ConstValue.P_MAP_OBJ=null,ConstValue.P_MAP_OBJ=new e(this.context,t,3),ConstValue.P_MAP_OBJ.mapKey=t.id},e.prototype.checkGroundValidate=function(){for(var t in e.groundLayerSubObj){var i=e.groundLayerSubObj[t];if(i.groundEmpty)return!1}return!0},e.prototype.checkPlayers=function(){var t=!1,i=!1;for(var n in e.groundLayerSubObj){var o=e.groundLayerSubObj[n];119==o.isPlayer?t=!0:120==o.isPlayer&&(i=!0)}return t&&i?!0:!1},e.prototype.getPath=function(e,t,i,n){var o=this.grid.clone();return this.finder.findPath(e,t,i,n,o)},e.prototype.checkPathValidate=function(){var t=-1,i=-1,n=-1,o=-1,s=!1;for(var a in e.groundLayerSubObj){var l=e.groundLayerSubObj[a];2==l.subType&&0==l.isPlayer&&this.grid.setWalkableAt(l.getColumn(),l.getRow(),!1),119==l.isPlayer?(t=l.getColumn(),i=l.getRow()):120==l.isPlayer&&(n=l.getColumn(),o=l.getRow())}var r=this.getPath(t,i,n,o);r.length>0&&(s=!0);for(var a in e.groundLayerSubObj){var l=e.groundLayerSubObj[a];2==l.subType&&0==l.isPlayer&&this.grid.setWalkableAt(l.getColumn(),l.getRow(),!0)}return s},e.prototype.saveMap=function(){var t=this.panelSave.getChildByName("map_name_tx");if(""==t.text)return void CommonTools.addCommonTips(this.context,"名字不能为空");if(t.text.length>10)return void CommonTools.addCommonTips(this.context,"名字在10个长度内");var i=this.panelSave.getChildByName("map_sign_tx");if(""==i.text)return void CommonTools.addCommonTips(this.context,"签名不能为空");if(i.text.length>50)return void CommonTools.addCommonTips(this.context,"名字在50个长度内");this.txtMapName=t.text,this.txtMapSign=i.text;for(var n in this.testMap2)this.testMap2[n]=0;for(var n in e.groundLayerSubObj){var o=e.groundLayerSubObj[n];this.testGround2[parseInt(n)]=o.res,o.subType>0&&(this.testMap2[parseInt(n)]=o.resSub)}var s=CommonTools.getDataJsonStr("saveMap",1,{lBgConf:this.testGround2,lLayerConf:this.testMap2,mapName:t.text,mapSign:i.text,mapkey:this.mapKey});ConstValue.P_NET_OBJ.sendData(s)},e.prototype.openSaveUI=function(){this.maskBg2=new eui.Image("mask_layer_png"),this.maskBg2.width=this.context.getStageWidth(),this.maskBg2.height=this.context.getStageHeight(),this.context.addChild(this.maskBg2),this.panelSave=new eui.Panel,this.panelSave.skinName="resource/eui_skins/UserUI/SaveMapTipUI.exml",this.panelSave.title="Title",this.panelSave.horizontalCenter=0,this.panelSave.verticalCenter=0,this.context.addChild(this.panelSave),CommonTools.niceTip(this.panelSave,1,this);var e=this.panelSave.getChildByName("map_name_tx");e.text=this.txtMapName;var t=this.panelSave.getChildByName("map_sign_tx");t.text=this.txtMapSign,CommonButtonHandle.beginTouch(this.panelSave.getChildByName("btn_close_edit"),this),this.panelSave.getChildByName("btn_close_edit").addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),CommonButtonHandle.beginTouch(this.panelSave.getChildByName("btn_confirm_modify"),this),this.panelSave.getChildByName("btn_confirm_modify").addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this)},e.prototype.openRankUI=function(e){this.maskBg2=new eui.Image("mask_layer_png"),this.maskBg2.width=this.context.getStageWidth(),this.maskBg2.height=this.context.getStageHeight(),this.context.addChild(this.maskBg2),this.panelRank=new eui.Panel,this.panelRank.skinName="resource/eui_skins/UserUI/MapRankUI.exml",this.panelRank.title="Title",this.panelRank.horizontalCenter=0,this.panelRank.verticalCenter=0,this.context.addChild(this.panelRank),CommonTools.fixFix(this.context,this.panelRank,1,0,0),CommonTools.niceTip(this.panelRank,1,this),this.updateRankUI(e),CommonButtonHandle.beginTouch(this.panelRank.getChildByName("btn_close"),this),this.panelRank.getChildByName("btn_close").addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.panelRank.getChildByName("lb_new").addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.panelRank.getChildByName("lb_hot").addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this)},e.prototype.openViewUI=function(e){this.maskBg2=new eui.Image("mask_layer_png"),this.maskBg2.width=this.context.getStageWidth(),this.maskBg2.height=this.context.getStageHeight(),this.context.addChild(this.maskBg2),this.panelRank=new eui.Panel,this.panelRank.skinName="resource/eui_skins/UserUI/MapViewUI.exml",this.panelRank.title="Title",this.panelRank.horizontalCenter=0,this.panelRank.verticalCenter=0,this.context.addChild(this.panelRank),CommonTools.fixFix(this.context,this.panelRank,1,0,0),CommonTools.niceTip(this.panelRank,1,this);var t=this.panelRank.getChildByName("fighting_parent").getChildByName("scroll").getChildByName("scroll_group"),i=0,n=function(n){var s=e[n],a=new eui.Panel;a.skinName="resource/eui_skins/UserUI/MapViewGroup.exml",a.name="p_"+i,a.x+=40,a.y+=50+10*i+255*i,t.addChild(a),a.getChildByName("view_add").visible=!1,a.getChildByName("view_add_btn").visible=!1;var l=a.getChildByName("group_1"),r=l.getChildByName("lb_title");r.text=s.mapName;var h=l.getChildByName("lb_author");h.text=ConstValue.cacheUserInfo.name;var u=l.getChildByName("lb_sign");if(u.text=s.mapSign,a.getChildByName("view_fight_btn").addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){var i=CommonTools.getDataJsonStr("setFightMap",1,{mapId:s.id});ConstValue.P_NET_OBJ.sendData(i);for(var n=t.numChildren,o=0;n>o;o++){var l=t.getChildByName("p_"+o),r=l.getChildByName("fighting_lb_png");null!=r&&l.removeChild(r)}var h=new eui.Image("fighting_lb_png");h.name="fighting_lb_png",a.addChild(h),h.x=6,h.y=6},o),a.getChildByName("view_change_btn").addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){CommonTools.niceTip(this.panelRank,2,this),this.updateByClickModify(s)},o),new MapMiniDIYModule(a,s.bgconf,s.layerconf,2),1==s.isFight){var c=new eui.Image("fighting_lb_png");c.name="fighting_lb_png",a.addChild(c),c.x=6,c.y=6}i++},o=this;for(var s in e)n(s);var a=new eui.Panel;a.skinName="resource/eui_skins/UserUI/MapViewGroup.exml",a.name="p_"+i,a.x+=40,a.y+=50+10*i+255*i,t.addChild(a);var l=a.getChildByName("group_1");l.visible=!1,a.getChildByName("view_fight_btn").visible=!1,a.getChildByName("view_change_btn").visible=!1,a.getChildByName("view_add_btn").addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){CommonTools.niceTip(this.panelRank,2,this),this.updateByClickAdd()},this),CommonButtonHandle.beginTouch(this.panelRank.getChildByName("btn_close"),this),this.panelRank.getChildByName("btn_close").addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this)},e.prototype.updateRankUI=function(e){var t=this.panelRank.getChildByName("fighting_parent").getChildByName("scroll").getChildByName("scroll_group");t.removeChildren();var i=function(i){var o=e[i],s=new eui.Panel;s.skinName="resource/eui_skins/UserUI/MapRankGroup.exml",s.name="p_"+i,s.x+=40,s.y+=50+10*parseInt(i)+255*parseInt(i),t.addChild(s);var a=s.getChildByName("group_1"),l=a.getChildByName("lb_title");l.text=o.mapName;var r=a.getChildByName("lb_author");r.text=o.name;var h=a.getChildByName("lb_sign");h.text=o.mapSign;var u=a.getChildByName("like_num");u.text=o.like;var c=a.getChildByName("like_heart");CommonButtonHandle.beginTouch(c,n),c.addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){var t=CommonTools.getDataJsonStr("addLike",1,{mapKey:o.mapkey});ConstValue.P_NET_OBJ.sendData(t)},n),new MapMiniDIYModule(s,o.lBgconf,o.lLayerconf,1)},n=this;for(var o in e)i(o)},e.prototype.handlePacket=function(e){"saveMap"==e.f?""!=e.m||1!=e.s||(CommonTools.niceTip(this.panelSave,2,this),this.mapKey=e.d.mapkey,CommonTools.addCommonTips(this.context,"保存成功")):"getNewRank"==e.f?""!=e.m||1!=e.s||(null!=this.panelRank?this.updateRankUI(e.d.lnewRank):this.openRankUI(e.d.lnewRank)):"getHopRank"==e.f?""!=e.m||1!=e.s||this.updateRankUI(e.d.lhotRank):"getMyMaps"==e.f&&(""!=e.m||1!=e.s||this.openViewUI(e.d))},e.groundLayerSubObj={},e.ONE_P="",e.TWO_P="",e.defaultData={},e}();__reflect(MapDIYModule.prototype,"MapDIYModule");var MapMiniDIYModule=function(e){function t(t,i,n,o){var s=e.call(this)||this;return s.initRow=9,s.initColumn=11,s.firstItemX=494.88,s.firstItemY=100.84,s.groundItemW=58,s.groundItemH=55,s.groundOffX=0,s.groundOffY=0,s.testGround2=[1,24,24,1,2,2,2,1,1,1,26,1,1,1,1,1,1,1,1,1,1,1,2,2,1,1,1,2,3,1,1,1,1,2,2,1,1,1,1,1,1,1,1,1,2,1,1,1,25,1,2,1,1,1,1,1,1,1,3,1,1,1,1,2,1,1,1,1,1,1,1,1,1,1,2,1,1,1,1,1,1,1,1,1,1,2,1,2,1,1,1,1,3,3,1,1,2,2,2],s.testMap2=[119,0,7,7,16,21,16,7,7,0,0,0,4,4,20,21,4,21,20,4,4,0,0,0,9,9,16,4,16,9,9,0,0,6,19,5,5,11,4,11,5,5,16,6,6,19,5,11,0,4,0,11,5,16,6,6,19,5,5,11,4,11,7,5,16,6,0,0,0,4,16,4,16,4,0,0,0,0,4,4,4,12,19,12,4,4,4,0,0,20,20,12,16,19,16,12,20,20,120],s.type=1,s.context=t,s.type=o,s.panel=new eui.Panel,s.panel.skinName="resource/eui_skins/UserUI/mapMiniDIYUI.exml",s.panel.title="Title",s.context.addChild(s.panel),s.testGround=i,s.testMap=n,s.initConfig(),s}return __extends(t,e),t.prototype.initConfig=function(){var e=this;LZMA.decompress(EBitUtil.getArr(new egret.ByteArray(RES.getRes("config_json"))),function(t){ConstValue.P_CONFIG=JSON.parse(t),e.initScene()},function(e){})},t.prototype.initScene=function(){for(var e=0,i=0;i<this.initRow;i++)for(var n=0;n<this.initColumn;n++){var o=this.groundItemW,s=this.groundItemH,a=this.groundOffX,l=this.groundOffY;i>0&&(l=7),n>0&&(a=4);var r=this.firstItemX+o*n+a*n,h=this.firstItemY+s*i+l*i,u={img:"res_"+this.testGround[e]+"_png",x:r,y:h,name:"ground_"+e,curIdx:e},c=new Fight.MapItem(u);if(c.setRow(i),c.setColumn(n),c.setType(ConstValue.P_CONFIG.MapBase[this.testGround[e].toString()].Type),this.panel.addChild(c),c.scaleX=.7,c.scaleY=.7,t.groundLayerSubObj[e.toString()]=c,c.itemRange[0]=497+55*n+6*n,c.itemRange[1]=c.itemRange[0]+55,c.itemRange[2]=103+55*i+7*i,c.itemRange[3]=c.itemRange[2]+55,c.setRes(this.testGround[e]),this.testMap[e]>0&&this.testMap[e]<100){var d="res_"+this.testMap[e]+"_png";c.addMiniBlock(d)}else this.testMap[e]>100&&c.addMiniPlayer(this.testMap[e]);e++}this.panel.scaleX=.4,this.panel.scaleY=.4,1==this.type?(this.panel.x=180,this.panel.y=-10):2==this.type?(this.panel.x=-180,this.panel.y=-10):3==this.type&&(this.panel.x=112,this.panel.y=116,this.panel.scaleX=.66,this.panel.scaleY=.66)},t.prototype.viewMapSubLayer=function(e){for(var i in t.groundLayerSubObj){var n=t.groundLayerSubObj[i];n.viewSub(e)}},t.groundLayerSubObj={},t}(egret.DisplayObjectContainer);__reflect(MapMiniDIYModule.prototype,"MapMiniDIYModule");var AIUtil=function(){function e(e,t,i,n,o){this.aiObj=null,this.iCmd=0,this.curPathPointIndex=0,this.boxMap={},this.curBoxMapIdex=0,this.workMap={},this.isVirtualOpen=!1,this.iOpenState=!1,this.iSmart=1,this.delayFunc=null,this.delayTimer=null,this.aiObj=e,this.aiObj.aiRobot=!0,this.initRow=i,this.initColumn=n,1==o?this.matrix=[[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0]]:2==o&&(this.matrix=[[0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0]]),this.grid=new PF.Grid(n,i,this.matrix),this.op=new PF.Option,this.op.allowDiagonal=!1,this.finder=new PF.AStarFinder(this.op);for(var s=0,a=0;i>a;a++)for(var l=0;n>l;l++){if(t[s]>0&&t[s]<100){this.grid.setWalkableAt(l,a,!1);var r=ConstValue.P_CONFIG.MapBase[t[s].toString()].Type;if(3==r){var h=Math.abs(this.aiObj.getColumn()-l);null==this.boxMap[h.toString()]&&(this.boxMap[h.toString()]={}),this.boxMap[h.toString()][l+"_"+a]=[l,a]}}s++}for(var a=0;i>a;a++)for(var l=0;n>l;l++){var u=this.getPath(l,a);u.length>0&&(this.workMap[l+"_"+a]=[l,a])}}return e.prototype.beNotifyHasFood=function(e,t){CommonTools.logAI("----------------***卧槽有东西吃了,看下能到达吗 "+e+"_"+t);var i=this.getPath(e,t);i.length>0?(CommonTools.logAI("----------------***就在眼前，去吃"),this.isVirtualOpen=!1,this.iCmd=3,this.removeDelay(),this.resetMove(i),CommonTools.logAI("move------55555555555555555555555555555555"),this.moveNext()):CommonTools.logAI("----------------***蛋疼无路可以过去吃")},e.prototype.moveNext=function(){if(this.iOpenState){if(this.isConnectEnemy())if(CommonTools.logAI("----------------***发现敌人"),this.isHasBoom()){CommonTools.logAI("----------------***发现有炸弹"),CommonTools.logAI("----------------***赶紧逃跑"),this.iCmd=1;var e=this.getSafePath(),t=this.getPath(e[0],e[1]);this.resetMove(t)}else{var i=this.getPath(this.getOtherPlayer().getColumn(),this.getOtherPlayer().getRow());i.length>0&&(CommonTools.logAI("----------------***杀啊。。。"),this.iCmd=2,this.resetMove(i))}else if(CommonTools.logAI("----------------***没有发现敌人"),this.isHasBoom()){CommonTools.logAI("----------------***发现有炸弹"),CommonTools.logAI("----------------***赶紧逃跑");var e=this.getSafePath();CommonTools.logAI("----------------***safePath:"+e);var t=this.getPath(e[0],e[1]);t.length>0&&(this.iCmd=1,this.resetMove(t))}else{CommonTools.logAI("----------------***不危险，找箱子");var n=this.getNextBox();if(1==this.iCmd&&(this.iCmd=0),null!=n&&0==this.iCmd){this.grid.setWalkableAt(n[0],n[1],!0),this.isVirtualOpen=!0;var o=this.getPath(n[0],n[1]);this.grid.setWalkableAt(n[0],n[1],!1),o.length>0&&(CommonTools.logAI("----------------***找箱子"),this.iCmd=2,this.resetMove(o))}}if(0==this.iCmd)return CommonTools.logAI("----------------***没有命令，主人"),CommonTools.logAI("move------6666666666666666666666666666666666"),void this.moveNext();this.curPathPointIndex++,CommonTools.logAI("this.iCmd------------aaaaaaaaaaaa----------"+this.iCmd+" this.curPathPointIndex:"+this.curPathPointIndex+" this.curPath:"+this.curPath);var s=this.curPath.length;if(this.isVirtualOpen&&(s=this.curPath.length-1),this.curPathPointIndex>=s)if(this.curPathPointIndex=0,this.isVirtualOpen){this.isVirtualOpen=!1,CommonTools.logAI("----------------***找到箱子了，要放炮了");var a=CommonTools.getDataJsonStr("syncPut",1,{x:this.aiObj.x,y:this.aiObj.y,idx:parseInt(this.aiObj.curMapIdx),playerID:this.aiObj.roleId});ConstValue.P_NET_OBJ.sendData2(a)}else if(CommonTools.logAI("----------------***到达终点，找下一件事情做"),1==this.iCmd)CommonTools.logAI("----------------***逃生中，躲3秒"),this.isConnectEnemy()?(this.removeDelay(),this.delayFunc=function(){CommonTools.logAI("move------7777777777777777777777777777777777"),1==this.iCmd&&(CommonTools.log("move------7777777777777777777777777777777777"),this.moveNext())},this.Delay(10)):(this.removeDelay(),this.delayFunc=function(){CommonTools.logAI("move------7777777777777777777777777777777777"),1==this.iCmd&&this.moveNext()},this.Delay(3800));else if(3==this.iCmd)CommonTools.logAI("----------------***吃了东西了"),this.iCmd=0,CommonTools.logAI("move------8888888888888888888888888888888888888888"),this.moveNext();else if(2==this.iCmd){CommonTools.logAI("----------------***炸死个扑街");
var a=CommonTools.getDataJsonStr("syncPut",1,{x:this.aiObj.x,y:this.aiObj.y,idx:parseInt(this.aiObj.curMapIdx),playerID:this.aiObj.roleId});ConstValue.P_NET_OBJ.sendData2(a)}else CommonTools.logAI("move------999999999999999999999999999999999999"),this.moveNext();else{if(1==this.iCmd&&this.curPathPointIndex>=4){CommonTools.logAI("----------------***逃跑也放雷");var a=CommonTools.getDataJsonStr("syncPut",1,{x:this.aiObj.x,y:this.aiObj.y,idx:parseInt(this.aiObj.curMapIdx),playerID:this.aiObj.roleId});ConstValue.P_NET_OBJ.sendData2(a)}this.move(this.curPath[this.curPathPointIndex][0],this.curPath[this.curPathPointIndex][1])}}},e.prototype.resetMove=function(e){this.curPathPointIndex=0,this.curPath=e},e.prototype.openBlock=function(e,t){this.setWalkAble(e,t,!0);var i=e+"_"+t;this.workMap[i]=[e,t],CommonTools.printMap(this.workMap);var n="";for(var o in this.boxMap){var s=this.boxMap[o];for(var a in s){var l=s[a];if(l[0]==e&&l[1]==t){n=o;break}}if(""!=n)break}""!=n&&(this.boxMap[n][e+"_"+t]=null,delete this.boxMap[n][e+"_"+t]);for(var o=0;o<this.initRow;o++)for(var a=0;a<this.initColumn;a++){var r=this.getPath(a,o);r.length>0&&null==this.workMap[a+"_"+o]&&(this.workMap[a+"_"+o]=[a,o])}},e.prototype.Delay=function(e){this.delayTimer=new egret.Timer(e,1),this.delayTimer.addEventListener(egret.TimerEvent.TIMER,this.delayFunc,this),this.delayTimer.start()},e.prototype.removeDelay=function(){null!=this.delayTimer&&(this.delayTimer.stop(),this.delayTimer.removeEventListener(egret.TimerEvent.TIMER,this.delayFunc,this),this.delayTimer=null,this.delayFunc=null)},e.prototype.getNextBox=function(){var e=this.boxMap[this.curBoxMapIdex.toString()],t=0;for(var i in e)t++;for(;0==t;){if(this.curBoxMapIdex++,this.curBoxMapIdex>=this.initColumn)return null;e=this.boxMap[this.curBoxMapIdex.toString()];for(var i in e)t++}for(var i in e){CommonTools.logAI("getNextBox************************tBox[i]:"+e[i]),this.grid.setWalkableAt(e[i][0],e[i][1],!0);var n=this.getPath(e[i][0],e[i][1]);if(this.grid.setWalkableAt(e[i][0],e[i][1],!1),n.length>0)return e[i]}return CommonTools.logAI("getNextBox************xxxxxx***no box*********"),this.curBoxMapIdex++,this.getNextBox()},e.prototype.isHasBoom=function(){if(this.isConnectEnemy())for(var e in FightingModule.bulletLayerSubObj)return!0;else for(var e in FightingModule.bulletLayerSubObj){var t=FightingModule.bulletLayerSubObj[e];if(t.owner.roleId==this.aiObj.roleId)return!0}return!1},e.prototype.getSafePath=function(){var e=null,t=100;if(CommonTools.printMap(this.workMap),this.isConnectEnemy())for(var i in this.workMap){var n=this.workMap[i],o=!0;for(var s in FightingModule.bulletLayerSubObj){var a=FightingModule.bulletLayerSubObj[s];if(a.getColumn()==n[0]||a.getRow()==n[1]){o=!1;break}}if(o){var l=this.getPath(n[0],n[1]);l.length>0&&l.length<t&&(t=l.length,e=n)}}else for(var i in this.workMap){var n=this.workMap[i],o=!0;for(var s in FightingModule.bulletLayerSubObj){var a=FightingModule.bulletLayerSubObj[s];if(a.owner.roleId==this.aiObj.roleId&&(a.getColumn()==n[0]||a.getRow()==n[1])){o=!1;break}}if(o){var l=this.getPath(n[0],n[1]);l.length>0&&l.length<t&&(t=l.length,e=n,CommonTools.logAI("getSafePath----miniLenChoose-----------------"+e))}}if(null!=e)return e;t=0;for(var i in this.workMap){var n=this.workMap[i],l=this.getPath(n[0],n[1]);l.length>t&&(t=l.length,e=n,CommonTools.logAI("getSafePath--22--miniLenChoose-----------------"+e))}return null!=e?e:null},e.prototype.getPath=function(e,t){var i=this.grid.clone();return this.finder.findPath(this.aiObj.getColumn(),this.aiObj.getRow(),e,t,i)},e.prototype.startAI=function(){if(this.iOpenState=!0,this.isConnectEnemy());else{CommonTools.logAI("----------------***开局打一炮");var e=CommonTools.getDataJsonStr("syncPut",1,{x:this.aiObj.x,y:this.aiObj.y,idx:parseInt(this.aiObj.curMapIdx),playerID:this.aiObj.roleId});ConstValue.P_NET_OBJ.sendData2(e)}},e.prototype.stopAI=function(){this.iOpenState=!1},e.prototype.isConnectEnemy=function(){var e=this.getPath(this.getOtherPlayer().getColumn(),this.getOtherPlayer().getRow());return 0==e.length?!1:!0},e.prototype.setWalkAble=function(e,t,i){this.grid.setWalkableAt(e,t,i)},e.prototype.getOtherPlayer=function(){for(var e in FightingModule.playerLayerSubObj){var t=FightingModule.playerLayerSubObj[e];if(t.roleId!=this.aiObj.roleId)return t}return null},e.prototype.move=function(e,t){var i=this.aiObj;null==this.aiObj.func&&(this.aiObj.func=function(e){i.setMoving(!0),i.move(-1,!0)},this.aiObj.addEventListener(egret.Event.ENTER_FRAME,this.aiObj.func,this.aiObj)),this.aiObj.setMoving(!0),this.aiObj.moveDetail(e,t)},e}();__reflect(AIUtil.prototype,"AIUtil");var Fight;!function(e){var t=function(e){function t(t){var i=e.call(this)||this;return i.whichSide=0,i.sideDes="",i.owner=null,i.effDic={},i.curLen=1,i.nextDic={},i.leftShowLimit=100,i.rightShowLimit=100,i.upShowLimit=100,i.downShowLimit=100,i.preBobo=null,i.bulletLen=1,i.hitMap={},i.whichSide=t.side,1==i.whichSide?i.sideDes="paopao":i.sideDes="paopao",i.bodyAni=CommonTools.getAnimDraw(RES.getRes(i.sideDes+"_json"),RES.getRes(i.sideDes+"_png"),"0"),1==ConstValue.P_FIGHT_OBJ.APP_MODE?(i.bodyAni.scaleX=1.4,i.bodyAni.scaleY=1.4,i.bodyAni.x+=2,i.bodyAni.y-=5):(i.scaleX=.7,i.scaleY=.7,i.bodyAni.scaleX=1.6,i.bodyAni.scaleY=1.6,i.bodyAni.x-=12,i.bodyAni.y-=15),i.addChild(i.bodyAni),i.x=t.x,i.y=t.y,i.name=t.name,i.curIdx=t.curIdx,i.bodyAni.play(-1),i}return __extends(t,e),t.prototype.setOwner=function(e){this.owner=e,this.bulletLen=this.owner.bulletLen},t.prototype.baozha=function(){FightingModule.Delay(3e3,function(){this.drawBaozha();for(var e in this.hitMap){var t=this.hitMap[e],i=0;if(1==this.owner.isAI&&(i=this.owner.roleId),this.owner.isMainPlayer||1==this.owner.isAI){var n=CommonTools.getDataJsonStr("syncBoomZhuan",1,{paopaoID:this.name,x:this.x,y:this.y,idx:this.curIdx,breakidx:t.getCurIdx(),playerID:i});ConstValue.P_NET_OBJ.sendData2(n)}}for(var e in FightingModule.bulletLayerSubObj){var t=FightingModule.bulletLayerSubObj[e],o=t.getPreBobo();if(null!=o)for(var s in o)s==this.name&&t.beBaozha()}},this)},t.prototype.beBaozha=function(){this.drawBaozha();for(var e in this.hitMap){var t=this.hitMap[e],i=0;if(1==this.owner.isAI&&(i=this.owner.roleId),this.owner.isMainPlayer||1==this.owner.isAI){var n=CommonTools.getDataJsonStr("syncBoomZhuan",1,{paopaoID:this.name,x:this.x,y:this.y,idx:this.curIdx,breakidx:t.getCurIdx(),playerID:i});ConstValue.P_NET_OBJ.sendData2(n)}}},t.prototype.setLeftLimit=function(e){this.leftShowLimit=e},t.prototype.setRightLimit=function(e){this.rightShowLimit=e},t.prototype.setDownLimit=function(e){this.downShowLimit=e},t.prototype.setUpLimit=function(e){this.upShowLimit=e},t.prototype.getLeftLimit=function(){return this.leftShowLimit},t.prototype.getRightLimit=function(){return this.rightShowLimit},t.prototype.getDownLimit=function(){return this.downShowLimit},t.prototype.getUpLimit=function(){return this.upShowLimit},t.prototype.getCurIdx=function(){return this.curIdx},t.prototype.checkHit=function(e,t,i){try{var n=0;1==this.owner.isAI&&(n=this.owner.roleId);for(var o in FightingModule.playerLayerSubObj){var s=FightingModule.playerLayerSubObj[o];if(CommonTools.logDebug("checkHit===========0============"+s.roleId+" len:"+i+" bul_row:"+this.row+" bul_column:"+this.column+" obj_row:"+s.getRow()+" obj_column:"+s.getColumn()+" director:"+t),"zhong"==t){if(FightingModule.groundLayerSubObjDanger[this.column+"_"+this.row].dangerCount++,FightingModule.groundLayerSubObjDanger[this.column+"_"+this.row].dangerPaoPaoObj=this,s.getRow()==this.row&&s.getColumn()==this.column){CommonTools.logDebug("checkHit===========1============"+s.roleId);var a=CommonTools.getDataJsonStr("syncBoomPlayer",1,{paopaoID:this.name,x:this.x,y:this.y,idx:this.curIdx,killrid:s.roleId,killidx:parseInt(s.curMapIdx),playerID:n});return ConstValue.P_NET_OBJ.sendData2(a),!0}}else if("up"==t){if(this.bulletLen!=this.curLen&&(FightingModule.groundLayerSubObjDanger[this.column+"_"+(this.row-i)].dangerCount++,FightingModule.groundLayerSubObjDanger[this.column+"_"+(this.row-i)].dangerPaoPaoObj=this),s.getColumn()==this.column&&this.row-i==s.getRow()){CommonTools.logDebug("checkHit===========2============"+s.roleId);var a=CommonTools.getDataJsonStr("syncBoomPlayer",1,{paopaoID:this.name,x:this.x,y:this.y,idx:this.curIdx,killrid:s.roleId,killidx:parseInt(s.curMapIdx),playerID:n});return ConstValue.P_NET_OBJ.sendData2(a),!0}}else if("down"==t){if(this.bulletLen!=this.curLen&&(FightingModule.groundLayerSubObjDanger[this.column+"_"+(this.row+i)].dangerCount++,FightingModule.groundLayerSubObjDanger[this.column+"_"+(this.row+i)].dangerPaoPaoObj=this),s.getColumn()==this.column&&this.row+i==s.getRow()){CommonTools.logDebug("checkHit===========3============"+s.roleId);var a=CommonTools.getDataJsonStr("syncBoomPlayer",1,{paopaoID:this.name,x:this.x,y:this.y,idx:this.curIdx,killrid:s.roleId,killidx:parseInt(s.curMapIdx),playerID:n});return ConstValue.P_NET_OBJ.sendData2(a),!0}}else if("left"==t){if(this.bulletLen!=this.curLen&&(FightingModule.groundLayerSubObjDanger[this.column-i+"_"+this.row].dangerCount++,FightingModule.groundLayerSubObjDanger[this.column-i+"_"+this.row].dangerPaoPaoObj=this),s.getRow()==this.row&&this.column-i==s.getColumn()){CommonTools.logDebug("checkHit===========4============"+s.roleId);var a=CommonTools.getDataJsonStr("syncBoomPlayer",1,{paopaoID:this.name,x:this.x,y:this.y,idx:this.curIdx,killrid:s.roleId,killidx:parseInt(s.curMapIdx),playerID:n});return ConstValue.P_NET_OBJ.sendData2(a),!0}}else if("right"==t&&(this.bulletLen!=this.curLen&&(FightingModule.groundLayerSubObjDanger[this.column+i+"_"+this.row].dangerCount++,FightingModule.groundLayerSubObjDanger[this.column+i+"_"+this.row].dangerPaoPaoObj=this),s.getRow()==this.row&&this.column+i==s.getColumn())){CommonTools.logDebug("checkHit===========5============"+s.roleId);var a=CommonTools.getDataJsonStr("syncBoomPlayer",1,{paopaoID:this.name,x:this.x,y:this.y,idx:this.curIdx,killrid:s.roleId,killidx:parseInt(s.curMapIdx),playerID:n});return ConstValue.P_NET_OBJ.sendData2(a),!0}}}catch(l){CommonTools.logError("checkHit==================error "+l)}return!1},t.prototype.drawBaozha=function(){try{CommonAudioHandle.playEffect("boom_mp3",1),this.removeChild(this.bodyAni),this.bodyAni=null,1==this.bulletLen?(this.effDic.zhong_1=CommonTools.getAnimDraw(RES.getRes("baozha_zhong_anim_json"),RES.getRes("baozha_zhong_anim_png"),"0"),this.addChild(this.effDic.zhong_1),this.effDic.zhong_1.play(-1),this.checkHit(this.effDic.zhong_1,"zhong",this.curLen),this.effDic.up_1=CommonTools.getAnimDraw(RES.getRes("baozha_last_anim_json"),RES.getRes("baozha_last_anim_png"),"0"),this.addChild(this.effDic.up_1),this.effDic.up_1.play(1),this.curLen>=this.upShowLimit&&(this.effDic.up_1.visible=!1),this.effDic.up_1.visible&&this.checkHit(this.effDic.up_1,"up",this.curLen),this.effDic.down_1=CommonTools.getAnimDraw(RES.getRes("baozha_last_anim_json"),RES.getRes("baozha_last_anim_png"),"0"),this.addChild(this.effDic.down_1),this.effDic.down_1.play(1),this.effDic.down_1.scaleY="-1",this.curLen>=this.downShowLimit&&(this.effDic.down_1.visible=!1),this.effDic.down_1.visible&&this.checkHit(this.effDic.down_1,"down",this.curLen),this.effDic.right_1=CommonTools.getAnimDraw(RES.getRes("baozha_last_anim_json"),RES.getRes("baozha_last_anim_png"),"0"),this.addChild(this.effDic.right_1),this.effDic.right_1.play(1),this.effDic.right_1.rotation=90,this.curLen>=this.rightShowLimit&&(this.effDic.right_1.visible=!1),this.effDic.right_1.visible&&this.checkHit(this.effDic.right_1,"right",this.curLen),this.effDic.left_1=CommonTools.getAnimDraw(RES.getRes("baozha_last_anim_json"),RES.getRes("baozha_last_anim_png"),"0"),this.addChild(this.effDic.left_1),this.effDic.left_1.play(1),this.effDic.left_1.rotation=-90,this.curLen>=this.leftShowLimit&&(this.effDic.left_1.visible=!1),this.effDic.left_1.visible&&this.checkHit(this.effDic.left_1,"left",this.curLen),1==ConstValue.P_FIGHT_OBJ.APP_MODE?(this.effDic.zhong_1.y+=28,this.effDic.up_1.y-=55,this.effDic.left_1.x-=70,this.effDic.left_1.y+=15,this.effDic.right_1.x+=70,this.effDic.right_1.y+=15,this.effDic.down_1.y+=82):(this.effDic.zhong_1.x-=12,this.effDic.zhong_1.y+=10,this.effDic.up_1.x-=10,this.effDic.up_1.y-=45,this.effDic.left_1.x-=70,this.effDic.left_1.y+=0,this.effDic.right_1.x+=58,this.effDic.right_1.y+=0,this.effDic.down_1.x-=13,this.effDic.down_1.y+=68),this.effDic.up_1.once(egret.Event.COMPLETE,function(e){this.effDic.up_1.visible&&(FightingModule.groundLayerSubObjDanger[this.column+"_"+(this.row-1)].dangerCount=0),this.removeChild(this.effDic.up_1),this.effDic.up_1=null,delete this.effDic.up_1},this),this.effDic.down_1.once(egret.Event.COMPLETE,function(e){this.effDic.down_1.visible&&(FightingModule.groundLayerSubObjDanger[this.column+"_"+(this.row+1)].dangerCount=0),this.removeChild(this.effDic.down_1),this.effDic.down_1=null,delete this.effDic.down_1},this),this.effDic.right_1.once(egret.Event.COMPLETE,function(e){this.effDic.right_1.visible&&(FightingModule.groundLayerSubObjDanger[this.column+1+"_"+this.row].dangerCount=0),this.removeChild(this.effDic.right_1),this.effDic.right_1=null,delete this.effDic.right_1},this),this.effDic.left_1.once(egret.Event.COMPLETE,function(e){this.effDic.left_1.visible&&(FightingModule.groundLayerSubObjDanger[this.column-1+"_"+this.row].dangerCount=0),this.removeChild(this.effDic.left_1),this.effDic.left_1=null,delete this.effDic.left_1,this.effDic.zhong_1.visible&&(FightingModule.groundLayerSubObjDanger[this.column+"_"+this.row].dangerCount=0),this.removeChild(this.effDic.zhong_1),this.effDic.zhong_1=null,delete this.effDic.zhong_1,null!=FightingModule.bulletLayerSubObj[this.name]&&(FightingModule.bulletLayer.removeChild(this),FightingModule.bulletLayerSubObj[this.name]=null,delete FightingModule.bulletLayerSubObj[this.name])},this)):(this.effDic["zhong_"+this.bulletLen]=CommonTools.getAnimDraw(RES.getRes("baozha_zhong_anim_json"),RES.getRes("baozha_zhong_anim_png"),"0"),this.addChild(this.effDic["zhong_"+this.bulletLen]),this.effDic["zhong_"+this.bulletLen].play(-1),1==ConstValue.P_FIGHT_OBJ.APP_MODE?this.effDic["zhong_"+this.bulletLen].y+=22:(this.effDic["zhong_"+this.bulletLen].x-=15,this.effDic["zhong_"+this.bulletLen].y+=6),this.checkHit(this.effDic["zhong_"+this.bulletLen],"zhong",this.curLen),this.addNext(this.effDic["zhong_"+this.bulletLen].x,this.effDic["zhong_"+this.bulletLen].y))}catch(e){CommonTools.logError("drawBaozha==================error "+e)}},t.prototype.addNext=function(e,t){FightingModule.Delay(20,function(){this.nextDic["up_"+this.curLen]=new eui.Image(RES.getRes("baozha_jie_png")),this.addChild(this.nextDic["up_"+this.curLen]),this.nextDic["up_"+this.curLen].x=e-47,this.nextDic["up_"+this.curLen].y=t-180-80*(this.curLen-1),CommonTools.logDebug("drawBaozha-------------this.curLen:"+this.curLen+" this.upShowLimit:"+this.upShowLimit),this.curLen>=this.upShowLimit&&(this.nextDic["up_"+this.curLen].visible=!1),this.nextDic["up_"+this.curLen].visible&&this.checkHit(this.nextDic["up_"+this.curLen],"up",this.curLen),this.nextDic["down_"+this.curLen]=new eui.Image(RES.getRes("baozha_jie_png")),this.addChild(this.nextDic["down_"+this.curLen]),this.nextDic["down_"+this.curLen].y=t+160+80*(this.curLen-1),this.nextDic["down_"+this.curLen].scaleY="-1",this.curLen>=this.downShowLimit&&(this.nextDic["down_"+this.curLen].visible=!1),this.nextDic["down_"+this.curLen].visible&&this.checkHit(this.nextDic["down_"+this.curLen],"down",this.curLen),1==ConstValue.P_FIGHT_OBJ.APP_MODE?this.nextDic["down_"+this.curLen].x=e-47:this.nextDic["down_"+this.curLen].x=e-44,this.nextDic["right_"+this.curLen]=new eui.Image(RES.getRes("baozha_jie_png")),this.addChild(this.nextDic["right_"+this.curLen]),this.nextDic["right_"+this.curLen].x=e+169+80*(this.curLen-1),this.nextDic["right_"+this.curLen].y=t-62,this.nextDic["right_"+this.curLen].rotation=90,this.curLen>=this.rightShowLimit&&(this.nextDic["right_"+this.curLen].visible=!1),this.nextDic["right_"+this.curLen].visible&&this.checkHit(this.nextDic["right_"+this.curLen],"right",this.curLen),this.nextDic["left_"+this.curLen]=new eui.Image(RES.getRes("baozha_jie_png")),this.addChild(this.nextDic["left_"+this.curLen]),this.nextDic["left_"+this.curLen].x=e-169-80*(this.curLen-1),this.nextDic["left_"+this.curLen].y=t-62,this.nextDic["left_"+this.curLen].rotation=90,this.nextDic["left_"+this.curLen].scaleY="-1",CommonTools.logDebug("drawBaozha-------------this.curLen:"+this.curLen+" this.leftShowLimit:"+this.leftShowLimit),this.curLen>=this.leftShowLimit&&(this.nextDic["left_"+this.curLen].visible=!1),this.nextDic["left_"+this.curLen].visible&&this.checkHit(this.nextDic["left_"+this.curLen],"left",this.curLen),this.curLen++,this.bulletLen==this.curLen?(this.baozhaLastEff(this.nextDic["up_"+(this.curLen-1)].x,this.nextDic["up_"+(this.curLen-1)].y,1),this.baozhaLastEff(this.nextDic["down_"+(this.curLen-1)].x,this.nextDic["down_"+(this.curLen-1)].y,2),this.baozhaLastEff(this.nextDic["right_"+(this.curLen-1)].x,this.nextDic["right_"+(this.curLen-1)].y,3),this.baozhaLastEff(this.nextDic["left_"+(this.curLen-1)].x,this.nextDic["left_"+(this.curLen-1)].y,4)):this.addNext(e,t)},this)},t.prototype.removePre=function(e){FightingModule.Delay(20,function(){try{0==e?(this.effDic["zhong_"+this.bulletLen].visible&&(FightingModule.groundLayerSubObjDanger[this.column+"_"+this.row].dangerCount=0),this.removeChild(this.effDic["zhong_"+this.bulletLen]),this.effDic["zhong_"+this.bulletLen]=null,delete this.effDic["zhong_"+this.bulletLen],null!=FightingModule.bulletLayerSubObj[this.name]&&(FightingModule.bulletLayer.removeChild(this),FightingModule.bulletLayerSubObj[this.name]=null,delete FightingModule.bulletLayerSubObj[this.name])):(this.nextDic["up_"+e].visible&&(FightingModule.groundLayerSubObjDanger[this.column+"_"+(this.row-e)].dangerCount=0),this.removeChild(this.nextDic["up_"+e]),this.nextDic["up_"+e]=null,delete this.nextDic["up_"+e],this.nextDic["down_"+e].visible&&(FightingModule.groundLayerSubObjDanger[this.column+"_"+(this.row+e)].dangerCount=0),this.removeChild(this.nextDic["down_"+e]),this.nextDic["down_"+e]=null,delete this.nextDic["down_"+e],this.nextDic["right_"+e].visible&&(FightingModule.groundLayerSubObjDanger[this.column+e+"_"+this.row].dangerCount=0),this.removeChild(this.nextDic["right_"+e]),this.nextDic["right_"+e]=null,delete this.nextDic["right_"+e],this.nextDic["left_"+e].visible&&(FightingModule.groundLayerSubObjDanger[this.column-e+"_"+this.row].dangerCount=0),this.removeChild(this.nextDic["left_"+e]),this.nextDic["left_"+e]=null,delete this.nextDic["left_"+e],this.removePre(e-1))}catch(t){CommonTools.logError("removePre==================error "+t)}},this)},t.prototype.baozhaLastEff=function(e,t,i){try{1==i?(this.effDic.up_1=CommonTools.getAnimDraw(RES.getRes("baozha_last_anim_json"),RES.getRes("baozha_last_anim_png"),"0"),this.addChild(this.effDic.up_1),this.effDic.up_1.play(1),this.effDic.up_1.x=e+48,this.effDic.up_1.y=t+30,this.effDic.up_1.once(egret.Event.COMPLETE,function(e){this.effDic.up_1.visible&&(FightingModule.groundLayerSubObjDanger[this.column+"_"+(this.row-this.curLen)].dangerCount=0),this.removeChild(this.effDic.up_1),this.effDic.up_1=null,delete this.effDic.up_1},this),this.curLen>=this.upShowLimit&&(this.effDic.up_1.visible=!1),this.effDic.up_1.visible&&this.checkHit(this.nextDic.up_1,"up",this.curLen)):2==i?(this.effDic.down_1=CommonTools.getAnimDraw(RES.getRes("baozha_last_anim_json"),RES.getRes("baozha_last_anim_png"),"0"),this.addChild(this.effDic.down_1),this.effDic.down_1.play(1),this.effDic.down_1.x=e+48,this.effDic.down_1.y=t-30,this.effDic.down_1.scaleY="-1",this.effDic.down_1.once(egret.Event.COMPLETE,function(e){this.effDic.down_1.visible&&(FightingModule.groundLayerSubObjDanger[this.column+"_"+(this.row+this.curLen)].dangerCount=0),this.removeChild(this.effDic.down_1),this.effDic.down_1=null,delete this.effDic.down_1},this),this.curLen>=this.downShowLimit&&(this.effDic.down_1.visible=!1),this.effDic.down_1.visible&&this.checkHit(this.nextDic.down_1,"down",this.curLen)):3==i?(this.effDic.right_1=CommonTools.getAnimDraw(RES.getRes("baozha_last_anim_json"),RES.getRes("baozha_last_anim_png"),"0"),this.addChild(this.effDic.right_1),this.effDic.right_1.play(1),this.effDic.right_1.x=e-25,this.effDic.right_1.y=t+47,this.effDic.right_1.rotation=90,this.effDic.right_1.once(egret.Event.COMPLETE,function(e){this.effDic.right_1.visible&&(FightingModule.groundLayerSubObjDanger[this.column+this.curLen+"_"+this.row].dangerCount=0),this.removeChild(this.effDic.right_1),this.effDic.right_1=null,delete this.effDic.right_1},this),this.curLen>=this.rightShowLimit&&(this.effDic.right_1.visible=!1),this.effDic.right_1.visible&&this.checkHit(this.nextDic.right_1,"right",this.curLen)):4==i&&(this.effDic.left_1=CommonTools.getAnimDraw(RES.getRes("baozha_last_anim_json"),RES.getRes("baozha_last_anim_png"),"0"),this.addChild(this.effDic.left_1),this.effDic.left_1.play(1),this.effDic.left_1.x=e+35,this.effDic.left_1.y=t+47,this.effDic.left_1.rotation=90,this.effDic.left_1.scaleY="-1",this.effDic.left_1.once(egret.Event.COMPLETE,function(e){this.effDic.left_1.visible&&(FightingModule.groundLayerSubObjDanger[this.column-this.curLen+"_"+this.row].dangerCount=0),this.removeChild(this.effDic.left_1),this.effDic.left_1=null,delete this.effDic.left_1,this.removePre(this.bulletLen-1)},this),this.curLen>=this.leftShowLimit&&(this.effDic.left_1.visible=!1),this.effDic.left_1.visible&&this.checkHit(this.nextDic.left_1,"left",this.curLen))}catch(n){CommonTools.logError("baozhaLastEff==================error "+n)}},t.prototype.setRow=function(e){this.row=e},t.prototype.getRow=function(){return this.row},t.prototype.setColumn=function(e){this.column=e},t.prototype.getColumn=function(){return this.column},t.prototype.setPreBobo=function(e){null==this.preBobo&&(this.preBobo={}),this.preBobo[e]=1},t.prototype.getPreBobo=function(){return this.preBobo},t}(egret.DisplayObjectContainer);e.Bullet=t,__reflect(t.prototype,"Fight.Bullet")}(Fight||(Fight={}));var Fight;!function(e){var t=function(e){function t(t){var i=e.call(this)||this;return i.subType=0,i.itemRange=[0,0,0,0],i.isPlayer=0,i.groundEmpty=!1,i.dangerCount=0,i.dangerPaoPaoObj=null,i.showImg=new eui.Image(t.img),i.x=t.x,i.y=t.y,i.name=t.name,i.curIdx=t.curIdx,i.addChild(i.showImg),i}return __extends(t,e),t.prototype.checkRange=function(e,t,i,n,o){if(e>=this.itemRange[0]&&e<this.itemRange[1]&&t>=this.itemRange[2]&&t<this.itemRange[3])if(1==n){this.removeChild(this.showImg);var s=i;if(2==o)s="diy_add_big_item_png",this.groundEmpty=!0;else{this.groundEmpty=!1;var a=s.split("_");this.res=parseInt(a[1])}this.showImg=new eui.Image(s),this.addChild(this.showImg)}else{if(this.sub&&(this.removeChild(this.sub),this.sub=null,this.subType=0,this.isPlayer>0&&(119==this.isPlayer?MapDIYModule.ONE_P="":MapDIYModule.TWO_P="",this.isPlayer=0)),2==o)return;var s=i;if(3==o&&""!=MapDIYModule.ONE_P)return;if(4==o&&""!=MapDIYModule.TWO_P)return;if(3==o&&(MapDIYModule.ONE_P=this.name,this.isPlayer=119,s="diy_1p_png"),4==o&&(MapDIYModule.TWO_P=this.name,this.isPlayer=120,s="diy_2p_png"),this.isPlayer>0)this.resSub=this.isPlayer;else{var a=s.split("_");this.resSub=parseInt(a[1])}this.sub=new eui.Image(s),this.subType=n,this.addChild(this.sub),this.sub.y-=38,this.isPlayer>0&&(this.sub.y-=38)}},t.prototype.checkRange2=function(e,t,i){if(1==t){this.removeChild(this.showImg);var n=e;if(2==i)n="diy_add_big_item_png",this.groundEmpty=!0;else{this.groundEmpty=!1;var o=n.split("_");this.res=parseInt(o[1])}this.showImg=new eui.Image(n),this.addChild(this.showImg)}else{if(this.sub&&(this.removeChild(this.sub),this.sub=null,this.subType=0,this.isPlayer>0&&(119==this.isPlayer?MapDIYModule.ONE_P="":MapDIYModule.TWO_P="",this.isPlayer=0)),2==i)return;var n=e;if(3==i&&""!=MapDIYModule.ONE_P)return;if(4==i&&""!=MapDIYModule.TWO_P)return;if(3==i&&(MapDIYModule.ONE_P=this.name,this.isPlayer=119,n="diy_1p_png"),4==i&&(MapDIYModule.TWO_P=this.name,this.isPlayer=120,n="diy_2p_png"),this.isPlayer>0)this.resSub=this.isPlayer;else{var o=n.split("_");this.resSub=parseInt(o[1])}this.sub=new eui.Image(n),this.subType=t,this.addChild(this.sub),this.sub.y-=38,this.isPlayer>0&&(this.sub.y-=38)}},t.prototype.addMiniBlock=function(e){this.sub=new eui.Image(e),this.addChild(this.sub),this.sub.y-=38},t.prototype.addMiniPlayer=function(e){var t="";t=119==e?"diy_1p_png":"diy_2p_png",this.sub=new eui.Image(t),this.addChild(this.sub),this.sub.y-=76},t.prototype.viewSub=function(e){if(this.sub)if(e){var t=this.sub.source,i=this.sub.x,n=this.sub.y;this.removeChild(this.sub),this.sub=new eui.Image(t),this.sub.x=i,this.sub.y=n,this.addChild(this.sub)}else this.sub.visible=!1},t.prototype.setRow=function(e){this.row=e},t.prototype.getRow=function(){return this.row},t.prototype.setColumn=function(e){this.column=e},t.prototype.getColumn=function(){return this.column},t.prototype.setType=function(e){this.type=e},t.prototype.getType=function(){return this.type},t.prototype.getCurIdx=function(){return this.curIdx},t.prototype.getSubType=function(){return this.subType},t.prototype.setRes=function(e){this.res=e},t.prototype.addSub=function(e,t){this.sub=e,this.subType=t,this.addChild(this.sub),this.sub.x+=8,this.sub.y+=8,this.sub.scaleX=1.2,this.sub.scaleY=1.2,this.notifyToAI()},t.prototype.notifyToAI=function(){for(var e in FightingModule.aiSubObj){var t=FightingModule.aiSubObj[e];t.beNotifyHasFood(this.column,this.row)}},t.prototype.clearSub=function(){null!=this.sub&&(this.removeChild(this.sub),this.sub=null,this.subType=0)},t}(egret.DisplayObjectContainer);e.MapItem=t,__reflect(t.prototype,"Fight.MapItem")}(Fight||(Fight={}));var Fight;!function(e){var t=function(t){function i(e){var i=t.call(this)||this;i.xDis=3,i.yDis=3,i.uTime=100,i.whichSide=0,i.sideDes="",i.bulletLen=4,i.life=1,i.speed=1,i.isMainPlayer=!1,i.isMoving=!1,i.curDirect=-1,i.row=-1,i.column=-1,i.keyDir=-1,i.keyBoom=-1,i.aiRobot=!1,i.endX=-1,i.endY=-1,i.fixAIX=0,i.fixAIY=0,i.isAI=0,i.markLeft=0,i.markRight=0,i.death=!1,i.iClass=1;var n=e.pObj;return i.roleId=n.uid,i.roleId==ConstValue.cacheUserInfo.id&&(i.isMainPlayer=!0),i.life=n.life,i.speed=n.speed,i.bulletLen=n.power,i.iClass=n.iClass,i.whichSide=e.side,i.bodyName=new eui.Label(n.name),1==i.whichSide?(i.sideDes="p"+i.iClass,i.bodyName.textColor=16710910,i.bodyName.stroke=4,i.bodyName.strokeColor=1603060):(i.sideDes="p"+i.iClass,i.bodyName.textColor=16710910,i.bodyName.stroke=4,i.bodyName.strokeColor=15877656),i.bodyName.texAlign="center",i.bodyAniUp=CommonTools.getAnimDraw(RES.getRes(i.sideDes+"_03_json"),RES.getRes(i.sideDes+"_03_png"),"0"),i.bodyAniDown=CommonTools.getAnimDraw(RES.getRes(i.sideDes+"_01_json"),RES.getRes(i.sideDes+"_01_png"),"0"),i.bodyAniLeft=CommonTools.getAnimDraw(RES.getRes(i.sideDes+"_02_json"),RES.getRes(i.sideDes+"_02_png"),"0"),i.bodyAniRight=CommonTools.getAnimDraw(RES.getRes(i.sideDes+"_04_json"),RES.getRes(i.sideDes+"_04_png"),"0"),i.bodyAniUpStatic=CommonTools.getAnimDraw(RES.getRes(i.sideDes+"_static_03_json"),RES.getRes(i.sideDes+"_static_03_png"),"0"),i.bodyAniDownStatic=CommonTools.getAnimDraw(RES.getRes(i.sideDes+"_static_json"),RES.getRes(i.sideDes+"_static_png"),"0"),i.bodyAniLeftStatic=CommonTools.getAnimDraw(RES.getRes(i.sideDes+"_static_02_json"),RES.getRes(i.sideDes+"_static_02_png"),"0"),i.bodyAniRightStatic=CommonTools.getAnimDraw(RES.getRes(i.sideDes+"_static_04_json"),RES.getRes(i.sideDes+"_static_04_png"),"0"),i.bodyAni=i.bodyAniDownStatic,i.addChild(i.bodyAni),i.bodyName.x-=55,i.bodyName.y-=128,i.addChild(i.bodyName),i.x=e.x,i.y=e.y,i.name=e.name,i.bodyAni.play(-1),i.isAI=e.isAI,2==ConstValue.P_FIGHT_OBJ.APP_MODE&&(i.xDis=1.5,i.yDis=1.5),i}return __extends(i,t),i.prototype.setMoving=function(e){if(this.isMoving=e,!e){if(!this.isMoving){switch(null!=this.bodyAni&&(this.removeChild(this.bodyAni),this.bodyAni=null),this.curDirect){case 0:null==this.bodyAni&&(this.bodyAni=this.bodyAniUpStatic,this.bodyAni.play(-1));break;case 1:null==this.bodyAni&&(this.bodyAni=this.bodyAniRightStatic,this.bodyAni.play(-1));break;case 2:null==this.bodyAni&&(this.bodyAni=this.bodyAniDownStatic,this.bodyAni.play(-1));break;case 3:null==this.bodyAni&&(this.bodyAni=this.bodyAniLeftStatic,this.bodyAni.play(-1))}this.addChild(this.bodyAni)}this.curDirect=-1}},i.prototype.moveDetail=function(e,t){return this.endX=e,this.endY=t,CommonTools.logAI("--moveDetail--------------this.column:"+this.column+" this.row:"+this.row+" endX:"+e+" endY:"+t),this.column==e?t>=this.row?void this.move(2,!1):void this.move(0,!1):this.row==t?e>=this.column?void this.move(1,!1):void this.move(3,!1):void 0},i.prototype.findOwnAi=function(){for(var e in FightingModule.aiSubObj){var t=FightingModule.aiSubObj[e];if(t.aiObj.roleId==this.roleId)return t}return null},i.prototype.move=function(e,t){try{if(!this.isMoving)return;CommonTools.logAI("this.speed--move----"+this.speed),this.speed>5&&(this.speed=5);var i=this.xDis+1.2*this.speed,n=this.yDis+1.2*this.speed;if(-1==e&&(e=-1==this.curDirect?1:this.curDirect),this.aiRobot&&this.column==this.endX&&this.row==this.endY)if(0==e||2==e){if(!(this.fixAIY<=50))return this.setMoving(!1),this.removeEventListener(egret.Event.ENTER_FRAME,this.func,this),this.func=null,this.keyDir=-1,this.fixAIY=0,CommonTools.logAI("move------11111111111111111111111111111"),void this.findOwnAi().moveNext();this.fixAIY+=n}else if(1==e||3==e){if(!(this.fixAIX<=50))return this.setMoving(!1),this.removeEventListener(egret.Event.ENTER_FRAME,this.func,this),this.func=null,this.keyDir=-1,this.fixAIX=0,CommonTools.logAI("move------2222222222222222222222222222222"),void this.findOwnAi().moveNext();this.fixAIX+=i}if(3==e){if(this.x<=FightingModule.mapLeftLimit)return;for(var o in FightingModule.mapLayerSubObj){var s=FightingModule.mapLayerSubObj[o];if(s.getRow()==this.row&&s.getColumn()+1==this.column&&this.x-18<=s.x+s.width){i=0;break}}for(var o in FightingModule.bulletLayerSubObj){var s=FightingModule.groundLayerSubObj[FightingModule.bulletLayerSubObj[o].getCurIdx()];if(s.getRow()==this.row&&s.getColumn()+1==this.column&&this.x-38<=s.x+s.width){i=0;break}}}else if(0==e){if(this.y<=FightingModule.mapUpLimit)return;for(var o in FightingModule.mapLayerSubObj){var s=FightingModule.mapLayerSubObj[o];if(s.getColumn()==this.column&&s.getRow()+1==this.row&&this.y<=s.y+s.height){n=0;break}}for(var o in FightingModule.bulletLayerSubObj){var s=FightingModule.groundLayerSubObj[FightingModule.bulletLayerSubObj[o].getCurIdx()];if(s.getColumn()==this.column&&s.getRow()+1==this.row&&this.y-20<=s.y+s.height){n=0;break}}}else if(2==e){if(this.y>=FightingModule.mapDownLimit)return;for(var o in FightingModule.mapLayerSubObj){var s=FightingModule.mapLayerSubObj[o];if(s.getColumn()==this.column&&s.getRow()-1==this.row&&this.y+20>=s.y){n=0;break}}for(var o in FightingModule.bulletLayerSubObj){var s=FightingModule.groundLayerSubObj[FightingModule.bulletLayerSubObj[o].getCurIdx()];if(s.getColumn()==this.column&&s.getRow()-1==this.row&&this.y+78>=s.y){n=0;break}}}else if(1==e){if(this.x>=FightingModule.mapRightLimit)return;for(var o in FightingModule.mapLayerSubObj){var s=FightingModule.mapLayerSubObj[o];if(s.getRow()==this.row&&s.getColumn()-1==this.column&&this.x+38>=s.x){i=0;break}}for(var o in FightingModule.bulletLayerSubObj){var s=FightingModule.groundLayerSubObj[FightingModule.bulletLayerSubObj[o].getCurIdx()];if(s.getRow()==this.row&&s.getColumn()-1==this.column&&this.x+38>=s.x){i=0;break}}}if(e!=this.curDirect)null!=this.bodyAni&&(this.removeChild(this.bodyAni),this.bodyAni=null);else if(!t)return;switch(e){case 0:null==this.bodyAni&&(this.bodyAni=this.bodyAniUp,this.bodyAni.play(-1)),this.y=this.y-n;break;case 1:null==this.bodyAni&&(this.bodyAni=this.bodyAniRight,this.bodyAni.play(-1)),this.x=this.x+i;break;case 2:null==this.bodyAni&&(this.bodyAni=this.bodyAniDown,this.bodyAni.play(-1)),this.y=this.y+n;break;case 3:null==this.bodyAni&&(this.bodyAni=this.bodyAniLeft,this.bodyAni.play(-1)),this.x=this.x-i}if(e!=this.curDirect&&(this.curDirect=e),this.addChild(this.bodyAni),this.markPosition(e),this.isMainPlayer&&!FightingModule.aiPVE){var a=CommonTools.getDataJsonStr("syncPos",1,{x:this.x,y:this.y,direction:this.curDirect,speed:this.speed,idx:parseInt(this.curMapIdx),playerID:0});
ConstValue.P_NET_OBJ.sendData2(a)}}catch(l){CommonTools.logError("move=====================error===="+l)}},i.prototype.fire=function(t,i){CommonAudioHandle.playEffect("playBomb_mp3",1),this.aiRobot&&2==this.findOwnAi().iCmd&&(this.findOwnAi().iCmd=0),this.markPosition(-1);var n={side:1,x:this.bulletX,y:this.bulletY,name:t,curIdx:i},o=new e.Bullet(n);o.setOwner(this),o.setRow(this.groundObj.getRow()),o.setColumn(this.groundObj.getColumn()),FightingModule.bulletLayer.addChild(o),FightingModule.bulletLayerSubObj[o.name]=o,o.setRightLimit(this.bulletLen+1),o.setLeftLimit(this.bulletLen+1),o.setDownLimit(this.bulletLen+1),o.setUpLimit(this.bulletLen+1);for(var s in FightingModule.mapLayerSubObj){var a=FightingModule.mapLayerSubObj[s.toString()];if(1!=a.getType()){if(a.getRow()==o.getRow()){if(a.getColumn()<o.getColumn()){var l=o.getColumn()-a.getColumn();this.bulletLen>=l&&o.getLeftLimit()>l&&(o.setLeftLimit(l),o.hitMap.leftHitMap=a)}if(a.getColumn()>o.getColumn()){var r=a.getColumn()-o.getColumn();this.bulletLen>=r&&o.getRightLimit()>r&&(o.setRightLimit(r),o.hitMap.rightHitMap=a)}}if(a.getColumn()==o.getColumn()){if(a.getRow()<o.getRow()){var h=o.getRow()-a.getRow();this.bulletLen>=h&&o.getUpLimit()>h&&(o.setUpLimit(h),o.hitMap.upHitMap=a)}if(a.getRow()>o.getRow()){var u=a.getRow()-o.getRow();this.bulletLen>=u&&o.getDownLimit()>u&&(o.setDownLimit(u),o.hitMap.downHitMap=a)}}}}var c=o.getColumn()+1;this.bulletLen>=c&&o.getLeftLimit()>c&&o.setLeftLimit(c);var d=ConstValue.P_FIGHT_OBJ.getInitColumn()-o.getColumn();this.bulletLen>=d&&o.getRightLimit()>d&&o.setRightLimit(d);var g=o.getRow()+1;this.bulletLen>=g&&o.getUpLimit()>g&&o.setUpLimit(g);var m=ConstValue.P_FIGHT_OBJ.getInitRow()-o.getRow();this.bulletLen>=m&&o.getDownLimit()>m&&o.setDownLimit(m);var p=!0;for(var s in FightingModule.bulletLayerSubObj)if(s!=o.name){var _=FightingModule.bulletLayerSubObj[s];if(o.getRow()==_.getRow()&&o.getColumn()==_.getColumn())if(p=!1,null!=_.getPreBobo())for(var C in _.getPreBobo())o.setPreBobo(s);else o.setPreBobo(_.name);else if(o.getRow()==_.getRow()){if(o.getColumn()>_.getColumn()){if(_.getRightLimit()>=o.getColumn()-_.getColumn())if(p=!1,null!=_.getPreBobo())for(var C in _.getPreBobo())o.setPreBobo(s);else o.setPreBobo(_.name)}else if(_.getLeftLimit()>=_.getColumn()-o.getColumn())if(p=!1,null!=_.getPreBobo())for(var C in _.getPreBobo())o.setPreBobo(s);else o.setPreBobo(_.name)}else if(o.getColumn()==_.getColumn())if(_.getRow()>o.getRow()){if(_.getUpLimit()>=_.getRow()-o.getRow())if(null!=_.getPreBobo())for(var C in _.getPreBobo())o.setPreBobo(s);else o.setPreBobo(_.name)}else if(_.getDownLimit()>=o.getRow()-_.getRow())if(null!=_.getPreBobo())for(var C in _.getPreBobo())o.setPreBobo(s);else o.setPreBobo(_.name)}p&&o.baozha(),this.aiRobot&&(CommonTools.logAI("move------3333333333333333333333333333333"),this.findOwnAi().moveNext())},i.prototype.markPosition=function(e){var t,i=1e4,n=0,o=0,s=null,a=5,l=41;for(var r in FightingModule.groundLayerSubObj){var h=FightingModule.groundLayerSubObj[r],u=new egret.Point(this.x+a,this.y+l),c=h.x+41,d=h.y+41,g=new egret.Point(c,d),m=egret.Point.distance(u,g);i>=m&&(t=r,i=m,n=c,o=d,s=h)}if(this.curMapIdx=t,this.bulletX=n,this.bulletY=o-10,this.groundObj=s,this.row=this.groundObj.getRow(),this.column=this.groundObj.getColumn(),this.groundObj.getSubType()>0){CommonTools.log("吃东西啦》。。。。。。");var p=0;if(1==this.isAI&&(p=this.roleId),this.isMainPlayer||1==this.isAI){var _=CommonTools.getDataJsonStr("pickItem",1,{itype:this.groundObj.getSubType(),idx:parseInt(this.curMapIdx),playerID:p});ConstValue.P_NET_OBJ.sendData2(_)}this.groundObj.clearSub(),this.aiRobot&&3==this.findOwnAi().iCmd&&(this.findOwnAi().iCmd=0,CommonTools.logAI("move------444444444444444444444444444444"),this.findOwnAi().moveNext())}CommonTools.logAI("markPosition=============this.curMapIdx："+this.curMapIdx+" this.row："+this.row+" this.column："+this.column);var C=FightingModule.groundLayerSubObjDanger[this.groundObj.getColumn()+"_"+this.groundObj.getRow()];if(C.dangerCount>0&&!this.death){this.death=!0;var p=0;1==this.isAI&&(p=this.roleId);var _=CommonTools.getDataJsonStr("syncBoomPlayer",1,{paopaoID:this.groundObj.dangerPaoPaoObj.name,x:this.groundObj.dangerPaoPaoObj.x,y:this.groundObj.dangerPaoPaoObj.y,idx:this.groundObj.dangerPaoPaoObj.curIdx,killrid:this.roleId,killidx:parseInt(this.curMapIdx),playerID:p});ConstValue.P_NET_OBJ.sendData2(_)}},i.prototype.getRow=function(){return this.row},i.prototype.getColumn=function(){return this.column},i}(egret.DisplayObjectContainer);e.Player=t,__reflect(t.prototype,"Fight.Player")}(Fight||(Fight={}));