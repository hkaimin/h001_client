var __reflect=this&&this.__reflect||function(t,e,i){t.__class__=e,i?i.push(e):i=[e],t.__types__=t.__types__?i.concat(t.__types__):i},__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o]);i.prototype=e.prototype,t.prototype=new i},__awaiter=this&&this.__awaiter||function(t,e,i,o){return new(i||(i=Promise))(function(n,s){function a(t){try{r(o.next(t))}catch(e){s(e)}}function l(t){try{r(o["throw"](t))}catch(e){s(e)}}function r(t){t.done?n(t.value):new i(function(e){e(t.value)}).then(a,l)}r((o=o.apply(t,e||[])).next())})},__generator=this&&this.__generator||function(t,e){function i(t){return function(e){return o([t,e])}}function o(i){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,s&&(a=s[2&i[0]?"return":i[0]?"throw":"next"])&&!(a=a.call(s,i[1])).done)return a;switch(s=0,a&&(i=[0,a.value]),i[0]){case 0:case 1:a=i;break;case 4:return r.label++,{value:i[1],done:!1};case 5:r.label++,s=i[1],i=[0];continue;case 7:i=r.ops.pop(),r.trys.pop();continue;default:if(a=r.trys,!(a=a.length>0&&a[a.length-1])&&(6===i[0]||2===i[0])){r=0;continue}if(3===i[0]&&(!a||i[1]>a[0]&&i[1]<a[3])){r.label=i[1];break}if(6===i[0]&&r.label<a[1]){r.label=a[1],a=i;break}if(a&&r.label<a[2]){r.label=a[2],r.ops.push(i);break}a[2]&&r.ops.pop(),r.trys.pop();continue}i=e.call(t,r)}catch(o){i=[6,o],s=0}finally{n=a=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}var n,s,a,l,r={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return l={next:i(0),"throw":i(1),"return":i(2)},"function"==typeof Symbol&&(l[Symbol.iterator]=function(){return this}),l},ResourceUtils=function(){function t(){this._groupIndex=0,this._configs=new Array,this._groups={},RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceLoadProgress,this),RES.addEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this)}return t.prototype.addConfig=function(t,e){this._configs.push([t,e])},t.prototype.loadConfig=function(t,e){this._onConfigComplete=t,this._onConfigCompleteTarget=e,this.loadNextConfig()},t.prototype.loadNextConfig=function(){if(0==this._configs.length)return this._onConfigComplete.call(this._onConfigCompleteTarget),this._onConfigComplete=null,void(this._onConfigCompleteTarget=null);var t=this._configs.shift();RES.addEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigCompleteHandle,this),RES.loadConfig(t[0],t[1])},t.prototype.onConfigCompleteHandle=function(t){RES.removeEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigCompleteHandle,this),this.loadNextConfig()},t.prototype.loadGroup=function(t,e,i,o){this._groups[t]=[e,i,o],RES.loadGroup(t)},t.prototype.loadGroups=function(t,e,i,o,n){RES.createGroup(t,e,!0),this.loadGroup(t,i,o,n)},t.prototype.pilfererLoadGroup=function(t,e){void 0===e&&(e=null);var i="pilferer_"+t;e||(e=[t]),RES.createGroup(i,e,!0),RES.loadGroup(i,-1)},t.prototype.onResourceLoadComplete=function(t){var e=t.groupName;if(this._groups[e]){var i=this._groups[e][0],o=this._groups[e][2];null!=i&&i.call(o),this._groups[e]=null,delete this._groups[e]}},t.prototype.onResourceLoadProgress=function(t){var e=t.groupName;if(this._groups[e]){var i=this._groups[e][1],o=this._groups[e][2];null!=i&&i.call(o,t.itemsLoaded,t.itemsTotal)}},t.prototype.onResourceLoadError=function(t){egret.error(t.groupName+"资源组有资源加载失败"),this.onResourceLoadComplete(t)},t.prototype.loadResource=function(t,e,i,o,n){void 0===t&&(t=[]),void 0===e&&(e=[]),void 0===i&&(i=null),void 0===o&&(o=null),void 0===n&&(n=null);var s=t.concat(e),a="loadGroup"+this._groupIndex++;RES.createGroup(a,s,!0),this._groups[a]=[i,o,n],RES.loadGroup(a)},t}();__reflect(ResourceUtils.prototype,"ResourceUtils");var AssetAdapter=function(){function t(){}return t.prototype.getAsset=function(t,e,i){function o(o){e.call(i,o,t)}if(RES.hasRes(t)){var n=RES.getRes(t);n?o(n):RES.getResAsync(t,o,this)}else RES.getResByUrl(t,o,this,RES.ResourceItem.TYPE_IMAGE)},t}();__reflect(AssetAdapter.prototype,"AssetAdapter",["eui.IAssetAdapter"]);var Main=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.isLoaded=!1,e.dDataInfo=null,e.dDataInfo2=null,e}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),egret.lifecycle.addLifecycleListener(function(t){CommonTools.log("===========onPause")}),egret.lifecycle.onPause=function(){CommonTools.log("===========onPause")},egret.lifecycle.onResume=function(){egret.ticker.resume(),null==ConstValue.cacheUserInfo||ConstValue.P_NET_OBJ.socket.connected||(ConstValue.P_NET_OBJ.socketConnect(),ConstValue.P_NET_OBJ.out_relogin(),CommonTools.log("-----resumeresumeresumeresume1-------------------")),null!=ConstValue.cacheUserInfo&&ConstValue.P_NET_OBJ.socket.connected&&WebSocketUtil.closeFlag&&(CommonTools.log("-----resumeresumeresumeresume2-------------------"),ConstValue.P_NET_OBJ.out_relogin()),CommonTools.log("===========onResume")},egret.ImageLoader.crossOrigin="anonymous";var e=new AssetAdapter;egret.registerImplementation("eui.IAssetAdapter",e),egret.registerImplementation("eui.IThemeAdapter",new ThemeAdapter),this.runGame()["catch"](function(t){CommonTools.log(t)})},e.prototype.runGame=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this.loadResource("pre_preload",1)];case 1:return t.sent(),[2]}})})},e.prototype.doNext=function(t){if(this.stage.removeChild(this.loadingView),this.loadingView=null,1==t)ConstValue.P_LOGIN_OBJ=new LoginModule(this);else if(2==t)ConstValue.P_HALL_OBJ=new HallModule(this);else if(3==t)if(ConstValue.P_IS_DEBUG);else{var e=CommonTools.getDataJsonStr("enterPPRoom",1,{});ConstValue.P_NET_OBJ.sendData(e)}else if(4==t)if(ConstValue.P_IS_DEBUG);else{var e=CommonTools.getDataJsonStr("openDiyMapUI",1,{theme:1});ConstValue.P_NET_OBJ.sendData(e)}else 5==t?ConstValue.P_IS_DEBUG:6==t&&(ConstValue.P_IS_DEBUG||(null==ConstValue.P_FIGHT_OBJ&&(ConstValue.P_FIGHT_OBJ=new FightingModule(this)),ConstValue.P_FIGHT_OBJ.initMapData(this.dDataInfo),FightingModule.readyTwo&&!FightingModule.readyRes&&(ConstValue.P_FIGHT_OBJ.releaseVsPanel(),ConstValue.P_FIGHT_OBJ.updateInfo(this.dDataInfo2))));null==ConstValue.P_CONTEXT&&(ConstValue.P_CONTEXT=this)},e.prototype.loadResource=function(t,e){return __awaiter(this,void 0,void 0,function(){var i;return __generator(this,function(o){switch(o.label){case 0:return o.trys.push([0,5,,6]),this.loadingView=new LoadingUI(this.stage.stageWidth,this.stage.stageHeight,this),this.stage.addChildAt(this.loadingView,1),this.isLoaded?[3,1]:(CommonTools.resourceMgr.addConfig(PathUtils.RESOURC+PathUtils.Version_Default_Res,PathUtils.RESOURC),CommonTools.resourceMgr.loadConfig(this.onLoginConfigComplete,this),[3,4]);case 1:return null!=ConstValue.cacheKeyGroup[t]?[3,3]:[4,RES.loadGroup(t,0,this.loadingView)];case 2:o.sent(),ConstValue.cacheKeyGroup[t]=1,o.label=3;case 3:ConstValue.P_IS_DEBUG&&this.stage.removeChild(this.loadingView),this.doNext(e),o.label=4;case 4:return[3,6];case 5:return i=o.sent(),console.error(i),[3,6];case 6:return[2]}})})},e.prototype.onLoginConfigComplete=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this.loadTheme()];case 1:return t.sent(),[4,RES.loadGroup("pre_preload",0,this.loadingView)];case 2:return t.sent(),this.isLoaded=!0,ConstValue.cacheKeyGroup.preload=1,ConstValue.P_IS_DEBUG&&this.stage.removeChild(this.loadingView),this.doNext(1),[2]}})})},e.prototype.loadResourceBlackground=function(t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return CommonTools.log("loadBlackGround=================2"),[4,RES.loadGroup(t,0,null)];case 1:return e.sent(),CommonTools.log("loadBlackGround=================2_1"),[2]}})})},e.prototype.addBackGround=function(t){var e=this.createBitmapByName(t),i=this.stage.stageWidth+50,o=this.stage.stageHeight+50;return e.width=i,e.height=o,e.y=-25,e.x=-25,e},e.prototype.getStageWidth=function(){return this.stage.stageWidth},e.prototype.getStageHeight=function(){return this.stage.stageHeight},e.prototype.getClientWidth=function(){return document.documentElement.clientWidth},e.prototype.getClientHeight=function(){return document.documentElement.clientHeight},e.prototype.loadTheme=function(){var t=this;return new Promise(function(e,i){var o=new eui.Theme(PathUtils.RESOURC+PathUtils.Version_Default_Thm,t.stage);o.addEventListener(eui.UIEvent.COMPLETE,function(){e()},t)})},e.prototype.createGameScene=function(){var t=this.stage.stageWidth;this.stage.stageHeight;this.addChild(this.addBackGround("bg_jpg"));var e=new egret.Shape;e.graphics.beginFill(0,.5),e.graphics.drawRect(0,0,t,172),e.graphics.endFill(),e.y=33,this.addChild(e);var i=this.createBitmapByName("egret_icon_png");this.addChild(i),i.x=26,i.y=33;var o=new egret.Shape;o.graphics.lineStyle(2,16777215),o.graphics.moveTo(0,0),o.graphics.lineTo(0,117),o.graphics.endFill(),o.x=172,o.y=61,this.addChild(o);var n=new egret.TextField;n.textColor=16777215,n.width=t-172,n.textAlign="center",n.text="Hello Egret",n.size=24,n.x=172,n.y=80,this.addChild(n);var s=new egret.TextField;this.addChild(s),s.alpha=0,s.width=t-172,s.textAlign=egret.HorizontalAlign.CENTER,s.size=24,s.textColor=16777215,s.x=172,s.y=135,this.textfield=s;var a=new eui.Button;a.label="Click!",a.horizontalCenter=0,a.verticalCenter=0,this.addChild(a),a.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onButtonClick,this),CommonTools.log("createGameScene=============done")},e.prototype.createBitmapByName=function(t){var e=new egret.Bitmap,i=RES.getRes(t);return e.texture=i,e},e.prototype.startAnimation=function(t){var e=this,i=new egret.HtmlTextParser,o=t.map(function(t){return i.parse(t)}),n=this.textfield,s=-1,a=function(){s++,s>=o.length&&(s=0);var t=o[s];n.textFlow=t;var i=egret.Tween.get(n);i.to({alpha:1},200),i.wait(2e3),i.to({alpha:0},200),i.call(a,e)};a()},e.getResUtil=function(t){return RES.getRes(t)},e.prototype.onButtonClick=function(t){var e=new eui.Panel;e.title="Title",e.horizontalCenter=0,e.verticalCenter=0,this.addChild(e)},e.roomkey=null,e}(eui.UILayer);__reflect(Main.prototype,"Main");var DebugPlatform=function(){function t(){}return t.prototype.getUserInfo=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2,{nickName:"username"}]})})},t.prototype.login=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return CommonTools.log("-----DebugPlatform--------login"),[2]})})},t.prototype.updateInfo=function(t){},t.prototype.shareAppMessage=function(t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return CommonTools.log("-------DebugPlatform------shareAppMessage"),[2]})})},t.prototype.showShareMenu=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return CommonTools.log("-------DebugPlatform------showShareMenu"),[2]})})},t.prototype.onWxShow=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return CommonTools.log("-------DebugPlatform------onWxShow"),[2]})})},t}();__reflect(DebugPlatform.prototype,"DebugPlatform",["Platform"]),window.platform||(window.platform=new DebugPlatform);var ThemeAdapter=function(){function t(){}return t.prototype.getTheme=function(t,e,i,o){function n(t){e.call(o,t)}function s(e){e.resItem.url==t&&(RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,s,null),i.call(o))}var a=this;"undefined"!=typeof generateEUI?egret.callLater(function(){e.call(o,generateEUI)},this):"undefined"!=typeof generateEUI2?RES.getResByUrl("resource/gameEui.bin",function(t,i){window.JSONParseClass.setData(t),n(t),egret.callLater(function(){e.call(o,generateEUI2)},a)},this,RES.ResourceItem.TYPE_BIN):(RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,s,null),RES.getResByUrl(t,n,this,RES.ResourceItem.TYPE_TEXT))},t}();__reflect(ThemeAdapter.prototype,"ThemeAdapter",["eui.IThemeAdapter"]);var CommonAudioHandle=function(){function t(){}return t.play=function(e,i){null!=t.channel&&t.channel.stop();var o=RES.getRes(e);o.type=egret.Sound.MUSIC,t.channel=o.play(0,i)},t.setVolume=function(e){null!=t.channel&&(t.channel.volume=e)},t.playEffect=function(t,e){var i=RES.getRes(t);i.play(0,e)},t.stop=function(){null!=t.channel&&(t.channel.stop(),t.channel=null)},t}();__reflect(CommonAudioHandle.prototype,"CommonAudioHandle");var CommonButtonHandle=function(){function t(){}return t.beginTouch=function(e,i){e.addEventListener(egret.TouchEvent.TOUCH_BEGIN,t.onButtonClickBegin,i),e.addEventListener(egret.TouchEvent.TOUCH_END,t.onButtonClickEnd,i),e.addEventListener(egret.TouchEvent.TOUCH_MOVE,t.onButtonClickEnd,i)},t.onButtonClickBegin=function(t){t.target.scaleX="0.9",t.target.scaleY="0.9",CommonAudioHandle.playEffect("playBomb_mp3",1)},t.onButtonClickEnd=function(t){t.target.scaleX="1",t.target.scaleY="1"},t}();__reflect(CommonButtonHandle.prototype,"CommonButtonHandle");var CommonTools=function(){function t(){}return t.addShapeBG=function(t,e){var i=new egret.Shape;return i.graphics.beginFill(2301984,.6),i.graphics.drawRect(0,0,t,e),i.graphics.endFill(),i},t.niceTip=function(t,e,i){if(1==e){t.scaleX=.5,t.scaleY=.5;var o=1,n=1;ConstValue.deviveNormalScale>2&&(o=ConstValue.deviveScale,n=ConstValue.deviveScale);var s=egret.Tween.get(t);s.to({scaleX:1,scaleY:1},90),s.to({scaleX:1.05,scaleY:1.05},80),s.to({scaleX:o,scaleY:o},100)}else{var s=egret.Tween.get(t);s.to({scaleX:1.05,scaleY:1.05},100),s.to({scaleX:0,scaleY:0,visible:!1},200),s.call(function(){i.closeNice()},this)}},t.fixFix=function(t,e,i,o,n){var s=750,a=t.getStageHeight(),l=a/s;ConstValue.deviveScale=l;var r=1*t.getClientWidth()/t.getClientHeight();if(ConstValue.deviveNormalScale=r,!(2>r)){var h=0,u=0;if(1==i?h=e.y:2==i?u=s-e.y:3==i&&(u=s-e.y),e.scaleX=l,e.scaleY=l,1==i){var c=(1-l)/2;e.y=h*l+a*c+n,e.x=e.x+o}else if(2==i){var c=(1-l)/2;e.y=a-u*l+a*c+n,e.x=e.x+o}}},t.addCommonTips=function(t,e){var i=t.stage.stageWidth,o=t.stage.stageHeight,n=new eui.Panel;n.skinName="resource/eui_skins/UserUI/CommonTips.exml";var s=i/2-n.width/2,a=o/2-n.height/2;n.x=s,n.y=a;var l=n.getChildByName("lb_tips_txt");l.text=e,t.addChild(n);var r=function(){t.removeChild(n)},h=a-120,u=egret.Tween.get(n);u.to({y:h},500),u.wait(1e3),u.call(r)},t.getDataJsonStr=function(t,e,i){var o={};return o.f=t,o.s=e,o.d=i,JSON.stringify(o)},t.getAnimDraw=function(t,e,i){var o,n=new egret.MovieClipDataFactory(t,e);return o=""==i?new egret.MovieClip(n.generateMovieClipData()):new egret.MovieClip(n.generateMovieClipData(i))},t.deepCopyMap=function(t){var e={};for(var i in t){var o=t[i];e[i]=o}return e},t.printMap=function(t){if(ConstValue.p_is_PRINT_MAP){console.log("-----startMap------");var e=0;for(var i in t){t[i];console.log("-----srcMap--key----"+i),e++}console.log("-----endMap------len:"+e)}},t.printObject=function(t){var e="";for(var i in t){var o=t[i];e+=i+" = "+o+"\n"}console.log("-----printObject------description:"+e)},t.getRandomFloor=function(t,e){return e?Math.floor(Math.random()*t):Math.floor(Math.random()*t==0?1:Math.random()*t)},t.log=function(t){ConstValue.P_IS_INNER&&console.log(t)},t.logError=function(t){ConstValue.p_is_PRINT_ERROR&&console.log(t)},t.logDebug=function(t){ConstValue.p_is_PRINT_DEBUG&&console.log(t)},t.logAI=function(t){ConstValue.p_is_PRINT_AI&&console.log(t)},t.logAIPath=function(t){ConstValue.p_is_PRINT_AI_PATH&&console.log(t)},t.resourceMgr=new ResourceUtils,t}();__reflect(CommonTools.prototype,"CommonTools");var ConstValue=function(){function t(){}return t.P_BAR_LABEL="资源加载中",t.P_BAR_LABEL2="^_^.每个场景部分地图较大，首次加载可能需要几分钟  喝杯茶吧，以后再次加载将会秒速进入",t.P_BAR_LABEL3="资源加载中",t.P_NULL_ACCOUNT="请输入账号",t.P_NULL_PASSWORD="请输入密码",t.P_NULL_INVITE="请输入推广号",t.P_NULL_VERIFY="请输入验证码",t.P_SEND_VERIFY="验证码发送成功",t.P_SEND_MODIFY_SUCCESS="修改成功",t.P_SEND_REGISTE_SUCCESS="注册成功",t.P_SEND_REGISTE_FAIL="用户名已存在",t.P_SEND_LOGIN_FAIL="用户名或密码错误",t.P_SEND_LOGIN_SUCCESS="登录成功",t.P_SEND_WAITING="敬请期待",t.P_SEND_HALLBACK_FAIL="网络异常，进入大厅失败",t.P_COPY_SUCCESS="复制成功",t.P_MODIFY_NULL_FAIL="修改内容不能为空",t.P_MODIFY_TITLE="信息",t.P_MODIFY_NICHENG="修改昵称：",t.P_MODIFY_OLD_PWD="旧密码：",t.P_MODIFY_NEW_PWD="新密码：",t.P_MODIFY_REALNAME="修改名字：",t.P_MODIFY_WX="修改微信：",t.P_MODIFY_BEGET="修改比例：",t.P_MODIFY_FAIL="修改失败，请稍后再试",t.P_MODIFY_PWD_FAIL="新密码2次输入有误",t.P_ENTER_ROOM_FAIL="进入房间失败",t.P_WAIT_NEXT="请等待下轮开始",t.P_IS_DEBUG=!1,t.P_IS_INNER=!0,t.p_is_PRINT_ERROR=!0,t.p_is_PRINT_DEBUG=!1,t.p_is_PRINT_AI=!1,t.p_is_PRINT_AI_PATH=!1,t.p_is_PRINT_MAP=!1,t.p_LOGIN_MODEL=1,t.P_NET_OBJ=null,t.P_LOGIN_OBJ=null,t.P_HALL_OBJ=null,t.P_FIGHT_OBJ=null,t.P_MAP_OBJ=null,t.P_CONTEXT=null,t.P_CONFIG=null,t.cacheUserAccount="",t.cacheUserPwd="",t.cacheHasLoginSuccess=!1,t.cacheUserInfo=null,t.cacheKeyGroup={},t.gatewayType=0,t.deviveScale=1,t.deviveNormalScale=1.7,t.role_select_img={0:"role_select_p1_png",1:"role_select_p2_png",2:"role_select_p3_png"},t.PUSH_BUTTON={1:{btn_name:"btn_map_bag",btn_res_01:"new_ui_10_01_png",btn_res_02:"new_ui_10_02_png"},2:{btn_name:"btn_friend",btn_res_01:"new_ui_09_01_png",btn_res_02:"new_ui_09_02_png"},3:{btn_name:"btn_setting",btn_res_01:"new_ui_04_01_png",btn_res_02:"new_ui_04_02_png"},4:{btn_name:"btn_ranking",btn_res_01:"new_ui_06_01_png",btn_res_02:"new_ui_06_02_png"},5:{btn_name:"btn_map_shop",btn_res_01:"new_ui_05_png",btn_res_02:"new_ui_05_png"},6:{btn_name:"btn_vip",btn_res_01:"new_ui_08_png",btn_res_02:"new_ui_08_png"},7:{btn_name:"btn_activity",btn_res_01:"new_ui_07_png",btn_res_02:"new_ui_07_png"}},t.role_select_bg={0:"role_select_bg_png",1:"role_select_bg2_png",2:"role_select_bg3_png"},t}();__reflect(ConstValue.prototype,"ConstValue");var EBitUtil=function(){function t(){}return t.isSetBit=function(t,e){return e>31?!1:(t&1<<e)>0},t.SetBit=function(t,e){return e>31?t:t|1<<e},t.ClearBit=function(t,e){return e>31?t:t&~(1<<e)},t.getArr=function(t){var e=[];for(t.position=0;t.bytesAvailable>0;)e.push(t.readByte());return e},t}();__reflect(EBitUtil.prototype,"EBitUtil");var PathUtils=function(){function t(){}return Object.defineProperty(t,"RESOURC",{get:function(){return 1==ConstValue.p_LOGIN_MODEL&&(t.CDN_URL=""),t.CDN_URL="",t.CDN_URL+t.RESOURC_URL},enumerable:!0,configurable:!0}),Object.defineProperty(t,"NOTICE",{get:function(){return 1==ConstValue.p_LOGIN_MODEL&&(t.CDN_URL=""),t.CDN_URL+t.RESOURC_URL+t.NOTICE_URL},enumerable:!0,configurable:!0}),t.CND_URL_49YOU="",t.CDN_URL="https://www.iogood.cn:442/pptcdn/",t.RESOURC_URL="resource/",t.NOTICE_URL="notice/",t.Version_Default_Res="default.res.json",t.Version_Default_Thm="default.thm.json",t}();__reflect(PathUtils.prototype,"PathUtils");var LoadingUI=function(t){function e(e,i,o){var n=t.call(this)||this;return n.iScreenWidth=e,n.iScreenHeight=i,n.context=o,n.createView(),n}return __extends(e,t),e.prototype.createView=function(){if(null==ConstValue.cacheKeyGroup.preload){CommonTools.log("=====================not load preload ,use mask");var t=new egret.Shape;t.graphics.beginFill(0,1),t.graphics.drawRect(0,0,this.iScreenWidth,this.iScreenHeight),t.graphics.endFill(),this.addChild(t)}else{if(CommonTools.log("=====================load preload ,use ui"),null==ConstValue.P_LOGIN_OBJ){var e=new eui.Image("login_bg_ppt_png");e.width=this.iScreenWidth,e.height=this.iScreenHeight,this.addChild(e)}this.pBar=new eui.ProgressBar,this.pBar.maximum=100,this.pBar.minimum=0,this.pBar.width=544,this.pBar.height=104,this.addChild(this.pBar),this.pBar.value=0,this.pBar.x=400,this.pBar.y=600,this.pBar.labelFunction=this.barLabelFunction,CommonTools.fixFix(this.context,this.pBar,2,40,0)}this.textField3=new egret.TextField,this.addChild(this.textField3),this.textField3.y=620,this.textField3.x=420,this.textField3.width=480,this.textField3.height=100,this.textField3.size=20,this.textField3.textAlign="center",null!=ConstValue.cacheKeyGroup.preload&&(this.textField3.textColor=519),CommonTools.fixFix(this.context,this.textField3,2,40,0)},e.prototype.barLabelFunction=function(t,e){return""},e.prototype.onProgress=function(t,e){var i=t/(1*e)*100;i=Math.ceil(i),null!=this.pBar&&(this.pBar.value=i),this.textField3.text=ConstValue.P_BAR_LABEL3+"...("+i+"%)"},e}(egret.Sprite);__reflect(LoadingUI.prototype,"LoadingUI",["RES.PromiseTaskReporter"]);var WebSocketUtil=function(t){function e(e){var i=t.call(this)||this;return i.zipAndAes=!0,i.ip="134.175.171.37",i.ipUrl="wss://www.iogood.cn:441",i.zipPort=18024,i.freePort=8011,i.sCurData="",i.text="TestWebSocket",i.protoId=1,i.sCurData=e,i.initWebSocket(),i.timer=new egret.Timer(3e4,0),i.timer.addEventListener(egret.TimerEvent.TIMER,i.timerFunc,i),i.timer.addEventListener(egret.TimerEvent.TIMER_COMPLETE,i.timerComFunc,i),i.timer.start(),i}return __extends(e,t),e.prototype.socketConnect=function(){this.zipAndAes?1==ConstValue.p_LOGIN_MODEL?this.socket.connect(this.ip,this.zipPort):2==ConstValue.p_LOGIN_MODEL&&this.socket.connectByUrl(this.ipUrl):this.socket.connect(this.ip,this.freePort)},e.prototype.timerFunc=function(){if(CommonTools.log("计时"),this.socket.connected){var t=new egret.ByteArray;t.writeByte(0),t.writeByte(0),t.position=0,this.socket.writeBytes(t,0,t.bytesAvailable),CommonTools.log("======heart beat==========sendData... "+t.bytesAvailable+" byte.toString:"+this.Bytes2Str(t.bytes))}else e.reloginCnt++,this.socketConnect()},e.prototype.timerComFunc=function(){CommonTools.log("计时结束")},e.prototype.initStateText=function(){this.stateText=new egret.TextField,this.stateText.size=22,this.stateText.text=this.text,this.stateText.width=480,this.addChild(this.stateText)},e.prototype.initWebSocket=function(){CommonTools.log("==============initWebSocket"),this.socket=new egret.WebSocket,this.socket.type=egret.WebSocket.TYPE_BINARY,this.socket.addEventListener(egret.ProgressEvent.SOCKET_DATA,this.onReceiveMessage,this),this.socket.addEventListener(egret.Event.CONNECT,this.onSocketOpen,this),this.socket.addEventListener(egret.Event.CLOSE,this.onSocketClose,this),this.socket.addEventListener(egret.IOErrorEvent.IO_ERROR,this.onSocketError,this),this.socketConnect()},e.prototype.trim=function(t){return t.replace(/(^\s*)|(\s*$)/g,"")},e.prototype.makeJsonObj=function(t){var e=t.replace(/{/g,"").replace(/}/g,""),i=e.split(","),o={};for(var n in i){var s=i[n].split(":");o[s[0]]=s[1]}},e.prototype.handleRecJsonStr=function(t){try{var i=JSON.parse(t);switch(i.f){case"register":case"login":case"entergame":case"loginWX":ConstValue.P_LOGIN_OBJ.handlePacket(i);break;case"gmFunc":case"WaitingInfo":case"syncMapData":case"openRnakUI":case"getTotalPvpRank":case"getTotalLvRank":case"openDiyMapUI":case"openShopUI":case"openBagUI":case"Buy":case"C2GOpenWujinUI":case"SeventDayReward":case"open1V1Room":case"open1V1RoomByMap":case"showMatch1v1RoomUI":case"Room1v1Dismiss":case"showAllClassList":case"reflashClassList":ConstValue.P_HALL_OBJ.handlePacket(i);break;case"pushBtnData":HallModule.pushBtnData=i.d;break;case"refreshInfo":null!=ConstValue.cacheUserInfo&&(ConstValue.cacheUserInfo=i.d);break;case"notify":CommonTools.addCommonTips(ConstValue.P_CONTEXT,i.d.tips);break;case"syncPosBroadcase":case"syncPut":case"syncBoomZhuan":case"syncpickItem":case"gameResult":case"gameGuanKaResult":ConstValue.P_FIGHT_OBJ.handlePacket(i);break;case"getMyMaps":null==ConstValue.P_MAP_OBJ?ConstValue.P_HALL_OBJ.handlePacket(i):ConstValue.P_MAP_OBJ.handlePacket(i);break;case"saveMap":case"getNewRank":case"getHopRank":ConstValue.P_MAP_OBJ.handlePacket(i);break;case"relogin":e.closeFlag=!1}}catch(o){CommonTools.log("handleRecJsonStr====error====="+t),CommonTools.log("handleRecJsonStr====error====="+o)}},e.prototype.out_relogin=function(){return e.reloginCnt>=5&&!this.socket.connected?void this.outLogin():e.reloginCnt>=5&&this.socket.connected&&e.closeFlag?void this.outLogin():(ConstValue.P_HALL_OBJ?ConstValue.P_NET_OBJ.relogin():ConstValue.P_NET_OBJ.relogin2(),void CommonTools.addCommonTips(ConstValue.P_CONTEXT,"网络重试:"+e.reloginCnt+"/5"))},e.prototype.sendData=function(t){if(this.sCurData=t,!this.socket.connected)return void FightingModule.Delay(2e3,function(){CommonTools.log("----sendData--------reloginCnt-----"+e.reloginCnt),this.socketConnect(),this.out_relogin()},this);e.closeFlag&&(FightingModule.Delay(2e3,function(){CommonTools.log("----sendData--------reloginCnt-----"+e.reloginCnt),this.out_relogin()},this),this.sCurData=CommonTools.getDataJsonStr("relogin",1,{pid:ConstValue.cacheUserInfo.id,token:ConstValue.cacheUserInfo.token}));var i=function(t){return new Blob([t]).size};if(CommonTools.log(" ====11111 "+this.bToString(this.stringToByte(t))),this.zipAndAes){var o=new egret.ByteArray;o.endian=egret.Endian.LITTLE_ENDIAN,o.writeByte(0),o.writeByte(0),o.writeByte(1),this.protoId+=1,o.writeUnsignedShort(this.protoId),o.endian=egret.Endian.BIG_ENDIAN;for(var n=this.stringToByte(t),s=0;s<n.length;s++)o.writeByte(n[s]);o.position=0;var a=JSZip.compressions.DEFLATE.compressgzip(o.bytes,{level:6}),l=new egret.ByteArray;l._writeUint8Array(a),l.position=0;var r=new egret.ByteArray;r.endian=egret.Endian.LITTLE_ENDIAN,r.writeUnsignedShort(l.bytesAvailable),o.endian=egret.Endian.BIG_ENDIAN,r.writeBytes(l),r.position=0,this.socket.writeBytes(r,0,r.bytesAvailable)}else{var o=new egret.ByteArray;o.endian=egret.Endian.LITTLE_ENDIAN,o.writeUnsignedShort(i(t)+5),o.writeByte(0),o.writeByte(0),o.writeByte(1),this.protoId+=1,o.writeUnsignedShort(this.protoId),o.endian=egret.Endian.BIG_ENDIAN,o.writeUTFBytes(t),o.position=0,this.socket.writeBytes(o,0,o.bytesAvailable)}this.sCurData=""},e.prototype.sendData2=function(t){if(this.sCurData=t,!this.socket.connected)return void FightingModule.Delay(1e3,function(){this.socketConnect(),this.out_relogin()},this);e.closeFlag&&(FightingModule.Delay(1e3,function(){CommonTools.log("----sendData--------reloginCnt-----"+e.reloginCnt),this.out_relogin()},this),this.sCurData=CommonTools.getDataJsonStr("relogin",1,{pid:ConstValue.cacheUserInfo.id,token:ConstValue.cacheUserInfo.token}));var i=function(t){return new Blob([t]).size};if(CommonTools.log(" ====11111 "+this.bToString(this.stringToByte(t))),this.zipAndAes){var o=new egret.ByteArray;o.endian=egret.Endian.LITTLE_ENDIAN,o.writeByte(0),o.writeByte(1),o.writeByte(1),this.protoId+=1,o.writeUnsignedShort(this.protoId),o.endian=egret.Endian.BIG_ENDIAN;for(var n=this.stringToByte(t),s=0;s<n.length;s++)o.writeByte(n[s]);o.position=0;var a=JSZip.compressions.DEFLATE.compressgzip(o.bytes,{level:6}),l=new egret.ByteArray;l._writeUint8Array(a),l.position=0;var r=new egret.ByteArray;r.endian=egret.Endian.LITTLE_ENDIAN,r.writeUnsignedShort(l.bytesAvailable),o.endian=egret.Endian.BIG_ENDIAN,r.writeBytes(l),r.position=0,this.socket.writeBytes(r,0,r.bytesAvailable)}else{var o=new egret.ByteArray;o.endian=egret.Endian.LITTLE_ENDIAN,o.writeUnsignedShort(i(t)+5),o.writeByte(0),o.writeByte(1),o.writeByte(1),this.protoId+=1,o.writeUnsignedShort(this.protoId),o.endian=egret.Endian.BIG_ENDIAN,o.writeUTFBytes(t),o.position=0,this.socket.writeBytes(o,0,o.bytesAvailable)}this.sCurData=""},e.prototype.Bytes2Str=function(t){for(var e="",i=0;i<t.length;i++){var o=t[i].toString(16);1==o.length&&(o="0"+o),e+=i==t.length-1?o:o+"-"}return e},e.prototype.Bytes2Str2=function(t){for(var e="",i=0;i<t.length;i++)e+=i==t.length-1?t[i]+"":t[i]+"-";return e},e.prototype.Bytes2StrNoFix=function(t){for(var e="",i=0;i<t.length;i++){var o=t[i].toString(16);1==o.length&&(o="0"+o),e+=o}return e},e.prototype.stringToByte=function(t){var e,i,o=new Array;e=t.length;for(var n=0;e>n;n++)i=t.charCodeAt(n),i>=65536&&1114111>=i?(o.push(i>>18&7|240),o.push(i>>12&63|128),o.push(i>>6&63|128),o.push(63&i|128)):i>=2048&&65535>=i?(o.push(i>>12&15|224),o.push(i>>6&63|128),o.push(63&i|128)):i>=128&&2047>=i?(o.push(i>>6&31|192),o.push(63&i|128)):o.push(255&i);return o},e.prototype.bToString=function(t){if("string"==typeof t)return t;for(var e="",i=t,o=0;o<i.length;o++){var n=i[o].toString(2),s=n.match(/^1+?(?=0)/);if(s&&8==n.length){for(var a=s[0].length,l=i[o].toString(2).slice(7-a),r=1;a>r;r++)l+=i[r+o].toString(2).slice(2);e+=String.fromCharCode(parseInt(l,2)),o+=a-1}else e+=String.fromCharCode(i[o])}return e},e.prototype.outLogin=function(){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),e.closeFlag=!1,e.reloginCnt=0,this.timer.stop(),this.socket.removeEventListener(egret.ProgressEvent.SOCKET_DATA,this.onReceiveMessage,this),this.socket.removeEventListener(egret.Event.CONNECT,this.onSocketOpen,this),this.socket.removeEventListener(egret.Event.CLOSE,this.onSocketClose,this),this.socket.removeEventListener(egret.IOErrorEvent.IO_ERROR,this.onSocketError,this),this.socket=null,null!=ConstValue.P_HALL_OBJ&&ConstValue.P_HALL_OBJ.clear(),null!=ConstValue.P_FIGHT_OBJ&&ConstValue.P_FIGHT_OBJ.clear2(),ConstValue.P_NET_OBJ=null,ConstValue.cacheHasLoginSuccess=!1,ConstValue.cacheUserInfo=null,[4,ConstValue.P_CONTEXT.loadResource("pre_preload",1)];case 1:return i.sent(),[3,3];case 2:return t=i.sent(),CommonTools.log("outLogin-----------back console"),[3,3];case 3:return[2]}})})},e.prototype.relogin=function(){e.reloginCnt++;var t=CommonTools.getDataJsonStr("relogin",1,{pid:ConstValue.cacheUserInfo.id,token:ConstValue.cacheUserInfo.token});this.sendData(t)},e.prototype.relogin2=function(){e.reloginCnt++;var t=CommonTools.getDataJsonStr("relogin",1,{pid:ConstValue.cacheUserInfo.id,token:ConstValue.cacheUserInfo.token});this.sendData2(t)},e.prototype.onSocketOpen=function(){e.reloginCnt=0,CommonTools.log("================onSocketOpen..."),""!=this.sCurData&&this.sendData(this.sCurData)},e.prototype.onSocketClose=function(){e.closeFlag=!0,CommonTools.log("------onSocketClose "),this.socketConnect(),this.out_relogin()},e.prototype.onSocketError=function(){CommonTools.log("------onSocketError")},e.prototype.onReceiveMessage=function(t){var e=new egret.ByteArray;if(this.socket.readBytes(e),e.length>2){e.endian=egret.Endian.LITTLE_ENDIAN;var i=e.readShort();if(this.zipAndAes){for(var o=new egret.ByteArray,n=2;n<e.bytes.length;n++)o.writeByte(e.bytes[n]);o.position=0;var s=SnappyJS.uncompress(o.bytes),a=new egret.ByteArray(s);a.endian=egret.Endian.LITTLE_ENDIAN;a.readByte(),a.readByte(),a.readByte(),a.readShort();a.endian=egret.Endian.BIG_ENDIAN;var l=a.readUTFBytes(a.bytesAvailable);CommonTools.log("------onReceiveMessage 收到数据:"+l),this.handleRecJsonStr(l)}else{e.readByte(),e.readByte(),e.readShort();e.endian=egret.Endian.BIG_ENDIAN;var l=e.readUTFBytes(e.bytesAvailable);CommonTools.log("------onReceiveMessage 收到数据:"+l),CommonTools.log("------onReceiveMessage 收到数据: iLen "+i)}}else CommonTools.log("------onReceiveMessage length<=2---")},e.prototype.trace=function(t){this.text=this.text+"\n"+t,this.stateText.text=this.text,egret.log(t)},e.reloginCnt=0,e.closeFlag=!1,e}(egret.DisplayObjectContainer);__reflect(WebSocketUtil.prototype,"WebSocketUtil");var FightingModule=function(){function t(t){this.pMainRole="",this.p1=119,this.p2=120,this.controlerHit_x=28,this.controlerHit_y=183,this.r=104,this.controlerHit_x_c=132,this.controlerHit_y_c=287,this.initRow=7,this.initColumn=9,this.firstItemX=167,this.firstItemY=134,this.groundItemW=82,this.groundItemH=82,this.groundOffX=-25,this.groundOffY=-28,this.APP_MODE=1,this.FIGHT_MODE=1,this.scaleX=1,this.scaleY=1,this.playerData=null,this.playerLen=0,this.curPlayer=null,this.vsPanel=null,this.resultPanel=null,this.miniGamePanel=null,this.otherCount=0,this.counterTimer=null,this.countDown=3,this.backBtn=null,this.initCnt=0,this.testGround=[1,1,1,1,1,1,2,2,1,1,1,1,1,1,1,2,1,2,1,1,1,3,1,1,2,2,1,3,2,2,1,1,1,2,2,3,1,1,3,1,1,1,2,2,1,1,2,1,1,1,1,2,3,2,1,1,1,1,1,1,2,3,2],this.testMap=[1,1,1,1,1,1,2,6,1,1,119,1,1,1,1,2,6,1,1,1,1,1,1,1,2,6,1,3,2,2,1,1,120,2,6,1,1,1,13,1,1,1,2,6,1,1,9,6,1,1,1,2,6,1,1,12,11,1,1,1,2,6,1],this.testGround2=[1,1,1,1,1,1,2,2,1,1,1,1,1,1,1,1,1,2,1,2,1,1,1,1,1,3,1,1,2,2,1,1,1,3,2,2,1,1,1,2,2,3,1,1,1,1,3,1,1,1,2,2,1,1,1,1,2,1,1,1,1,2,3,2,1,1,1,1,1,1,1,1,2,3,2,1,1,1,1,1,1,1,1,2,3,2,1,1,1,1,1,1,1,1,2,3,2,1,1],this.testMap2=[0,0,0,0,0,0,0,0,5,6,0,0,119,0,0,0,0,0,6,5,6,0,0,0,0,0,0,0,0,6,5,6,0,0,0,0,0,0,120,0,6,5,6,0,0,0,13,0,0,0,0,6,5,6,0,0,9,6,0,0,0,0,0,0,0,0,0,9,6,0,0,0,0,6,5,6,0,0,9,6,0,0,0,0,6,5,6,0,0,12,11,0,0,0,0,6,5,6,0],CommonAudioHandle.play("mainmenu_mp3",0),CommonTools.log("=init===1=========="),this.context=t,this.maskBg=new eui.Image("bg_ppt_1_png"),this.maskBg.width=this.context.getStageWidth(),this.maskBg.height=this.context.getStageHeight(),this.context.addChild(this.maskBg),this.panel=new eui.Panel,this.panel.skinName="resource/eui_skins/UserUI/fightingUI.exml",this.panel.title="Title",this.panel.horizontalCenter=0,this.panel.verticalCenter=0,this.context.addChild(this.panel),this.backBtn=new eui.Image("btn_back_png"),this.backBtn.width=60,this.backBtn.height=60,this.backBtn.x=44,this.backBtn.y=10,this.backBtn.name="back_btn",this.context.addChild(this.backBtn),this.backBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.infoPanel=new eui.Panel,this.infoPanel.skinName="resource/eui_skins/UserUI/FightInfoGroup.exml",this.infoPanel.title="TitleInfo",this.infoPanel.x=0,this.infoPanel.y=110,this.infoPanel.scaleX=.6,this.infoPanel.scaleY=.6,this.context.addChild(this.infoPanel),CommonTools.log("=init===2=========="),CommonTools.fixFix(this.context,this.panel,1,0,0),ConstValue.gatewayType=1,Main.roomkey=null
}return t.prototype.initConfig=function(){LZMA.decompress(EBitUtil.getArr(new egret.ByteArray(RES.getRes("config_json"))),function(t){ConstValue.P_CONFIG=JSON.parse(t)},function(t){})},t.prototype.initMapData=function(t){this.APP_MODE=t.map_mode,this.FIGHT_MODE=t.fight_mode,this.testGround=t.bgConf,this.testMap=t.layerConf,this.playerData=t.player},t.prototype.setControl=function(t,e){var i=Math.atan2(e-this.controlerHit_y_c,t-this.controlerHit_x_c),o=i*(180/Math.PI),n=this.controlerHit_x+this.r*Math.cos(3.14*o/180),s=this.controlerHit_y+this.r*Math.sin(3.14*o/180);this.controlerHit.x=n,this.controlerHit.y=s},t.prototype.myKeyDown=function(t){if(CommonTools.logDebug("keydown =====code:"+t.keyCode),87==t.keyCode||83==t.keyCode||65==t.keyCode||68==t.keyCode){var e=ConstValue.P_FIGHT_OBJ.getMainPlayer();e.keyDir!=t.keyCode&&(null!=e.func&&(e.setMoving(!1),e.removeEventListener(egret.Event.ENTER_FRAME,e.func,e),e.func=null),e.func=function(t){e.setMoving(!0),e.move(-1,!0)},e.addEventListener(egret.Event.ENTER_FRAME,e.func,e),e.keyDir=t.keyCode),87==t.keyCode&&(e.setMoving(!0),e.move(0,!1)),83==t.keyCode&&(e.setMoving(!0),e.move(2,!1)),65==t.keyCode&&(e.setMoving(!0),e.move(3,!1)),68==t.keyCode&&(e.setMoving(!0),e.move(1,!1))}if(74==t.keyCode){var i=ConstValue.P_FIGHT_OBJ.getMainPlayer();i.markPosition(-1);var o=CommonTools.getDataJsonStr("syncPut",1,{x:i.x,y:i.y,idx:parseInt(i.curMapIdx),playerID:0});ConstValue.P_NET_OBJ.sendData2(o)}},t.prototype.myKeyUp=function(e){if(CommonTools.logDebug("keyup =====code:"+e.keyCode),87==e.keyCode||83==e.keyCode||65==e.keyCode||68==e.keyCode){ConstValue.P_FIGHT_OBJ.controlerHit.x=ConstValue.P_FIGHT_OBJ.controlerHit_x,ConstValue.P_FIGHT_OBJ.controlerHit.y=ConstValue.P_FIGHT_OBJ.controlerHit_y;var i=ConstValue.P_FIGHT_OBJ.getMainPlayer();if(i.setMoving(!1),i.removeEventListener(egret.Event.ENTER_FRAME,i.func,i),i.func=null,i.keyDir=-1,!t.aiPVE){var o=CommonTools.getDataJsonStr("syncPos",1,{x:i.x,y:i.y,direction:-1,speed:i.speed,idx:parseInt(i.curMapIdx),playerID:0});ConstValue.P_NET_OBJ.sendData2(o)}}},t.prototype.initScene=function(){if(!(this.initCnt>0)){this.initCnt++,2==this.APP_MODE&&(this.initRow=9,this.initColumn=11,this.scaleX=.8,this.scaleY=.8),t.groundLayer=this.panel.getChildByName("fighting_parent").getChildByName("ground_layer"),t.playerLayer=this.panel.getChildByName("fighting_parent").getChildByName("player_layer"),t.bulletLayer=this.panel.getChildByName("fighting_parent").getChildByName("bullet_layer"),t.mapLayer=this.panel.getChildByName("fighting_parent").getChildByName("map_layer"),2==this.APP_MODE?(this.panel.getChildByName("fighting_parent").getChildByName("fighting_platform").width=802,this.panel.getChildByName("fighting_parent").getChildByName("fighting_platform").height=670,this.panel.getChildByName("fighting_parent").x=156,this.panel.getChildByName("fighting_parent").y=-50):1==this.APP_MODE&&(this.panel.getChildByName("fighting_parent").x=145,this.panel.getChildByName("fighting_parent").y=-45),this.controlerParent=this.panel.getChildByName("controler_parent"),this.controlerHit=this.panel.getChildByName("controler_parent").getChildByName("controler_hit_btn"),this.panel.getChildByName("test").addEventListener(egret.TouchEvent.TOUCH_TAP,function(t){var e=CommonTools.getDataJsonStr("test",1,{v:1});ConstValue.P_NET_OBJ.sendData2(e)},this),this.panel.getChildByName("boom_btn").addEventListener(egret.TouchEvent.TOUCH_TAP,function(t){var e=this.getMainPlayer();e.markPosition(-1);var i=CommonTools.getDataJsonStr("syncPut",1,{x:e.x,y:e.y,idx:parseInt(e.curMapIdx),playerID:0});ConstValue.P_NET_OBJ.sendData2(i)},this),this.controlerParent.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(t){var e=this.getMainPlayer();null!=e.func&&(e.setMoving(!1),e.removeEventListener(egret.Event.ENTER_FRAME,e.func,e),e.func=null),e.func=function(t){e.setMoving(!0),e.move(-1,!0)},e.addEventListener(egret.Event.ENTER_FRAME,e.func,e)},this),document.addEventListener("keydown",this.myKeyDown),document.addEventListener("keyup",this.myKeyUp),this.controlerParent.addEventListener(egret.TouchEvent.TOUCH_END,function(e){this.controlerHit.x=this.controlerHit_x,this.controlerHit.y=this.controlerHit_y;var i=this.getMainPlayer();if(i.setMoving(!1),i.removeEventListener(egret.Event.ENTER_FRAME,i.func,i),i.func=null,!t.aiPVE){var o=CommonTools.getDataJsonStr("syncPos",1,{x:i.x,y:i.y,direction:-1,speed:i.speed,idx:parseInt(i.curMapIdx),playerID:0});ConstValue.P_NET_OBJ.sendData2(o)}},this),this.controlerParent.addEventListener(egret.TouchEvent.TOUCH_MOVE,function(t){CommonTools.log("=e.localX, e.localY========x:::="+t.localX+" y:::"+t.localY);var e=this.getMainPlayer();t.localX>=this.controlerHit_x_c&&t.localY>=this.controlerHit_y_c?t.localX-this.controlerHit_x_c>=t.localY-this.controlerHit_y_c?(CommonTools.log("四-------右"),e.setMoving(!0),e.move(1,!1)):(CommonTools.log("四-------下"),e.setMoving(!0),e.move(2,!1)):t.localX>=this.controlerHit_x_c&&t.localY<=this.controlerHit_y_c?t.localX-this.controlerHit_x_c>=this.controlerHit_y_c-t.localY?(CommonTools.log("一-------右"),e.setMoving(!0),e.move(1,!1)):(CommonTools.log("一-------上"),e.setMoving(!0),e.move(0,!1)):t.localX<=this.controlerHit_x_c&&t.localY<=this.controlerHit_y_c?this.controlerHit_x_c-t.localX>=this.controlerHit_y_c-t.localY?(CommonTools.log("二-------左"),e.setMoving(!0),e.move(3,!1)):(CommonTools.log("二-------上"),e.setMoving(!0),e.move(0,!1)):t.localX<=this.controlerHit_x_c&&t.localY>=this.controlerHit_y_c&&(this.controlerHit_x_c-t.localX>=t.localY-this.controlerHit_y_c?(CommonTools.log("三-------左"),e.setMoving(!0),e.move(3,!1)):(CommonTools.log("三-------下"),e.setMoving(!0),e.move(2,!1))),this.setControl(t.localX,t.localY)},this);for(var e=0,i=0;i<this.initRow;i++)for(var o=0;o<this.initColumn;o++){var n=this.groundItemW,s=this.groundItemH,a=this.groundOffX,l=this.groundOffY;2==this.APP_MODE&&o>0&&(a=-32,n=this.groundItemW*this.scaleX),2==this.APP_MODE&&i>0&&(l=-32,s=this.groundItemH*this.scaleY);var r=this.firstItemX+n*o+a,h=this.firstItemY+s*i+l,u={img:"res_"+this.testGround[e]+"_png",x:r,y:h,name:"ground_"+e,curIdx:e},c=new Fight.MapItem(u);c.setRow(i),c.setColumn(o),c.setType(ConstValue.P_CONFIG.MapBase[this.testGround[e].toString()].Type),2==this.APP_MODE&&(c.scaleX=this.scaleX,c.scaleY=this.scaleY),t.groundLayer.addChild(c),t.groundLayerSubObj[e.toString()]=c,t.groundLayerSubObjDanger[c.getColumn()+"_"+c.getRow()]=c;var d=-48;if(2==this.APP_MODE&&(d=-42),this.testMap[e]<=3&&(d=-9),this.testMap[e]>100&&this.playerLen<=this.getPlayerTotal()){this.playerLen++;var g={},m=null,p=!1,_=null;if(this.testMap[e]==this.p1){_=this.getPlayerBySize(1);var C=40,y=0;2==this.APP_MODE&&(C=28),g={pObj:_,side:1,x:r+C,y:h+y,name:"role1",isAI:_.isAI,iClass:_.iClass},p=!0}else{_=this.getPlayerBySize(2);var C=40,f=0;2==this.APP_MODE&&(C=28),g={pObj:_,side:2,x:r+C,y:h+f,name:"role2",isAI:_.isAI,iClass:_.iClass}}if(m=new Fight.Player(g),m.roleId==ConstValue.cacheUserInfo.id&&(this.curPlayer=m),2==this.APP_MODE&&(m.scaleX=this.scaleX,m.scaleY=this.scaleY),t.playerLayer.addChild(m),m.markPosition(-1),t.playerLayerSubObj[e.toString()]=m,1==m.isAI){var b=null;b=0==_.aiLevel?new AIUtil0(m,this.testMap,this.initRow,this.initColumn,this.APP_MODE):1==_.aiLevel?new AIUtil1(m,this.testMap,this.initRow,this.initColumn,this.APP_MODE):2==_.aiLevel?new AIUtil2(m,this.testMap,this.initRow,this.initColumn,this.APP_MODE):3==_.aiLevel?new AIUtil3(m,this.testMap,this.initRow,this.initColumn,this.APP_MODE):new AIUtil1(m,this.testMap,this.initRow,this.initColumn,this.APP_MODE),t.aiSubObj[e.toString()]=b,t.aiPVE=!0}CommonTools.log("init player x,y "+m.x+" "+m.y)}else if(this.testMap[e]>0&&this.testMap[e]<100){var v={img:"res_"+this.testMap[e]+"_png",x:r,y:h+d,name:"mapitem_"+e,curIdx:e},x=new Fight.MapItem(v);x.setRow(i),x.setColumn(o),x.setType(ConstValue.P_CONFIG.MapBase[this.testMap[e].toString()].Type),2==this.APP_MODE&&(x.scaleX=this.scaleX,x.scaleY=this.scaleY),t.mapLayer.addChild(x),t.mapLayerSubObj[e.toString()]=x}e++}}},t.prototype.getPlayerBySize=function(t){for(var e in this.playerData){var i=this.playerData[e];if(i.player_side==t)return i}return null},t.prototype.getPlayerTotal=function(){var t=0;for(var e in this.playerData)t++;return t},t.prototype.onClick=function(t){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(i){switch(e=t.target.name,CommonTools.log("==========name::::"+e),e){case"replay_btn":case"replay_fail_btn":this.replay();break;case"replay_btn_guanka":this.replayGuanka();break;case"goback_btn":case"back_btn":case"goback_fail_btn":this.clear();break;default:CommonTools.log("11111111 default")}return[2]})})},t.prototype.showResultpanel=function(t,e,i){if(null==this.resultPanel){this.maskResultBg=new eui.Image("mask_layer_png"),this.maskResultBg.width=this.context.getStageWidth(),this.maskResultBg.height=this.context.getStageHeight(),this.context.addChild(this.maskResultBg),this.resultPanel=new eui.Panel,this.resultPanel.horizontalCenter=0,this.resultPanel.verticalCenter=0,this.resultPanel.skinName="resource/eui_skins/UserUI/FightResultUI.exml",this.context.addChild(this.resultPanel),CommonTools.fixFix(this.context,this.resultPanel,1,0,0);var o=this.resultPanel.getChildByName("replay_btn");CommonButtonHandle.beginTouch(o,this),o.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this);var n=this.resultPanel.getChildByName("goback_btn");CommonButtonHandle.beginTouch(n,this),n.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this);var s=this.resultPanel.getChildByName("share_btn");CommonButtonHandle.beginTouch(s,this),s.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this);var a=this.resultPanel.getChildByName("goback_fail_btn");CommonButtonHandle.beginTouch(a,this),a.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this);var l=this.resultPanel.getChildByName("replay_fail_btn");CommonButtonHandle.beginTouch(l,this),l.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.resultPanel.getChildByName("gold_lb").text=i.coin;var r=this.resultPanel.getChildByName("gold_add_img_01"),h=this.resultPanel.getChildByName("gold_add_img_02"),u=this.resultPanel.getChildByName("gold_add_img_03");if(i.addcoin<10)h.visible=!1,u.visible=!1,r.source="digital_1_json."+i.addcoin;else if(i.addcoin<100){u.visible=!1;var c=Math.floor(i.addcoin/10),d=i.addcoin%10;r.source="digital_1_json."+c,h.source="digital_1_json."+d}else{var g=Math.floor(i.addcoin/100),m=i.addcoin%100,c=Math.floor(m/10),d=m%10;r.source="digital_1_json."+g,h.source="digital_1_json."+c,u.source="digital_1_json."+d}var p=this.resultPanel.getChildByName("exp_add_img_01"),_=this.resultPanel.getChildByName("exp_add_img_02"),C=this.resultPanel.getChildByName("exp_add_img_03");if(i.addExp<10)_.visible=!1,C.visible=!1,p.source="digital_2_json."+i.addExp;else if(i.addExp<100){C.visible=!1;var c=Math.floor(i.addExp/10),d=i.addExp%10;p.source="digital_2_json."+c,_.source="digital_2_json."+d}else{var g=Math.floor(i.addExp/100),m=i.addExp%100,c=Math.floor(m/10),d=m%10;p.source="digital_2_json."+g,_.source="digital_2_json."+c,C.source="digital_2_json."+d}var y=this.resultPanel.getChildByName("win_title_img");0==i.win?(y.source=RES.getRes("fail_png"),CommonAudioHandle.playEffect("failure_mp3",1),o.visible=!1,s.visible=!1,n.visible=!1):(CommonAudioHandle.playEffect("success_mp3",1),a.visible=!1,l.visible=!1);var f=this.resultPanel.getChildByName("right_name_lb");f.text=e.name;var b=this.resultPanel.getChildByName("left_name_lb");b.text=t.name,CommonTools.niceTip(this.resultPanel,1,this)}},t.prototype.showGuanKaResultpanel=function(t,e,i){if(null==this.resultPanel){this.maskResultBg=new eui.Image("mask_layer_png"),this.maskResultBg.width=this.context.getStageWidth(),this.maskResultBg.height=this.context.getStageHeight(),this.context.addChild(this.maskResultBg),this.resultPanel=new eui.Panel,this.resultPanel.horizontalCenter=0,this.resultPanel.verticalCenter=0,this.resultPanel.skinName="resource/eui_skins/UserUI/FightGuanKaResultUI.exml",this.context.addChild(this.resultPanel),CommonTools.fixFix(this.context,this.resultPanel,1,0,0);var o=this.resultPanel.getChildByName("replay_btn_guanka");CommonButtonHandle.beginTouch(o,this),o.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this);var n=this.resultPanel.getChildByName("goback_btn");CommonButtonHandle.beginTouch(n,this),n.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this);var s=this.resultPanel.getChildByName("share_btn");CommonButtonHandle.beginTouch(s,this),s.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.resultPanel.getChildByName("gold_lb").text=i.coin;var a=this.resultPanel.getChildByName("gold_add_img_01"),l=this.resultPanel.getChildByName("gold_add_img_02"),r=this.resultPanel.getChildByName("gold_add_img_03");if(i.addcoin<10)l.visible=!1,r.visible=!1,a.source="digital_1_json."+i.addcoin;else if(i.addcoin<100){r.visible=!1;var h=Math.floor(i.addcoin/10),u=i.addcoin%10;a.source="digital_1_json."+h,l.source="digital_1_json."+u}else{var c=Math.floor(i.addcoin/100),d=i.addcoin%100,h=Math.floor(d/10),u=d%10;a.source="digital_1_json."+c,l.source="digital_1_json."+h,r.source="digital_1_json."+u}var g=this.resultPanel.getChildByName("exp_add_img_01"),m=this.resultPanel.getChildByName("exp_add_img_02"),p=this.resultPanel.getChildByName("exp_add_img_03");if(i.addExp<10)m.visible=!1,p.visible=!1,g.source="digital_2_json."+i.addExp;else if(i.addExp<100){p.visible=!1;var h=Math.floor(i.addExp/10),u=i.addExp%10;g.source="digital_2_json."+h,m.source="digital_2_json."+u}else{var c=Math.floor(i.addExp/100),d=i.addExp%100,h=Math.floor(d/10),u=d%10;g.source="digital_2_json."+c,m.source="digital_2_json."+h,p.source="digital_2_json."+u}var _=this.resultPanel.getChildByName("win_title_img");0==i.win?(_.source=RES.getRes("fail_png"),CommonAudioHandle.playEffect("failure_mp3",1)):CommonAudioHandle.playEffect("success_mp3",1);for(var C=1;C<=i.star;C++){var y=this.resultPanel.getChildByName("star_0"+C);y.source="start_01_png"}var f=this.resultPanel.getChildByName("lb_guanka");f.text=i.GuanKaDesc,CommonTools.niceTip(this.resultPanel,1,this)}},t.prototype.closeResultpanel=function(){null!=this.resultPanel&&(this.context.removeChild(this.resultPanel),this.resultPanel=null),null!=this.maskResultBg&&(this.context.removeChild(this.maskResultBg),this.maskResultBg=null)},t.prototype.closeNice=function(){},t.prototype.isAiVs=function(){for(var e in t.aiSubObj)return!0;return!1},t.prototype.showVsMiniGamepanel=function(){if(null==this.miniGamePanel){this.maskMiniBg=new eui.Image("fighting_vs_png"),this.maskMiniBg.width=this.context.getStageWidth(),this.maskMiniBg.height=this.context.getStageHeight(),this.context.addChild(this.maskMiniBg),this.miniGamePanel=new eui.Panel,this.miniGamePanel.horizontalCenter=0,this.miniGamePanel.verticalCenter=0,this.miniGamePanel.skinName="resource/eui_skins/UserUI/FightingVsMiniGameUI.exml",this.context.addChild(this.miniGamePanel),CommonTools.fixFix(this.context,this.miniGamePanel,1,0,0);var t=this.miniGamePanel.getChildByName("time_countdown"),e=(this.miniGamePanel.getChildByName("my_click_num_lb"),this.miniGamePanel.getChildByName("other_click_num_lb"));this.miniGamePanel.getChildByName("click_btn").addEventListener(egret.TouchEvent.TOUCH_TAP,function(t){if(this.countDown>0)return void CommonTools.addCommonTips(this.context,"倒计时中...");var e=CommonTools.getDataJsonStr("normalClick",1,{});ConstValue.P_NET_OBJ.sendData2(e)},this),this.miniGamePanel.getChildByName("giveup_btn").addEventListener(egret.TouchEvent.TOUCH_TAP,function(t){},this),this.miniGamePanel.getChildByName("use_btn").addEventListener(egret.TouchEvent.TOUCH_TAP,function(t){},this),this.counterTimer=new egret.Timer(1e3,0),this.counterTimer.addEventListener(egret.TimerEvent.TIMER,function(){0==this.countDown?(t.visible=!1,0==this.otherCount?CommonTools.addCommonTips(this.context,"开始抢夺！！GO"):CommonTools.addCommonTips(this.context,"扑街，7头！！加油，加油...冇吃饭啊，丢"),this.isAiVs()&&(this.otherCount++,e.text=this.otherCount+" 对手")):(this.countDown--,t.text=this.countDown)},this),this.counterTimer.start()}},t.prototype.updateClickData=function(e){var i=this.miniGamePanel.getChildByName("my_click_num_lb"),o=this.miniGamePanel.getChildByName("other_click_num_lb");for(var n in t.playerLayerSubObj){var s=t.playerLayerSubObj[n];s.roleId==e.uid&&(1==s.whichSide?i.text=s.name+" "+e.click:o.text=s.name+" "+e.click)}},t.prototype.showVspanel=function(){null==this.vsPanel&&(this.maskVsBg=new eui.Image("fighting_vs_png"),this.maskVsBg.width=this.context.getStageWidth(),this.maskVsBg.height=this.context.getStageHeight(),this.context.addChild(this.maskVsBg),this.vsPanel=new eui.Panel,this.vsPanel.horizontalCenter=0,this.vsPanel.verticalCenter=0,this.vsPanel.skinName="resource/eui_skins/UserUI/FightingVsUI.exml",this.context.addChild(this.vsPanel),HallModule.isNoEnd||HallModule.isTrainBrr?this.vsPanel.getChildByName("match_tip").text="进入中":this.vsPanel.getChildByName("match_tip").text="匹配中....",CommonTools.fixFix(this.context,this.vsPanel,1,0,0))},t.prototype.releaseVsPanel=function(){null==this.vsPanel&&this.showVspanel(),HallModule.isNoEnd||HallModule.isTrainBrr?this.vsPanel.getChildByName("match_tip").text="开始战斗":this.vsPanel.getChildByName("match_tip").text="匹配成功",t.Delay(3e3,function(){if(null!=this.vsPanel&&(this.context.removeChild(this.vsPanel),this.vsPanel=null),null!=this.maskVsBg&&(this.context.removeChild(this.maskVsBg),this.maskVsBg=null),this.initScene(),null==this.miniGamePanel&&!HallModule.isTrainBrr)for(var e in t.aiSubObj){var i=t.aiSubObj[e];i.startAI()}},this)},t.prototype.releaseMiniGamePanel=function(){null!=this.miniGamePanel&&(this.context.removeChild(this.miniGamePanel),this.miniGamePanel=null),null!=this.maskMiniBg&&(this.context.removeChild(this.maskMiniBg),this.maskMiniBg=null)},t.prototype.updateInfo=function(t){var e=t[ConstValue.cacheUserInfo.id];this.infoPanel.getChildByName("group_1").getChildByName("heart_num_lb").text=e.life,this.infoPanel.getChildByName("group_1").getChildByName("spead_num_lb").text=e.speed,this.infoPanel.getChildByName("group_1").getChildByName("boom_num_lb").text=e.paopaocount,this.infoPanel.getChildByName("group_1").getChildByName("fire_num_lb").text=e.power},t.prototype.getMainPlayer=function(){return this.curPlayer},t.prototype.getPlayerById=function(e){for(var i in t.playerLayerSubObj){var o=t.playerLayerSubObj[i];if(o.roleId==e)return o}return null},t.Delay=function(t,e,i){var o=new egret.Timer(t,1);o.addEventListener(egret.TimerEvent.TIMER,e,i),o.start()},t.prototype.getInitRow=function(){return this.initRow},t.prototype.getInitColumn=function(){return this.initColumn},t.prototype.syncMove=function(t){var e=this.getPlayerById(t.rid);if(!e.isMainPlayer)return e.x=t.x,e.y=t.y,-1==t.direction?void(null!=e.func&&(e.setMoving(!1),e.removeEventListener(egret.Event.ENTER_FRAME,e.func,e),e.func=null)):void(null==e.func?(e.func=function(t){e.setMoving(!0),e.move(-1,!0)},e.addEventListener(egret.Event.ENTER_FRAME,e.func,e),e.setMoving(!0),e.move(t.direction,!1)):(e.setMoving(!0),e.move(t.direction,!1)))},t.prototype.getMapObjByIdx=function(e){for(var i in t.mapLayerSubObj){var o=t.mapLayerSubObj[i];if(o.getCurIdx()==e)return o}return null},t.prototype.syncBoomZhuan=function(e){var i=this.getMapObjByIdx(e.breakidx);for(var o in t.aiSubObj){var n=t.aiSubObj[o];n.openBlock(i.getColumn(),i.getRow())}var s=CommonTools.getAnimDraw(RES.getRes("SpeedNet_json"),RES.getRes("SpeedNet_png"),"0");t.mapLayer.addChild(s);var a=i.x,l=i.y;s.x=a,s.y=l,t.mapLayer.removeChild(i),t.mapLayerSubObj[e.breakidx.toString()]=null,delete t.mapLayerSubObj[e.breakidx.toString()],s.scaleX=3,s.scaleY=3,s.x+=40,s.y+=70,s.play(1),s.once(egret.Event.COMPLETE,function(i){if(null!=e.effect.type){var o=null;1==e.effect.type?o=new eui.Image(RES.getRes("mini_res_json.mini_speed")):3==e.effect.type?o=new eui.Image(RES.getRes("mini_res_json.mini_weili")):2==e.effect.type&&(o=new eui.Image(RES.getRes("mini_res_json.mini_boom"))),t.groundLayerSubObj[e.breakidx.toString()].addSub(o,e.effect.type)}t.mapLayer.removeChild(s)},this)},t.prototype.clear=function(){return __awaiter(this,void 0,void 0,function(){var e,i,o;return __generator(this,function(n){switch(n.label){case 0:for(e in t.aiSubObj)i=t.aiSubObj[e],i.stopAI();return this.context.removeChild(this.backBtn),this.backBtn=null,o=CommonTools.getDataJsonStr("exitPPRoom",1,{}),ConstValue.P_NET_OBJ.sendData(o),this.closeResultpanel(),this.context.removeChild(this.panel),t.groundLayer.removeChildren(),t.groundLayer=null,t.playerLayer.removeChildren(),t.playerLayer=null,t.bulletLayer.removeChildren(),t.bulletLayer=null,t.mapLayer.removeChildren(),t.mapLayer=null,t.groundLayerSubObj={},t.playerLayerSubObj={},t.bulletLayerSubObj={},t.mapLayerSubObj={},t.groundLayerSubObjDanger={},this.context.dDataInfo=null,this.context.dDataInfo2=null,t.readyRes=!1,t.readyTwo=!1,t.aiSubObj={},t.aiPVE=!1,document.removeEventListener("keydown",this.myKeyDown),document.removeEventListener("keyup",this.myKeyUp),[4,this.context.loadResource("preloadHall",2)];case 1:return n.sent(),ConstValue.P_FIGHT_OBJ=null,[2]}})})},t.prototype.clear2=function(){for(var e in t.aiSubObj){var i=t.aiSubObj[e];i.stopAI()}this.context.removeChild(this.backBtn),this.backBtn=null;var o=CommonTools.getDataJsonStr("exitPPRoom",1,{});ConstValue.P_NET_OBJ.sendData(o),this.closeResultpanel(),this.context.removeChild(this.panel),t.groundLayer.removeChildren(),t.groundLayer=null,t.playerLayer.removeChildren(),t.playerLayer=null,t.bulletLayer.removeChildren(),t.bulletLayer=null,t.mapLayer.removeChildren(),t.mapLayer=null,t.groundLayerSubObj={},t.playerLayerSubObj={},t.bulletLayerSubObj={},t.mapLayerSubObj={},t.groundLayerSubObjDanger={},this.context.dDataInfo=null,this.context.dDataInfo2=null,t.readyRes=!1,t.readyTwo=!1,t.aiSubObj={},t.aiPVE=!1,document.removeEventListener("keydown",this.myKeyDown),document.removeEventListener("keyup",this.myKeyUp),ConstValue.P_FIGHT_OBJ=null},t.prototype.replay=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return this.clear2(),[4,this.context.loadResource("fighting",3)];case 1:return t.sent(),[2]}})})},t.prototype.replayGuanka=function(){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(e){return this.clear2(),t=CommonTools.getDataJsonStr("C2GGotoBarrier",1,{barrierNo:1}),ConstValue.P_NET_OBJ.sendData(t),[2]})})},t.prototype.handlePacket=function(e){if("syncPosBroadcase"==e.f)""!=e.m||1!=e.s||this.syncMove(e.d);else if("syncPut"==e.f)if(""!=e.m||1!=e.s);else{if(null==e.d.rid)return;var i=this.getPlayerById(e.d.rid);i.fire(e.d.paopaoID,e.d.idx)}else if("syncBoomZhuan"==e.f)if(""!=e.m||1!=e.s);else{if(null==e.d.breakidx)return;this.syncBoomZhuan(e.d)}else if("syncpickItem"==e.f)if(""!=e.m||1!=e.s);else{for(var o in e.d.player){var n=e.d.player[o],s=this.getPlayerById(n.uid);s.speed=n.speed,s.bulletLen=n.power}this.updateInfo(e.d.player),CommonAudioHandle.playEffect("eatProp_mp3",1)}else if("gameResult"==e.f)if(""!=e.m||1!=e.s);else{for(var o in t.aiSubObj){var n=t.aiSubObj[o];n.stopAI()}var a=null,l=null,r=null;for(var o in e.d.player){var n=e.d.player[o];0==n.win?r=n:l=n,n.uid==ConstValue.cacheUserInfo.id&&(a=n)}this.showResultpanel(l,r,a)}else if("gameGuanKaResult"==e.f)if(""!=e.m||1!=e.s);else{for(var o in t.aiSubObj){var n=t.aiSubObj[o];n.stopAI()}var a=null,l=null,r=null;for(var o in e.d.player){var n=e.d.player[o];0==n.win?r=n:l=n,n.uid==ConstValue.cacheUserInfo.id&&(a=n)}this.showGuanKaResultpanel(l,r,a)}else if("miniGameInfo"==e.f)if(""!=e.m||1!=e.s);else{ConstValue.P_FIGHT_OBJ.showVsMiniGamepanel();for(var o in t.aiSubObj){var n=t.aiSubObj[o];n.stopAI()}}else"UpdateClick"==e.f&&(""!=e.m||1!=e.s||this.updateClickData(e.d))},t.groundLayerSubObj={},t.groundLayerSubObjDanger={},t.playerLayerSubObj={},t.bulletLayerSubObj={},t.mapLayerSubObj={},t.mapLayerLock=!1,t.mapLeftLimit=177,t.mapUpLimit=106,t.mapRightLimit=823,t.mapDownLimit=649,t.aiSubObj={},t.aiPVE=!1,t.readyTwo=!1,t.readyRes=!1,t}();__reflect(FightingModule.prototype,"FightingModule");var HallModule=function(){function t(e){this.sCurModifyBtn="",this.sCurModifyValue="",this.sCurModifyValue2="",this.shopUIType=1,this.shopPageType=0,this.shopItemNo=0,this.shopItemItemID=0,this.shopItemName="",this.barrLayer=1,this.seventCur=0,this.seventGetState=!1,this.shopItemClickName="",this.showWxVsPanel=null,this.isMainRoomer=!1,this.roleSelectIdx="0",this.isdisplay=!1,this.context=e,t.isNoEnd=!1,t.isTrainBrr=!1,ConstValue.P_CONFIG=JSON.parse(JSON.stringify(RES.getRes("res_json"))),this.init()}return t.prototype.initConfig=function(){var t=this;LZMA.decompress(EBitUtil.getArr(new egret.ByteArray(RES.getRes("config_json"))),function(e){ConstValue.P_CONFIG=JSON.parse(e),t.init()},function(t){})},t.prototype.init=function(){CommonAudioHandle.play("mainmenu_mp3",0),this.panel=new eui.Panel,this.panel.skinName="resource/eui_skins/UserUI/HallUI.exml",this.panel.title="Title",this.panel.horizontalCenter=0,this.panel.verticalCenter=0,this.context.addChild(this.panel),this.panel.getChildByName("btn_match_pvp").addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.panel.getChildByName("btn_map_diy").addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.panel.getChildByName("btn_noend_pve").addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.panel.getChildByName("btn_friend_pvp").addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.panel.getChildByName("img_info").addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.panel.getChildByName("btn_training_pve").addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),CommonTools.fixFix(this.context,this.panel.getChildByName("btn_shop"),1,0,10),CommonTools.fixFix(this.context,this.panel.getChildByName("btn_map_diy"),2,0,0),CommonTools.fixFix(this.context,this.panel.getChildByName("btn_match_pvp"),2,0,0),CommonTools.fixFix(this.context,this.panel.getChildByName("btn_training_pve"),2,0,0),CommonTools.fixFix(this.context,this.panel.getChildByName("btn_noend_pve"),2,0,0),CommonTools.fixFix(this.context,this.panel.getChildByName("btn_friend_pvp"),2,0,0),CommonTools.fixFix(this.context,this.panel.getChildByName("info_grp"),1,44,10),CommonTools.fixFix(this.context,this.panel.getChildByName("img_head_bg"),1,34,10),CommonTools.fixFix(this.context,this.panel.getChildByName("img_info"),1,44,10),CommonTools.fixFix(this.context,this.panel.getChildByName("img_exp_bg"),1,27,10),CommonTools.fixFix(this.context,this.panel.getChildByName("img_exp_value"),1,27,10),CommonTools.fixFix(this.context,this.panel.getChildByName("img_coin_bg"),1,-10,10),CommonTools.fixFix(this.context,this.panel.getChildByName("img_zuan_bg"),1,0,10),CommonTools.fixFix(this.context,this.panel.getChildByName("btn_noticetip"),1,0,10),CommonTools.fixFix(this.context,this.panel.getChildByName("hall_id_lb"),1,34,10),CommonTools.fixFix(this.context,this.panel.getChildByName("coin_num_lb"),1,-10,10),CommonTools.fixFix(this.context,this.panel.getChildByName("zuan_num_lb"),1,-10,10),CommonTools.fixFix(this.context,this.panel.getChildByName("img_lv_lb"),1,30,10),CommonTools.fixFix(this.context,this.panel.getChildByName("rank_grounp_main"),1,44,10);var t=this.panel.getChildByName("img_info");""!=ConstValue.cacheUserInfo.headPic&&(t.source=ConstValue.cacheUserInfo.headPic);var e=this.panel.getChildByName("hall_id_lb");e.text=ConstValue.cacheUserInfo.name;var i=this.panel.getChildByName("img_lv_lb");i.text=ConstValue.cacheUserInfo.lv;var o=this.panel.getChildByName("img_exp_value");o.width=1*ConstValue.cacheUserInfo.exp/1e5*o.width;var n=this.panel.getChildByName("coin_num_lb");n.text=ConstValue.cacheUserInfo.coin;var s=this.panel.getChildByName("zuan_num_lb");s.text=ConstValue.cacheUserInfo.diamond,null!=ConstValue.cacheUserInfo&&1==ConstValue.cacheUserInfo.gm&&(CommonButtonHandle.beginTouch(this.panel.getChildByName("btn_gm"),this),this.panel.getChildByName("btn_gm").addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this)),CommonTools.fixFix(this.context,this.panel.getChildByName("btn_gm"),2,44,0),ConstValue.gatewayType=0,this.openWXPVP(),this.initPushBtn()},t.prototype.initPushBtn=function(){var e=39.77,i=625.03,o=47,n=1222.48,s=195,a=28,l=0,r=0;for(var h in t.pushBtnData){var u=t.pushBtnData[h];if(0!=u.isOpen){var c=ConstValue.PUSH_BUTTON[u.id+""],d=new eui.Image;d.name=c.btn_name,d.source=c.btn_res_01,1==u.pos?(d.width=84,d.height=84,d.x=n,d.y=s+a*r+d.height*r,r++,CommonTools.fixFix(this.context,d,2,0,0)):(d.width=88,d.height=90,d.x=e+o*l+d.width*l,d.y=i,l++,CommonTools.fixFix(this.context,d,2,0,30)),d.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.panel.addChild(d)}}},t.prototype.openWXPVP=function(){if(CommonTools.log("--Main.roomkey--------"+Main.roomkey),null!=Main.roomkey){CommonTools.log("--Main.roomkey----xxxx----"+Main.roomkey);var t=CommonTools.getDataJsonStr("enter1V1Room",1,{fightRoomKey:Main.roomkey});ConstValue.P_NET_OBJ.sendData(t)}},t.prototype.clickNotice=function(t){for(var e=this.panelNotice.getChildByName("left_scroller"),i=e.getChildByName("left_group"),o=this.panelNotice.getChildByName("lb_title"),n=this.panelNotice.getChildByName("lb_mail_info"),s=i.numChildren,a=parseInt(t.replace("lb_notice_click","")),l=0;s>l;l++){var r=i.getChildByName("p_"+l),h=r.getChildByName("group_1");if(l==a){h.getChildByName("img_yellow").visible=!0,h.getChildByName("img_red").visible=!1;var u=h.getChildByName("img_letter");u.source=RES.getRes("mail_open2_png"),o.text="标题：喜报！！"+(l+1),n.text="恭喜用户1000"+l+"喜获超级大奖xxxxxxxxxxxxxx"}else h.getChildByName("img_yellow").visible=!1}},t.prototype.clickShopItem=function(t){this.shopItemClickName=t;var e=this.panelNotice.getChildByName("res_scroller"),i=e.getChildByName("res_group"),o=this.panelNotice.getChildByName("shop_show_icon"),n=this.panelNotice.getChildByName("shop_show_info"),s=this.panelNotice.getChildByName("lb_gold");s.text=ConstValue.cacheUserInfo.coin;var a=this.panelNotice.getChildByName("lb_diamond");a.text=ConstValue.cacheUserInfo.diamond;var l=i.numChildren,r=parseInt(t.replace("shop_item_click",""));1==this.shopUIType?(this.shopItemNo=this.dShopOrBagData.lShopInfo[r].iNo,n.text=this.getConf("ItemData",this.dShopOrBagData.lShopInfo[r].iNo.toString(),"desc"),this.shopItemName=this.getConf("ItemData",this.dShopOrBagData.lShopInfo[r].iNo.toString(),"name")):(this.shopItemNo=this.dShopOrBagData.lItmeInfo[r].iNo,this.shopItemItemID=this.dShopOrBagData.lItmeInfo[r].iItemID,n.text=this.getConf("ItemData",this.dShopOrBagData.lItmeInfo[r].iNo.toString(),"desc"),this.shopItemName=this.getConf("ItemData",this.dShopOrBagData.lItmeInfo[r].iNo.toString(),"name"));for(var h=0;l>h;h++){var u=i.getChildByName("p_"+h),c=u.getChildByName("group_1"),d=c.getChildByName("shop_item_icon"),g=c.getChildByName("shop_item_bg"),m="shop_item_not_png",p="shop_item_yes_png";2==this.shopUIType&&(m="bag_item_not_png",p="bag_item_yes_png"),h==r?(o.source=d.source,g.source=p):g.source=m}},t.prototype.clickShopPage=function(t){var e=this.panelNotice.getChildByName("btn_fashion"),i=this.panelNotice.getChildByName("btn_paopao"),o=this.panelNotice.getChildByName("btn_texiao"),n=this.panelNotice.getChildByName("btn_daoju"),s=this.panelNotice.getChildByName("t_shi"),a=this.panelNotice.getChildByName("t_zhuang"),l=this.panelNotice.getChildByName("t_pao1"),r=this.panelNotice.getChildByName("t_pao2"),h=this.panelNotice.getChildByName("t_te"),u=this.panelNotice.getChildByName("t_xiao"),c=this.panelNotice.getChildByName("t_dao"),d=this.panelNotice.getChildByName("t_ju"),g="shop_page_not_png",m="shop_page_yes_png",p=16773583,_=15371313;2==this.shopUIType&&(g="rank_select_01_png",m="rank_select_02_png",p=10531804,_=7633371);var C=1;switch(t){case"btn_one_lb":e.source=m,i.source=g,o.source=g,n.source=g,s.textColor=_,a.textColor=_,l.textColor=p,r.textColor=p,h.textColor=p,u.textColor=p,c.textColor=p,d.textColor=p,C=1;
break;case"btn_two_lb":e.source=g,i.source=m,o.source=g,n.source=g,s.textColor=p,a.textColor=p,l.textColor=_,r.textColor=_,h.textColor=p,u.textColor=p,c.textColor=p,d.textColor=p,C=2;break;case"btn_three_lb":e.source=g,i.source=g,o.source=m,n.source=g,s.textColor=p,a.textColor=p,l.textColor=p,r.textColor=p,h.textColor=_,u.textColor=_,c.textColor=p,d.textColor=p,C=3;break;case"btn_four_lb":e.source=g,i.source=g,o.source=g,n.source=m,s.textColor=p,a.textColor=p,l.textColor=p,r.textColor=p,h.textColor=p,u.textColor=p,c.textColor=_,d.textColor=_,C=4}if(1==this.shopUIType){this.shopPageType=C-1;var y=CommonTools.getDataJsonStr("openShopUI",1,{iType:this.shopPageType});ConstValue.P_NET_OBJ.sendData(y)}else{this.shopPageType=C-1;var y=CommonTools.getDataJsonStr("openBagUI",1,{iType:this.shopPageType});ConstValue.P_NET_OBJ.sendData(y)}},t.prototype.onClick=function(e){return __awaiter(this,void 0,void 0,function(){var i,o,n,n,s,a,l,r,h,u,c,d,g,m,p,_;return __generator(this,function(C){switch(C.label){case 0:if(null!=this.context.loadingView&&!ConstValue.P_IS_DEBUG)return CommonTools.log("还在加载中......return "),[2];if(i=e.target.name,CommonTools.log("==========name::::"+i),i.indexOf("lb_notice_click")>=0)return this.clickNotice(i),[2];if(i.indexOf("shop_item_click")>=0)return this.clickShopItem(i),[2];switch(o=i){case"btn_close":return[3,1];case"btn_close_wx_vs":return[3,2];case"btn_start":return[3,3];case"btn_shop":return[3,4];case"btn_training_pve":return[3,5];case"btn_ranking":return[3,6];case"all_rank_lb":return[3,7];case"match_rank_lb":return[3,7];case"lv_rank_lb":return[3,8];case"btn_noticetip":return[3,9];case"btn_match_pvp":return[3,10];case"btn_friend_pvp":return[3,12];case"btn_noend_pve":return[3,13];case"btn_map_diy":return[3,14];case"btn_map_shop":return[3,16];case"btn_map_bag":return[3,17];case"img_info":return[3,18];case"btn_close_edit":return[3,19];case"btn_gm":return[3,20];case"btn_one_lb":return[3,21];case"btn_two_lb":return[3,21];case"btn_three_lb":return[3,21];case"btn_four_lb":return[3,21];case"btn_buy":return[3,22];case"btn_confirm_modify":return[3,23]}return[3,24];case 1:return this.closeNotice(),[3,25];case 2:return this.closeWxVsUI(),[3,25];case 3:return this.isMainRoomer?(n=CommonTools.getDataJsonStr("startGame1V1",1,{fightRoomKey:Main.roomkey}),ConstValue.P_NET_OBJ.sendData(n)):(n=CommonTools.getDataJsonStr("setReady1V1",1,{fightRoomKey:Main.roomkey}),ConstValue.P_NET_OBJ.sendData(n)),[3,25];case 4:return CommonTools.addCommonTips(this.context,ConstValue.P_SEND_WAITING),[3,25];case 5:return t.isTrainBrr=!0,s=CommonTools.getDataJsonStr("C2GEnterTrain",1,{}),ConstValue.P_NET_OBJ.sendData(s),[3,25];case 6:return a=CommonTools.getDataJsonStr("openRnakUI",1,{}),ConstValue.P_NET_OBJ.sendData(a),[3,25];case 7:return l=CommonTools.getDataJsonStr("getTotalPvpRank",1,{}),ConstValue.P_NET_OBJ.sendData(l),[3,25];case 8:return r=CommonTools.getDataJsonStr("getTotalLvRank",1,{}),ConstValue.P_NET_OBJ.sendData(r),[3,25];case 9:return this.showNotice("resource/eui_skins/UserUI/NoticeUI.exml",i),[3,25];case 10:return[4,this.context.loadResource("fighting",3)];case 11:return C.sent(),[3,25];case 12:return this.showNotice("resource/eui_skins/UserUI/SelectShareVsMapUI.exml",i),[3,25];case 13:return h=CommonTools.getDataJsonStr("C2GOpenWujinUI",1,{diffLevel:1}),ConstValue.P_NET_OBJ.sendData(h),[3,25];case 14:return[4,this.context.loadResource("diymap",4)];case 15:return C.sent(),[3,25];case 16:return u=CommonTools.getDataJsonStr("openShopUI",1,{iType:0}),ConstValue.P_NET_OBJ.sendData(u),[3,25];case 17:return c=CommonTools.getDataJsonStr("openBagUI",1,{iType:0}),ConstValue.P_NET_OBJ.sendData(c),[3,25];case 18:return d=CommonTools.getDataJsonStr("showAllClassList",1,{}),ConstValue.P_NET_OBJ.sendData(d),[3,25];case 19:return this.closeSub(),[3,25];case 20:return this.showEditUI(i),[3,25];case 21:return this.clickShopPage(i),[3,25];case 22:return 1==this.shopUIType?(g=CommonTools.getDataJsonStr("Buy",1,{iNo:this.shopItemNo,iType:this.shopPageType,num:1}),ConstValue.P_NET_OBJ.sendData(g)):(m=CommonTools.getDataJsonStr("useItem",1,{iNo:this.shopItemNo,iType:this.shopPageType,iItemID:this.shopItemItemID}),ConstValue.P_NET_OBJ.sendData(m)),[3,25];case 23:if(p=this.panelSub.getChildByName("account_lb_txt"),""==p.text)return CommonTools.addCommonTips(this.context,ConstValue.P_MODIFY_NULL_FAIL),[2];if(ConstValue.P_IS_DEBUG)CommonTools.addCommonTips(this.context,ConstValue.P_SEND_MODIFY_SUCCESS),this.closeSub();else{if(this.sCurModifyValue=p.text,_="","btn_gm"==this.sCurModifyBtn&&(_=CommonTools.getDataJsonStr("gmFunc",1,{gmCmd:this.sCurModifyValue})),""==_)return ConstValue.P_IS_INNER&&CommonTools.addCommonTips(this.context,"btn_confirm_modify sData 为空"),[2];ConstValue.P_NET_OBJ.sendData(_)}return[3,25];case 24:return CommonTools.log("11111111 default"),[3,25];case 25:return[2]}})})},t.prototype.getConf=function(t,e,i){try{return ConstValue.P_CONFIG[t][e][i]}catch(o){return""}},t.prototype.onButtonClick=function(t){return __awaiter(this,void 0,void 0,function(){var t,e;return __generator(this,function(i){switch(i.label){case 0:return CommonTools.log("shareAppMessage-------1"),t=CommonTools.getDataJsonStr("gmFunc",1,{gmCmd:"test1v1"}),ConstValue.P_NET_OBJ.sendData(t),e=window.platform,[4,e.shareAppMessage(ConstValue.cacheUserInfo.id+"")];case 1:return i.sent(),CommonTools.log("shareAppMessage-------2"),[2]}})})},t.prototype.showNotice=function(t,e){this.maskBg=new eui.Image("bg_ppt_1_png"),this.maskBg.width=this.context.getStageWidth(),this.maskBg.height=this.context.getStageHeight(),this.context.addChild(this.maskBg),this.panelNotice=new eui.Panel,this.panelNotice.skinName=t,this.panelNotice.title="Title",this.panelNotice.horizontalCenter=0,this.panelNotice.verticalCenter=0,this.context.addChild(this.panelNotice),CommonTools.fixFix(this.context,this.panelNotice,1,0,0),CommonButtonHandle.beginTouch(this.panelNotice.getChildByName("btn_close"),this),this.panelNotice.getChildByName("btn_close").addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.handlePanel(this.panelNotice,e),CommonTools.niceTip(this.panelNotice,1,this)},t.prototype.showRoleInfoUI=function(){var t=this.roleClassData[this.roleSelectIdx];this.maskBg2=new eui.Image("mask_layer_png"),this.maskBg2.width=this.context.getStageWidth(),this.maskBg2.height=this.context.getStageHeight(),this.context.addChild(this.maskBg2),this.panelSub=new eui.Panel,this.panelSub.skinName="resource/eui_skins/UserUI/RoleInfoUI.exml",this.panelSub.title="Title",this.panelSub.horizontalCenter=0,this.panelSub.verticalCenter=0,this.context.addChild(this.panelSub),CommonTools.fixFix(this.context,this.panelSub,1,0,0);var e=this.panelSub.getChildByName("lb_life"),i=this.panelSub.getChildByName("lb_boom"),o=this.panelSub.getChildByName("lb_speed"),n=this.panelSub.getChildByName("lb_power"),s=this.panelSub.getChildByName("lb_lv"),a=this.panelSub.getChildByName("lb_exp");e.text=t.life,i.text=t.cnt,o.text=t.speed,n.text=t.power,s.text=ConstValue.cacheUserInfo.lv,a.text=ConstValue.cacheUserInfo.curexp,CommonButtonHandle.beginTouch(this.panelSub.getChildByName("btn_close"),this),this.panelSub.getChildByName("btn_close").addEventListener(egret.TouchEvent.TOUCH_TAP,function(t){CommonTools.niceTip(this.panelSub,2,this)},this),this.bodyAniDown2=CommonTools.getAnimDraw(RES.getRes("p"+t.iClass+"_special_json"),RES.getRes("p"+t.iClass+"_special_png"),"0"),this.bodyAniDown2.play(-1),this.panelSub.addChild(this.bodyAniDown2),this.bodyAniDown2.x=580,this.bodyAniDown2.y=370},t.prototype.showWxVsUI=function(t){this.maskBg2=new eui.Image("vs_bg_1v1_png"),this.maskBg2.width=this.context.getStageWidth(),this.maskBg2.height=this.context.getStageHeight(),this.context.addChild(this.maskBg2),this.showWxVsPanel=new eui.Panel,this.showWxVsPanel.skinName="resource/eui_skins/UserUI/WxVsWaitUI.exml",this.showWxVsPanel.title="Title",this.showWxVsPanel.horizontalCenter=0,this.showWxVsPanel.verticalCenter=0,this.context.addChild(this.showWxVsPanel),CommonTools.fixFix(this.context,this.showWxVsPanel,1,0,0),CommonButtonHandle.beginTouch(this.showWxVsPanel.getChildByName("btn_close_wx_vs"),this),this.showWxVsPanel.getChildByName("btn_close_wx_vs").addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),CommonButtonHandle.beginTouch(this.showWxVsPanel.getChildByName("btn_start"),this),this.showWxVsPanel.getChildByName("btn_start").addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.updateWxVsUI(t)},t.prototype.updateWxVsUI=function(t){var e=this.showWxVsPanel.getChildByName("left_online"),i=this.showWxVsPanel.getChildByName("left_name"),o=this.showWxVsPanel.getChildByName("left_ready"),n=this.showWxVsPanel.getChildByName("right_online"),s=this.showWxVsPanel.getChildByName("right_name"),a=this.showWxVsPanel.getChildByName("right_ready"),l=this.showWxVsPanel.getChildByName("btn_start"),r=[.3,.6,0,0,0,.3,.6,0,0,0,.3,.6,0,0,0,0,0,0,1,0],h=new egret.ColorMatrixFilter(r);if(1==t.lWaitInfo.length?(e.text=1==t.lWaitInfo[0].isOnline?"在线":"等待",i.text=t.lWaitInfo[0].name,o.text=1==t.lWaitInfo[0].isReady?"已准备":"等待",t.lWaitInfo[0].rid==ConstValue.cacheUserInfo.id&&(this.isMainRoomer=!0),l.filters=[h],l.enabled=!1):(e.text=1==t.lWaitInfo[0].isOnline?"在线":"等待",i.text=t.lWaitInfo[0].name,o.text=1==t.lWaitInfo[0].isReady?"已准备":"等待",n.text=1==t.lWaitInfo[1].isOnline?"在线":"等待",s.text=t.lWaitInfo[1].name,a.text=1==t.lWaitInfo[1].isReady?"已准备":"等待",this.isMainRoomer?1==t.lWaitInfo[1].isOnline&&1==t.lWaitInfo[1].isReady?(l.filters=[],l.enabled=!0):(l.filters=[h],l.enabled=!1):1==t.lWaitInfo[1].isReady?(l.filters=[h],l.enabled=!1,l.label="就  绪"):(l.filters=[],l.enabled=!0,l.label="准  备")),null!=t.MapInfo.roleId&&(this.showWxVsPanel.getChildByName("img_wx_wenhao").visible=!1,new MapMiniDIYModule(this.showWxVsPanel,t.MapInfo.bgconf,t.MapInfo.layerconf,3)),1==t.lWaitInfo.length){var u=this.showWxVsPanel.getChildByName("img_lefthead");""!=t.lWaitInfo[0].head&&(u.source=t.lWaitInfo[0].head)}if(2==t.lWaitInfo.length){var u=this.showWxVsPanel.getChildByName("img_lefthead");""!=t.lWaitInfo[0].head&&(u.source=t.lWaitInfo[0].head);var c=this.showWxVsPanel.getChildByName("img_righthead");""!=t.lWaitInfo[1].head&&(c.source=t.lWaitInfo[1].head)}},t.prototype.showEditUI=function(t){this.panelSub=new eui.Panel,this.panelSub.skinName="resource/eui_skins/UserUI/EditUI.exml",this.panelSub.title="Title",this.panelSub.horizontalCenter=0,this.panelSub.verticalCenter=0,this.context.addChild(this.panelSub),CommonButtonHandle.beginTouch(this.panelSub.getChildByName("btn_close_edit"),this),this.panelSub.getChildByName("btn_close_edit").addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),CommonButtonHandle.beginTouch(this.panelSub.getChildByName("btn_confirm_modify"),this),this.panelSub.getChildByName("btn_confirm_modify").addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.panelSub.getChildByName("lb_edit_title").text=ConstValue.P_MODIFY_TITLE,this.sCurModifyBtn=t,"modify_nichen_btn"==t?this.panelSub.getChildByName("lb_desc").text=ConstValue.P_MODIFY_NICHENG:"modify_pwd_btn"==t?(this.panelSub.getChildByName("lb_old_pwd").text=ConstValue.P_MODIFY_OLD_PWD,this.panelSub.getChildByName("lb_desc").text=ConstValue.P_MODIFY_NEW_PWD,this.panelSub.getChildByName("lb_new_pwd").text=ConstValue.P_MODIFY_NEW_PWD,this.panelSub.getChildByName("lb_old_pwd").visible=!0,this.panelSub.getChildByName("bg_old").visible=!0,this.panelSub.getChildByName("account_lb_old").visible=!0,this.panelSub.getChildByName("account_lb_old").displayAsPassword=!0,this.panelSub.getChildByName("account_lb_txt").displayAsPassword=!0,this.panelSub.getChildByName("lb_new_pwd").visible=!0,this.panelSub.getChildByName("bg_new").visible=!0,this.panelSub.getChildByName("account_lb_new").visible=!0,this.panelSub.getChildByName("account_lb_new").displayAsPassword=!0):"modify_realname_btn"==t?this.panelSub.getChildByName("lb_desc").text=ConstValue.P_MODIFY_REALNAME:"modify_wx_btn"==t?this.panelSub.getChildByName("lb_desc").text=ConstValue.P_MODIFY_WX:"modify_beget_btn"==t?this.panelSub.getChildByName("lb_desc").text=ConstValue.P_MODIFY_BEGET:"btn_gm"==t?(this.panelSub.getChildByName("lb_edit_title").text="gm",this.panelSub.getChildByName("lb_desc").text="输入命令："):"hall_question_btn"==t&&(this.panelSub.getChildByName("lb_edit_title").text="反馈",this.panelSub.getChildByName("lb_desc").text="问题描述：")},t.prototype.showChoiceUI=function(){if(null==this.choicePanel){this.choicePanel=new eui.Panel,this.choicePanel.skinName="resource/eui_skins/UserUI/OptionUI.exml",this.choicePanel.title="Title",this.context.addChild(this.choicePanel);var t=this.panel.getChildByName("btn_choice").x,e=this.panel.getChildByName("btn_choice").y;this.choicePanel.x=t-50,this.choicePanel.y=e+50}else this.context.removeChild(this.choicePanel),this.choicePanel=null},t.prototype.handleRank=function(t,e,i){for(var o in this.lRank){var n=this.lRank[o],s=parseInt(o);CommonTools.log("lRank-------i:"+o);var a=new eui.Panel;a.skinName="resource/eui_skins/UserUI/RankGroup.exml",a.name="p_"+o,a.y=72*s,t.addChild(a);var l=a.getChildByName("group_1"),r=l.getChildByName("rank");r.text=s+1+"";var h=l.getChildByName("name");h.text=n[1];var u=l.getChildByName("desc");1==i?u.text="胜场 ： "+n[3]+"   胜率："+n[4]+"%":u.text="等级 ： "+n[3]}var c=e.getChildByName("myrankG"),d=c.getChildByName("myrank");d.text=this.sMyRankDesc;var g=c.getChildByName("name");g.text=this.lMyRank[1];var m=c.getChildByName("desc");1==i?m.text="胜场 ： "+this.lMyRank[3]+"   胜率："+this.lMyRank[4]+"%":m.text="等级 ： "+this.lMyRank[3]},t.prototype.updateRoleClass=function(t){var e=this.panelNotice.getChildByName("lb_life"),i=this.panelNotice.getChildByName("lb_boom"),o=this.panelNotice.getChildByName("lb_speed"),n=this.panelNotice.getChildByName("lb_power"),s=this.panelNotice.getChildByName("lb_name"),a=this.panelNotice.getChildByName("img_buy_bg"),l=this.panelNotice.getChildByName("btn_gold"),r=this.panelNotice.getChildByName("lb_gold"),h=this.panelNotice.getChildByName("btn_fight"),u=this.panelNotice.getChildByName("btn_buy"),c=this.panelNotice.getChildByName("lb_attr"),d=this.panelNotice.getChildByName("select_role_bg");d.source=ConstValue.role_select_bg[t];var g=this.roleClassData[t];e.text=g.life,i.text=g.cnt,o.text=g.speed,n.text=g.power,c.text=g.desc,s.text=g.name,1==g.isOwn?(a.visible=!1,l.visible=!1,r.visible=!1,u.visible=!1,h.visible=!0,1==g.isUse?h.label="出战中":h.label="出 战"):(h.visible=!1,a.visible=!0,l.visible=!0,r.visible=!0,u.visible=!0,r.text=g.price),null!=this.bodyAniDown&&(this.panelNotice.removeChild(this.bodyAniDown),this.bodyAniDown=null),this.bodyAniDown=CommonTools.getAnimDraw(RES.getRes("p"+g.iClass+"_special_json"),RES.getRes("p"+g.iClass+"_special_png"),"0"),this.bodyAniDown.play(-1),this.panelNotice.addChild(this.bodyAniDown),this.bodyAniDown.x=610,this.bodyAniDown.y=240},t.prototype.handleRoleClass=function(t,e){var i=function(e){var i=o.roleClassData[e],n=parseInt(e),s=new eui.Panel;s.skinName="resource/eui_skins/UserUI/RoleSelectUIGroup.exml",s.name="p_"+e,s.y=125*n,t.addChild(s);var a=s.getChildByName("group_1"),l=a.getChildByName("role_name");l.text=i.name;var r=a.getChildByName("img_selected");n>0&&(r.visible=!1);var h=a.getChildByName("role_head");h.source=ConstValue.role_select_img[e],s.addEventListener(egret.TouchEvent.TOUCH_TAP,function(i){for(var o=t.numChildren,n=0;o>n;n++){var s=t.getChildByName("p_"+n),a=s.getChildByName("group_1"),l=a.getChildByName("img_selected");l.visible=!1}r.visible=!0,this.roleSelectIdx=e,this.updateRoleClass(e)},o)},o=this;for(var n in this.roleClassData)i(n);this.updateRoleClass("0");var s=this.panelNotice.getChildByName("btn_fight"),a=this.panelNotice.getChildByName("btn_buy"),l=this.panelNotice.getChildByName("lb_role_click");s.addEventListener(egret.TouchEvent.TOUCH_TAP,function(t){var e=this.roleClassData[this.roleSelectIdx],i=CommonTools.getDataJsonStr("useClass",1,{iClass:e.iClass});ConstValue.P_NET_OBJ.sendData(i)},this),a.addEventListener(egret.TouchEvent.TOUCH_TAP,function(t){var e=this.roleClassData[this.roleSelectIdx],i=CommonTools.getDataJsonStr("buyClass",1,{iClass:e.iClass});ConstValue.P_NET_OBJ.sendData(i)},this),l.addEventListener(egret.TouchEvent.TOUCH_TAP,function(t){this.showRoleInfoUI()},this)},t.prototype.handleSeventDay=function(){for(var t=1;7>=t;t++){0==this.seventCur&&0==this.seventData[t.toString()].bGet&&(this.seventCur=t),this.seventCur==t&&1==this.seventData[t.toString()].bGet&&(this.seventGetState=!0);var e=this.panelNotice.getChildByName("item_icon_"+t);e.source=this.getConf("ItemData",this.seventData[t.toString()].itemNo,"res")+"_png";var i=this.panelNotice.getChildByName("lb_name_"+t);i.text=this.getConf("ItemData",this.seventData[t.toString()].itemNo,"name");var o=this.panelNotice.getChildByName("item_state_"+t);0==this.seventData[t.toString()].bGet?o.source="sevent_get_png":o.source="sevent_got_png",this.panelNotice.getChildByName("item_lb_"+t).addEventListener(egret.TouchEvent.TOUCH_TAP,function(t){var e=t.target.name,i=parseInt(e.replace("item_lb_",""));if(i>this.seventCur)CommonTools.addCommonTips(this.context,"请领取第"+this.seventCur+"天奖励！");else if(this.seventGetState)CommonTools.addCommonTips(this.context,"已领取当天奖励");else{var o=CommonTools.getDataJsonStr("getSeventDayReward",1,{});ConstValue.P_NET_OBJ.sendData(o)}},this)}},t.prototype.handleGetMyMaps=function(){var t=this.panelNotice.getChildByName("fighting_parent").getChildByName("scroll").getChildByName("scroll_group"),e=0,i=function(i){var n=o.selectMapData[i],s=new eui.Panel;s.skinName="resource/eui_skins/UserUI/MapViewGroup.exml",s.name="p_"+e,s.x+=40,s.y+=50+10*e+255*e,t.addChild(s),s.getChildByName("view_fight_btn").visible=!1,s.getChildByName("view_change_btn").visible=!1;var a=s.getChildByName("group_1"),l=a.getChildByName("lb_title");l.text=n.mapName;var r=a.getChildByName("lb_author");r.text=ConstValue.cacheUserInfo.name;var h=a.getChildByName("lb_sign");h.text=n.mapSign;var u=s.getChildByName("view_add_btn");u.label="邀 请",u.addEventListener(egret.TouchEvent.TOUCH_TAP,function(t){this.selectKey=i;var e=CommonTools.getDataJsonStr("open1V1RoomByMap",1,{mapID:parseInt(this.selectKey)});ConstValue.P_NET_OBJ.sendData(e)},o),new MapMiniDIYModule(s,n.bgconf,n.layerconf,2),e++},o=this;for(var n in this.selectMapData)i(n)},t.prototype.handleSelectMap=function(){this.panelNotice.getChildByName("btn_random").addEventListener(egret.TouchEvent.TOUCH_TAP,function(t){this.panelNotice.getChildByName("img_left").visible=!0,this.panelNotice.getChildByName("img_right").visible=!1},this),this.panelNotice.getChildByName("btn_mymap").addEventListener(egret.TouchEvent.TOUCH_TAP,function(t){this.panelNotice.getChildByName("img_left").visible=!1,this.panelNotice.getChildByName("img_right").visible=!0},this),this.panelNotice.getChildByName("btn_certain_map").addEventListener(egret.TouchEvent.TOUCH_TAP,function(t){if(this.closeNotice(),this.panelNotice.getChildByName("img_left").visible){var e=CommonTools.getDataJsonStr("open1V1Room",1,{});ConstValue.P_NET_OBJ.sendData(e)}else{var i=CommonTools.getDataJsonStr("getMyMaps",1,{});ConstValue.P_NET_OBJ.sendData(i)}},this)},t.prototype.handleNoEnd=function(e,i){var o=25,n=128,s=1,a=i.getChildByName("lb_star_total"),l=i.getChildByName("lb_bg_total");a.text="获得"+this.barrData.nowstar+"/"+this.barrData.totalstar+"颗星";var r=this.barrData.nowstar/this.barrData.totalstar*1;l.width=l.width*r;var h=i.getChildByName("guanka_layer");h.text="第"+this.barrLayer+"层",i.getChildByName("btn_left").addEventListener(egret.TouchEvent.TOUCH_TAP,function(t){if(1==this.barrLayer)return void CommonTools.addCommonTips(this.context,"当前为首页关卡");this.barrLayer--;var e=CommonTools.getDataJsonStr("C2GOpenWujinUI",1,{diffLevel:this.barrLayer});ConstValue.P_NET_OBJ.sendData(e)},this),i.getChildByName("btn_right").addEventListener(egret.TouchEvent.TOUCH_TAP,function(t){if(this.barrLayer+1>this.barrData.totallayer)return void CommonTools.addCommonTips(this.context,"当前为尾页关卡");this.barrLayer++;var e=CommonTools.getDataJsonStr("C2GOpenWujinUI",1,{diffLevel:this.barrLayer});ConstValue.P_NET_OBJ.sendData(e)},this);var u=function(i){var a=c.barrData.barrierList[i],l=new eui.Panel;l.skinName="resource/eui_skins/UserUI/noEndBarrStartGroup.exml",l.name="p_"+s;var r=s%6==0?6:s%6,h=0;h=s%6==0?s/6:s/6+1,l.x=o+165*(r-1),l.y=n+120*Math.floor(h-1),e.addChild(l);var u=l.getChildByName("group_1"),d=u.getChildByName("num_lb");d.text=a.barrierNo+"";for(var g=1;g<=a.star&&!(g>3);g++){var m=u.getChildByName("star_0"+g);m.source="barr_pass_start_png"}l.addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){t.isNoEnd=!0;var i=CommonTools.getDataJsonStr("C2GGotoBarrier",1,{barrierNo:a.barrierNo});ConstValue.P_NET_OBJ.sendData(i)},c),s++},c=this;for(var d in this.barrData.barrierList)u(d)},t.prototype.updateShopUI=function(t){var e=this.panelNotice.getChildByName("res_scroller"),i=e.getChildByName("res_group");i.removeChildren();var o=0;if(1==this.shopUIType)o=this.dShopOrBagData.lShopInfo.length;else if(o=this.dShopOrBagData.lItmeInfo.length,""!=this.shopItemClickName){var n=parseInt(this.shopItemClickName.replace("shop_item_click",""));n>=o&&(t=!0,this.shopItemClickName="")}for(var s=0;o>s;s++){var a=new eui.Panel;a.skinName="resource/eui_skins/UserUI/ShopItemGroup.exml",a.name="p_"+s;var l=5;2==this.shopUIType&&(l=20),a.x=l+180*(s%3)+5*(s%3),a.y=20+230*Math.floor(s/3)+20*Math.floor(s/3),i.addChild(a);var r=a.getChildByName("group_1"),h=r.getChildByName("shop_item_bg"),u=r.getChildByName("shop_item_pay"),c=r.getChildByName("shop_item_icon"),d=r.getChildByName("shop_item_click");d.name="shop_item_click"+s,d.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this);var g=r.getChildByName("shop_item_name"),m=r.getChildByName("shop_item_money");if(1==this.shopUIType)c.source=this.getConf("ItemData",this.dShopOrBagData.lShopInfo[s].iNo.toString(),"res")+"_png",g.text=this.getConf("ItemData",this.dShopOrBagData.lShopInfo[s].iNo.toString(),"name"),m.text=this.dShopOrBagData.lShopInfo[s].NeedCoin,0==s&&(h.source="shop_item_yes_png",t&&this.clickShopItem(d.name));else{u.visible=!1,c.source=this.getConf("ItemData",this.dShopOrBagData.lItmeInfo[s].iNo.toString(),"res")+"_png",g.text=this.getConf("ItemData",this.dShopOrBagData.lItmeInfo[s].iNo.toString(),"name"),m.text="x "+this.dShopOrBagData.lItmeInfo[s].iNum;var p=r.getChildByName("shop_item_bg"),_=r.getChildByName("shop_item_name");_.y-=5,0==s?(p.source="bag_item_yes_png",t&&this.clickShopItem(d.name)):p.source="bag_item_not_png"}}},t.prototype.handlePanel=function(t,e){switch(e){case"btn_rank":var i=t.getChildByName("fighting_parent"),o=i.getChildByName("scroll"),n=o.getChildByName("scroll_group");n.removeChildren(),i.getChildByName("all_rank_lb").addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),CommonButtonHandle.beginTouch(i.getChildByName("all_rank_lb"),this),i.getChildByName("friend_rank_lb").addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),CommonButtonHandle.beginTouch(i.getChildByName("friend_rank_lb"),this),i.getChildByName("match_rank_lb").addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),CommonButtonHandle.beginTouch(i.getChildByName("match_rank_lb"),this),i.getChildByName("lv_rank_lb").addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),CommonButtonHandle.beginTouch(i.getChildByName("lv_rank_lb"),this),this.handleRank(n,i,1);break;case"all_rank_lb":var s=t.getChildByName("fighting_parent"),a=s.getChildByName("scroll"),l=a.getChildByName("scroll_group");l.removeChildren(),s.getChildByName("all_rank_bg").visible=!0,s.getChildByName("friend_rank_bg").visible=!1,this.handleRank(l,s,1);break;case"friend_rank_lb":var r=t.getChildByName("fighting_parent"),h=r.getChildByName("scroll"),u=h.getChildByName("scroll_group");u.removeChildren(),r.getChildByName("all_rank_bg").visible=!1,r.getChildByName("friend_rank_bg").visible=!0;break;case"match_rank_lb":case"getTotalPvpRank":var c=t.getChildByName("fighting_parent"),d=c.getChildByName("scroll"),g=d.getChildByName("scroll_group");g.removeChildren();var m=c.getChildByName("match_rank_bg");m.source=RES.getRes("rank_select_02_png");var p=c.getChildByName("lv_rank_bg");p.source=RES.getRes("rank_select_01_png"),this.handleRank(g,c,1);break;case"lv_rank_lb":case"getTotalLvRank":var _=t.getChildByName("fighting_parent"),C=_.getChildByName("scroll"),y=C.getChildByName("scroll_group");y.removeChildren();var f=_.getChildByName("match_rank_bg");f.source=RES.getRes("rank_select_01_png");var b=_.getChildByName("lv_rank_bg");b.source=RES.getRes("rank_select_02_png"),this.handleRank(y,_,2);break;case"btn_map_shop":case"btn_map_bag":this.panelNotice.getChildByName("btn_one_lb").addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.panelNotice.getChildByName("btn_two_lb").addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.panelNotice.getChildByName("btn_three_lb").addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.panelNotice.getChildByName("btn_four_lb").addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),CommonButtonHandle.beginTouch(this.panelNotice.getChildByName("btn_buy"),this),this.panelNotice.getChildByName("btn_buy").addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.updateShopUI(!0);break;case"btn_noend_pve":var v=t.getChildByName("fighting_parent");v.removeChildren(),this.handleNoEnd(v,t);break;case"SeventDayReward":this.handleSeventDay();break;case"getMyMaps":this.handleGetMyMaps();break;case"btn_friend_pvp":this.handleSelectMap();break;case"btn_img_info":var x=t.getChildByName("fighting_parent"),T=x.getChildByName("scroll"),I=T.getChildByName("scroll_group");I.removeChildren(),this.handleRoleClass(I,x);break;case"btn_noticetip":var P=t.getChildByName("group_clear");if(P.getChildByName("lb_clear_click").addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),CommonButtonHandle.beginTouch(P.getChildByName("lb_clear_click"),this),ConstValue.P_IS_DEBUG,0){var B=CommonTools.getDataJsonStr("getAllMail",1,{roleId:ConstValue.cacheUserInfo.id});ConstValue.P_NET_OBJ.sendData(B)}else{var N=10,w=this.panelNotice.getChildByName("left_scroller"),S=w.getChildByName("left_group"),D=this.panelNotice.getChildByName("lb_title");D.text="标题：";var E=this.panelNotice.getChildByName("lb_mail_info");E.text="";for(var O=0;N>O;O++){var k=new eui.Panel;k.skinName="resource/eui_skins/UserUI/NoticeGroup.exml",k.name="p_"+O,k.y=72*O,S.addChild(k);var M=k.getChildByName("group_1");M.getChildByName("img_yellow").visible=!1;var L=M.getChildByName("lb_title");L.text="喜报！！"+(O+1);var R=M.getChildByName("lb_notice_click");R.name="lb_notice_click"+O,R.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),CommonButtonHandle.beginTouch(R,this)}}break;default:CommonTools.log("22222222 default")}},t.prototype.handlePacket=function(t){return __awaiter(this,void 0,void 0,function(){var e,i,o;return __generator(this,function(n){switch(n.label){case 0:return"setName"!=t.f?[3,1]:(""!=t.m||1!=t.s?CommonTools.addCommonTips(this.context,ConstValue.P_MODIFY_FAIL):(CommonTools.addCommonTips(this.context,ConstValue.P_SEND_MODIFY_SUCCESS),this.panelNotice.getChildByName("nickName_lb").text=t.d.name,ConstValue.cacheUserInfo.name=t.d.name,this.closeSub()),[3,22]);case 1:return"gmFunc"!=t.f?[3,2]:(""!=t.m||1!=t.s?CommonTools.addCommonTips(this.context,"执行失败"):CommonTools.addCommonTips(this.context,"执行成功"),[3,22]);case 2:return"Room1v1Dismiss"!=t.f?[3,3]:(""!=t.m||1!=t.s||(CommonTools.addCommonTips(this.context,"房间解散"),Main.roomkey=null,null!=this.showWxVsPanel&&CommonTools.niceTip(this.showWxVsPanel,2,this)),[3,22]);case 3:return"WaitingInfo"!=t.f?[3,4]:(""!=t.m||1!=t.s?CommonTools.addCommonTips(this.context,ConstValue.P_ENTER_ROOM_FAIL):(null==ConstValue.P_FIGHT_OBJ&&(ConstValue.P_FIGHT_OBJ=new FightingModule(this.context)),t.d.state<2?ConstValue.P_FIGHT_OBJ.showVspanel():2==t.d.state&&(FightingModule.readyTwo=!0,this.context.dDataInfo2=t.d.player,null!=ConstValue.P_FIGHT_OBJ.playerData&&(FightingModule.readyRes=!0,ConstValue.P_FIGHT_OBJ.releaseVsPanel(),ConstValue.P_FIGHT_OBJ.updateInfo(t.d.player)))),[3,22]);case 4:return"syncMapData"!=t.f?[3,9]:""==t.m&&1==t.s?[3,5]:[3,8];case 5:return null!=ConstValue.cacheKeyGroup.fighting?[3,7]:(this.context.dDataInfo=t.d,[4,this.context.loadResource("fighting",6)]);case 6:return n.sent(),[3,8];case 7:null==ConstValue.P_FIGHT_OBJ&&(ConstValue.P_FIGHT_OBJ=new FightingModule(this.context)),ConstValue.P_FIGHT_OBJ.initMapData(t.d),FightingModule.readyTwo&&!FightingModule.readyRes&&(ConstValue.P_FIGHT_OBJ.releaseVsPanel(),ConstValue.P_FIGHT_OBJ.updateInfo(this.context.dDataInfo2)),n.label=8;case 8:return[3,22];case 9:return"openDiyMapUI"!=t.f?[3,10]:(""!=t.m||1!=t.s||null==ConstValue.P_MAP_OBJ&&(ConstValue.P_MAP_OBJ=new MapDIYModule(this.context,t.d,1)),[3,22]);case 10:return"showAllClassList"!=t.f&&"reflashClassList"!=t.f?[3,11]:(""!=t.m||1!=t.s||(this.roleClassData=t.d.allRoleList,null==this.panelNotice?this.showNotice("resource/eui_skins/UserUI/RoleSelectUI.exml","btn_img_info"):this.updateRoleClass(this.roleSelectIdx)),[3,22]);case 11:return"openShopUI"!=t.f?[3,12]:(""!=t.m||1!=t.s||(this.dShopOrBagData=t.d,this.shopUIType=1,null==this.panelNotice?this.showNotice("resource/eui_skins/UserUI/PayShopUI.exml","btn_map_shop"):(this.updateShopUI(!1),e=this.dShopOrBagData.lShopInfo.length,e>0&&this.clickShopItem(this.shopItemClickName))),[3,22]);case 12:return"openBagUI"!=t.f?[3,13]:(""!=t.m||1!=t.s||(this.dShopOrBagData=t.d,this.shopUIType=2,null==this.panelNotice?this.showNotice("resource/eui_skins/UserUI/BagUI.exml","btn_map_bag"):(this.updateShopUI(!1),this.clickShopItem(this.shopItemClickName))),[3,22]);case 13:return"Buy"!=t.f?[3,14]:(""!=t.m||1!=t.s||0==t.d.err,[3,22]);case 14:return"getMyMaps"!=t.f?[3,15]:(""!=t.m||1!=t.s||FightingModule.Delay(500,function(){this.selectMapData=t.d,this.showNotice("resource/eui_skins/UserUI/MapViewUI.exml","getMyMaps")},this),[3,22]);case 15:return"C2GOpenWujinUI"!=t.f?[3,16]:(""!=t.m||1!=t.s||(this.barrData=t.d,null!=this.panelNotice?(i=this.panelNotice.getChildByName("fighting_parent"),i.removeChildren(),this.handleNoEnd(i,this.panelNotice)):this.showNotice("resource/eui_skins/UserUI/noEndBarrUI.exml","btn_noend_pve")),[3,22]);case 16:return"SeventDayReward"!=t.f?[3,17]:(""!=t.m||1!=t.s||(this.seventData=t.d,null==this.panelNotice?this.showNotice("resource/eui_skins/UserUI/SeventDayGet.exml",t.f):this.handleSeventDay()),[3,22]);case 17:return"open1V1Room"!=t.f&&"open1V1RoomByMap"!=t.f?[3,21]:""==t.m&&1==t.s?[3,18]:[3,20];case 18:return CommonTools.log("shareAppMessage-------1"),Main.roomkey=t.d.roomkey,o=window.platform,[4,o.shareAppMessage(t.d.roomkey)];case 19:n.sent(),n.label=20;case 20:return[3,22];case 21:"showMatch1v1RoomUI"==t.f?""!=t.m||1!=t.s||(null!=t.d.roomID&&(Main.roomkey=t.d.roomID),null==this.showWxVsPanel?this.showWxVsUI(t.d):this.updateWxVsUI(t.d)):("openRnakUI"==t.f||"getTotalPvpRank"==t.f||"getTotalLvRank"==t.f)&&(""!=t.m||1!=t.s||(this.lRank=t.d.lRank,this.lMyRank=t.d.myRank,this.sMyRankDesc=t.d.myRankDesc,"openRnakUI"==t.f?this.showNotice("resource/eui_skins/UserUI/NewRankUI.exml","btn_rank"):this.handlePanel(this.panelNotice,t.f),CommonTools.log("this.lRank-------------"+this.lRank))),n.label=22;case 22:return[2]}})})},t.prototype.closeNotice=function(){CommonTools.niceTip(this.panelNotice,2,this)},t.prototype.closeWxVsUI=function(){if(this.isMainRoomer){var t=CommonTools.getDataJsonStr("remove1V1Room",1,{});ConstValue.P_NET_OBJ.sendData(t),this.isMainRoomer=!1}else{var t=CommonTools.getDataJsonStr("leaveGame1v1",1,{fightRoomKey:Main.roomkey});ConstValue.P_NET_OBJ.sendData(t)}CommonTools.niceTip(this.showWxVsPanel,2,this)},t.prototype.closeNice=function(){null!=this.showWxVsPanel&&null==this.panelNotice?(null!=this.maskBg2&&this.context.removeChild(this.maskBg2),this.maskBg2=null,this.context.removeChild(this.showWxVsPanel),this.showWxVsPanel=null):null!=this.panelSub&&null!=this.panelNotice?(null!=this.bodyAniDown2&&(this.panelSub.removeChild(this.bodyAniDown2),this.bodyAniDown2=null),null!=this.maskBg2&&this.context.removeChild(this.maskBg2),this.maskBg2=null,this.context.removeChild(this.panelSub),this.panelSub=null):(null!=this.bodyAniDown&&(this.panelNotice.removeChild(this.bodyAniDown),this.bodyAniDown=null),null!=this.panelNotice&&this.context.removeChild(this.panelNotice),null!=this.maskBg&&this.context.removeChild(this.maskBg),this.maskBg=null,this.panelNotice=null,this.dShopOrBagData=null,this.shopPageType=0,this.shopItemNo=0,this.shopItemItemID=0,this.shopItemName="",this.shopItemClickName="")
},t.prototype.closeSub=function(){null!=this.panelSub&&this.context.removeChild(this.panelSub),this.panelSub=null},t.prototype.clear=function(){this.closeSub(),this.context.removeChild(this.panel),ConstValue.P_HALL_OBJ=null},t.isNoEnd=!1,t.isTrainBrr=!1,t.pushBtnData=null,t}();__reflect(HallModule.prototype,"HallModule");var LoginModule=function(){function t(t){this.context=t,this.init()}return t.prototype.init=function(){return __awaiter(this,void 0,void 0,function(){var t,e,i,o;return __generator(this,function(n){switch(n.label){case 0:return this.objChild=this.context.addBackGround("login_bg_ppt_png"),this.context.addChild(this.objChild),this.panel=new eui.Panel,this.panel.skinName="resource/eui_skins/UserUI/LoginUI.exml",this.panel.title="Title",this.panel.horizontalCenter=0,this.panel.verticalCenter=0,this.context.addChild(this.panel),this.panel.getChildByName("btn_login").addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.panel.getChildByName("btn_registe").addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.panel.getChildByName("account_lb_txt").addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.panel.getChildByName("password_lb_txt").addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),CommonTools.fixFix(this.context,this.panel.getChildByName("btn_login"),2,-60,10),CommonTools.fixFix(this.context,this.panel.getChildByName("btn_registe"),2,-60,10),CommonTools.fixFix(this.context,this.panel.getChildByName("account_lb_txt"),2,0,20),CommonTools.fixFix(this.context,this.panel.getChildByName("password_lb_txt"),2,0,10),CommonTools.fixFix(this.context,this.panel.getChildByName("account_lb_title"),2,0,20),CommonTools.fixFix(this.context,this.panel.getChildByName("password_lb_title"),2,0,10),2!=ConstValue.p_LOGIN_MODEL?[3,3]:[4,platform.login()];case 1:return t=n.sent(),e=JSON.parse(t),[4,platform.getUserInfo()];case 2:i=n.sent(),CommonTools.printObject(i),o=CommonTools.getDataJsonStr("loginWX",1,{openID:e.openid,sHead:i.avatarUrl,sName:i.nickName,iGender:i.gender}),null==ConstValue.P_NET_OBJ?ConstValue.P_NET_OBJ=new WebSocketUtil(o):ConstValue.P_NET_OBJ.sendData(o),n.label=3;case 3:return[2]}})})},t.prototype.onClick=function(t){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(i){if(null!=this.context.loadingView&&!ConstValue.P_IS_DEBUG)return CommonTools.log("还在加载中......return "),[2];switch(this.bClick||(this.bClick=!0),e=t.target.name){case"btn_notice":this.showNotice("resource/eui_skins/UserUI/ShengminUI.exml",e);break;case"btn_close":this.closeNotice();break;case"btn_forgetpas":this.showNotice("resource/eui_skins/UserUI/GetPassword.exml",e);break;case"btn_registe":this.showNotice("resource/eui_skins/UserUI/RegisteUI.exml",e);break;case"btn_login":this.btnClickLogin();break;case"btn_nologinman":break;case"btn_verify_forget":CommonTools.addCommonTips(this.context,ConstValue.P_SEND_VERIFY);break;case"btn_confirm_forget":this.btnClickConfirmForget();break;case"btn_verify_registe":CommonTools.addCommonTips(this.context,ConstValue.P_SEND_VERIFY);break;case"btn_confirm_registe":this.btnClickConfirmRegiste();break;default:CommonTools.log("11111111 default")}return[2]})})},t.prototype.btnClickLogin=function(){return __awaiter(this,void 0,void 0,function(){var t,e,i;return __generator(this,function(o){switch(o.label){case 0:return t=this.panel.getChildByName("account_lb_txt"),""==t.text?(CommonTools.addCommonTips(this.context,ConstValue.P_NULL_ACCOUNT),[2]):(e=this.panel.getChildByName("password_lb_txt"),""==e.text?(CommonTools.addCommonTips(this.context,ConstValue.P_NULL_PASSWORD),[2]):ConstValue.P_IS_DEBUG?(this.clear(),[4,this.context.loadResource("preloadHall",2)]):[3,2]);case 1:return o.sent(),[3,3];case 2:i=CommonTools.getDataJsonStr("login",1,{account:t.text,password:e.text}),null==ConstValue.P_NET_OBJ?ConstValue.P_NET_OBJ=new WebSocketUtil(i):ConstValue.P_NET_OBJ.sendData(i),ConstValue.cacheUserAccount=t.text,ConstValue.cacheUserPwd=e.text,o.label=3;case 3:return[2]}})})},t.prototype.clear=function(){this.context.removeChild(this.objChild),this.context.removeChild(this.panel),ConstValue.P_LOGIN_OBJ=null},t.prototype.btnClickConfirmForget=function(){var t=this.panelNotice.getChildByName("password_lb_txt");if(""==t.text)return void CommonTools.addCommonTips(this.context,ConstValue.P_NULL_PASSWORD);var e=this.panelNotice.getChildByName("verify_lb_txt");return""==e.text?void CommonTools.addCommonTips(this.context,ConstValue.P_NULL_VERIFY):(CommonTools.addCommonTips(this.context,ConstValue.P_SEND_MODIFY_SUCCESS),void this.closeNotice())},t.prototype.btnClickConfirmRegiste=function(){var t=this.panelNotice.getChildByName("invite_lb_txt");if(""==t.text)return void CommonTools.addCommonTips(this.context,ConstValue.P_NULL_INVITE);var e=this.panelNotice.getChildByName("account_lb_txt");if(""==e.text)return void CommonTools.addCommonTips(this.context,ConstValue.P_NULL_ACCOUNT);var i=this.panelNotice.getChildByName("password_lb_txt");if(""==i.text)return void CommonTools.addCommonTips(this.context,ConstValue.P_NULL_PASSWORD);var o=this.panelNotice.getChildByName("verify_lb_txt");if(""==o.text)return void CommonTools.addCommonTips(this.context,ConstValue.P_NULL_VERIFY);if(ConstValue.P_IS_DEBUG)CommonTools.addCommonTips(this.context,ConstValue.P_SEND_REGISTE_SUCCESS),this.closeNotice();else{var n=CommonTools.getDataJsonStr("register",1,{account:e.text,password:i.text,pcode:t.text});null==ConstValue.P_NET_OBJ?ConstValue.P_NET_OBJ=new WebSocketUtil(n):ConstValue.P_NET_OBJ.sendData(n)}},t.prototype.showNotice=function(t,e){this.panelNotice=new eui.Panel,this.panelNotice.skinName=t,this.panelNotice.title="Title",this.panelNotice.horizontalCenter=0,this.panelNotice.verticalCenter=0,this.context.addChild(this.panelNotice),this.panelNotice.getChildByName("btn_close").addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.handlePanel(this.panelNotice,e)},t.prototype.handlePacket=function(t){return __awaiter(this,void 0,void 0,function(){var e,i,o;return __generator(this,function(n){switch(n.label){case 0:return"register"!=t.f?[3,1]:""!=t.m||1!=t.s?(CommonTools.addCommonTips(this.context,ConstValue.P_SEND_REGISTE_FAIL),[2]):(CommonTools.addCommonTips(this.context,ConstValue.P_SEND_REGISTE_SUCCESS),this.closeNotice(),[3,5]);case 1:return"login"!=t.f&&"loginWX"!=t.f?[3,2]:(CommonTools.log("11111111 -----------------------------22"),""!=t.m||1!=t.s?(CommonTools.addCommonTips(this.context,ConstValue.P_SEND_LOGIN_FAIL),CommonTools.log("11111111 --------------------------------piercj default 1"),[2]):(ConstValue.cacheHasLoginSuccess||(CommonTools.log("11111111 --------------------------------piercj default 1"),e=CommonTools.getDataJsonStr("entergame",1,{}),ConstValue.P_NET_OBJ.sendData(e),ConstValue.cacheHasLoginSuccess=!0),[3,5]));case 2:return"entergame"!=t.f?[3,5]:""==t.m&&1==t.s?[3,3]:(CommonTools.addCommonTips(this.context,ConstValue.P_SEND_HALLBACK_FAIL),[2]);case 3:for(ConstValue.cacheUserInfo=t.d,i=1;i<this.panel.numChildren;i++)o=this.panel.getChildAt(i),o.visible=!1;return[4,this.context.loadResource("preloadHall",2)];case 4:n.sent(),this.clear(),n.label=5;case 5:return[2]}})})},t.prototype.handlePanel=function(t,e){switch(e){case"btn_forgetpas":t.getChildByName("btn_verify_forget").addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),t.getChildByName("btn_confirm_forget").addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this);break;case"btn_registe":t.getChildByName("btn_verify_registe").addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),t.getChildByName("btn_confirm_registe").addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this);break;default:CommonTools.log("22222222 default")}},t.prototype.closeNotice=function(){null!=this.panelNotice&&this.context.removeChild(this.panelNotice),this.panelNotice=null},t}();__reflect(LoginModule.prototype,"LoginModule");var MapDIYModule=function(){function t(e,i,o){this.initRow=9,this.initColumn=11,this.firstItemX=494.88,this.firstItemY=100.84,this.groundItemW=58,this.groundItemH=55,this.groundOffX=0,this.groundOffY=0,this.curFunc=1,this.curtype=1,this.curRes="",this.isShow=!1,this.posScrollerClose=0,this.resTitle=1,this.selectList={},this.txtMapName="输入地图名字",this.txtMapSign="输入地图个性签名",this.mapKey=0,this.testGround2=[1,1,1,1,1,1,2,2,1,1,1,1,1,1,1,1,1,2,1,2,1,1,1,1,1,3,1,1,2,2,1,1,1,3,2,2,1,1,1,2,2,3,1,1,1,1,3,1,1,1,2,2,1,1,1,1,2,1,1,1,1,2,3,2,1,1,1,1,1,1,1,1,2,3,2,1,1,1,1,1,1,1,1,2,3,2,1,1,1,1,1,1,1,1,2,3,2,1,1],this.testMap2=[0,0,0,0,0,0,0,0,5,6,0,0,5,0,0,0,0,0,6,5,6,0,0,0,0,0,0,0,0,6,5,6,0,0,0,0,0,0,5,0,6,5,6,0,0,0,13,0,0,0,0,6,5,6,0,0,9,6,0,0,0,0,0,0,0,0,0,9,6,0,0,0,0,6,5,6,0,0,9,6,0,0,0,0,6,5,6,0,0,12,11,0,0,0,0,6,5,6,0],this.iType=o,this.context=e,this.maskBg=new eui.Image("bg_ppt_1_png"),this.maskBg.width=this.context.getStageWidth(),this.maskBg.height=this.context.getStageHeight(),this.context.addChild(this.maskBg),this.panel=new eui.Panel,this.panel.skinName="resource/eui_skins/UserUI/mapDIYUI.exml",this.panel.title="Title",this.panel.horizontalCenter=0,this.panel.verticalCenter=0,this.context.addChild(this.panel),1==o?(this.testGround=i.DefaultBg,t.defaultData=i.DefaultBg):2==o?this.testGround=t.defaultData:(this.testGround=i.bgconf,this.testMap=i.layerconf),CommonTools.fixFix(this.context,this.panel,1,0,0);var n=new eui.Image("btn_back_png");n.width=60,n.height=60,n.x=44,n.y=10,n.name="goback_btn",this.context.addChild(n),n.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.matrix=[[0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0]],this.grid=new PF.Grid(11,9,this.matrix),this.op=new PF.Option,this.op.allowDiagonal=!1,this.finder=new PF.AStarFinder(this.op),this.initScene()}return t.prototype.initConfig=function(){var t=this;LZMA.decompress(EBitUtil.getArr(new egret.ByteArray(RES.getRes("config_json"))),function(e){ConstValue.P_CONFIG=JSON.parse(e),t.initScene()},function(t){})},t.prototype.initMapData=function(t){},t.prototype.initScene=function(){this.panel.getChildByName("btn_ground_lb").addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.panel.getChildByName("btn_block_lb").addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.panel.getChildByName("btn_decorate_lb").addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.panel.getChildByName("STYLE_BTN").addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.panel.getChildByName("lb_1p").addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.panel.getChildByName("lb_2p").addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.panel.getChildByName("lb_eraser").addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.panel.getChildByName("lb_save").addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.panel.getChildByName("btn_rank").addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.panel.getChildByName("btn_mymap").addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.btn=this.panel.getChildByName("STYLE_BTN"),this.btnGround=this.panel.getChildByName("btn_ground"),this.btnBlock=this.panel.getChildByName("btn_block"),this.btnDecorate=this.panel.getChildByName("btn_decorate"),this.tDi=this.panel.getChildByName("t_di"),this.tBiao=this.panel.getChildByName("t_biao"),this.tZhang=this.panel.getChildByName("t_zhang"),this.tAi=this.panel.getChildByName("t_ai"),this.tZhuang=this.panel.getChildByName("t_zhuang"),this.tShi=this.panel.getChildByName("t_shi");var e=this.panel.getChildByName("coin_num_lb");e.text=ConstValue.cacheUserInfo.coin;var i=this.panel.getChildByName("zuan_num_lb");i.text=ConstValue.cacheUserInfo.diamond,t.ONE_P="",t.TWO_P="";for(var o=0,n=0;n<this.initRow;n++)for(var s=function(e){var i=a.groundItemW,s=a.groundItemH,l=a.groundOffX,r=a.groundOffY;n>0&&(r=7),e>0&&(l=4);var h=a.firstItemX+i*e+l*e,u=a.firstItemY+s*n+r*n,c={img:"res_"+a.testGround[o]+"_png",x:h,y:u,name:"ground_"+o,curIdx:o},d=new Fight.MapItem(c);if(d.setRow(n),d.setColumn(e),d.setType(ConstValue.P_CONFIG.MapBase[a.testGround[o].toString()].Type),a.panel.addChild(d),d.scaleX=.7,d.scaleY=.7,t.groundLayerSubObj[o.toString()]=d,d.itemRange[0]=497+55*e+6*e,d.itemRange[1]=d.itemRange[0]+55,d.itemRange[2]=103+55*n+7*n,d.itemRange[3]=d.itemRange[2]+55,d.setRes(a.testGround[o]),d.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){return""==this.curRes&&1==this.curFunc?void CommonTools.addCommonTips(this.context,"请选择左侧资源"):void d.checkRange2(this.curRes,this.curtype,this.curFunc)},a),d.addEventListener(egret.TouchEvent.TOUCH_MOVE,function(){return""==this.curRes&&1==this.curFunc?void CommonTools.addCommonTips(this.context,"请选择左侧资源"):void d.checkRange2(this.curRes,this.curtype,this.curFunc)},a),3==a.iType)if(a.testMap[o]>0&&a.testMap[o]<100){var g="res_"+a.testMap[o]+"_png",m=ConstValue.P_CONFIG.MapBase[a.testMap[o].toString()];d.checkRange2(g,m.Type,1)}else a.testMap[o]>100&&(119==a.testMap[o]?d.checkRange2(null,2,3):d.checkRange2(null,2,4));o++},a=this,l=0;l<this.initColumn;l++)s(l);this.drawDownList(),this.resGroup=this.panel.getChildByName("res_scroller").getChildByName("res_group"),this.initResList(1,1),3==this.iType&&this.clickBolck()},t.prototype.initResList=function(t,e){this.resGroup.removeChildren(),this.selectList={};var i=0,o=function(o){var s=ConstValue.P_CONFIG.MapBase[o];if(s.mapType==t&&s.Type==e){var a=new eui.Image(s.res+"_png"),l=new eui.Image("diy_item_bg_png");n.resGroup.addChild(l),n.resGroup.addChild(a);var r=100,h=30,u=10,c=0;if(1==e?(r=82,h=0,u=0):2==e&&(h=28,u=0,3>i&&(c=5)),a.x=i%3*82+10+i%3*10,a.y=parseInt(i/3+"")*r+10+10*parseInt(i/3+"")-h-parseInt(i/3+"")*u+c,1==e?(l.x=a.x-2.25,l.y=a.y-2.5):(l.x=a.x-2,l.y=a.y+24,l.scaleY=1.15),0==i){n.curFunc=1,n.curRes=s.res+"_png";for(var d in n.selectList){var g=n.selectList[d];g.source="diy_item_bg_png"}l.source="diy_select_kuan_png"}i++,n.selectList[i.toString()]=l,a.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.curFunc=1,this.curRes=s.res+"_png";for(var t in this.selectList){var e=this.selectList[t];e.source="diy_item_bg_png"}l.source="diy_select_kuan_png"},n)}},n=this;for(var s in ConstValue.P_CONFIG.MapBase)o(s)},t.prototype.viewMapSubLayer=function(e){for(var i in t.groundLayerSubObj){var o=t.groundLayerSubObj[i];o.viewSub(e)}},t.prototype.clickGround=function(){this.initResList(this.resTitle,1),this.viewMapSubLayer(!1),this.curFunc=1,this.curtype=1,this.btnGround.source="diy_page_yes_png",this.btnBlock.source="diy_page_not_png",this.btnDecorate.source="diy_page_not_png",this.tDi.textColor=16242333,this.tBiao.textColor=16242333,this.tZhang.textColor=14005920,this.tAi.textColor=14005920,this.tZhuang.textColor=14005920,this.tShi.textColor=14005920},t.prototype.closeNice=function(){null!=this.panelSave&&this.context.removeChild(this.panelSave),this.panelSave=null,null!=this.panelRank&&this.context.removeChild(this.panelRank),this.panelRank=null,null!=this.maskBg2&&this.context.removeChild(this.maskBg2)},t.prototype.clickBolck=function(){this.initResList(this.resTitle,2),this.viewMapSubLayer(!0),this.curFunc=1,this.curtype=2,this.btnGround.source="diy_page_not_png",this.btnBlock.source="diy_page_yes_png",this.btnDecorate.source="diy_page_not_png",this.tDi.textColor=14005920,this.tBiao.textColor=14005920,this.tZhang.textColor=16242333,this.tAi.textColor=16242333,this.tZhuang.textColor=14005920,this.tShi.textColor=14005920},t.prototype.onClick=function(t){return __awaiter(this,void 0,void 0,function(){var e,i,o,n,s,a,l,r,h;return __generator(this,function(u){switch(e=t.target.name,CommonTools.log("==========name::::"+e),e){case"STYLE_BTN":this.changeListType();break;case"btn_rank":i=CommonTools.getDataJsonStr("getNewRank",1,{}),ConstValue.P_NET_OBJ.sendData(i);break;case"btn_mymap":o=CommonTools.getDataJsonStr("getMyMaps",1,{}),ConstValue.P_NET_OBJ.sendData(o);break;case"btn_close":CommonTools.niceTip(this.panelRank,2,this);break;case"btn_ground_lb":this.clickGround();break;case"btn_block_lb":this.clickBolck();break;case"btn_decorate_lb":this.initResList(this.resTitle,3),this.viewMapSubLayer(!0),this.curFunc=1,this.curtype=3,this.btnGround.source="diy_page_not_png",this.btnBlock.source="diy_page_not_png",this.btnDecorate.source="diy_page_yes_png",this.tDi.textColor=14005920,this.tBiao.textColor=14005920,this.tZhang.textColor=14005920,this.tAi.textColor=14005920,this.tZhuang.textColor=16242333,this.tShi.textColor=16242333;break;case"goback_btn":this.clear();break;case"lb_1p":if(1==this.curtype)return CommonTools.addCommonTips(this.context,"当前在地表层，请选择障碍层或者装饰层"),[2];this.curFunc=3;break;case"lb_2p":if(1==this.curtype)return CommonTools.addCommonTips(this.context,"当前在地表层，请选择障碍层或者装饰层"),[2];this.curFunc=4;break;case"lb_eraser":this.curFunc=2;break;case"btn_close_edit":CommonTools.niceTip(this.panelSave,2,this);break;case"btn_confirm_modify":this.saveMap();break;case"lb_save":if(!this.checkGroundValidate())return CommonTools.addCommonTips(this.context,"地表层不能有空块"),[2];if(!this.checkPlayers())return CommonTools.addCommonTips(this.context,"需要完整p1和p2,请设置位置"),[2];if(!this.checkPathValidate())return CommonTools.addCommonTips(this.context,"玩家间不联通，请合理设计"),[2];this.openSaveUI();break;case"lb_new":n=this.panelRank.getChildByName("match_rank_bg"),s=this.panelRank.getChildByName("lv_rank_bg"),n.source="map_rank_normal_png",s.source="map_rank_select_png",a=CommonTools.getDataJsonStr("getNewRank",1,{}),ConstValue.P_NET_OBJ.sendData(a);break;case"lb_hot":l=this.panelRank.getChildByName("match_rank_bg"),r=this.panelRank.getChildByName("lv_rank_bg"),l.source="map_rank_select_png",r.source="map_rank_normal_png",h=CommonTools.getDataJsonStr("getHopRank",1,{}),ConstValue.P_NET_OBJ.sendData(h);break;default:CommonTools.log("11111111 default")}return[2]})})},t.prototype.changeListType=function(){this.isShow?(this.isShow=!1,this.scroller.visible=!1):(this.isShow=!0,this.scroller.visible=!0)},t.prototype.drawDownList=function(){var t=["基础主题","吃货主题","暗黑主题"];this.list=new eui.List,this.list.width=170,this.list.dataProvider=new eui.ArrayCollection(t),this.list.selectedIndex=0,this.list.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onChange,this);var e=new eui.Scroller;e.height=200,e.viewport=this.list,e.x=this.btn.x,e.y=this.btn.y+this.btn.height,e.visible=!1,this.panel.addChild(e),this.scroller=e},t.prototype.onChange=function(t){this.resTitle=this.list.selectedIndex+1,this.initResList(this.resTitle,1),this.viewMapSubLayer(!1),this.curtype=1,this.changeListType(),this.clickGround()},t.prototype.clear=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return this.context.removeChild(this.panel),t.groundLayerSubObj={},[4,this.context.loadResource("preloadHall",2)];case 1:return e.sent(),ConstValue.P_MAP_OBJ=null,[2]}})})},t.prototype.updateByClickAdd=function(){this.context.removeChild(this.panel),t.groundLayerSubObj={},ConstValue.P_MAP_OBJ=null,ConstValue.P_MAP_OBJ=new t(this.context,null,2)},t.prototype.updateByClickModify=function(e){this.context.removeChild(this.panel),t.groundLayerSubObj={},ConstValue.P_MAP_OBJ=null,ConstValue.P_MAP_OBJ=new t(this.context,e,3),ConstValue.P_MAP_OBJ.mapKey=e.id},t.prototype.checkGroundValidate=function(){for(var e in t.groundLayerSubObj){var i=t.groundLayerSubObj[e];if(i.groundEmpty)return!1}return!0},t.prototype.checkPlayers=function(){var e=!1,i=!1;for(var o in t.groundLayerSubObj){var n=t.groundLayerSubObj[o];119==n.isPlayer?e=!0:120==n.isPlayer&&(i=!0)}return e&&i?!0:!1},t.prototype.getPath=function(t,e,i,o){var n=this.grid.clone();return this.finder.findPath(t,e,i,o,n)},t.prototype.checkPathValidate=function(){var e=-1,i=-1,o=-1,n=-1,s=!1;for(var a in t.groundLayerSubObj){var l=t.groundLayerSubObj[a];2==l.subType&&0==l.isPlayer&&this.grid.setWalkableAt(l.getColumn(),l.getRow(),!1),119==l.isPlayer?(e=l.getColumn(),i=l.getRow()):120==l.isPlayer&&(o=l.getColumn(),n=l.getRow())}var r=this.getPath(e,i,o,n);r.length>0&&(s=!0);for(var a in t.groundLayerSubObj){var l=t.groundLayerSubObj[a];2==l.subType&&0==l.isPlayer&&this.grid.setWalkableAt(l.getColumn(),l.getRow(),!0)}return s},t.prototype.saveMap=function(){var e=this.panelSave.getChildByName("map_name_tx");if(""==e.text)return void CommonTools.addCommonTips(this.context,"名字不能为空");if(e.text.length>10)return void CommonTools.addCommonTips(this.context,"名字在10个长度内");var i=this.panelSave.getChildByName("map_sign_tx");if(""==i.text)return void CommonTools.addCommonTips(this.context,"签名不能为空");if(i.text.length>50)return void CommonTools.addCommonTips(this.context,"名字在50个长度内");this.txtMapName=e.text,this.txtMapSign=i.text;for(var o in this.testMap2)this.testMap2[o]=0;for(var o in t.groundLayerSubObj){var n=t.groundLayerSubObj[o];this.testGround2[parseInt(o)]=n.res,n.subType>0&&(this.testMap2[parseInt(o)]=n.resSub)}var s=CommonTools.getDataJsonStr("saveMap",1,{lBgConf:this.testGround2,lLayerConf:this.testMap2,mapName:e.text,mapSign:i.text,mapkey:this.mapKey});ConstValue.P_NET_OBJ.sendData(s)},t.prototype.openSaveUI=function(){this.maskBg2=new eui.Image("mask_layer_png"),this.maskBg2.width=this.context.getStageWidth(),this.maskBg2.height=this.context.getStageHeight(),this.context.addChild(this.maskBg2),this.panelSave=new eui.Panel,this.panelSave.skinName="resource/eui_skins/UserUI/SaveMapTipUI.exml",this.panelSave.title="Title",this.panelSave.horizontalCenter=0,this.panelSave.verticalCenter=0,this.context.addChild(this.panelSave),CommonTools.niceTip(this.panelSave,1,this);var t=this.panelSave.getChildByName("map_name_tx");t.text=this.txtMapName;var e=this.panelSave.getChildByName("map_sign_tx");e.text=this.txtMapSign,CommonButtonHandle.beginTouch(this.panelSave.getChildByName("btn_close_edit"),this),this.panelSave.getChildByName("btn_close_edit").addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),CommonButtonHandle.beginTouch(this.panelSave.getChildByName("btn_confirm_modify"),this),this.panelSave.getChildByName("btn_confirm_modify").addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this)},t.prototype.openRankUI=function(t){this.maskBg2=new eui.Image("mask_layer_png"),this.maskBg2.width=this.context.getStageWidth(),this.maskBg2.height=this.context.getStageHeight(),this.context.addChild(this.maskBg2),this.panelRank=new eui.Panel,this.panelRank.skinName="resource/eui_skins/UserUI/MapRankUI.exml",this.panelRank.title="Title",this.panelRank.horizontalCenter=0,this.panelRank.verticalCenter=0,this.context.addChild(this.panelRank),CommonTools.fixFix(this.context,this.panelRank,1,0,0),CommonTools.niceTip(this.panelRank,1,this),this.updateRankUI(t,1),CommonButtonHandle.beginTouch(this.panelRank.getChildByName("btn_close"),this),this.panelRank.getChildByName("btn_close").addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.panelRank.getChildByName("lb_new").addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.panelRank.getChildByName("lb_hot").addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this)},t.prototype.openViewUI=function(t){this.maskBg2=new eui.Image("mask_layer_png"),this.maskBg2.width=this.context.getStageWidth(),this.maskBg2.height=this.context.getStageHeight(),this.context.addChild(this.maskBg2),this.panelRank=new eui.Panel,this.panelRank.skinName="resource/eui_skins/UserUI/MapViewUI.exml",this.panelRank.title="Title",this.panelRank.horizontalCenter=0,this.panelRank.verticalCenter=0,this.context.addChild(this.panelRank),CommonTools.fixFix(this.context,this.panelRank,1,0,0),CommonTools.niceTip(this.panelRank,1,this);var e=this.panelRank.getChildByName("fighting_parent").getChildByName("scroll").getChildByName("scroll_group"),i=0,o=function(o){var s=t[o],a=new eui.Panel;a.skinName="resource/eui_skins/UserUI/MapViewGroup.exml",a.name="p_"+i,a.x+=40,a.y+=50+10*i+255*i,e.addChild(a),a.getChildByName("view_add").visible=!1,a.getChildByName("view_add_btn").visible=!1;var l=a.getChildByName("group_1"),r=l.getChildByName("lb_title");r.text=s.mapName;var h=l.getChildByName("lb_author");h.text=ConstValue.cacheUserInfo.name;var u=l.getChildByName("lb_sign");if(u.text=s.mapSign,a.getChildByName("view_fight_btn").addEventListener(egret.TouchEvent.TOUCH_TAP,function(t){var i=CommonTools.getDataJsonStr("setFightMap",1,{mapId:s.id});ConstValue.P_NET_OBJ.sendData(i);for(var o=e.numChildren,n=0;o>n;n++){var l=e.getChildByName("p_"+n),r=l.getChildByName("fighting_lb_png");null!=r&&l.removeChild(r)}var h=new eui.Image("fighting_lb_png");h.name="fighting_lb_png",a.addChild(h),h.x=6,h.y=6},n),a.getChildByName("view_change_btn").addEventListener(egret.TouchEvent.TOUCH_TAP,function(t){CommonTools.niceTip(this.panelRank,2,this),this.updateByClickModify(s)},n),new MapMiniDIYModule(a,s.bgconf,s.layerconf,2),1==s.isFight){var c=new eui.Image("fighting_lb_png");c.name="fighting_lb_png",a.addChild(c),c.x=6,c.y=6}i++},n=this;for(var s in t)o(s);var a=new eui.Panel;a.skinName="resource/eui_skins/UserUI/MapViewGroup.exml",a.name="p_"+i,a.x+=40,a.y+=50+10*i+255*i,e.addChild(a);var l=a.getChildByName("group_1");l.visible=!1,a.getChildByName("view_fight_btn").visible=!1,a.getChildByName("view_change_btn").visible=!1,a.getChildByName("view_add_btn").addEventListener(egret.TouchEvent.TOUCH_TAP,function(t){CommonTools.niceTip(this.panelRank,2,this),this.updateByClickAdd()},this),CommonButtonHandle.beginTouch(this.panelRank.getChildByName("btn_close"),this),this.panelRank.getChildByName("btn_close").addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this)},t.prototype.updateRankUI=function(t,e){var i=this.panelRank.getChildByName("fighting_parent").getChildByName("scroll").getChildByName("scroll_group");i.removeChildren();var o=function(o){var s=t[o],a=new eui.Panel;a.skinName="resource/eui_skins/UserUI/MapRankGroup.exml",a.name="p_"+o,a.x+=40,a.y+=50+10*parseInt(o)+255*parseInt(o),i.addChild(a);var l=a.getChildByName("group_1"),r=l.getChildByName("lb_title");r.text=s.mapName;var h=l.getChildByName("lb_author");h.text=s.name;var u=l.getChildByName("lb_sign");u.text=s.mapSign;var c=l.getChildByName("like_num");c.text=s.like;var d=l.getChildByName("like_heart");CommonButtonHandle.beginTouch(d,n),d.addEventListener(egret.TouchEvent.TOUCH_TAP,function(t){var i=CommonTools.getDataJsonStr("addLike",1,{rid:s.rid,mapKey:s.mapkey,iType:e});ConstValue.P_NET_OBJ.sendData(i)},n),new MapMiniDIYModule(a,s.lBgconf,s.lLayerconf,1)},n=this;for(var s in t)o(s)},t.prototype.handlePacket=function(t){"saveMap"==t.f?""!=t.m||1!=t.s||(CommonTools.niceTip(this.panelSave,2,this),this.mapKey=t.d.mapkey,CommonTools.addCommonTips(this.context,"保存成功")):"getNewRank"==t.f?""!=t.m||1!=t.s||(null!=this.panelRank?this.updateRankUI(t.d.lnewRank,1):this.openRankUI(t.d.lnewRank)):"getHopRank"==t.f?""!=t.m||1!=t.s||this.updateRankUI(t.d.lhotRank,2):"getMyMaps"==t.f&&(""!=t.m||1!=t.s||this.openViewUI(t.d))},t.groundLayerSubObj={},t.ONE_P="",t.TWO_P="",t.defaultData={},t}();__reflect(MapDIYModule.prototype,"MapDIYModule");var MapMiniDIYModule=function(t){function e(e,i,o,n){var s=t.call(this)||this;return s.initRow=9,s.initColumn=11,s.firstItemX=494.88,s.firstItemY=100.84,s.groundItemW=58,s.groundItemH=55,s.groundOffX=0,s.groundOffY=0,s.testGround2=[1,24,24,1,2,2,2,1,1,1,26,1,1,1,1,1,1,1,1,1,1,1,2,2,1,1,1,2,3,1,1,1,1,2,2,1,1,1,1,1,1,1,1,1,2,1,1,1,25,1,2,1,1,1,1,1,1,1,3,1,1,1,1,2,1,1,1,1,1,1,1,1,1,1,2,1,1,1,1,1,1,1,1,1,1,2,1,2,1,1,1,1,3,3,1,1,2,2,2],s.testMap2=[119,0,7,7,16,21,16,7,7,0,0,0,4,4,20,21,4,21,20,4,4,0,0,0,9,9,16,4,16,9,9,0,0,6,19,5,5,11,4,11,5,5,16,6,6,19,5,11,0,4,0,11,5,16,6,6,19,5,5,11,4,11,7,5,16,6,0,0,0,4,16,4,16,4,0,0,0,0,4,4,4,12,19,12,4,4,4,0,0,20,20,12,16,19,16,12,20,20,120],s.type=1,s.context=e,s.type=n,s.panel=new eui.Panel,s.panel.skinName="resource/eui_skins/UserUI/mapMiniDIYUI.exml",s.panel.title="Title",s.context.addChild(s.panel),s.testGround=i,s.testMap=o,s.initScene(),s}return __extends(e,t),e.prototype.initConfig=function(){var t=this;LZMA.decompress(EBitUtil.getArr(new egret.ByteArray(RES.getRes("config_json"))),function(e){ConstValue.P_CONFIG=JSON.parse(e),t.initScene()},function(t){})},e.prototype.initScene=function(){for(var t=0,i=0;i<this.initRow;i++)for(var o=0;o<this.initColumn;o++){var n=this.groundItemW,s=this.groundItemH,a=this.groundOffX,l=this.groundOffY;i>0&&(l=7),o>0&&(a=4);var r=this.firstItemX+n*o+a*o,h=this.firstItemY+s*i+l*i,u={img:"res_"+this.testGround[t]+"_png",x:r,y:h,name:"ground_"+t,curIdx:t},c=new Fight.MapItem(u);if(c.setRow(i),c.setColumn(o),c.setType(ConstValue.P_CONFIG.MapBase[this.testGround[t].toString()].Type),this.panel.addChild(c),c.scaleX=.7,c.scaleY=.7,e.groundLayerSubObj[t.toString()]=c,c.itemRange[0]=497+55*o+6*o,c.itemRange[1]=c.itemRange[0]+55,c.itemRange[2]=103+55*i+7*i,c.itemRange[3]=c.itemRange[2]+55,c.setRes(this.testGround[t]),this.testMap[t]>0&&this.testMap[t]<100){var d="res_"+this.testMap[t]+"_png";c.addMiniBlock(d)}else this.testMap[t]>100&&c.addMiniPlayer(this.testMap[t]);t++}this.panel.scaleX=.4,this.panel.scaleY=.4,1==this.type?(this.panel.x=180,this.panel.y=-10):2==this.type?(this.panel.x=-180,this.panel.y=-10):3==this.type&&(this.panel.x=112,this.panel.y=116,this.panel.scaleX=.66,this.panel.scaleY=.66)},e.prototype.viewMapSubLayer=function(t){for(var i in e.groundLayerSubObj){var o=e.groundLayerSubObj[i];o.viewSub(t)}},e.groundLayerSubObj={},e}(egret.DisplayObjectContainer);__reflect(MapMiniDIYModule.prototype,"MapMiniDIYModule");var AIUtil0=function(){function t(t,e,i,o,n){this.aiObj=null,this.iCmd=0,this.curPathPointIndex=0,this.boxMap={},this.curBoxMapIdex=0,this.workMap={},this.isVirtualOpen=!1,this.iOpenState=!1,this.delayFunc=null,this.delayTimer=null,this.isSameCR=!1,this.aiObj=t,this.aiObj.aiRobot=!0,this.initRow=i,this.initColumn=o,1==n?this.matrix=[[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0]]:2==n&&(this.matrix=[[0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0]]),this.grid=new PF.Grid(o,i,this.matrix),this.op=new PF.Option,this.op.allowDiagonal=!1,this.finder=new PF.AStarFinder(this.op);for(var s=0,a=0;i>a;a++)for(var l=0;o>l;l++){if(e[s]>0&&e[s]<100){this.grid.setWalkableAt(l,a,!1);var r=ConstValue.P_CONFIG.MapBase[e[s].toString()].Type;if(3==r){var h=Math.abs(this.aiObj.getColumn()-l);null==this.boxMap[h.toString()]&&(this.boxMap[h.toString()]={}),this.boxMap[h.toString()][l+"_"+a]=[l,a]}}s++}for(var a=0;i>a;a++)for(var l=0;o>l;l++){var u=this.getPath(l,a);u.length>0&&(this.workMap[l+"_"+a]=[l,a])}}return t.prototype.beNotifyHasFood=function(t,e){CommonTools.logAI("----------------***卧槽有东西吃了,看下能到达吗 "+t+"_"+e);var i=this.getPath(t,e);i.length>0?(CommonTools.logAI("----------------***就在眼前，去吃"),this.isVirtualOpen=!1,this.iCmd=3,this.removeDelay(),this.resetMove(i),CommonTools.logAI("move------55555555555555555555555555555555"),this.moveNext()):CommonTools.logAI("----------------***蛋疼无路可以过去吃")},t.prototype.moveNext=function(){if(this.iOpenState){if(this.isConnectEnemy())if(CommonTools.logAI("----------------***发现敌人"),this.isHasBoom()){CommonTools.logAI("----------------***发现有炸弹"),CommonTools.logAI("----------------***赶紧逃跑"),this.iCmd=1;var t=this.getSafePath(),e=this.getPath(t[0],t[1]);this.resetMove(e)}else{var i=this.getPath(this.getOtherPlayer().getColumn(),this.getOtherPlayer().getRow());i.length>0&&(CommonTools.logAI("----------------***杀啊。。。"),this.iCmd=2,this.resetMove(i))}else if(CommonTools.logAI("----------------***没有发现敌人"),this.isHasBoom()){if(!this.isSameCR){CommonTools.logAI("----------------***发现有炸弹"),CommonTools.logAI("----------------***赶紧逃跑");var t=this.getSafePath();CommonTools.logAI("----------------***safePath:"+t);var e=this.getPath(t[0],t[1]);
e.length>0&&(this.iCmd=1,this.resetMove(e))}}else{CommonTools.logAI("----------------***不危险，找箱子"),this.isSameCR=!1;var o=this.getNextBox();if(1==this.iCmd&&(this.iCmd=0),null!=o&&0==this.iCmd){this.grid.setWalkableAt(o[0],o[1],!0),this.isVirtualOpen=!0;var n=this.getPath(o[0],o[1]);this.grid.setWalkableAt(o[0],o[1],!1),n.length>0&&(CommonTools.logAI("----------------***找箱子"),this.iCmd=2,this.resetMove(n))}}if(0==this.iCmd)return CommonTools.logAI("----------------***没有命令，主人"),CommonTools.logAI("move------6666666666666666666666666666666666"),void this.moveNext();this.curPathPointIndex++,CommonTools.logAI("this.iCmd------------aaaaaaaaaaaa----------"+this.iCmd+" this.curPathPointIndex:"+this.curPathPointIndex+" this.curPath:"+this.curPath);var s=this.curPath.length;if(this.isVirtualOpen&&(s=this.curPath.length-1),this.curPathPointIndex>=s)if(this.curPathPointIndex=0,this.isVirtualOpen){this.isVirtualOpen=!1,CommonTools.logAI("----------------***找到箱子了，要放炮了");var a=CommonTools.getDataJsonStr("syncPut",1,{x:this.aiObj.x,y:this.aiObj.y,idx:parseInt(this.aiObj.curMapIdx),playerID:this.aiObj.roleId});ConstValue.P_NET_OBJ.sendData2(a)}else if(CommonTools.logAI("----------------***到达终点，找下一件事情做"),1==this.iCmd)CommonTools.logAI("----------------***逃生中，躲3秒"),this.isConnectEnemy()?(this.removeDelay(),this.delayFunc=function(){CommonTools.logAI("move------7777777777777777777777777777777777"),1==this.iCmd&&(CommonTools.log("move------7777777777777777777777777777777777"),this.moveNext())},this.Delay(10)):(this.removeDelay(),this.delayFunc=function(){CommonTools.logAI("move------7777777777777777777777777777777777"),1==this.iCmd&&this.moveNext()},this.Delay(3800));else if(3==this.iCmd)CommonTools.logAI("----------------***吃了东西了"),this.iCmd=0,CommonTools.logAI("move------8888888888888888888888888888888888888888"),this.moveNext();else if(2==this.iCmd){CommonTools.logAI("----------------***炸死个扑街");var a=CommonTools.getDataJsonStr("syncPut",1,{x:this.aiObj.x,y:this.aiObj.y,idx:parseInt(this.aiObj.curMapIdx),playerID:this.aiObj.roleId});ConstValue.P_NET_OBJ.sendData2(a)}else CommonTools.logAI("move------999999999999999999999999999999999999"),this.moveNext();else{if(1==this.iCmd&&this.curPathPointIndex>=4&&this.isConnectEnemy()){CommonTools.logAI("----------------***逃跑也放雷");var a=CommonTools.getDataJsonStr("syncPut",1,{x:this.aiObj.x,y:this.aiObj.y,idx:parseInt(this.aiObj.curMapIdx),playerID:this.aiObj.roleId});ConstValue.P_NET_OBJ.sendData2(a)}this.move(this.curPath[this.curPathPointIndex][0],this.curPath[this.curPathPointIndex][1])}}},t.prototype.resetMove=function(t){this.curPathPointIndex=0,this.curPath=t},t.prototype.openBlock=function(t,e){this.setWalkAble(t,e,!0);var i=t+"_"+e;this.workMap[i]=[t,e],CommonTools.printMap(this.workMap);var o="";for(var n in this.boxMap){var s=this.boxMap[n];for(var a in s){var l=s[a];if(l[0]==t&&l[1]==e){o=n;break}}if(""!=o)break}""!=o&&(this.boxMap[o][t+"_"+e]=null,delete this.boxMap[o][t+"_"+e]);for(var n=0;n<this.initRow;n++)for(var a=0;a<this.initColumn;a++){var r=this.getPath(a,n);r.length>0&&null==this.workMap[a+"_"+n]&&(this.workMap[a+"_"+n]=[a,n])}},t.prototype.Delay=function(t){this.delayTimer=new egret.Timer(t,1),this.delayTimer.addEventListener(egret.TimerEvent.TIMER,this.delayFunc,this),this.delayTimer.start()},t.prototype.removeDelay=function(){null!=this.delayTimer&&(this.delayTimer.stop(),this.delayTimer.removeEventListener(egret.TimerEvent.TIMER,this.delayFunc,this),this.delayTimer=null,this.delayFunc=null)},t.prototype.getNextBox=function(){var t=this.boxMap[this.curBoxMapIdex.toString()],e=0;for(var i in t)e++;for(;0==e;){if(this.curBoxMapIdex++,this.curBoxMapIdex>=this.initColumn)return null;t=this.boxMap[this.curBoxMapIdex.toString()];for(var i in t)e++}for(var i in t){CommonTools.logAI("getNextBox************************tBox[i]:"+t[i]),this.grid.setWalkableAt(t[i][0],t[i][1],!0);var o=this.getPath(t[i][0],t[i][1]);if(this.grid.setWalkableAt(t[i][0],t[i][1],!1),o.length>0)return t[i]}return CommonTools.logAI("getNextBox************xxxxxx***no box*********"),this.curBoxMapIdex++,this.getNextBox()},t.prototype.isHasBoom=function(){if(this.isConnectEnemy())for(var t in FightingModule.bulletLayerSubObj)return!0;else for(var t in FightingModule.bulletLayerSubObj){var e=FightingModule.bulletLayerSubObj[t];if(e.owner.roleId==this.aiObj.roleId)return!0}return!1},t.prototype.getSafePath=function(){var t=null,e=100;if(CommonTools.printMap(this.workMap),this.isConnectEnemy())for(var i in this.workMap){var o=this.workMap[i],n=!0;for(var s in FightingModule.bulletLayerSubObj){var a=FightingModule.bulletLayerSubObj[s];if(a.getColumn()==o[0]||a.getRow()==o[1]){n=!1;break}}if(n){var l=this.getPath(o[0],o[1]);l.length>0&&l.length<e&&(e=l.length,t=o)}}else for(var i in this.workMap){var o=this.workMap[i],n=!0;for(var s in FightingModule.bulletLayerSubObj){var a=FightingModule.bulletLayerSubObj[s];if(a.owner.roleId==this.aiObj.roleId&&(a.getColumn()==o[0]||a.getRow()==o[1])){n=!1;break}}if(n){var l=this.getPath(o[0],o[1]);l.length>0&&l.length<e&&(e=l.length,t=o,CommonTools.logAI("getSafePath----miniLenChoose-----------------"+t))}}if(null!=t)return t;this.isSameCR=!0,e=0;for(var i in this.workMap){var o=this.workMap[i],l=this.getPath(o[0],o[1]);l.length>e&&(e=l.length,t=o,CommonTools.logAI("getSafePath--22--miniLenChoose-----------------"+t))}return null!=t?t:null},t.prototype.getPath=function(t,e){var i=this.grid.clone();return this.finder.findPath(this.aiObj.getColumn(),this.aiObj.getRow(),t,e,i)},t.prototype.startAI=function(){},t.prototype.stopAI=function(){this.iOpenState=!1},t.prototype.isConnectEnemy=function(){var t=this.getPath(this.getOtherPlayer().getColumn(),this.getOtherPlayer().getRow());return 0==t.length?!1:!0},t.prototype.setWalkAble=function(t,e,i){this.grid.setWalkableAt(t,e,i)},t.prototype.getOtherPlayer=function(){for(var t in FightingModule.playerLayerSubObj){var e=FightingModule.playerLayerSubObj[t];if(e.roleId!=this.aiObj.roleId&&0==e.isAI)return e}return null},t.prototype.move=function(t,e){var i=this.aiObj;null==this.aiObj.func&&(this.aiObj.func=function(t){i.setMoving(!0),i.move(-1,!0)},this.aiObj.addEventListener(egret.Event.ENTER_FRAME,this.aiObj.func,this.aiObj)),this.aiObj.setMoving(!0),this.aiObj.moveDetail(t,e)},t}();__reflect(AIUtil0.prototype,"AIUtil0");var AIUtil1=function(){function t(t,e,i,o,n){this.aiObj=null,this.iCmd=0,this.curPathPointIndex=0,this.boxMap={},this.curBoxMapIdex=0,this.workMap={},this.isVirtualOpen=!1,this.iOpenState=!1,this.delayFunc=null,this.delayTimer=null,this.isSameCR=!1,this.aiObj=t,this.aiObj.aiRobot=!0,this.initRow=i,this.initColumn=o,1==n?this.matrix=[[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0]]:2==n&&(this.matrix=[[0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0]]),this.grid=new PF.Grid(o,i,this.matrix),this.op=new PF.Option,this.op.allowDiagonal=!1,this.finder=new PF.AStarFinder(this.op);for(var s=0,a=0;i>a;a++)for(var l=0;o>l;l++){if(e[s]>0&&e[s]<100){this.grid.setWalkableAt(l,a,!1);var r=ConstValue.P_CONFIG.MapBase[e[s].toString()].Type;if(3==r){var h=Math.abs(this.aiObj.getColumn()-l);null==this.boxMap[h.toString()]&&(this.boxMap[h.toString()]={}),this.boxMap[h.toString()][l+"_"+a]=[l,a]}}s++}for(var a=0;i>a;a++)for(var l=0;o>l;l++){var u=this.getPath(l,a);u.length>0&&(this.workMap[l+"_"+a]=[l,a])}}return t.prototype.beNotifyHasFood=function(t,e){CommonTools.logAI("----------------***卧槽有东西吃了,看下能到达吗 "+t+"_"+e);var i=this.getPath(t,e);i.length>0?(CommonTools.logAI("----------------***就在眼前，去吃"),this.isVirtualOpen=!1,this.iCmd=3,this.removeDelay(),this.resetMove(i),CommonTools.logAI("move------55555555555555555555555555555555"),this.moveNext()):CommonTools.logAI("----------------***蛋疼无路可以过去吃")},t.prototype.moveNext=function(){if(this.iOpenState){if(this.isConnectEnemy())if(CommonTools.logAI("----------------***发现敌人"),this.isHasBoom()){CommonTools.logAI("----------------***发现有炸弹"),CommonTools.logAI("----------------***赶紧逃跑"),this.iCmd=1;var t=this.getSafePath(),e=this.getPath(t[0],t[1]);this.resetMove(e)}else{var i=this.getPath(this.getOtherPlayer().getColumn(),this.getOtherPlayer().getRow());i.length>0&&(CommonTools.logAI("----------------***杀啊。。。"),this.iCmd=2,this.resetMove(i))}else if(CommonTools.logAI("----------------***没有发现敌人"),this.isHasBoom()){if(!this.isSameCR){CommonTools.logAI("----------------***发现有炸弹"),CommonTools.logAI("----------------***赶紧逃跑");var t=this.getSafePath();CommonTools.logAI("----------------***safePath:"+t);var e=this.getPath(t[0],t[1]);e.length>0&&(this.iCmd=1,this.resetMove(e))}}else{CommonTools.logAI("----------------***不危险，找箱子"),this.isSameCR=!1;var o=this.getNextBox();if(1==this.iCmd&&(this.iCmd=0),null!=o&&0==this.iCmd){this.grid.setWalkableAt(o[0],o[1],!0),this.isVirtualOpen=!0;var n=this.getPath(o[0],o[1]);this.grid.setWalkableAt(o[0],o[1],!1),n.length>0&&(CommonTools.logAI("----------------***找箱子"),this.iCmd=2,this.resetMove(n))}}if(0==this.iCmd)return CommonTools.logAI("----------------***没有命令，主人"),CommonTools.logAI("move------6666666666666666666666666666666666"),void this.moveNext();this.curPathPointIndex++,CommonTools.logAI("this.iCmd------------aaaaaaaaaaaa----------"+this.iCmd+" this.curPathPointIndex:"+this.curPathPointIndex+" this.curPath:"+this.curPath);var s=this.curPath.length;if(this.isVirtualOpen&&(s=this.curPath.length-1),this.curPathPointIndex>=s)if(this.curPathPointIndex=0,this.isVirtualOpen){this.isVirtualOpen=!1,CommonTools.logAI("----------------***找到箱子了，要放炮了");var a=CommonTools.getDataJsonStr("syncPut",1,{x:this.aiObj.x,y:this.aiObj.y,idx:parseInt(this.aiObj.curMapIdx),playerID:this.aiObj.roleId});ConstValue.P_NET_OBJ.sendData2(a)}else if(CommonTools.logAI("----------------***到达终点，找下一件事情做"),1==this.iCmd)CommonTools.logAI("----------------***逃生中，躲3秒"),this.isConnectEnemy()?(this.removeDelay(),this.delayFunc=function(){CommonTools.logAI("move------7777777777777777777777777777777777"),1==this.iCmd&&(CommonTools.log("move------7777777777777777777777777777777777"),this.moveNext())},this.Delay(10)):(this.removeDelay(),this.delayFunc=function(){CommonTools.logAI("move------7777777777777777777777777777777777"),1==this.iCmd&&this.moveNext()},this.Delay(3800));else if(3==this.iCmd)CommonTools.logAI("----------------***吃了东西了"),this.iCmd=0,CommonTools.logAI("move------8888888888888888888888888888888888888888"),this.moveNext();else if(2==this.iCmd){CommonTools.logAI("----------------***炸死个扑街");var a=CommonTools.getDataJsonStr("syncPut",1,{x:this.aiObj.x,y:this.aiObj.y,idx:parseInt(this.aiObj.curMapIdx),playerID:this.aiObj.roleId});ConstValue.P_NET_OBJ.sendData2(a)}else CommonTools.logAI("move------999999999999999999999999999999999999"),this.moveNext();else{if(1==this.iCmd&&this.curPathPointIndex>=4&&this.isConnectEnemy()){CommonTools.logAI("----------------***逃跑也放雷");var a=CommonTools.getDataJsonStr("syncPut",1,{x:this.aiObj.x,y:this.aiObj.y,idx:parseInt(this.aiObj.curMapIdx),playerID:this.aiObj.roleId});ConstValue.P_NET_OBJ.sendData2(a)}this.move(this.curPath[this.curPathPointIndex][0],this.curPath[this.curPathPointIndex][1])}}},t.prototype.resetMove=function(t){this.curPathPointIndex=0,this.curPath=t},t.prototype.openBlock=function(t,e){this.setWalkAble(t,e,!0);var i=t+"_"+e;this.workMap[i]=[t,e],CommonTools.printMap(this.workMap);var o="";for(var n in this.boxMap){var s=this.boxMap[n];for(var a in s){var l=s[a];if(l[0]==t&&l[1]==e){o=n;break}}if(""!=o)break}""!=o&&(this.boxMap[o][t+"_"+e]=null,delete this.boxMap[o][t+"_"+e]);for(var n=0;n<this.initRow;n++)for(var a=0;a<this.initColumn;a++){var r=this.getPath(a,n);r.length>0&&null==this.workMap[a+"_"+n]&&(this.workMap[a+"_"+n]=[a,n])}},t.prototype.Delay=function(t){this.delayTimer=new egret.Timer(t,1),this.delayTimer.addEventListener(egret.TimerEvent.TIMER,this.delayFunc,this),this.delayTimer.start()},t.prototype.removeDelay=function(){null!=this.delayTimer&&(this.delayTimer.stop(),this.delayTimer.removeEventListener(egret.TimerEvent.TIMER,this.delayFunc,this),this.delayTimer=null,this.delayFunc=null)},t.prototype.getNextBox=function(){var t=this.boxMap[this.curBoxMapIdex.toString()],e=0;for(var i in t)e++;for(;0==e;){if(this.curBoxMapIdex++,this.curBoxMapIdex>=this.initColumn)return null;t=this.boxMap[this.curBoxMapIdex.toString()];for(var i in t)e++}for(var i in t){CommonTools.logAI("getNextBox************************tBox[i]:"+t[i]),this.grid.setWalkableAt(t[i][0],t[i][1],!0);var o=this.getPath(t[i][0],t[i][1]);if(this.grid.setWalkableAt(t[i][0],t[i][1],!1),o.length>0)return t[i]}return CommonTools.logAI("getNextBox************xxxxxx***no box*********"),this.curBoxMapIdex++,this.getNextBox()},t.prototype.isHasBoom=function(){if(this.isConnectEnemy())for(var t in FightingModule.bulletLayerSubObj)return!0;else for(var t in FightingModule.bulletLayerSubObj){var e=FightingModule.bulletLayerSubObj[t];if(e.owner.roleId==this.aiObj.roleId)return!0}return!1},t.prototype.getSafePath=function(){var t=null,e=100;if(CommonTools.printMap(this.workMap),this.isConnectEnemy())for(var i in this.workMap){var o=this.workMap[i],n=!0;for(var s in FightingModule.bulletLayerSubObj){var a=FightingModule.bulletLayerSubObj[s];if(a.getColumn()==o[0]||a.getRow()==o[1]){n=!1;break}}if(n){var l=this.getPath(o[0],o[1]);l.length>0&&l.length<e&&(e=l.length,t=o)}}else for(var i in this.workMap){var o=this.workMap[i],n=!0;for(var s in FightingModule.bulletLayerSubObj){var a=FightingModule.bulletLayerSubObj[s];if(a.owner.roleId==this.aiObj.roleId&&(a.getColumn()==o[0]||a.getRow()==o[1])){n=!1;break}}if(n){var l=this.getPath(o[0],o[1]);l.length>0&&l.length<e&&(e=l.length,t=o,CommonTools.logAI("getSafePath----miniLenChoose-----------------"+t))}}if(null!=t)return t;this.isSameCR=!0,e=0;for(var i in this.workMap){var o=this.workMap[i],l=this.getPath(o[0],o[1]);l.length>e&&(e=l.length,t=o,CommonTools.logAI("getSafePath--22--miniLenChoose-----------------"+t))}return null!=t?t:null},t.prototype.getPath=function(t,e){var i=this.grid.clone();return this.finder.findPath(this.aiObj.getColumn(),this.aiObj.getRow(),t,e,i)},t.prototype.startAI=function(){this.iOpenState=!0,this.isConnectEnemy()||(CommonTools.logAI("----------------***开局"),this.moveNext())},t.prototype.stopAI=function(){this.iOpenState=!1},t.prototype.isConnectEnemy=function(){var t=this.getPath(this.getOtherPlayer().getColumn(),this.getOtherPlayer().getRow());return 0==t.length?!1:!0},t.prototype.setWalkAble=function(t,e,i){this.grid.setWalkableAt(t,e,i)},t.prototype.getOtherPlayer=function(){for(var t in FightingModule.playerLayerSubObj){var e=FightingModule.playerLayerSubObj[t];if(e.roleId!=this.aiObj.roleId&&0==e.isAI)return e}return null},t.prototype.move=function(t,e){var i=this.aiObj;null==this.aiObj.func&&(this.aiObj.func=function(t){i.setMoving(!0),i.move(-1,!0)},this.aiObj.addEventListener(egret.Event.ENTER_FRAME,this.aiObj.func,this.aiObj)),this.aiObj.setMoving(!0),this.aiObj.moveDetail(t,e)},t}();__reflect(AIUtil1.prototype,"AIUtil1");var AIUtil2=function(){function t(t,e,i,o,n){this.aiObj=null,this.iCmd=0,this.curPathPointIndex=0,this.boxMap={},this.curBoxMapIdex=0,this.workMap={},this.isVirtualOpen=!1,this.iOpenState=!1,this.delayFunc=null,this.delayTimer=null,this.isSameCR=!1,this.isStartFlag=!0,this.aiObj=t,this.aiObj.aiRobot=!0,this.initRow=i,this.initColumn=o,1==n?this.matrix=[[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0]]:2==n&&(this.matrix=[[0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0]]),this.grid=new PF.Grid(o,i,this.matrix),this.op=new PF.Option,this.op.allowDiagonal=!1,this.finder=new PF.AStarFinder(this.op);for(var s=0,a=0;i>a;a++)for(var l=0;o>l;l++){if(e[s]>0&&e[s]<100){this.grid.setWalkableAt(l,a,!1);var r=ConstValue.P_CONFIG.MapBase[e[s].toString()].Type;if(3==r){var h=Math.abs(this.aiObj.getColumn()-l);null==this.boxMap[h.toString()]&&(this.boxMap[h.toString()]={}),this.boxMap[h.toString()][l+"_"+a]=[l,a]}}s++}for(var a=0;i>a;a++)for(var l=0;o>l;l++){var u=this.getPath(l,a);u.length>0&&(this.workMap[l+"_"+a]=[l,a])}}return t.prototype.beNotifyHasFood=function(t,e){CommonTools.logAI("----------------***卧槽有东西吃了,看下能到达吗 "+t+"_"+e);var i=this.getPath(t,e);i.length>0?(CommonTools.logAI("----------------***就在眼前，去吃"),this.isVirtualOpen=!1,this.iCmd=3,this.removeDelay(),this.resetMove(i),CommonTools.logAI("move------55555555555555555555555555555555"),this.moveNext()):CommonTools.logAI("----------------***蛋疼无路可以过去吃")},t.prototype.moveNext=function(){if(this.iOpenState){if(this.isConnectEnemy())if(CommonTools.logAI("----------------***发现敌人"),this.isHasBoom()){CommonTools.logAI("----------------***发现有炸弹"),CommonTools.logAI("----------------***赶紧逃跑"),this.iCmd=1;var t=this.getSafePath(),e=this.getPath(t[0],t[1]);this.resetMove(e)}else{var i=this.getPath(this.getOtherPlayer().getColumn(),this.getOtherPlayer().getRow());i.length>0&&(CommonTools.logAI("----------------***杀啊。。。"),this.iCmd=2,this.resetMove(i))}else if(CommonTools.logAI("----------------***没有发现敌人"),this.isHasBoom()){if(!this.isSameCR){CommonTools.logAI("----------------***发现有炸弹"),CommonTools.logAI("----------------***赶紧逃跑");var t=this.getSafePath();CommonTools.logAI("----------------***safePath:"+t);var e=this.getPath(t[0],t[1]);e.length>0&&(this.iCmd=1,this.resetMove(e))}}else{CommonTools.logAI("----------------***不危险，找箱子"),this.isSameCR=!1;var o=this.getNextBox();if(1==this.iCmd&&(this.iCmd=0),null!=o&&0==this.iCmd){this.grid.setWalkableAt(o[0],o[1],!0),this.isVirtualOpen=!0;var n=this.getPath(o[0],o[1]);this.grid.setWalkableAt(o[0],o[1],!1),n.length>0&&(CommonTools.logAI("----------------***找箱子"),this.iCmd=2,this.resetMove(n))}}if(0==this.iCmd)return CommonTools.logAI("----------------***没有命令，主人"),CommonTools.logAI("move------6666666666666666666666666666666666"),void this.moveNext();this.curPathPointIndex++,CommonTools.logAI("this.iCmd------------aaaaaaaaaaaa----------"+this.iCmd+" this.curPathPointIndex:"+this.curPathPointIndex+" this.curPath:"+this.curPath);var s=this.curPath.length;if(this.isVirtualOpen&&(s=this.curPath.length-1),this.curPathPointIndex>=s)if(this.curPathPointIndex=0,this.isVirtualOpen){this.isVirtualOpen=!1,CommonTools.logAI("----------------***找到箱子了，要放炮了");var a=CommonTools.getDataJsonStr("syncPut",1,{x:this.aiObj.x,y:this.aiObj.y,idx:parseInt(this.aiObj.curMapIdx),playerID:this.aiObj.roleId});ConstValue.P_NET_OBJ.sendData2(a)}else if(CommonTools.logAI("----------------***到达终点，找下一件事情做"),1==this.iCmd)CommonTools.logAI("----------------***逃生中，躲3秒"),this.isConnectEnemy()?(this.removeDelay(),this.delayFunc=function(){CommonTools.logAI("move------7777777777777777777777777777777777"),1==this.iCmd&&(CommonTools.log("move------7777777777777777777777777777777777"),this.moveNext())},this.Delay(10)):(this.removeDelay(),this.delayFunc=function(){CommonTools.logAI("move------7777777777777777777777777777777777"),1==this.iCmd&&this.moveNext()},this.Delay(3800));else if(3==this.iCmd)CommonTools.logAI("----------------***吃了东西了"),this.iCmd=0,CommonTools.logAI("move------8888888888888888888888888888888888888888"),this.moveNext();else if(2==this.iCmd){CommonTools.logAI("----------------***炸死个扑街");var a=CommonTools.getDataJsonStr("syncPut",1,{x:this.aiObj.x,y:this.aiObj.y,idx:parseInt(this.aiObj.curMapIdx),playerID:this.aiObj.roleId});ConstValue.P_NET_OBJ.sendData2(a)}else CommonTools.logAI("move------999999999999999999999999999999999999"),this.moveNext();else{if(1==this.iCmd&&this.curPathPointIndex>=4&&this.isConnectEnemy()){CommonTools.logAI("----------------***逃跑也放雷");var a=CommonTools.getDataJsonStr("syncPut",1,{x:this.aiObj.x,y:this.aiObj.y,idx:parseInt(this.aiObj.curMapIdx),playerID:this.aiObj.roleId});ConstValue.P_NET_OBJ.sendData2(a)}this.move(this.curPath[this.curPathPointIndex][0],this.curPath[this.curPathPointIndex][1])}}},t.prototype.resetMove=function(t){this.curPathPointIndex=0,this.curPath=t},t.prototype.openBlock=function(t,e){this.setWalkAble(t,e,!0);var i=t+"_"+e;this.workMap[i]=[t,e],CommonTools.printMap(this.workMap);var o="";for(var n in this.boxMap){var s=this.boxMap[n];for(var a in s){var l=s[a];if(l[0]==t&&l[1]==e){o=n;break}}if(""!=o)break}""!=o&&(this.boxMap[o][t+"_"+e]=null,delete this.boxMap[o][t+"_"+e]);for(var n=0;n<this.initRow;n++)for(var a=0;a<this.initColumn;a++){var r=this.getPath(a,n);r.length>0&&null==this.workMap[a+"_"+n]&&(this.workMap[a+"_"+n]=[a,n])}},t.prototype.Delay=function(t){this.delayTimer=new egret.Timer(t,1),this.delayTimer.addEventListener(egret.TimerEvent.TIMER,this.delayFunc,this),this.delayTimer.start()},t.prototype.removeDelay=function(){null!=this.delayTimer&&(this.delayTimer.stop(),this.delayTimer.removeEventListener(egret.TimerEvent.TIMER,this.delayFunc,this),this.delayTimer=null,this.delayFunc=null)},t.prototype.getNextBox=function(){var t=this.boxMap[this.curBoxMapIdex.toString()],e=0;for(var i in t)e++;for(;0==e;){if(this.curBoxMapIdex++,this.curBoxMapIdex>=this.initColumn)return null;t=this.boxMap[this.curBoxMapIdex.toString()];for(var i in t)e++}for(var i in t){CommonTools.logAI("getNextBox************************tBox[i]:"+t[i]),this.grid.setWalkableAt(t[i][0],t[i][1],!0);var o=this.getPath(t[i][0],t[i][1]);if(this.grid.setWalkableAt(t[i][0],t[i][1],!1),o.length>0){if(!this.isStartFlag)return t[i];this.isStartFlag=!1}}return CommonTools.logAI("getNextBox************xxxxxx***no box*********"),this.curBoxMapIdex++,this.getNextBox()},t.prototype.isHasBoom=function(){if(this.isConnectEnemy())for(var t in FightingModule.bulletLayerSubObj)return!0;else for(var t in FightingModule.bulletLayerSubObj){var e=FightingModule.bulletLayerSubObj[t];if(e.owner.roleId==this.aiObj.roleId)return!0}return!1},t.prototype.getSafePath=function(){var t=null,e=100;if(CommonTools.printMap(this.workMap),this.isConnectEnemy())for(var i in this.workMap){var o=this.workMap[i],n=!0;for(var s in FightingModule.bulletLayerSubObj){var a=FightingModule.bulletLayerSubObj[s];if(a.getColumn()==o[0]||a.getRow()==o[1]){n=!1;break}}if(n){var l=this.getPath(o[0],o[1]);l.length>0&&l.length<e&&(e=l.length,t=o)}}else for(var i in this.workMap){var o=this.workMap[i],n=!0;for(var s in FightingModule.bulletLayerSubObj){var a=FightingModule.bulletLayerSubObj[s];if(a.owner.roleId==this.aiObj.roleId&&(a.getColumn()==o[0]||a.getRow()==o[1])){n=!1;break}}if(n){var l=this.getPath(o[0],o[1]);l.length>0&&l.length<e&&(e=l.length,t=o,CommonTools.logAI("getSafePath----miniLenChoose-----------------"+t))}}if(null!=t)return t;this.isSameCR=!0,e=0;for(var i in this.workMap){var o=this.workMap[i],l=this.getPath(o[0],o[1]);l.length>e&&(e=l.length,t=o,CommonTools.logAI("getSafePath--22--miniLenChoose-----------------"+t))}return null!=t?t:null},t.prototype.getPath=function(t,e){var i=this.grid.clone();return this.finder.findPath(this.aiObj.getColumn(),this.aiObj.getRow(),t,e,i)},t.prototype.startAI=function(){this.iOpenState=!0,this.isConnectEnemy()||(CommonTools.logAI("----------------***开局"),this.moveNext())},t.prototype.stopAI=function(){this.iOpenState=!1},t.prototype.isConnectEnemy=function(){var t=this.getPath(this.getOtherPlayer().getColumn(),this.getOtherPlayer().getRow());return 0==t.length?!1:!0},t.prototype.setWalkAble=function(t,e,i){this.grid.setWalkableAt(t,e,i)},t.prototype.getOtherPlayer=function(){for(var t in FightingModule.playerLayerSubObj){var e=FightingModule.playerLayerSubObj[t];if(e.roleId!=this.aiObj.roleId&&0==e.isAI)return e}return null},t.prototype.move=function(t,e){var i=this.aiObj;null==this.aiObj.func&&(this.aiObj.func=function(t){i.setMoving(!0),i.move(-1,!0)},this.aiObj.addEventListener(egret.Event.ENTER_FRAME,this.aiObj.func,this.aiObj)),this.aiObj.setMoving(!0),this.aiObj.moveDetail(t,e)},t}();__reflect(AIUtil2.prototype,"AIUtil2");var AIUtil3=function(){function t(t,e,i,o,n){this.aiObj=null,this.iCmd=0,this.curPathPointIndex=0,this.boxMap={},this.curBoxMapIdex=0,this.workMap={},this.isVirtualOpen=!1,this.iOpenState=!1,this.delayFunc=null,this.delayTimer=null,this.isSameCR=!1,this.aiObj=t,this.aiObj.aiRobot=!0,this.initRow=i,this.initColumn=o,1==n?this.matrix=[[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0]]:2==n&&(this.matrix=[[0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0]]),this.grid=new PF.Grid(o,i,this.matrix),this.op=new PF.Option,this.op.allowDiagonal=!1,this.finder=new PF.AStarFinder(this.op);for(var s=0,a=0;i>a;a++)for(var l=0;o>l;l++){if(e[s]>0&&e[s]<100){this.grid.setWalkableAt(l,a,!1);var r=ConstValue.P_CONFIG.MapBase[e[s].toString()].Type;if(3==r){var h=Math.abs(this.aiObj.getColumn()-l);null==this.boxMap[h.toString()]&&(this.boxMap[h.toString()]={}),this.boxMap[h.toString()][l+"_"+a]=[l,a]}}s++}for(var a=0;i>a;a++)for(var l=0;o>l;l++){var u=this.getPath(l,a);u.length>0&&(this.workMap[l+"_"+a]=[l,a])}}return t.prototype.beNotifyHasFood=function(t,e){CommonTools.logAI("----------------***卧槽有东西吃了,看下能到达吗 "+t+"_"+e);var i=this.getPath(t,e);i.length>0?(CommonTools.logAI("----------------***就在眼前，去吃"),this.isVirtualOpen=!1,this.iCmd=3,this.removeDelay(),this.resetMove(i),CommonTools.logAI("move------55555555555555555555555555555555"),this.moveNext()):CommonTools.logAI("----------------***蛋疼无路可以过去吃")},t.prototype.moveNext=function(){if(this.iOpenState){if(this.isConnectEnemy())if(CommonTools.logAI("----------------***发现敌人"),this.isHasBoom()){CommonTools.logAI("----------------***发现有炸弹"),CommonTools.logAI("----------------***赶紧逃跑"),this.iCmd=1;var t=this.getSafePath(),e=this.getPath(t[0],t[1]);this.resetMove(e)}else{var i=this.getPath(this.getOtherPlayer().getColumn(),this.getOtherPlayer().getRow());i.length>0&&(CommonTools.logAI("----------------***杀啊。。。"),this.iCmd=2,this.resetMove(i))}else if(CommonTools.logAI("----------------***没有发现敌人"),this.isHasBoom()){if(!this.isSameCR){CommonTools.logAI("----------------***发现有炸弹"),CommonTools.logAI("----------------***赶紧逃跑");var t=this.getSafePath();CommonTools.logAI("----------------***safePath:"+t);var e=this.getPath(t[0],t[1]);e.length>0&&(this.iCmd=1,this.resetMove(e))}}else{CommonTools.logAI("----------------***不危险，找箱子"),this.isSameCR=!1;var o=this.getNextBox();if(1==this.iCmd&&(this.iCmd=0),null!=o&&0==this.iCmd){this.grid.setWalkableAt(o[0],o[1],!0),this.isVirtualOpen=!0;var n=this.getPath(o[0],o[1]);this.grid.setWalkableAt(o[0],o[1],!1),n.length>0&&(CommonTools.logAI("----------------***找箱子"),this.iCmd=2,this.resetMove(n))}}if(0==this.iCmd)return CommonTools.logAI("----------------***没有命令，主人"),CommonTools.logAI("move------6666666666666666666666666666666666"),void this.moveNext();this.curPathPointIndex++,CommonTools.logAI("this.iCmd------------aaaaaaaaaaaa----------"+this.iCmd+" this.curPathPointIndex:"+this.curPathPointIndex+" this.curPath:"+this.curPath);var s=this.curPath.length;if(this.isVirtualOpen&&(s=this.curPath.length-1),this.curPathPointIndex>=s)if(this.curPathPointIndex=0,this.isVirtualOpen){this.isVirtualOpen=!1,CommonTools.logAI("----------------***找到箱子了，要放炮了");var a=CommonTools.getDataJsonStr("syncPut",1,{x:this.aiObj.x,y:this.aiObj.y,idx:parseInt(this.aiObj.curMapIdx),playerID:this.aiObj.roleId});ConstValue.P_NET_OBJ.sendData2(a)}else if(CommonTools.logAI("----------------***到达终点，找下一件事情做"),1==this.iCmd)CommonTools.logAI("----------------***逃生中，躲3秒"),this.isConnectEnemy()?(this.removeDelay(),this.delayFunc=function(){CommonTools.logAI("move------7777777777777777777777777777777777"),1==this.iCmd&&(CommonTools.log("move------7777777777777777777777777777777777"),this.moveNext())},this.Delay(10)):(this.removeDelay(),this.delayFunc=function(){CommonTools.logAI("move------7777777777777777777777777777777777"),1==this.iCmd&&this.moveNext()},this.Delay(3800));else if(3==this.iCmd)CommonTools.logAI("----------------***吃了东西了"),this.iCmd=0,CommonTools.logAI("move------8888888888888888888888888888888888888888"),this.moveNext();else if(2==this.iCmd){CommonTools.logAI("----------------***炸死个扑街");var a=CommonTools.getDataJsonStr("syncPut",1,{x:this.aiObj.x,y:this.aiObj.y,idx:parseInt(this.aiObj.curMapIdx),playerID:this.aiObj.roleId});ConstValue.P_NET_OBJ.sendData2(a)}else CommonTools.logAI("move------999999999999999999999999999999999999"),this.moveNext();else{if(1==this.iCmd&&this.curPathPointIndex>=4&&this.isConnectEnemy()){CommonTools.logAI("----------------***逃跑也放雷");var a=CommonTools.getDataJsonStr("syncPut",1,{x:this.aiObj.x,y:this.aiObj.y,idx:parseInt(this.aiObj.curMapIdx),playerID:this.aiObj.roleId});ConstValue.P_NET_OBJ.sendData2(a)}this.move(this.curPath[this.curPathPointIndex][0],this.curPath[this.curPathPointIndex][1])}}},t.prototype.resetMove=function(t){this.curPathPointIndex=0,this.curPath=t},t.prototype.openBlock=function(t,e){this.setWalkAble(t,e,!0);var i=t+"_"+e;this.workMap[i]=[t,e],CommonTools.printMap(this.workMap);var o="";for(var n in this.boxMap){var s=this.boxMap[n];for(var a in s){var l=s[a];if(l[0]==t&&l[1]==e){o=n;break}}if(""!=o)break}""!=o&&(this.boxMap[o][t+"_"+e]=null,delete this.boxMap[o][t+"_"+e]);for(var n=0;n<this.initRow;n++)for(var a=0;a<this.initColumn;a++){var r=this.getPath(a,n);r.length>0&&null==this.workMap[a+"_"+n]&&(this.workMap[a+"_"+n]=[a,n])}},t.prototype.Delay=function(t){this.delayTimer=new egret.Timer(t,1),this.delayTimer.addEventListener(egret.TimerEvent.TIMER,this.delayFunc,this),this.delayTimer.start()},t.prototype.removeDelay=function(){null!=this.delayTimer&&(this.delayTimer.stop(),this.delayTimer.removeEventListener(egret.TimerEvent.TIMER,this.delayFunc,this),this.delayTimer=null,this.delayFunc=null)},t.prototype.getNextBox=function(){var t=this.boxMap[this.curBoxMapIdex.toString()],e=0;for(var i in t)e++;for(;0==e;){if(this.curBoxMapIdex++,this.curBoxMapIdex>=this.initColumn)return null;t=this.boxMap[this.curBoxMapIdex.toString()];for(var i in t)e++}for(var i in t){CommonTools.logAI("getNextBox************************tBox[i]:"+t[i]),this.grid.setWalkableAt(t[i][0],t[i][1],!0);var o=this.getPath(t[i][0],t[i][1]);if(this.grid.setWalkableAt(t[i][0],t[i][1],!1),o.length>0)return t[i]}return CommonTools.logAI("getNextBox************xxxxxx***no box*********"),this.curBoxMapIdex++,this.getNextBox()},t.prototype.isHasBoom=function(){if(this.isConnectEnemy())for(var t in FightingModule.bulletLayerSubObj)return!0;else for(var t in FightingModule.bulletLayerSubObj){var e=FightingModule.bulletLayerSubObj[t];if(e.owner.roleId==this.aiObj.roleId)return!0}return!1},t.prototype.getSafePath=function(){var t=null,e=100;if(CommonTools.printMap(this.workMap),this.isConnectEnemy())for(var i in this.workMap){var o=this.workMap[i],n=!0;for(var s in FightingModule.bulletLayerSubObj){var a=FightingModule.bulletLayerSubObj[s];if(a.getColumn()==o[0]||a.getRow()==o[1]){n=!1;break}}if(n){var l=this.getPath(o[0],o[1]);l.length>0&&l.length<e&&(e=l.length,t=o)}}else for(var i in this.workMap){var o=this.workMap[i],n=!0;for(var s in FightingModule.bulletLayerSubObj){var a=FightingModule.bulletLayerSubObj[s];if(a.owner.roleId==this.aiObj.roleId&&(a.getColumn()==o[0]||a.getRow()==o[1])){n=!1;break}}if(n){var l=this.getPath(o[0],o[1]);l.length>0&&l.length<e&&(e=l.length,t=o,CommonTools.logAI("getSafePath----miniLenChoose-----------------"+t))}}if(null!=t)return t;this.isSameCR=!0,e=0;for(var i in this.workMap){var o=this.workMap[i],l=this.getPath(o[0],o[1]);l.length>e&&(e=l.length,t=o,CommonTools.logAI("getSafePath--22--miniLenChoose-----------------"+t))}return null!=t?t:null},t.prototype.getPath=function(t,e){var i=this.grid.clone();
return this.finder.findPath(this.aiObj.getColumn(),this.aiObj.getRow(),t,e,i)},t.prototype.startAI=function(){this.iOpenState=!0,this.isConnectEnemy()||(CommonTools.logAI("----------------***开局"),this.moveNext())},t.prototype.stopAI=function(){this.iOpenState=!1},t.prototype.isConnectEnemy=function(){var t=this.getPath(this.getOtherPlayer().getColumn(),this.getOtherPlayer().getRow());return 0==t.length?!1:!0},t.prototype.setWalkAble=function(t,e,i){this.grid.setWalkableAt(t,e,i)},t.prototype.getOtherPlayer=function(){for(var t in FightingModule.playerLayerSubObj){var e=FightingModule.playerLayerSubObj[t];if(e.roleId!=this.aiObj.roleId&&0==e.isAI)return e}return null},t.prototype.move=function(t,e){var i=this.aiObj;null==this.aiObj.func&&(this.aiObj.func=function(t){i.setMoving(!0),i.move(-1,!0)},this.aiObj.addEventListener(egret.Event.ENTER_FRAME,this.aiObj.func,this.aiObj)),this.aiObj.setMoving(!0),this.aiObj.moveDetail(t,e)},t}();__reflect(AIUtil3.prototype,"AIUtil3");var Fight;!function(t){var e=function(t){function e(e){var i=t.call(this)||this;return i.whichSide=0,i.sideDes="",i.owner=null,i.effDic={},i.curLen=1,i.nextDic={},i.leftShowLimit=100,i.rightShowLimit=100,i.upShowLimit=100,i.downShowLimit=100,i.preBobo=null,i.bulletLen=1,i.hitMap={},i.whichSide=e.side,1==i.whichSide?i.sideDes="paopao":i.sideDes="paopao",i.bodyAni=CommonTools.getAnimDraw(RES.getRes(i.sideDes+"_json"),RES.getRes(i.sideDes+"_png"),"0"),1==ConstValue.P_FIGHT_OBJ.APP_MODE?(i.bodyAni.scaleX=1.4,i.bodyAni.scaleY=1.4,i.bodyAni.x+=2,i.bodyAni.y-=5):(i.scaleX=.7,i.scaleY=.7,i.bodyAni.scaleX=1.6,i.bodyAni.scaleY=1.6,i.bodyAni.x-=12,i.bodyAni.y-=15),i.addChild(i.bodyAni),i.x=e.x,i.y=e.y,i.name=e.name,i.curIdx=e.curIdx,i.bodyAni.play(-1),i}return __extends(e,t),e.prototype.setOwner=function(t){this.owner=t,this.bulletLen=this.owner.bulletLen},e.prototype.baozha=function(){FightingModule.Delay(3e3,function(){this.drawBaozha();for(var t in this.hitMap){var e=this.hitMap[t],i=0;if(1==this.owner.isAI&&(i=this.owner.roleId),this.owner.isMainPlayer||1==this.owner.isAI){var o=CommonTools.getDataJsonStr("syncBoomZhuan",1,{paopaoID:this.name,x:this.x,y:this.y,idx:this.curIdx,breakidx:e.getCurIdx(),playerID:i});ConstValue.P_NET_OBJ.sendData2(o)}}for(var t in FightingModule.bulletLayerSubObj){var e=FightingModule.bulletLayerSubObj[t],n=e.getPreBobo();if(null!=n)for(var s in n)s==this.name&&e.beBaozha()}},this)},e.prototype.beBaozha=function(){this.drawBaozha();for(var t in this.hitMap){var e=this.hitMap[t],i=0;if(1==this.owner.isAI&&(i=this.owner.roleId),this.owner.isMainPlayer||1==this.owner.isAI){var o=CommonTools.getDataJsonStr("syncBoomZhuan",1,{paopaoID:this.name,x:this.x,y:this.y,idx:this.curIdx,breakidx:e.getCurIdx(),playerID:i});ConstValue.P_NET_OBJ.sendData2(o)}}},e.prototype.setLeftLimit=function(t){this.leftShowLimit=t},e.prototype.setRightLimit=function(t){this.rightShowLimit=t},e.prototype.setDownLimit=function(t){this.downShowLimit=t},e.prototype.setUpLimit=function(t){this.upShowLimit=t},e.prototype.getLeftLimit=function(){return this.leftShowLimit},e.prototype.getRightLimit=function(){return this.rightShowLimit},e.prototype.getDownLimit=function(){return this.downShowLimit},e.prototype.getUpLimit=function(){return this.upShowLimit},e.prototype.getCurIdx=function(){return this.curIdx},e.prototype.checkHit=function(t,e,i){try{var o=0;1==this.owner.isAI&&(o=this.owner.roleId);for(var n in FightingModule.playerLayerSubObj){var s=FightingModule.playerLayerSubObj[n];if(CommonTools.logDebug("checkHit===========0============"+s.roleId+" len:"+i+" bul_row:"+this.row+" bul_column:"+this.column+" obj_row:"+s.getRow()+" obj_column:"+s.getColumn()+" director:"+e),"zhong"==e){if(FightingModule.groundLayerSubObjDanger[this.column+"_"+this.row].dangerCount++,FightingModule.groundLayerSubObjDanger[this.column+"_"+this.row].dangerPaoPaoObj=this,s.getRow()==this.row&&s.getColumn()==this.column){CommonTools.logDebug("checkHit===========1============"+s.roleId);var a=CommonTools.getDataJsonStr("syncBoomPlayer",1,{paopaoID:this.name,x:this.x,y:this.y,idx:this.curIdx,killrid:s.roleId,killidx:parseInt(s.curMapIdx),playerID:o});return ConstValue.P_NET_OBJ.sendData2(a),!0}}else if("up"==e){if(this.bulletLen!=this.curLen&&(FightingModule.groundLayerSubObjDanger[this.column+"_"+(this.row-i)].dangerCount++,FightingModule.groundLayerSubObjDanger[this.column+"_"+(this.row-i)].dangerPaoPaoObj=this),s.getColumn()==this.column&&this.row-i==s.getRow()){CommonTools.logDebug("checkHit===========2============"+s.roleId);var a=CommonTools.getDataJsonStr("syncBoomPlayer",1,{paopaoID:this.name,x:this.x,y:this.y,idx:this.curIdx,killrid:s.roleId,killidx:parseInt(s.curMapIdx),playerID:o});return ConstValue.P_NET_OBJ.sendData2(a),!0}}else if("down"==e){if(this.bulletLen!=this.curLen&&(FightingModule.groundLayerSubObjDanger[this.column+"_"+(this.row+i)].dangerCount++,FightingModule.groundLayerSubObjDanger[this.column+"_"+(this.row+i)].dangerPaoPaoObj=this),s.getColumn()==this.column&&this.row+i==s.getRow()){CommonTools.logDebug("checkHit===========3============"+s.roleId);var a=CommonTools.getDataJsonStr("syncBoomPlayer",1,{paopaoID:this.name,x:this.x,y:this.y,idx:this.curIdx,killrid:s.roleId,killidx:parseInt(s.curMapIdx),playerID:o});return ConstValue.P_NET_OBJ.sendData2(a),!0}}else if("left"==e){if(this.bulletLen!=this.curLen&&(FightingModule.groundLayerSubObjDanger[this.column-i+"_"+this.row].dangerCount++,FightingModule.groundLayerSubObjDanger[this.column-i+"_"+this.row].dangerPaoPaoObj=this),s.getRow()==this.row&&this.column-i==s.getColumn()){CommonTools.logDebug("checkHit===========4============"+s.roleId);var a=CommonTools.getDataJsonStr("syncBoomPlayer",1,{paopaoID:this.name,x:this.x,y:this.y,idx:this.curIdx,killrid:s.roleId,killidx:parseInt(s.curMapIdx),playerID:o});return ConstValue.P_NET_OBJ.sendData2(a),!0}}else if("right"==e&&(this.bulletLen!=this.curLen&&(FightingModule.groundLayerSubObjDanger[this.column+i+"_"+this.row].dangerCount++,FightingModule.groundLayerSubObjDanger[this.column+i+"_"+this.row].dangerPaoPaoObj=this),s.getRow()==this.row&&this.column+i==s.getColumn())){CommonTools.logDebug("checkHit===========5============"+s.roleId);var a=CommonTools.getDataJsonStr("syncBoomPlayer",1,{paopaoID:this.name,x:this.x,y:this.y,idx:this.curIdx,killrid:s.roleId,killidx:parseInt(s.curMapIdx),playerID:o});return ConstValue.P_NET_OBJ.sendData2(a),!0}}}catch(l){CommonTools.logError("checkHit==================error "+l)}return!1},e.prototype.drawBaozha=function(){try{CommonAudioHandle.playEffect("boom_mp3",1),this.removeChild(this.bodyAni),this.bodyAni=null,1==this.bulletLen?(this.effDic.zhong_1=CommonTools.getAnimDraw(RES.getRes("baozha_zhong_anim_json"),RES.getRes("baozha_zhong_anim_png"),"0"),this.addChild(this.effDic.zhong_1),this.effDic.zhong_1.play(-1),this.checkHit(this.effDic.zhong_1,"zhong",this.curLen),this.effDic.up_1=CommonTools.getAnimDraw(RES.getRes("baozha_last_anim_json"),RES.getRes("baozha_last_anim_png"),"0"),this.addChild(this.effDic.up_1),this.effDic.up_1.play(1),this.curLen>=this.upShowLimit&&(this.effDic.up_1.visible=!1),this.effDic.up_1.visible&&this.checkHit(this.effDic.up_1,"up",this.curLen),this.effDic.down_1=CommonTools.getAnimDraw(RES.getRes("baozha_last_anim_json"),RES.getRes("baozha_last_anim_png"),"0"),this.addChild(this.effDic.down_1),this.effDic.down_1.play(1),this.effDic.down_1.scaleY="-1",this.curLen>=this.downShowLimit&&(this.effDic.down_1.visible=!1),this.effDic.down_1.visible&&this.checkHit(this.effDic.down_1,"down",this.curLen),this.effDic.right_1=CommonTools.getAnimDraw(RES.getRes("baozha_last_anim_json"),RES.getRes("baozha_last_anim_png"),"0"),this.addChild(this.effDic.right_1),this.effDic.right_1.play(1),this.effDic.right_1.rotation=90,this.curLen>=this.rightShowLimit&&(this.effDic.right_1.visible=!1),this.effDic.right_1.visible&&this.checkHit(this.effDic.right_1,"right",this.curLen),this.effDic.left_1=CommonTools.getAnimDraw(RES.getRes("baozha_last_anim_json"),RES.getRes("baozha_last_anim_png"),"0"),this.addChild(this.effDic.left_1),this.effDic.left_1.play(1),this.effDic.left_1.rotation=-90,this.curLen>=this.leftShowLimit&&(this.effDic.left_1.visible=!1),this.effDic.left_1.visible&&this.checkHit(this.effDic.left_1,"left",this.curLen),1==ConstValue.P_FIGHT_OBJ.APP_MODE?(this.effDic.zhong_1.y+=28,this.effDic.up_1.y-=55,this.effDic.left_1.x-=70,this.effDic.left_1.y+=15,this.effDic.right_1.x+=70,this.effDic.right_1.y+=15,this.effDic.down_1.y+=82):(this.effDic.zhong_1.x-=12,this.effDic.zhong_1.y+=10,this.effDic.up_1.x-=10,this.effDic.up_1.y-=45,this.effDic.left_1.x-=70,this.effDic.left_1.y+=0,this.effDic.right_1.x+=58,this.effDic.right_1.y+=0,this.effDic.down_1.x-=13,this.effDic.down_1.y+=68),this.effDic.up_1.once(egret.Event.COMPLETE,function(t){this.effDic.up_1.visible&&(FightingModule.groundLayerSubObjDanger[this.column+"_"+(this.row-1)].dangerCount=0),this.removeChild(this.effDic.up_1),this.effDic.up_1=null,delete this.effDic.up_1},this),this.effDic.down_1.once(egret.Event.COMPLETE,function(t){this.effDic.down_1.visible&&(FightingModule.groundLayerSubObjDanger[this.column+"_"+(this.row+1)].dangerCount=0),this.removeChild(this.effDic.down_1),this.effDic.down_1=null,delete this.effDic.down_1},this),this.effDic.right_1.once(egret.Event.COMPLETE,function(t){this.effDic.right_1.visible&&(FightingModule.groundLayerSubObjDanger[this.column+1+"_"+this.row].dangerCount=0),this.removeChild(this.effDic.right_1),this.effDic.right_1=null,delete this.effDic.right_1},this),this.effDic.left_1.once(egret.Event.COMPLETE,function(t){this.effDic.left_1.visible&&(FightingModule.groundLayerSubObjDanger[this.column-1+"_"+this.row].dangerCount=0),this.removeChild(this.effDic.left_1),this.effDic.left_1=null,delete this.effDic.left_1,this.effDic.zhong_1.visible&&(FightingModule.groundLayerSubObjDanger[this.column+"_"+this.row].dangerCount=0),this.removeChild(this.effDic.zhong_1),this.effDic.zhong_1=null,delete this.effDic.zhong_1,null!=FightingModule.bulletLayerSubObj[this.name]&&(FightingModule.bulletLayer.removeChild(this),FightingModule.bulletLayerSubObj[this.name]=null,delete FightingModule.bulletLayerSubObj[this.name])},this)):(this.effDic["zhong_"+this.bulletLen]=CommonTools.getAnimDraw(RES.getRes("baozha_zhong_anim_json"),RES.getRes("baozha_zhong_anim_png"),"0"),this.addChild(this.effDic["zhong_"+this.bulletLen]),this.effDic["zhong_"+this.bulletLen].play(-1),1==ConstValue.P_FIGHT_OBJ.APP_MODE?this.effDic["zhong_"+this.bulletLen].y+=22:(this.effDic["zhong_"+this.bulletLen].x-=15,this.effDic["zhong_"+this.bulletLen].y+=6),this.checkHit(this.effDic["zhong_"+this.bulletLen],"zhong",this.curLen),this.addNext(this.effDic["zhong_"+this.bulletLen].x,this.effDic["zhong_"+this.bulletLen].y))}catch(t){CommonTools.logError("drawBaozha==================error "+t)}},e.prototype.addNext=function(t,e){FightingModule.Delay(20,function(){this.nextDic["up_"+this.curLen]=new eui.Image(RES.getRes("baozha_jie_png")),this.addChild(this.nextDic["up_"+this.curLen]),this.nextDic["up_"+this.curLen].x=t-47,this.nextDic["up_"+this.curLen].y=e-180-80*(this.curLen-1),CommonTools.logDebug("drawBaozha-------------this.curLen:"+this.curLen+" this.upShowLimit:"+this.upShowLimit),this.curLen>=this.upShowLimit&&(this.nextDic["up_"+this.curLen].visible=!1),this.nextDic["up_"+this.curLen].visible&&this.checkHit(this.nextDic["up_"+this.curLen],"up",this.curLen),this.nextDic["down_"+this.curLen]=new eui.Image(RES.getRes("baozha_jie_png")),this.addChild(this.nextDic["down_"+this.curLen]),this.nextDic["down_"+this.curLen].y=e+160+80*(this.curLen-1),this.nextDic["down_"+this.curLen].scaleY="-1",this.curLen>=this.downShowLimit&&(this.nextDic["down_"+this.curLen].visible=!1),this.nextDic["down_"+this.curLen].visible&&this.checkHit(this.nextDic["down_"+this.curLen],"down",this.curLen),1==ConstValue.P_FIGHT_OBJ.APP_MODE?this.nextDic["down_"+this.curLen].x=t-47:this.nextDic["down_"+this.curLen].x=t-44,this.nextDic["right_"+this.curLen]=new eui.Image(RES.getRes("baozha_jie_png")),this.addChild(this.nextDic["right_"+this.curLen]),this.nextDic["right_"+this.curLen].x=t+169+80*(this.curLen-1),this.nextDic["right_"+this.curLen].y=e-62,this.nextDic["right_"+this.curLen].rotation=90,this.curLen>=this.rightShowLimit&&(this.nextDic["right_"+this.curLen].visible=!1),this.nextDic["right_"+this.curLen].visible&&this.checkHit(this.nextDic["right_"+this.curLen],"right",this.curLen),this.nextDic["left_"+this.curLen]=new eui.Image(RES.getRes("baozha_jie_png")),this.addChild(this.nextDic["left_"+this.curLen]),this.nextDic["left_"+this.curLen].x=t-169-80*(this.curLen-1),this.nextDic["left_"+this.curLen].y=e-62,this.nextDic["left_"+this.curLen].rotation=90,this.nextDic["left_"+this.curLen].scaleY="-1",CommonTools.logDebug("drawBaozha-------------this.curLen:"+this.curLen+" this.leftShowLimit:"+this.leftShowLimit),this.curLen>=this.leftShowLimit&&(this.nextDic["left_"+this.curLen].visible=!1),this.nextDic["left_"+this.curLen].visible&&this.checkHit(this.nextDic["left_"+this.curLen],"left",this.curLen),this.curLen++,this.bulletLen==this.curLen?(this.baozhaLastEff(this.nextDic["up_"+(this.curLen-1)].x,this.nextDic["up_"+(this.curLen-1)].y,1),this.baozhaLastEff(this.nextDic["down_"+(this.curLen-1)].x,this.nextDic["down_"+(this.curLen-1)].y,2),this.baozhaLastEff(this.nextDic["right_"+(this.curLen-1)].x,this.nextDic["right_"+(this.curLen-1)].y,3),this.baozhaLastEff(this.nextDic["left_"+(this.curLen-1)].x,this.nextDic["left_"+(this.curLen-1)].y,4)):this.addNext(t,e)},this)},e.prototype.removePre=function(t){FightingModule.Delay(20,function(){try{0==t?(this.effDic["zhong_"+this.bulletLen].visible&&(FightingModule.groundLayerSubObjDanger[this.column+"_"+this.row].dangerCount=0),this.removeChild(this.effDic["zhong_"+this.bulletLen]),this.effDic["zhong_"+this.bulletLen]=null,delete this.effDic["zhong_"+this.bulletLen],null!=FightingModule.bulletLayerSubObj[this.name]&&(FightingModule.bulletLayer.removeChild(this),FightingModule.bulletLayerSubObj[this.name]=null,delete FightingModule.bulletLayerSubObj[this.name])):(this.nextDic["up_"+t].visible&&(FightingModule.groundLayerSubObjDanger[this.column+"_"+(this.row-t)].dangerCount=0),this.removeChild(this.nextDic["up_"+t]),this.nextDic["up_"+t]=null,delete this.nextDic["up_"+t],this.nextDic["down_"+t].visible&&(FightingModule.groundLayerSubObjDanger[this.column+"_"+(this.row+t)].dangerCount=0),this.removeChild(this.nextDic["down_"+t]),this.nextDic["down_"+t]=null,delete this.nextDic["down_"+t],this.nextDic["right_"+t].visible&&(FightingModule.groundLayerSubObjDanger[this.column+t+"_"+this.row].dangerCount=0),this.removeChild(this.nextDic["right_"+t]),this.nextDic["right_"+t]=null,delete this.nextDic["right_"+t],this.nextDic["left_"+t].visible&&(FightingModule.groundLayerSubObjDanger[this.column-t+"_"+this.row].dangerCount=0),this.removeChild(this.nextDic["left_"+t]),this.nextDic["left_"+t]=null,delete this.nextDic["left_"+t],this.removePre(t-1))}catch(e){CommonTools.logError("removePre==================error "+e)}},this)},e.prototype.baozhaLastEff=function(t,e,i){try{1==i?(this.effDic.up_1=CommonTools.getAnimDraw(RES.getRes("baozha_last_anim_json"),RES.getRes("baozha_last_anim_png"),"0"),this.addChild(this.effDic.up_1),this.effDic.up_1.play(1),this.effDic.up_1.x=t+48,this.effDic.up_1.y=e+30,this.effDic.up_1.once(egret.Event.COMPLETE,function(t){this.effDic.up_1.visible&&(FightingModule.groundLayerSubObjDanger[this.column+"_"+(this.row-this.curLen)].dangerCount=0),this.removeChild(this.effDic.up_1),this.effDic.up_1=null,delete this.effDic.up_1},this),this.curLen>=this.upShowLimit&&(this.effDic.up_1.visible=!1),this.effDic.up_1.visible&&this.checkHit(this.nextDic.up_1,"up",this.curLen)):2==i?(this.effDic.down_1=CommonTools.getAnimDraw(RES.getRes("baozha_last_anim_json"),RES.getRes("baozha_last_anim_png"),"0"),this.addChild(this.effDic.down_1),this.effDic.down_1.play(1),this.effDic.down_1.x=t+48,this.effDic.down_1.y=e-30,this.effDic.down_1.scaleY="-1",this.effDic.down_1.once(egret.Event.COMPLETE,function(t){this.effDic.down_1.visible&&(FightingModule.groundLayerSubObjDanger[this.column+"_"+(this.row+this.curLen)].dangerCount=0),this.removeChild(this.effDic.down_1),this.effDic.down_1=null,delete this.effDic.down_1},this),this.curLen>=this.downShowLimit&&(this.effDic.down_1.visible=!1),this.effDic.down_1.visible&&this.checkHit(this.nextDic.down_1,"down",this.curLen)):3==i?(this.effDic.right_1=CommonTools.getAnimDraw(RES.getRes("baozha_last_anim_json"),RES.getRes("baozha_last_anim_png"),"0"),this.addChild(this.effDic.right_1),this.effDic.right_1.play(1),this.effDic.right_1.x=t-25,this.effDic.right_1.y=e+47,this.effDic.right_1.rotation=90,this.effDic.right_1.once(egret.Event.COMPLETE,function(t){this.effDic.right_1.visible&&(FightingModule.groundLayerSubObjDanger[this.column+this.curLen+"_"+this.row].dangerCount=0),this.removeChild(this.effDic.right_1),this.effDic.right_1=null,delete this.effDic.right_1},this),this.curLen>=this.rightShowLimit&&(this.effDic.right_1.visible=!1),this.effDic.right_1.visible&&this.checkHit(this.nextDic.right_1,"right",this.curLen)):4==i&&(this.effDic.left_1=CommonTools.getAnimDraw(RES.getRes("baozha_last_anim_json"),RES.getRes("baozha_last_anim_png"),"0"),this.addChild(this.effDic.left_1),this.effDic.left_1.play(1),this.effDic.left_1.x=t+35,this.effDic.left_1.y=e+47,this.effDic.left_1.rotation=90,this.effDic.left_1.scaleY="-1",this.effDic.left_1.once(egret.Event.COMPLETE,function(t){this.effDic.left_1.visible&&(FightingModule.groundLayerSubObjDanger[this.column-this.curLen+"_"+this.row].dangerCount=0),this.removeChild(this.effDic.left_1),this.effDic.left_1=null,delete this.effDic.left_1,this.removePre(this.bulletLen-1)},this),this.curLen>=this.leftShowLimit&&(this.effDic.left_1.visible=!1),this.effDic.left_1.visible&&this.checkHit(this.nextDic.left_1,"left",this.curLen))}catch(o){CommonTools.logError("baozhaLastEff==================error "+o)}},e.prototype.setRow=function(t){this.row=t},e.prototype.getRow=function(){return this.row},e.prototype.setColumn=function(t){this.column=t},e.prototype.getColumn=function(){return this.column},e.prototype.setPreBobo=function(t){null==this.preBobo&&(this.preBobo={}),this.preBobo[t]=1},e.prototype.getPreBobo=function(){return this.preBobo},e}(egret.DisplayObjectContainer);t.Bullet=e,__reflect(e.prototype,"Fight.Bullet")}(Fight||(Fight={}));var Fight;!function(t){var e=function(t){function e(e){var i=t.call(this)||this;return i.subType=0,i.itemRange=[0,0,0,0],i.isPlayer=0,i.groundEmpty=!1,i.dangerCount=0,i.dangerPaoPaoObj=null,i.showImg=new eui.Image(e.img),i.x=e.x,i.y=e.y,i.name=e.name,i.curIdx=e.curIdx,i.addChild(i.showImg),i}return __extends(e,t),e.prototype.checkRange=function(t,e,i,o,n){if(t>=this.itemRange[0]&&t<this.itemRange[1]&&e>=this.itemRange[2]&&e<this.itemRange[3])if(1==o){this.removeChild(this.showImg);var s=i;if(2==n)s="diy_add_big_item_png",this.groundEmpty=!0;else{this.groundEmpty=!1;var a=s.split("_");this.res=parseInt(a[1])}this.showImg=new eui.Image(s),this.addChild(this.showImg)}else{if(this.sub&&(this.removeChild(this.sub),this.sub=null,this.subType=0,this.isPlayer>0&&(119==this.isPlayer?MapDIYModule.ONE_P="":MapDIYModule.TWO_P="",this.isPlayer=0)),2==n)return;var s=i;if(3==n&&""!=MapDIYModule.ONE_P)return;if(4==n&&""!=MapDIYModule.TWO_P)return;if(3==n&&(MapDIYModule.ONE_P=this.name,this.isPlayer=119,s="diy_1p_png"),4==n&&(MapDIYModule.TWO_P=this.name,this.isPlayer=120,s="diy_2p_png"),this.isPlayer>0)this.resSub=this.isPlayer;else{var a=s.split("_");this.resSub=parseInt(a[1])}this.sub=new eui.Image(s),this.subType=o,this.addChild(this.sub),this.sub.y-=38,this.isPlayer>0&&(this.sub.y-=38)}},e.prototype.checkRange2=function(t,e,i){if(CommonTools.log("------curIdx:"+this.curIdx+" column:"+this.column+" row:"+this.row),1==e){this.removeChild(this.showImg);var o=t;if(2==i)o="diy_add_big_item_png",this.groundEmpty=!0;else{this.groundEmpty=!1;var n=o.split("_");this.res=parseInt(n[1])}this.showImg=new eui.Image(o),this.addChild(this.showImg)}else{if(this.sub&&(this.removeChild(this.sub),this.sub=null,this.subType=0,this.isPlayer>0&&(119==this.isPlayer?MapDIYModule.ONE_P="":MapDIYModule.TWO_P="",this.isPlayer=0)),2==i)return;var o=t;if(3==i&&""!=MapDIYModule.ONE_P)return;if(4==i&&""!=MapDIYModule.TWO_P)return;if(3==i&&(MapDIYModule.ONE_P=this.name,this.isPlayer=119,o="diy_1p_png"),4==i&&(MapDIYModule.TWO_P=this.name,this.isPlayer=120,o="diy_2p_png"),this.isPlayer>0)this.resSub=this.isPlayer;else{var n=o.split("_");this.resSub=parseInt(n[1])}this.sub=new eui.Image(o),this.subType=e,this.addChild(this.sub),this.sub.y-=38,this.isPlayer>0&&(this.sub.y-=38)}},e.prototype.addMiniBlock=function(t){this.sub=new eui.Image(t),this.addChild(this.sub),this.sub.y-=38},e.prototype.addMiniPlayer=function(t){var e="";e=119==t?"diy_1p_png":"diy_2p_png",this.sub=new eui.Image(e),this.addChild(this.sub),this.sub.y-=76},e.prototype.viewSub=function(t){if(this.sub)if(t){var e=this.sub.source,i=this.sub.x,o=this.sub.y;this.removeChild(this.sub),this.sub=new eui.Image(e),this.sub.x=i,this.sub.y=o,this.addChild(this.sub)}else this.sub.visible=!1},e.prototype.setRow=function(t){this.row=t},e.prototype.getRow=function(){return this.row},e.prototype.setColumn=function(t){this.column=t},e.prototype.getColumn=function(){return this.column},e.prototype.setType=function(t){this.type=t},e.prototype.getType=function(){return this.type},e.prototype.getCurIdx=function(){return this.curIdx},e.prototype.getSubType=function(){return this.subType},e.prototype.setRes=function(t){this.res=t},e.prototype.addSub=function(t,e){this.sub=t,this.subType=e,this.addChild(this.sub),this.sub.x+=8,this.sub.y+=8,this.sub.scaleX=1.2,this.sub.scaleY=1.2,this.notifyToAI()},e.prototype.notifyToAI=function(){for(var t in FightingModule.aiSubObj){var e=FightingModule.aiSubObj[t];e.beNotifyHasFood(this.column,this.row)}},e.prototype.clearSub=function(){null!=this.sub&&(this.removeChild(this.sub),this.sub=null,this.subType=0)},e}(egret.DisplayObjectContainer);t.MapItem=e,__reflect(e.prototype,"Fight.MapItem")}(Fight||(Fight={}));var Fight;!function(t){var e=function(e){function i(t){var i=e.call(this)||this;i.xDis=3,i.yDis=3,i.uTime=100,i.whichSide=0,i.sideDes="",i.bulletLen=4,i.life=1,i.speed=1,i.isMainPlayer=!1,i.isMoving=!1,i.curDirect=-1,i.row=-1,i.column=-1,i.keyDir=-1,i.keyBoom=-1,i.aiRobot=!1,i.endX=-1,i.endY=-1,i.fixAIX=0,i.fixAIY=0,i.isAI=0,i.markLeft=0,i.markRight=0,i.death=!1,i.iClass=1,i.isStatic=!1;var o=t.pObj;return i.roleId=o.uid,i.roleId==ConstValue.cacheUserInfo.id&&(i.isMainPlayer=!0),i.life=o.life,i.speed=o.speed,i.bulletLen=o.power,i.iClass=o.iClass,i.whichSide=t.side,i.bodyName=new eui.Label(o.name),1==i.whichSide?(i.sideDes="p"+i.iClass,i.bodyName.textColor=16710910,i.bodyName.stroke=4,i.bodyName.strokeColor=1603060):(i.sideDes="p"+i.iClass,i.bodyName.textColor=16710910,i.bodyName.stroke=4,i.bodyName.strokeColor=15877656),i.bodyName.texAlign="center",i.bodyAniUp=CommonTools.getAnimDraw(RES.getRes(i.sideDes+"_03_json"),RES.getRes(i.sideDes+"_03_png"),"0"),i.bodyAniDown=CommonTools.getAnimDraw(RES.getRes(i.sideDes+"_01_json"),RES.getRes(i.sideDes+"_01_png"),"0"),i.bodyAniLeft=CommonTools.getAnimDraw(RES.getRes(i.sideDes+"_02_json"),RES.getRes(i.sideDes+"_02_png"),"0"),i.bodyAniRight=CommonTools.getAnimDraw(RES.getRes(i.sideDes+"_04_json"),RES.getRes(i.sideDes+"_04_png"),"0"),i.bodyAniUpStatic=CommonTools.getAnimDraw(RES.getRes(i.sideDes+"_static_03_json"),RES.getRes(i.sideDes+"_static_03_png"),"0"),i.bodyAniDownStatic=CommonTools.getAnimDraw(RES.getRes(i.sideDes+"_static_json"),RES.getRes(i.sideDes+"_static_png"),"0"),i.bodyAniLeftStatic=CommonTools.getAnimDraw(RES.getRes(i.sideDes+"_static_02_json"),RES.getRes(i.sideDes+"_static_02_png"),"0"),i.bodyAniRightStatic=CommonTools.getAnimDraw(RES.getRes(i.sideDes+"_static_04_json"),RES.getRes(i.sideDes+"_static_04_png"),"0"),i.bodyAni=i.bodyAniDownStatic,i.addChild(i.bodyAni),i.bodyName.x-=55,i.bodyName.y-=128,i.addChild(i.bodyName),i.x=t.x,i.y=t.y,i.name=t.name,i.bodyAni.play(-1),i.isAI=t.isAI,2==ConstValue.P_FIGHT_OBJ.APP_MODE&&(i.xDis=1.5,i.yDis=1.5),i}return __extends(i,e),i.prototype.setMoving=function(t){if(this.isMoving=t,!this.isMoving){switch(this.isStatic=!0,null!=this.bodyAni&&(this.removeChild(this.bodyAni),this.bodyAni=null),this.curDirect){case 0:null==this.bodyAni&&(this.bodyAni=this.bodyAniUpStatic,this.bodyAni.play(-1));break;case 1:null==this.bodyAni&&(this.bodyAni=this.bodyAniRightStatic,this.bodyAni.play(-1));break;case 2:null==this.bodyAni&&(this.bodyAni=this.bodyAniDownStatic,this.bodyAni.play(-1));break;case 3:null==this.bodyAni&&(this.bodyAni=this.bodyAniLeftStatic,this.bodyAni.play(-1))}this.addChild(this.bodyAni)}},i.prototype.moveDetail=function(t,e){return this.endX=t,this.endY=e,CommonTools.logAI("--moveDetail--------------this.column:"+this.column+" this.row:"+this.row+" endX:"+t+" endY:"+e),this.column==t?e>=this.row?void this.move(2,!1):void this.move(0,!1):this.row==e?t>=this.column?void this.move(1,!1):void this.move(3,!1):void 0},i.prototype.findOwnAi=function(){for(var t in FightingModule.aiSubObj){var e=FightingModule.aiSubObj[t];if(e.aiObj.roleId==this.roleId)return e}return null},i.prototype.move=function(t,e){try{if(CommonTools.logDebug(this.isMoving+"-"+t+"-"+this.curDirect),!this.isMoving)return;CommonTools.logAI("this.speed--move----"+this.speed),this.speed>6&&(this.speed=6),1==this.speed&&(this.speed=2),2==this.speed&&(this.speed=2.5);var i=this.xDis+1.2*this.speed,o=this.yDis+1.2*this.speed;if(-1==t&&(t=-1==this.curDirect?1:this.curDirect),this.aiRobot&&this.column==this.endX&&this.row==this.endY)if(0==t||2==t){if(!(this.fixAIY<=50))return this.setMoving(!1),this.removeEventListener(egret.Event.ENTER_FRAME,this.func,this),this.func=null,this.keyDir=-1,this.fixAIY=0,CommonTools.logAI("move------11111111111111111111111111111"),void this.findOwnAi().moveNext();this.fixAIY+=o}else if(1==t||3==t){if(!(this.fixAIX<=50))return this.setMoving(!1),this.removeEventListener(egret.Event.ENTER_FRAME,this.func,this),this.func=null,this.keyDir=-1,this.fixAIX=0,CommonTools.logAI("move------2222222222222222222222222222222"),void this.findOwnAi().moveNext();this.fixAIX+=i}if(t!=this.curDirect||this.isStatic){switch(this.isStatic=!1,null!=this.bodyAni&&(this.removeChild(this.bodyAni),this.bodyAni=null),this.curDirect=t,t){case 0:null==this.bodyAni&&(this.bodyAni=this.bodyAniUp,this.bodyAni.play(-1));break;case 1:null==this.bodyAni&&(this.bodyAni=this.bodyAniRight,this.bodyAni.play(-1));break;case 2:null==this.bodyAni&&(this.bodyAni=this.bodyAniDown,this.bodyAni.play(-1));break;case 3:null==this.bodyAni&&(this.bodyAni=this.bodyAniLeft,this.bodyAni.play(-1))}this.addChild(this.bodyAni)}if(3==t){if(this.x<=FightingModule.mapLeftLimit)return;for(var n in FightingModule.mapLayerSubObj){var s=FightingModule.mapLayerSubObj[n];if(s.getRow()==this.row&&s.getColumn()+1==this.column&&this.x-18<=s.x+s.width){i=0;break}}for(var n in FightingModule.bulletLayerSubObj){var s=FightingModule.groundLayerSubObj[FightingModule.bulletLayerSubObj[n].getCurIdx()];if(s.getRow()==this.row&&s.getColumn()+1==this.column&&this.x-38<=s.x+s.width){i=0;break}}}else if(0==t){if(this.y<=FightingModule.mapUpLimit)return;for(var n in FightingModule.mapLayerSubObj){var s=FightingModule.mapLayerSubObj[n];if(s.getColumn()==this.column&&s.getRow()+1==this.row&&this.y<=s.y+s.height){o=0;break}}for(var n in FightingModule.bulletLayerSubObj){var s=FightingModule.groundLayerSubObj[FightingModule.bulletLayerSubObj[n].getCurIdx()];if(s.getColumn()==this.column&&s.getRow()+1==this.row&&this.y-20<=s.y+s.height){o=0;break}}}else if(2==t){if(this.y>=FightingModule.mapDownLimit)return;for(var n in FightingModule.mapLayerSubObj){var s=FightingModule.mapLayerSubObj[n];if(s.getColumn()==this.column&&s.getRow()-1==this.row&&this.y+20>=s.y){o=0;break}}for(var n in FightingModule.bulletLayerSubObj){var s=FightingModule.groundLayerSubObj[FightingModule.bulletLayerSubObj[n].getCurIdx()];if(s.getColumn()==this.column&&s.getRow()-1==this.row&&this.y+78>=s.y){o=0;break}}}else if(1==t){if(this.x>=FightingModule.mapRightLimit)return;for(var n in FightingModule.mapLayerSubObj){var s=FightingModule.mapLayerSubObj[n];if(s.getRow()==this.row&&s.getColumn()-1==this.column&&this.x+38>=s.x){i=0;break}}for(var n in FightingModule.bulletLayerSubObj){var s=FightingModule.groundLayerSubObj[FightingModule.bulletLayerSubObj[n].getCurIdx()];if(s.getRow()==this.row&&s.getColumn()-1==this.column&&this.x+38>=s.x){i=0;break}}}if(t==this.curDirect&&!e)return;switch(t){case 0:null==this.bodyAni&&(this.bodyAni=this.bodyAniUp,this.bodyAni.play(-1)),this.y=this.y-o;break;case 1:null==this.bodyAni&&(this.bodyAni=this.bodyAniRight,this.bodyAni.play(-1)),this.x=this.x+i;break;case 2:null==this.bodyAni&&(this.bodyAni=this.bodyAniDown,this.bodyAni.play(-1)),this.y=this.y+o;break;case 3:null==this.bodyAni&&(this.bodyAni=this.bodyAniLeft,this.bodyAni.play(-1)),this.x=this.x-i}if(this.addChild(this.bodyAni),this.markPosition(t),this.isMainPlayer&&!FightingModule.aiPVE){var a=CommonTools.getDataJsonStr("syncPos",1,{x:this.x,y:this.y,direction:this.curDirect,speed:this.speed,idx:parseInt(this.curMapIdx),playerID:0});ConstValue.P_NET_OBJ.sendData2(a)}}catch(l){CommonTools.logError("move=====================error===="+l)}},i.prototype.fire=function(e,i){CommonAudioHandle.playEffect("playBomb_mp3",1),this.aiRobot&&2==this.findOwnAi().iCmd&&(this.findOwnAi().iCmd=0),this.markPosition(-1);var o={side:1,x:this.bulletX,y:this.bulletY,name:e,curIdx:i},n=new t.Bullet(o);n.setOwner(this),n.setRow(this.groundObj.getRow()),n.setColumn(this.groundObj.getColumn()),FightingModule.bulletLayer.addChild(n),FightingModule.bulletLayerSubObj[n.name]=n,n.setRightLimit(this.bulletLen+1),n.setLeftLimit(this.bulletLen+1),n.setDownLimit(this.bulletLen+1),n.setUpLimit(this.bulletLen+1);for(var s in FightingModule.mapLayerSubObj){var a=FightingModule.mapLayerSubObj[s.toString()];if(1!=a.getType()){if(a.getRow()==n.getRow()){if(a.getColumn()<n.getColumn()){var l=n.getColumn()-a.getColumn();this.bulletLen>=l&&n.getLeftLimit()>l&&(n.setLeftLimit(l),n.hitMap.leftHitMap=a)}if(a.getColumn()>n.getColumn()){var r=a.getColumn()-n.getColumn();this.bulletLen>=r&&n.getRightLimit()>r&&(n.setRightLimit(r),n.hitMap.rightHitMap=a)}}if(a.getColumn()==n.getColumn()){if(a.getRow()<n.getRow()){var h=n.getRow()-a.getRow();this.bulletLen>=h&&n.getUpLimit()>h&&(n.setUpLimit(h),n.hitMap.upHitMap=a)}if(a.getRow()>n.getRow()){var u=a.getRow()-n.getRow();this.bulletLen>=u&&n.getDownLimit()>u&&(n.setDownLimit(u),n.hitMap.downHitMap=a)}}}}var c=n.getColumn()+1;this.bulletLen>=c&&n.getLeftLimit()>c&&n.setLeftLimit(c);var d=ConstValue.P_FIGHT_OBJ.getInitColumn()-n.getColumn();this.bulletLen>=d&&n.getRightLimit()>d&&n.setRightLimit(d);var g=n.getRow()+1;this.bulletLen>=g&&n.getUpLimit()>g&&n.setUpLimit(g);var m=ConstValue.P_FIGHT_OBJ.getInitRow()-n.getRow();this.bulletLen>=m&&n.getDownLimit()>m&&n.setDownLimit(m);var p=!0;for(var s in FightingModule.bulletLayerSubObj)if(s!=n.name){var _=FightingModule.bulletLayerSubObj[s];if(n.getRow()==_.getRow()&&n.getColumn()==_.getColumn())if(p=!1,null!=_.getPreBobo())for(var C in _.getPreBobo())n.setPreBobo(s);else n.setPreBobo(_.name);else if(n.getRow()==_.getRow()){if(n.getColumn()>_.getColumn()){if(_.getRightLimit()>=n.getColumn()-_.getColumn())if(p=!1,null!=_.getPreBobo())for(var C in _.getPreBobo())n.setPreBobo(s);else n.setPreBobo(_.name)}else if(_.getLeftLimit()>=_.getColumn()-n.getColumn())if(p=!1,null!=_.getPreBobo())for(var C in _.getPreBobo())n.setPreBobo(s);else n.setPreBobo(_.name)}else if(n.getColumn()==_.getColumn())if(_.getRow()>n.getRow()){if(_.getUpLimit()>=_.getRow()-n.getRow())if(null!=_.getPreBobo())for(var C in _.getPreBobo())n.setPreBobo(s);else n.setPreBobo(_.name)}else if(_.getDownLimit()>=n.getRow()-_.getRow())if(null!=_.getPreBobo())for(var C in _.getPreBobo())n.setPreBobo(s);else n.setPreBobo(_.name)}p&&n.baozha(),this.aiRobot&&(CommonTools.logAI("move------3333333333333333333333333333333"),this.findOwnAi().moveNext())
},i.prototype.markPosition=function(t){var e,i=1e4,o=0,n=0,s=null,a=5,l=41;for(var r in FightingModule.groundLayerSubObj){var h=FightingModule.groundLayerSubObj[r],u=new egret.Point(this.x+a,this.y+l),c=h.x+41,d=h.y+41,g=new egret.Point(c,d),m=egret.Point.distance(u,g);i>=m&&(e=r,i=m,o=c,n=d,s=h)}if(this.curMapIdx=e,this.bulletX=o,this.bulletY=n-10,this.groundObj=s,this.row=this.groundObj.getRow(),this.column=this.groundObj.getColumn(),this.groundObj.getSubType()>0){CommonTools.log("吃东西啦》。。。。。。");var p=0;if(1==this.isAI&&(p=this.roleId),this.isMainPlayer||1==this.isAI){var _=CommonTools.getDataJsonStr("pickItem",1,{itype:this.groundObj.getSubType(),idx:parseInt(this.curMapIdx),playerID:p});ConstValue.P_NET_OBJ.sendData2(_)}this.groundObj.clearSub(),this.aiRobot&&3==this.findOwnAi().iCmd&&(this.findOwnAi().iCmd=0,CommonTools.logAI("move------444444444444444444444444444444"),this.findOwnAi().moveNext())}var C=FightingModule.groundLayerSubObjDanger[this.groundObj.getColumn()+"_"+this.groundObj.getRow()];if(C.dangerCount>0&&!this.death){this.death=!0;var p=0;1==this.isAI&&(p=this.roleId);var _=CommonTools.getDataJsonStr("syncBoomPlayer",1,{paopaoID:this.groundObj.dangerPaoPaoObj.name,x:this.groundObj.dangerPaoPaoObj.x,y:this.groundObj.dangerPaoPaoObj.y,idx:this.groundObj.dangerPaoPaoObj.curIdx,killrid:this.roleId,killidx:parseInt(this.curMapIdx),playerID:p});ConstValue.P_NET_OBJ.sendData2(_)}},i.prototype.getRow=function(){return this.row},i.prototype.getColumn=function(){return this.column},i}(egret.DisplayObjectContainer);t.Player=e,__reflect(e.prototype,"Fight.Player")}(Fight||(Fight={}));